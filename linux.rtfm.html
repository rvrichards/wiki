<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script id="versionArea" type="text/javascript">
//<![CDATA[
var version = {title: "TiddlyWiki", major: 2, minor: 6, revision: 1, date: new Date("Aug 18, 2010"), extensions: {}};
//]]>
</script>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="copyright" content="
TiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) UnaMesa Association 2004-2009

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the UnaMesa Association nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS' AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
" />
<!--PRE-HEAD-START-->
<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' />
<!--}}}-->

<!--PRE-HEAD-END-->
<title> Linux Notes - lotsa linux </title>
<style id="styleArea" type="text/css">
#saveTest {display:none;}
#messageArea {display:none;}
#copyright {display:none;}
#storeArea {display:none;}
#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}
#shadowArea {display:none;}
#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}
</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.unload) unload();">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
<div id="copyright">
Welcome to TiddlyWiki created by Jeremy Ruston, Copyright &copy; 2007 UnaMesa Association
</div>
<noscript>
<div id="javascriptWarning">
This page requires JavaScript to function properly.<br /><br />If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.
</div>
</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstageButton"></div>
<div id="backstageArea"><div id="backstageToolbar"></div></div>
<div id="backstage">
	<div id="backstagePanel"></div>
</div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="shadowArea">
<div title="MarkupPreHead">
<pre>&lt;!--{{{--&gt;
&lt;link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' /&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="ColorPalette">
<pre>Background: #fff
Foreground: #000
PrimaryPale: #8cf
PrimaryLight: #18f
PrimaryMid: #04b
PrimaryDark: #014
SecondaryPale: #ffc
SecondaryLight: #fe8
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #eee
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88
</pre>
</div>
<div title="StyleSheetColors">
<pre>/*{{{*/
body {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}

a {color:[[ColorPalette::PrimaryMid]];}
a:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}
a img {border:0;}

h1,h2,h3,h4,h5,h6 {color:[[ColorPalette::SecondaryDark]]; background:transparent;}
h1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}
h2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}

.button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}
.button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}
.button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}

.header {background:[[ColorPalette::PrimaryMid]];}
.headerShadow {color:[[ColorPalette::Foreground]];}
.headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}
.headerForeground {color:[[ColorPalette::Background]];}
.headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}

.tabSelected{color:[[ColorPalette::PrimaryDark]];
	background:[[ColorPalette::TertiaryPale]];
	border-left:1px solid [[ColorPalette::TertiaryLight]];
	border-top:1px solid [[ColorPalette::TertiaryLight]];
	border-right:1px solid [[ColorPalette::TertiaryLight]];
}
.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}
.tabContents {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::TertiaryPale]]; border:1px solid [[ColorPalette::TertiaryLight]];}
.tabContents .button {border:0;}

#sidebar {}
#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}
#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}

.wizard {background:[[ColorPalette::PrimaryPale]]; border:1px solid [[ColorPalette::PrimaryMid]];}
.wizard h1 {color:[[ColorPalette::PrimaryDark]]; border:none;}
.wizard h2 {color:[[ColorPalette::Foreground]]; border:none;}
.wizardStep {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];
	border:1px solid [[ColorPalette::PrimaryMid]];}
.wizardStep.wizardStepDone {background:[[ColorPalette::TertiaryLight]];}
.wizardFooter {background:[[ColorPalette::PrimaryPale]];}
.wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}
.wizard .button {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;
	border-color:[[ColorPalette::SecondaryPale]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryPale]];}
.wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}
.wizard .button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;
	border-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];}

.wizard .notChanged {background:transparent;}
.wizard .changedLocally {background:#80ff80;}
.wizard .changedServer {background:#8080ff;}
.wizard .changedBoth {background:#ff8080;}
.wizard .notFound {background:#ffff80;}
.wizard .putToServer {background:#ff80ff;}
.wizard .gotFromServer {background:#80ffff;}

#messageArea {border:1px solid [[ColorPalette::SecondaryMid]]; background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]];}
#messageArea .button {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none;}

.popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}

.popup {background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]]; border-left:1px solid [[ColorPalette::TertiaryMid]]; border-top:1px solid [[ColorPalette::TertiaryMid]]; border-right:2px solid [[ColorPalette::TertiaryDark]]; border-bottom:2px solid [[ColorPalette::TertiaryDark]];}
.popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}
.popup li.disabled {color:[[ColorPalette::TertiaryMid]];}
.popup li a, .popup li a:visited {color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:active {background:[[ColorPalette::SecondaryPale]]; color:[[ColorPalette::Foreground]]; border: none;}
.popupHighlight {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
.listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}

.tiddler .defaultCommand {font-weight:bold;}

.shadow .title {color:[[ColorPalette::TertiaryDark]];}

.title {color:[[ColorPalette::SecondaryDark]];}
.subtitle {color:[[ColorPalette::TertiaryDark]];}

.toolbar {color:[[ColorPalette::PrimaryMid]];}
.toolbar a {color:[[ColorPalette::TertiaryLight]];}
.selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}
.selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}

.tagging, .tagged {border:1px solid [[ColorPalette::TertiaryPale]]; background-color:[[ColorPalette::TertiaryPale]];}
.selected .tagging, .selected .tagged {background-color:[[ColorPalette::TertiaryLight]]; border:1px solid [[ColorPalette::TertiaryMid]];}
.tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}
.tagging .button, .tagged .button {border:none;}

.footer {color:[[ColorPalette::TertiaryLight]];}
.selected .footer {color:[[ColorPalette::TertiaryMid]];}

.sparkline {background:[[ColorPalette::PrimaryPale]]; border:0;}
.sparktick {background:[[ColorPalette::PrimaryDark]];}

.error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}
.warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}
.lowlight {background:[[ColorPalette::TertiaryLight]];}

.zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}

.imageLink, #displayArea .imageLink {background:transparent;}

.annotation {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border:2px solid [[ColorPalette::SecondaryMid]];}

.viewer .listTitle {list-style-type:none; margin-left:-2em;}
.viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}
.viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}

.viewer table, table.twtable {border:2px solid [[ColorPalette::TertiaryDark]];}
.viewer th, .viewer thead td, .twtable th, .twtable thead td {background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::Background]];}
.viewer td, .viewer tr, .twtable td, .twtable tr {border:1px solid [[ColorPalette::TertiaryDark]];}

.viewer pre {border:1px solid [[ColorPalette::SecondaryLight]]; background:[[ColorPalette::SecondaryPale]];}
.viewer code {color:[[ColorPalette::SecondaryDark]];}
.viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}

.highlight, .marked {background:[[ColorPalette::SecondaryLight]];}

.editor input {border:1px solid [[ColorPalette::PrimaryMid]];}
.editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%;}
.editorFooter {color:[[ColorPalette::TertiaryMid]];}
.readOnly {background:[[ColorPalette::TertiaryPale]];}

#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}
#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }
#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}
#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}
.backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}
.backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}
#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:'alpha(opacity=60)';}
/*}}}*/</pre>
</div>
<div title="StyleSheetLayout">
<pre>/*{{{*/
* html .tiddler {height:1%;}

body {font-size:.75em; font-family:arial,helvetica; margin:0; padding:0;}

h1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}
h1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}
h4,h5,h6 {margin-top:1em;}
h1 {font-size:1.35em;}
h2 {font-size:1.25em;}
h3 {font-size:1.1em;}
h4 {font-size:1em;}
h5 {font-size:.9em;}

hr {height:1px;}

a {text-decoration:none;}

dt {font-weight:bold;}

ol {list-style-type:decimal;}
ol ol {list-style-type:lower-alpha;}
ol ol ol {list-style-type:lower-roman;}
ol ol ol ol {list-style-type:decimal;}
ol ol ol ol ol {list-style-type:lower-alpha;}
ol ol ol ol ol ol {list-style-type:lower-roman;}
ol ol ol ol ol ol ol {list-style-type:decimal;}

.txtOptionInput {width:11em;}

#contentWrapper .chkOptionInput {border:0;}

.externalLink {text-decoration:underline;}

.indent {margin-left:3em;}
.outdent {margin-left:3em; text-indent:-3em;}
code.escaped {white-space:nowrap;}

.tiddlyLinkExisting {font-weight:bold;}
.tiddlyLinkNonExisting {font-style:italic;}

/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */
a.tiddlyLinkNonExisting.shadow {font-weight:bold;}

#mainMenu .tiddlyLinkExisting,
	#mainMenu .tiddlyLinkNonExisting,
	#sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}
#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}

.header {position:relative;}
.header a:hover {background:transparent;}
.headerShadow {position:relative; padding:4.5em 0 1em 1em; left:-1px; top:-1px;}
.headerForeground {position:absolute; padding:4.5em 0 1em 1em; left:0px; top:0px;}

.siteTitle {font-size:3em;}
.siteSubtitle {font-size:1.2em;}

#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}

#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}
#sidebarOptions {padding-top:0.3em;}
#sidebarOptions a {margin:0 0.2em; padding:0.2em 0.3em; display:block;}
#sidebarOptions input {margin:0.4em 0.5em;}
#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}
#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}
#sidebarOptions .sliderPanel input {margin:0 0 0.3em 0;}
#sidebarTabs .tabContents {width:15em; overflow:hidden;}

.wizard {padding:0.1em 1em 0 2em;}
.wizard h1 {font-size:2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizard h2 {font-size:1.2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizardStep {padding:1em 1em 1em 1em;}
.wizard .button {margin:0.5em 0 0; font-size:1.2em;}
.wizardFooter {padding:0.8em 0.4em 0.8em 0;}
.wizardFooter .status {padding:0 0.4em; margin-left:1em;}
.wizard .button {padding:0.1em 0.2em;}

#messageArea {position:fixed; top:2em; right:0; margin:0.5em; padding:0.5em; z-index:2000; _position:absolute;}
.messageToolbar {display:block; text-align:right; padding:0.2em;}
#messageArea a {text-decoration:underline;}

.tiddlerPopupButton {padding:0.2em;}
.popupTiddler {position: absolute; z-index:300; padding:1em; margin:0;}

.popup {position:absolute; z-index:300; font-size:.9em; padding:0; list-style:none; margin:0;}
.popup .popupMessage {padding:0.4em;}
.popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0;}
.popup li.disabled {padding:0.4em;}
.popup li a {display:block; padding:0.4em; font-weight:normal; cursor:pointer;}
.listBreak {font-size:1px; line-height:1px;}
.listBreak div {margin:2px 0;}

.tabset {padding:1em 0 0 0.5em;}
.tab {margin:0 0 0 0.25em; padding:2px;}
.tabContents {padding:0.5em;}
.tabContents ul, .tabContents ol {margin:0; padding:0;}
.txtMainTab .tabContents li {list-style:none;}
.tabContents li.listLink { margin-left:.75em;}

#contentWrapper {display:block;}
#splashScreen {display:none;}

#displayArea {margin:1em 17em 0 14em;}

.toolbar {text-align:right; font-size:.9em;}

.tiddler {padding:1em 1em 0;}

.missing .viewer,.missing .title {font-style:italic;}

.title {font-size:1.6em; font-weight:bold;}

.missing .subtitle {display:none;}
.subtitle {font-size:1.1em;}

.tiddler .button {padding:0.2em 0.4em;}

.tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}
.isTag .tagging {display:block;}
.tagged {margin:0.5em; float:right;}
.tagging, .tagged {font-size:0.9em; padding:0.25em;}
.tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}
.tagClear {clear:both;}

.footer {font-size:.9em;}
.footer li {display:inline;}

.annotation {padding:0.5em; margin:0.5em;}

* html .viewer pre {width:99%; padding:0 0 1em 0;}
.viewer {line-height:1.4em; padding-top:0.5em;}
.viewer .button {margin:0 0.25em; padding:0 0.25em;}
.viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}
.viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}

.viewer table, table.twtable {border-collapse:collapse; margin:0.8em 1.0em;}
.viewer th, .viewer td, .viewer tr,.viewer caption,.twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}
table.listView {font-size:0.85em; margin:0.8em 1.0em;}
table.listView th, table.listView td, table.listView tr {padding:0px 3px 0px 3px;}

.viewer pre {padding:0.5em; margin-left:0.5em; font-size:1.2em; line-height:1.4em; overflow:auto;}
.viewer code {font-size:1.2em; line-height:1.4em;}

.editor {font-size:1.1em;}
.editor input, .editor textarea {display:block; width:100%; font:inherit;}
.editorFooter {padding:0.25em 0; font-size:.9em;}
.editorFooter .button {padding-top:0px; padding-bottom:0px;}

.fieldsetFix {border:0; padding:0; margin:1px 0px;}

.sparkline {line-height:1em;}
.sparktick {outline:0;}

.zoomer {font-size:1.1em; position:absolute; overflow:hidden;}
.zoomer div {padding:1em;}

* html #backstage {width:99%;}
* html #backstageArea {width:99%;}
#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em;}
#backstageToolbar {position:relative;}
#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em;}
#backstageButton {display:none; position:absolute; z-index:175; top:0; right:0;}
#backstageButton a {padding:0.1em 0.4em; margin:0.1em;}
#backstage {position:relative; width:100%; z-index:50;}
#backstagePanel {display:none; z-index:100; position:absolute; width:90%; margin-left:3em; padding:1em;}
.backstagePanelFooter {padding-top:0.2em; float:right;}
.backstagePanelFooter a {padding:0.2em 0.4em;}
#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}

.whenBackstage {display:none;}
.backstageVisible .whenBackstage {display:block;}
/*}}}*/
</pre>
</div>
<div title="StyleSheetLocale">
<pre>/***
StyleSheet for use when a translation requires any css style changes.
This StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which need larger font sizes.
***/
/*{{{*/
body {font-size:0.8em;}
#sidebarOptions {font-size:1.05em;}
#sidebarOptions a {font-style:normal;}
#sidebarOptions .sliderPanel {font-size:0.95em;}
.subtitle {font-size:0.8em;}
.viewer table.listView {font-size:0.95em;}
/*}}}*/</pre>
</div>
<div title="StyleSheetPrint">
<pre>/*{{{*/
@media print {
#mainMenu, #sidebar, #messageArea, .toolbar, #backstageButton, #backstageArea {display: none !important;}
#displayArea {margin: 1em 1em 0em;}
noscript {display:none;} /* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */
}
/*}}}*/</pre>
</div>
<div title="PageTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;
&lt;div class='headerShadow'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class='headerForeground'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea'&gt;
&lt;div id='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="ViewTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="EditTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::EditToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div macro='annotations'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser excludeLists'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="GettingStarted">
<pre>To get started with this blank [[TiddlyWiki]], you'll need to modify the following tiddlers:
* [[SiteTitle]] &amp; [[SiteSubtitle]]: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* [[MainMenu]]: The menu (usually on the left)
* [[DefaultTiddlers]]: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;</pre>
</div>
<div title="OptionsPanel">
<pre>These [[InterfaceOptions]] for customising [[TiddlyWiki]] are saved in your browser

Your username for signing your edits. Write it as a [[WikiWord]] (eg [[JoeBloggs]])

&lt;&lt;option txtUserName&gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; [[SaveBackups]]
&lt;&lt;option chkAutoSave&gt;&gt; [[AutoSave]]
&lt;&lt;option chkRegExpSearch&gt;&gt; [[RegExpSearch]]
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; [[CaseSensitiveSearch]]
&lt;&lt;option chkAnimate&gt;&gt; [[EnableAnimations]]

----
Also see [[AdvancedOptions]]</pre>
</div>
<div title="ImportTiddlers">
<pre>&lt;&lt;importTiddlers&gt;&gt;</pre>
</div>
</div>
<!--POST-SHADOWAREA-->

<!--TIDDLYSPOT_INJECT-->
<div style="display:none"><img src="http://tiddlyspot.com/_ts/stats/linux.rtfm"/></div>
<!--TCEJNI_TOPSYLDDIT-->

<!--TIDDLYSPOT_INJECT-->
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">_uacct="UA-96965-3";urchinTracker();</script>

<!--TCEJNI_TOPSYLDDIT-->
<div id="storeArea">
<div title="/bin" creator="rvr" modifier="rvr" created="201102080534" modified="202301031316" changecount="12">
<pre>The ''/bin'' directory is off the root directory in a [[typical filesystem]]. 
It contains the [[bash]] shell.
It has essential user command binaries for all users. There are no subdirectories here. Here are some of the commands:
*cat
*[[echo]]
*[[chgrp]]
*[[chmod]]
*[[chown]]
*[[login]]
*[[ps|process]]
*''pwd'' - print working directory
*sh
*[[su]]</pre>
</div>
<div title="/boot" creator="rvr" modifier="rvr" created="201501311919" modified="202005260146" changecount="4">
<pre>This directory has the essential files for booting up Linux. Here are some of the contents:
*The kernel is compressed and is called ''vmlinuz''.
*''initramfs'' or ''initrd'' - the initial ram [[filesystem]].
*''config'' - only used for bookkeeping and debugging 
*''system.map'' - used by the kernel for debugging
*[[grub]]</pre>
</div>
<div title="/dev" creator="rvr" modifier="rvr" created="201501310436" modified="202005250555" changecount="19">
<pre>The ''/dev'' directory contains ''device nodes'' (usually just called ''devices'') that are used to access everything in Linux. Keyboards, monitor, hard drives, all need ''devices''.
Linux allows you to add, modify, and remove devices. Device nodes in Linux are like files, so you can see them when you do a listing. 
Picture devices like a telephone jack. It can take many different machines attached to it, as long as it fits that interface.
Device nodes:
*''/dev/dvd1'' - first dvd drive.
*''/dev/hda*'' - refers to the hard disk, *= 1,2,3,...
*''/dev/hda1'' - refers to the hard disk #1
*''/dev/tty01'' - is a console terminal. What terminal am I? type: ''@@tty@@''.
*''/dev/sda1'' - first partition on a disk
*''/dev/mt*'' - magnetic tape. * =1,2,3,...
*''/dev/fd0'' - is the floppy drive
*''/dev/lpt0'' - the first printer
*''/dev/lpt1'' - the second printer
*''/dev/st0'' - a streaming  tape. Can also be ''/dev/tape''
*''/dev/null'' - a pseudo device, discards all input
*''/dev/mouse'' - the mouse
It is possible to have two device nodes share the same device. They will have different names. For example, a swap partition could be ''/dev/sda4'' - which tells you where it is, and it can be ''/dev/swap'' - which tells you what it is.
To see the devices you can:
*@@ls /dev@@ - list all devices.
*@@cat /proc/devices@@ - list all devices
See [[typical filesystem]].</pre>
</div>
<div title="/etc" creator="rvr" modifier="rvr" created="201012091620" modified="202301031212" changecount="27">
<pre>''/etc'' contains numerous text based configuration files. Notable there is the defaults for login called: @@login.defs@@. Some /etc directories to know:
*''/etc/aliases'' - contains a table to redirect local users.
*''/etc/default'' - contains some defaults, notably for [[useradd]].
*''/etc/environment'' . . . this file will be used to set [[environment variables]].
*''/etc/exports'' - contains the directories and permissions that a host is willing to share
*[[/etc/fstab]] - lists partitions and filesystems mounted when system boots up
*''/etc/ftpusers'' - Controls user access to ftp
*[[/etc/group]] - where group info is stored.
*''/etc/hosts'' - contains host to IP information
*''/etc/inittab'' - contains startup scripts
*''/etc/init.d'' - subdirectory with even more startup scripts.
*[[/etc/passwd]] - primary user accounts (usernames) are stored here.
*[[/etc/profile]] - startup programs
*[[/etc/shadow]] - encrypted passwords are stored here
*''/etc/skel'' - contains list of hidden files to copy to user home directory when running [[adduser]].
There are also folders with config for software that we install, like ''/etc/ssh'' or ''/etc/nginx''
See [[typical filesystem]].
</pre>
</div>
<div title="/etc/fstab" creator="rvr" modifier="rvr" created="201501311634" modified="201612081809" changecount="34">
<pre>This is for [[filesystem]] configuration. It has information on devices and partitions and is found at ''/etc/fstab'' file. To setup network mounting, this is the place. Each line consists of the following information:
*Device Name 
*Mount point
*[[File system|filesystem]] type, ie ext2, ext3, swap, vfat, auto, ...
*Mount options - auto/noauto, user/nouser, exec/noexec, ro, rw, sync/async, defaults
*Dump - to backup or to not backup
*FSCK - to perform fsck or not
An example would be:&lt;html&gt;&lt;pre&gt;
#Device name          Mount point       System  Options    Dump FSCK
servername:/projects  /mnt/nfs/projects nfs     defaults     0   0
/dev/hda2             /                 ext2    defaults     1   1
/dev/hda1             swap              swap    pri=42       0   0
/dev/fd0              /media/floppy     auto    rw,user,sync 0   0
&lt;/pre&gt;&lt;/html&gt;
These and others can be done with the [[mount]] command, however, if not in this table then on bootup they will not be in place. To make sure that newly mounted files are available over the network use ''exportfs''.</pre>
</div>
<div title="/etc/group" creator="rvr" modifier="rvr" created="201102020036" modified="201612172244" changecount="5">
<pre>Enjoy this table:
&lt;html&gt;&lt;pre&gt;
# cat /etc/group
root:x:0:
daemon:x:1:
adm:x:4:syslog,ubuntu
&lt;/pre&gt;&lt;/html&gt;Here is the breakdown
#''group_name'' - the name of group.
#''password'' -  often empty/blank. 
#''group ID (GID)'' - each user is assigned a group ID like in [[/etc/passwd]].
#''group list (users)'' - a list of comma separated user names of group members.</pre>
</div>
<div title="/etc/passwd" creator="rvr" modifier="rvr" created="201102020018" modified="202301031042" changecount="46">
<pre>The  ''/etc/passwd'' file lists user, groups, ...
&lt;html&gt;&lt;pre&gt;
# cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/bin/sh
bin:x:2:2:bin:/bin:/bin/sh
hello:x:1001:1003:hello,,,:/home/hello:/bin/bash
postgres:x:128:138:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash
&lt;/pre&gt;&lt;/html&gt;Here is the breakdown:
#''Username'' - between 1 and 32 chars.
#''Password'' - ''x'' indicates that encrypted password is stored in /etc/shadow file.
#''User ID (UID)'' - each user is assigned a user ID.
##[[UID]] 0 (zero) is reserved for root.
##UID's 1-99 are reserved for predefined accounts.
##UID's 100-999 are reserved for administrative and [[system accounts]] and groups.
#''Group ID (GID)'' - the primary group ID (stored in [[/etc/group]] file)
#''User ID Info (GECOS)'' - comment field. Extra info like user's full name, phone # etc. Used by finger command.
#''Home directory'' - the absolute path to the [[home]] directory when user logs in. Default is ''/''
#''Command/shell'' - the absolute path of a command or most often a shell (/bin/sh). 
&lt;html&gt;&lt;pre&gt;
Username    Pw  UID       GID    GECOS        Home                  Shell
---------   --  ----     ---     -----        ---------             ---------
root        x     0         0    root         /root                 /bin/bash
daemon      x     1         1    daemon       /usr/sbin             /bin/sh
bin         x     2         2    bin          /bin                  /bin/sh
hello       x  1001      1003    hello...     /home/hello           /bin/bash
postgres    x   128       138    Pg admin...  /var/lib/postgresql   /bin/bash
&lt;/pre&gt;&lt;/html&gt;
We can create a password using [[openssl]].</pre>
</div>
<div title="/etc/profile" creator="rvr" modifier="rvr" created="201102051808" changecount="1">
<pre>''/etc/profile'' - used for system wide environment and startup programs, like PATH. It only runs as a login shell. It is used by many different shells.
''/etc/profile.d'' - used for making large or application specific changes.</pre>
</div>
<div title="/etc/shadow" creator="rvr" modifier="rvr" created="201102042035" modified="201612172249" changecount="4">
<pre>The ''/etc/shadow'' is where actual passwords are stored.
The ''/etc/gshadow'' is where actual passwords are stored for groups. (not often done.)
&lt;html&gt;&lt;pre&gt;
#cat /etc/shadow | grep rob
rob:$1$5Pmkw0nk$/8ZR9LTvPoeKIh6apX/Ht1:14995:0:99999:7:14::
&lt;/pre&gt;&lt;/html&gt;
Broken down:
#''Username'' - rob
#''Password'' which is encrypted - $1$5Pmkw0nk$/8ZR9LTvPoeKIh6apX/Ht1
#Days since Jan 1, 1970, since password was changed  -  14995
#Minimum number of days between days when you have to change password - 0
#Maximum number of days you can have same password - 99999
#Days warning you get b4 you have to change password - 7
#The number of days after password expires that account is disabled - 14
#Days since Jan 1, 1970 that account is expired -  not set
</pre>
</div>
<div title="/home" creator="rvr" modifier="rvr" created="201408230938" modified="202301031308" changecount="14">
<pre>When you first [[login]] you are placed in your home directory, aka $HOME. You can see the path by typing ''pwd'' right away or from anywhere ''echo $HOME''.
The ''/home'' directory is where user accounts are typically located. Like ''/home/rob'' or yet another directory of users like: ''/home/~BCusers''. It is typically in its own [[partition]].
Applications and things stored here are meant for individual users as opposed to system-wide applications.
The ''/home/&lt;usr&gt;'' directory has many directories under it that are important. 
*''/.local'' - often application config files will be here.
**''/bin'' - programs like python, aws, etc store local binaries here.
**''/lib'' - programs like python for virtual environment use will be here.
**''/share'' - progams data, logs, and config can be stored here. They can be stored elsewhere too.
*''.ssh'' - for [[SSH]] keys.
*''/Applications'' - Some applications (via [[AppImage]]) are stored here. Like EOS Scatter.
*''/Documents'' - default for documents.
*''/Desktop'' - desktop links
*''/Downloads'' - default for downloads.
*''/Music'' - default for music files.
*''/Pictures'' - default for pictures.
*''/var'' - where local apps should dump their logs.
</pre>
</div>
<div title="/lib" creator="rvr" modifier="rvr" created="201102080538" modified="201612131907" changecount="6">
<pre>''/lib'' - is the linked library directory.
It contains support data and linked library files needed for the boot process.
There will be no files that executable files need outside of here.
There are also device drivers here.
It is used by binaries in the [[/bin]] and [[/sbin]] directories. See [[filesystem|typical filesystem]].</pre>
</div>
<div title="/media" creator="rvr" modifier="rvr" created="201501311923" modified="202301031244" changecount="4">
<pre>The ''/media'' folder. For ~CDs, ~USBs and ~DVDs. Devices are automatically found and mounted.</pre>
</div>
<div title="/proc" creator="rvr" modifier="rvr" created="201501311708" modified="202301031251" changecount="13">
<pre>The [[filesystem]]s mounted at ''/proc'' is a pseudo or virtual filesystem, it is created dynamically. It is used to provide system information at run time. This would include things like system memory, hardware configuration, etc.  If you list the directory, you'll see a pile of &quot;number&quot; folders.. These correspond to a process or [[PID]]. There is a &quot;file&quot; for every system [[process]].
Some files include:
*/proc/cpuinfo - cpu info like ~MHz, cache, # of cores, model, etc .
*/proc/meminfo - tons of [[memory]] info.
*/proc/interrupts - yes, those.
*/proc/mounts - yes, [[mount]]s.
*/proc/partitions - yes, [[partition]]s.
*/proc/version - all kinds of version info.
*/proc/sys - is a directory with lots of info about the system.
**/proc/sys/dev - device info 
**/proc/sys/kernel/ - kernel info.
**/proc/sys/net - network info.
</pre>
</div>
<div title="/sbin" creator="rvr" modifier="rvr" created="201102080509" modified="201501290715" changecount="4">
<pre>The ''System Binaries'' directory, or ''/sbin'' directory contains important executable programs that are usually run by [[root]]. ''sbin'' stands for system binaries. If this directory is off the ''root'' then these binaries are used for the system startup and are mostly admin programs.
''/usr/bin'' directory contains other admin utilities that are required after boot is complete - like [[adduser]].
</pre>
</div>
<div title="/usr" creator="rvr" modifier="rvr" created="201102080542" modified="201904080056" changecount="7">
<pre>''/usr'' is shareable, read-only data.
''/usr/lib'' - is where linked library files are.
''/usr/local'' - is for use by the system administrator when installing software locally.
''/usr/local/sbin'' - is for system administration programs (which are not part of the core OS) that a local administrator may run. 
''/usr/share/man'' - manual pages. See also [[documentation]].
See [[typical filesystem]].</pre>
</div>
<div title="/var" creator="rvr" modifier="rvr" created="201102080545" modified="201612131843" changecount="4">
<pre>''/var'' - contains variable data files. This includes spool directories and files, administrative and logging data, and transient and temporary files.
''/var/log'' - log files and directories. See [[logs]]
''/var/log/messages'' - lists messages like results of running [[sudo]] commands.

To look for info in these places, use [[grep]]: @@grep sshd /var/log/* @@</pre>
</div>
<div title="&gt; and &gt;&gt;" creator="rvr" modifier="rvr" created="201511151423" modified="201709302111" changecount="3">
<pre>These are the ''redirect'' and ''append'' operators.
&lt;html&gt;&lt;pre&gt;
$ echo &quot;Goodbye, &quot; &gt; a.a      # File a.a has &quot;Goodbye, &quot;
$ echo &quot;cruel world!&quot; &gt;&gt; a.a  # Adds &quot;cruel world!&quot; to file a.a
&lt;/pre&gt;&lt;/html&gt;
See also [[echo]].</pre>
</div>
<div title="ANSI color codes" creator="rvr" modifier="rvr" created="201711210619" modified="201903181644" changecount="5">
<pre>There are escape associated with the ANSI terminal.
Begin with CSI (Control Sequence Introducer): @@\e[@@
Common codes:
*''\e[r;cH'' - set cursos to row &quot;r&quot; and column &quot;c&quot;
*''\e[2J'' - clear screen
*''\e[31;40m'' - Sets black as background with red text
*''\e[0m'' - Reset colours to original/default.

SGR codes - https://en.wikipedia.org/wiki/ANSI_escape_code#graphics
Control Codes - http://en.wikipedia.org/wiki/ASCII#ASCII_control_code_chart 
ANSI CSI Codes - http://en.wikipedia.org/wiki/ANSI_escape_code#CSI_codes 
ANSI Color Codes - http://en.wikipedia.org/wiki/ANSI_escape_code#Colors

</pre>
</div>
<div title="AppImage" creator="YourName" modifier="rvr" created="201902062349" modified="201904080216" changecount="5">
<pre>An AppImage is a universal software package format. It has all it needs to run.
It is a compressed image with all it's needs in one spot.
#Download it.
#Make it executable via GUI or @@chmod u+x &lt;~AppImageFile&gt; @@
#Now it will run!
Often this will end up in the @@~/Applications' 'directory. See [[/home]]</pre>
</div>
<div title="Boot Loader" creator="rvr" modifier="rvr" created="201501131435" modified="202301031306" changecount="15">
<pre>This is the big part of the  [[boot process]].

Boot Loader&amp;rArr; RAM &amp;rArr; [[Init]]&amp;rArr; Shell&amp;rArr; ~X-Windows

Boot Loader - These pgms are either GRUB or ISOLINUX
#The software to run (ie GRUB) is in either:
##Boot sector in typical BIOS/MBR .
##The EFI partition in EFI/UEFI systems. 
#Stage 1
##For BIOS - gets (MBR) Master Boot Record from first sector of drive.
###Now gets bootable spot in partition table.
###Now GRUB gets loaded into RAM
##For UEFI - firmware is stored in RAM - reads its boot manager data to figure out which UEFI application is to be aunched and from where it launches, 
###Firmware then launches, GRUB
#Stage 2
##The next bootloader is under [[/boot]]
##You get a splash screen, and choose what OS to run.
##For linux, the [[kernel]] is then loaded in compressed from, so it has to decompress.
##The kernel checks system hardware and init any devices in the kernel.
##Also check processors, storage, etc &amp; user apps.
##The boot loader loads both the [[kernel]] and an initial RAM–based file system (initramfs) into memory so it can e used directly by the kernel.  
#RAM Disk
##The initramfs has all info to mount the root [[filesystem]] and mass storage.
##initramfs (initial ram file system), is the successor of initrd. 
##Calls User Device (udev) to hook up the right drivers to the right devices.
##After loaded, it is checked for errors and then it mounts the [[filesystem]], and associated a &quot;mount point&quot; 
##Once initramfs is cleared from RAM, then /sbin/init is called.
##[[Init]] passes over the mounting of the filesystem to the final root.
#/sbin/init and Services
##Everything else gets started by init.
##Start system and network [[service]]s.
##Handles user login &amp; outs.
##Closes down everything when you are done and tries to clean up any mess.
#Text mode login (Shell)
##At end of init, the program ''getty'' fires up text-mode login prompts. 
##Typically six text shells are started and one GUI shell.
##Typical shell is 'bash' 
#[[X Window System]] - usually the final step
##A [[display manager]] keeps track of displays and logins &amp; [[desktop environment]].
##There is a [[session manager]], a [[window manager]], and a set of utilities.##An X server provides the GUI to you.</pre>
</div>
<div title="CLI" creator="rvr" modifier="rvr" created="201408180506" modified="202301231813" changecount="8">
<pre>The Command Line Interface (CLI) process [[commands]]. This is very useful to connect to machines on the internet.
The GUI uses Linux commands but presents you with a graphical interface to selection options.
To use a CLI in a GUI environment, you use a terminal-emulator like:
*Gnome Terminal
*xterm
*Terminator
*Konsole
See also [[virtual terminal]]s as well as [[basic commands]] and [[event designator]].</pre>
</div>
<div title="DNS" creator="rvr" modifier="rvr" created="201612142251" modified="202301031245" changecount="3">
<pre>DNS - Domain Name Server - translates a domain name into an IP address.
When we have a domain name, we'll need an [[IP Address]] to actually get the web site.
When a DNS gets a request, it'll take as input the domain name and return an IP address.</pre>
</div>
<div title="Debian" creator="rvr" modifier="rvr" created="201501222003" changecount="1">
<pre>Debian systems are used by Ubuntu. In turn, Ubuntu is used by Mint.</pre>
</div>
<div title="DefaultTiddlers" creator="rvr" modifier="rvr" created="201012090521" changecount="1">
<pre>[[Introduction]]</pre>
</div>
<div title="Gnome" creator="rvr" modifier="rvr" created="201501151334" modified="201907220350" changecount="8">
<pre>Gnome is the grandpa of almost all [[desktop environment]]s.
It is built with the GTK [[widgets]].
Gedit is the default editor.
See [[KDE]].</pre>
</div>
<div title="Graphical Desktop" creator="rvr" modifier="rvr" created="201408180514" modified="202301031311" changecount="11">
<pre>The ''Graphical Desktop'' is the fancy GUI you see, It can be turned off by the [[desktop manager]].  The desktop manager runs a [[service]] that can be stopped.
Different systems require different methods for doing this,
*Use ''sudo service gdm stop'' or ''sudo service lightdm stop''  commands, to stop the graphical user interface in Debian-based systems. 
*Use ''sudo telinit 3'' on ~RPM-based systems - may have the same effect of killing the GUI.
*For ~RPM-based systems, the Desktop Manager is run by [[Init]] when set to run level 5; switching to a different runlevel stops the desktop. (ie ''sudo telinit 3'')
All desktops come with a selection of desktop backgrounds or wallpaper. You can also pick just a colour. You can also change the [[theme]] which will change the look and feel of the system.</pre>
</div>
<div title="ICMP" creator="rvr" modifier="rvr" created="201612141923" modified="201612141924" changecount="2">
<pre>''ICMP'' -  Internet Control Message Protocol
This is for testing and verifying network communication between hosts.
The ''ping'' utility uses ICMP packets.
See also [[Networking]].</pre>
</div>
<div title="IP" creator="rvr" modifier="rvr" created="201612141837" modified="201612141954" changecount="7">
<pre>''IP'' - Internet Protocol. This handles the ''address'' of where the packets get sent. 
*Provides an [[IP Address]
*Works with other protocol like [[TCP]] and UDP
*The focus is on ''routing'' packets. It doesn't know packets are related, thats [[TCP]]s job.
*Wants to make sure packets arrive at the destination.
*Doesn't care what order the packets arrive at receiver.
You'll often see ''TCP/IP'' because they work so closely together.
See also [[Networking]] and [[port]].</pre>
</div>
<div title="IP Address" creator="rvr" modifier="rvr" created="201612141951" modified="201612142146" changecount="9">
<pre>Every computer on the internet has an IP address, an IPv4 and IPv6
It is a logical address, it can change at any time. This is unlike a ''MAC'' address burned into a device.
It is at layer 3 in the [[OSI Reference Model]].
It is a series for 4 numbers (0-255) separated by a dot.
My current [[IPv4]] is: 64.180.188.136
My current IPv6 is: 2001:569:bdfb:ec00:c4d7:308b:9533:5d0e
On a home network, you'll have a local IP assigned, see below.

Every ~IPv4 address is broken down into four sets of octets (8 bits) and translated into binary.
255~~10~~ = 11111111~~2~~
|IP in base 10|0-255|0255|0-255|0-255|
|IP Binary value|11111111|11111111|11111111|11111111|
|My IP |64|180|188|136|
|My IP in base 2|1000000|10110100|10111100|10001000|
When setting up a home network, some default ~IPs are set.
A ''gateway'' is where one network connects to another network. An example would be a home router.
|&gt;|!Home Network IP Assignment|
|!Default IP|!Description|
|192.168.1.0|0 is the automatically assigned network address.|
|192.168.1.1|1 is the commonly used address used as the gateway.|
|192.168.1.2|2 is also a commonly used address used for a gateway.|
|192.168.1.3- 254|Addresses assigned to computers and devices on the network.|
|192.168.1.255|255 is automatically assigned on most networks as the broadcast address.|
The ''router'' will assign each computer an IP address on your network.

See also [[IP Address Classes]]</pre>
</div>
<div title="IP Address Classes" creator="rvr" modifier="rvr" created="201612141954" modified="201612141954" changecount="2">
<pre>There are five defined [[IP Address]] classes. 
|!Class|!High Order Bits|!Network Bits|!Host Bits|!Networks #|!Hosts #|!IP Range|!Other|
|A|0|7|24|126|16,777,214|1.0.0.1 to 126.255.255.254|Large hosts - large companies|
|B|1 0|14|16|16,384|65,534|128.1.0.1 to 191.255.255.254||
|C|1 1 0|21|8|2,097,152|254|192.0.1.1 to 223.255.254.254|Large # networks, typically ~ISPs.|
|D|1 1 1 0|||||224.0.0.0 to 239.255.255.255|Multicast|
|E|1 1 1 1|||||240.0.0.0 to 254.255.255.254|Experimental|
Ranges 127.x.x.x are reserved for the loopback or localhost
Range 255.255.255.255 broadcasts to all hosts on the local network
The ''class'' of address defines which bits are used for the network ID and which bits are used for the host ID. It also defines the possible number of networks and the number of hosts per network.
!!Class A
Are for networks with a very large number of hosts. 
*The high-order bit in a class A address is always set to zero. 
*The next seven bits (completing the first octet) complete the network ID. 
*The remaining 24 bits (the last three octets) represent the host ID. 
This allows for 126 networks and 16,777,214 hosts per network. 
!!Class B
These addresses are assigned to medium-sized to large-sized networks. 
*The two high-order bits are always set to binary 1 0. 
*The next 14 bits (completing the first two octets) complete the network ID. 
*The remaining 16 bits (last two octets) represent the host ID. 
This allows for 16,384 networks and 65,534 hosts per network.
!!Class C 
These addresses are for small networks. 
*The three high-order bits in a class C address are always set to binary 1 1 0. 
*The next 21 bits (completing the first three octets) complete the network ID. 
*The remaining 8 bits (last octet) represent the host ID. 
This allows for 2,097,152 networks and 254 hosts per network.</pre>
</div>
<div title="IPv4" creator="rvr" modifier="rvr" created="201612142210" modified="202301031250" changecount="2">
<pre>IPv4 is [[IP]] version 4
</pre>
</div>
<div title="IPv6" creator="rvr" modifier="rvr" created="202301031250" changecount="1">
<pre>IPv6 is [[IP]] version 6
</pre>
</div>
<div title="Index A-E" creator="rvr" modifier="rvr" created="201408290614" modified="202301031302" changecount="52">
<pre>[[absolute|path]]
[[adduser]]
[[alias]]
[[ANSI color codes]]
[[AppImage]]
[[apropos]]
[[background]]
[[basic commands]]
[[bash]]
[[boot process]]
[[Boot Loader]]
[[builtin]]
[[bundle files|tar]] tar
[[bus]]
[[chgrp]] 
[[chmod]]  
[[chown]]
[[color]]
[[CLI]]
[[command prompt]]
[[commands]]
[[compare files|diff]] diff
[[console]]
[[cp|file commands]]
[[create variables]]
[[cron]]
[[curl]]
[[daemon]]
[[dd]]
[[debug shell]]
[[definitions]]
[[desktop environment]]
[[desktop manager]]
[[determine hardware]]
[[detemine machine]]
[[df]]
[[diff]]
[[display manager]]
[[display server]]
[[distribution]]
[[DNS]]
[[documentation]]
[[echo]]
[[environment variables]]
[[EUID|UID]] 
[[examples]]
[[export]]</pre>
</div>
<div title="Index F-M" creator="rvr" modifier="rvr" created="201408290614" modified="202302141520" changecount="31">
<pre>[[ffmpeg]]
[[file]]
[[file type]]
[[filesystem]]
[[find]]
[[firewall - CentOS]]
[[foreground|background]] background
[[Gnome]]
[[Graphical Desktop]]
[[grep]]
[[group]]
[[groupadd]]
[[groupdel]]
[[halt|shutdown]]
[[hidden]]
[[history]]
[[home]]
[[i/o streams|Standard File Streams]] Standard File Streams
[[id]]
[[info]]
[[inode]]
[[inode example]]
[[installation]]
[[IP]]
[[iptables]]
[[lspci]]
[[journal]]
[[kernel]]
[[less]]
[[link]]
[[locate]]
[[login]]
[[logs]]
[[ls]]
[[lsof]]
[[LXC]]
[[ls flags]]
[[mail]]
[[magic vars]]
[[man pages]] 
[[meld]]
[[Mint]]
[[mount]]</pre>
</div>
<div title="Index N-R" creator="rvr" modifier="rvr" created="201412131002" modified="202301031300" changecount="33">
<pre>[[nano]]
[[netstat]]
[[network configuration]]
[[Networking]]
[[Networking utilities]]
[[NFS]]
[[nobody]]
[[openssl]]
[[OSI Reference Model]]
[[other]]
[[Package Management]]
[[package management commands]]
[[package management examples]]
[[partition]]
[[passwd]]
[[patch|diff]]
[[path]]
[[PCI]]
[[permissions]]
[[PID]]
[[pipe]]
[[port]]
[[poweroff|shutdown]]
[[process]] - aka ps
[[ps examples]]
[[profile]]
[[quoting]]
[[reboot|shutdown]]
[[redirect]]
[[regex]]
[[relative|path]]
[[rm|file commands]]
[[root]]
[[RPM]]
[[RUID|UID]]
[[rsync]]</pre>
</div>
<div title="Index Other" creator="rvr" modifier="rvr" created="201012091619" modified="201904080200" changecount="25">
<pre>[[/bin]]
[[/boot]]
[[/etc]]
''/etc/exports''
[[/etc/group]]
[[/etc/fstab]]
[[/etc/passwd]]
[[/etc/profile]]
[[/etc/shadow]]
[[/home]]
[[/lib]]
[[/media]]
[[/proc]]
[[/sbin]]
[[/usr]]
[[/var]]
[[&gt; and &gt;&gt;]]
[[~]]
[[2&gt;&amp;1|redirect]] - redirect</pre>
</div>
<div title="Index S" creator="rvr" modifier="rvr" created="201412131003" modified="202302141520" changecount="44">
<pre>[[scp]]
[[script]]
[[script example 1]]
[[SSH]]
[[SSH setup]]
[[search|grep]] - grep
[[sendmail]]
[[session manager]]
[[service]]
[[service user]]
[[service - CentOS]]
[[settings]]
[[setup machine]]
[[shell]]
[[shell commands]]
[[shell example 1]]
[[shell misc]]
[[shell programming]]
[[shell variables]]
[[shutdown]]
[[SIGTERM]]
[[snap]]
[[socket|port]] - port
[[software]]
[[sort]]
[[SSH]]
[[Standard File Streams]]
[[startup]]
[[stderr|Standard File Streams]]
[[stdin|Standard File Streams]]
[[stdout|Standard File Streams]]
[[sticky bit]]
[[su]]
[[subnet mask]]
[[sudo]]
[[suspend]]
[[symbolic|link]]
[[Synaptic]] - package mgmt
[[syslog]]
[[system admin]]
[[system accounts]]
[[systemd]]

</pre>
</div>
<div title="Index T-Z" creator="rvr" modifier="rvr" created="201501290513" modified="202301031318" changecount="17">
<pre>[[tail]]
[[tar]]
[[TCP]]
[[theme]]
[[terminal]]
[[top]]
[[Tunneling|SSH]] - SSH
[[type]]
[[typical filesystem]]
[[Ubuntu]]
[[UID]]
[[user]]
[[useradd]]
[[userdel]]
[[username|UID]]
[[usermod|useradd]]
[[utility programs]]
[[vi]]
[[virtual terminal]]
[[virtual terminal]]
[[Wayland]]
[[web permissions]]
[[wifi]]
[[wildcards]]
[[window manager]]
[[write to file]]
[[X server]]
[[X Window System]]
[[xinput]]
[[xz]]
[[yum]]
[[zip]]</pre>
</div>
<div title="Init" creator="rvr" modifier="rvr" created="201501131450" modified="202301031207" changecount="8">
<pre>''Init'' is started by the [[kernel]].
The ''init'' process controls shutting down or rebooting the system. 
''Init'' is a daemon process that continues running until the system is shut down.

The directory: ''/usr/lib/systemd/system'' contains init scripts. These must  be linked to  ''/etc/systemd/system'' to start a service at boot time.
To display the status of all installed services that have init scripts: @@''systemctl list-unit-files -&amp;#45;type=service''@@.
There are three states for this command: 
*''enabled'' -  means it has a symlink in a .wants directory.
*''disabled'' - means it does NOT have a symlink in a .wants directory.
*''static'' -  means the service is missing the [Install] section in its init script, so you cannot enable or disable it.
**Typically they are dependencies of other services


</pre>
</div>
<div title="Introduction" creator="rvr" modifier="rvr" created="201012090515" modified="202207072025" changecount="59">
<pre>This covers Linux [[commands|shell commands]] and concepts as well as shell [[script]]ing and loads of other stuff.
It'll be developed like a stream of learning. As I learn new things or re-remember old things I will add them.
A good place to start is: 
*[[definitions]]
*[[documentation]]
*[[examples]]
*[[system admin]]
*or the very start of the [[boot process]].
For starters, 
*what shell or machine are you running? See [[detemine machine]].
*what is the [[typical filesystem]] on linux?
Or you may want to start at [[home]].</pre>
</div>
<div title="KDE" creator="rvr" modifier="rvr" created="201611291904" modified="201907220349" changecount="3">
<pre>KDE is a [[desktop environment]] used by Mandriva and Suse. 
It uses the Qt [[widgets]]. The Qt toolset has GUI features like creating windows, menus, and dialog boxes etc.
See [[Gnome]].
 </pre>
</div>
<div title="LXC" creator="rvr" modifier="rvr" created="201703240409" modified="202301031247" changecount="2">
<pre>LXC (Linux Containers) is an operating-system-level virtualization method for running multiple isolated Linux systems (containers) on a control host using a single Linux kernel.
The Linux kernel provides the ''cgroups'' functionality that allows limitation and prioritization of resources (CPU, memory, block I/O, network, etc.) without the need for starting any virtual machines, and also namespace isolation functionality that allows complete isolation of an applications' view of the operating environment, including process trees, networking, user ~IDs and mounted file systems.</pre>
</div>
<div title="LoadRemoteFileThroughProxy" modifier="YourName" created="200703202229" modified="201012090514" tags="systemConfig">
<pre>/***
|''Name:''|LoadRemoteFileThroughProxy (previous LoadRemoteFileHijack)|
|''Description:''|When the TiddlyWiki file is located on the web (view over http) the content of [[SiteProxy]] tiddler is added in front of the file url. If [[SiteProxy]] does not exist &quot;/proxy/&quot; is added. |
|''Version:''|1.1.0|
|''Date:''|mar 17, 2007|
|''Source:''|http://tiddlywiki.bidix.info/#LoadRemoteFileHijack|
|''Author:''|BidiX (BidiX (at) bidix (dot) info)|
|''License:''|[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D ]]|
|''~CoreVersion:''|2.2.0|
***/
//{{{
version.extensions.LoadRemoteFileThroughProxy = {
 major: 1, minor: 1, revision: 0, 
 date: new Date(&quot;mar 17, 2007&quot;), 
 source: &quot;http://tiddlywiki.bidix.info/#LoadRemoteFileThroughProxy&quot;};

if (!window.bidix) window.bidix = {}; // bidix namespace
if (!bidix.core) bidix.core = {};

bidix.core.loadRemoteFile = loadRemoteFile;
loadRemoteFile = function(url,callback,params)
{
 if ((document.location.toString().substr(0,4) == &quot;http&quot;) &amp;&amp; (url.substr(0,4) == &quot;http&quot;)){ 
 url = store.getTiddlerText(&quot;SiteProxy&quot;, &quot;/proxy/&quot;) + url;
 }
 return bidix.core.loadRemoteFile(url,callback,params);
}
//}}}
</pre>
</div>
<div title="MainMenu" creator="YourName" modifier="rvr" created="201012090515" modified="202008310539" changecount="16">
<pre>[[Introduction]]
[[Index A-E]]
[[Index F-M]]
[[Index N-R]] 
[[Index S]] 
[[Index T-Z]] 
[[Index Other]]
!
[[DevOps|http://devops.rtfm.tiddlyspot.com]]
[[Misc|http://misc.rtfm.tiddlyspot.com]]
[[Ruby|http://ruby.rtfm.tiddlyspot.com]]
[[Rails|http://rails.rtfm.tiddlyspot.com]]
[[Mongo|http://mongo.rtfm.tiddlyspot.com]]
[[git|http://git.rtfm.tiddlyspot.com]]
[[R Data|http://rdata.rtfm.tiddlyspot.com/]]
[[Angular|http://angular.rtfm.tiddlyspot.com/]]
[[Javascript|http://javascript.rtfm.tiddlyspot.com/]]
[[React|http://react.rtfm.tiddlyspot.com/]]
[[Concepts|http://concepts.rtfm.tiddlyspot.com/]]</pre>
</div>
<div title="Mint" creator="rvr" modifier="rvr" created="201501221839" modified="201501221845" changecount="6">
<pre>The Mint [[distribution]] is derived from [[Ubuntu]].
Mint 17.1 code name ''Rebecca'' comes with 3 [[desktop environment]]s : Cinnamon, Mate and Xfce.</pre>
</div>
<div title="NFS" creator="rvr" modifier="rvr" created="201501310505" modified="202301031211" changecount="11">
<pre>The ''NFS'' or Network Filesystem is used to share data across physical systems. This allows the admin to use a server to store data so when users log in from any machine they have access to their data.
To fire up NFS, on the server issue the command: @@sudo service nfs start@@
The file /etc/exports contains the directories and permissions that a host is willing to share.
The parameters in this file will look like: 
@@/projects *.rtfm.ca(rw)@@
*''/projects'' - the directory to be mounted.
*to be shared with computers in the ''rtfm.ca'' domain.
*with read+write permissions.
If you modifed the ''/etc/exports'' file, issue the command: @@exportfs -av@@</pre>
</div>
<div title="Networking" creator="rvr" modifier="rvr" created="201612141836" modified="202301031246" changecount="17">
<pre>Linux has great networking capabilities.
The internet, or any network, use protocols to communicate. It is like a language. The following follow the [[OSI Reference Model]]:
*[[IP]] - Intenet Protocol
*[[TCP]] - Transmission Control Protocol
*[[UDP]] - User Datagram Protocol
*[[ICMP]] - Internet Control Message Protocol
There are many things that can be networked, so here are some definitions:
*''host'' - can be a computer or a toaster, anything connected to the internet, at the &quot;end&quot; of the internet.
*''gateway'' - Software and/or hardware that exchanges data among networks which are using different protocols. Typically a ''router''.
*''router'' - Used extensively on the internet. It is an [[OSI|OSI Reference Model]] network layer device which routing data over the internet .  Typically a x.x.x.254 address.
All hosts on an IP based network have a unique [[IP Address]] so they can talk to each other.
See [[DNS]].
See [[Networking utilities]]
</pre>
</div>
<div title="Networking utilities" creator="rvr" modifier="rvr" created="201612152217" modified="201612152237" changecount="10">
<pre>Some good networking utilities:

|!Commands|!Description|
|ping|Used to test connections.|
|dig|To get IP and other info.|
|[[netstat]]|To list network connections.|
|route|Current route/net settings, NIC info.|
|traceroute|Traces routes that packets take.|
|ifconfig|Network settings - shows all network interface devices.|
|ip addr|Current IP address and network settings.|

This file is to resolve hostnames into IP addresses: ''/etc/resolv.conf''
Some distros tell you not to touch this file.

The settings for our network: ''/etc/sysconfig/network-scripts''
Currently we are using DHCP to get an IP, we could also manually set it, those lines are commented out.
&lt;html&gt;&lt;pre&gt;
# File ifcfg-eth0
DEVICE=&quot;eth0&quot;
BOOTPROTO=&quot;dhcp&quot;    # Can also be &quot;static&quot;
        # IPADDR=&quot;10.10.30.222&quot;
        # NETMASK=&quot;255.255.255.0&quot;
        # NETWORK=&quot;10.10.20.0&quot;
ONBOOT=&quot;yes&quot;
TYPE=&quot;Ethernet&quot;
USERCTL=&quot;yes&quot;
PEERDNS=&quot;yes&quot;
IPV6INIT=&quot;no&quot;
PERSISTENT_DHCLIENT=&quot;1&quot;
&lt;.pre&gt;&lt;/html&gt;</pre>
</div>
<div title="OSI Reference Model" creator="rvr" modifier="rvr" created="201612141941" modified="201706010541" changecount="12">
<pre>The ''OSI Reference Model'' has 7 layers.
#Physical - hubs, like a network card, modem, etc, Specifies signaling, voltage, cable type and length, etc.
#Data Link - rules for accessing the data from layer 1 - physical (Switches)
##Identifies the host on network, how to verify data received
#Network - manages a multi-node network. (Routers)Enables the routing of the data, recognizes address of neighbours.
**The [[IP]] operates at this layer. 
**Responsible for carrying data from one host to another.
**Routing, forwarding, addressing, internetworking, error handling, congestion control and packet sequencing.
#Transport - gets/gives info from/to upper layers. Reliable transmission of data segments between points on a network,
##It divides/joins data it into small chunks called packets.
##The ''receiving'' host assembles packets into data to give to upper layers
##The ''sending'' host divides data into smaller packets for transmission
##Provides end to end error checking. This is where [[TCP]] and [[UDP]] operate.
##Provides transparent transfer of data between end hosts.
##This layer identifies [[port]]s.
#Session - responsible for establishing &amp; maintaining source &amp; destination network hosts.
##Assists in synchronization and dialog control.
#Presentation - responsible for info passing is formatted correctly.
#Application - responsible for providing applications with a way to access the network. </pre>
</div>
<div title="PCI" creator="rvr" modifier="rvr" created="201606120107" modified="202301031251" changecount="3">
<pre>''PCI'' is short for Peripheral Component Interconnect, a local bus standard developed by Intel. 
A bus is a communications system between a computer and an external device, such as a router, video equipment or a sound system. A bus could also be USB, but we are talking about ''PCI'' here.
Most ~PCs include a PCI bus and a more general ISA expansion bus. These a connections typically at the back or side of a computer.
PCI is a 64-bit bus, though it is usually implemented as a 32-bit bus.</pre>
</div>
<div title="PID" creator="rvr" modifier="rvr" created="201102042039" modified="201612131817" changecount="2">
<pre>The ''PID'' is the process identifier, which is used to identify a process on Linux.
There are also ''PPID'' - parent proces ids.
~PIDs are used to manage running propcesses.</pre>
</div>
<div title="Package Management" creator="rvr" modifier="rvr" created="201501221951" modified="201711042204" changecount="17">
<pre>''Package Management'' is handled slightly different for the many distros out there. There are two basic package management systems.
*[[Debian]] systems. The low level utility is ''dpkg'', the higher level is [[apt-get]], GUI is ''Ubuntu Software Center'' or [[Synaptic]].
*[[RPM]] systems like Suse, Fedora, Mandriva, Oracle Linux, and ~CentOS. The low level utility is ''rpm'', the higher level is ''zypper'' or [[yum]].
''Packages'' are program files plus metadata (description, how-to, dependencies, version, etc).
''Package managers'' handle installation, updating, and removal of software. It handles dependencies &amp; knows where it installs things.
The lower level (dpkg and rpm) take care of unpacking and installing software.
The upper level (apt-get, zypper, and yum ) take care of groups of packages and dependencies.
There is also a higher GUI level tool which uses the upper level CLI.
YUM=Yellowdog Updater Modified, which has both CLI and GUI versions.
See [[package management commands]].
</pre>
</div>
<div title="PasswordOptionsPlugin" modifier="YourName" created="200704220851" modified="201012090514" tags="systemConfig">
<pre>/***
|''Name:''|PasswordOptionPlugin|
|''Description:''|Extends TiddlyWiki options with non encrypted password option.|
|''Version:''|1.0.2|
|''Date:''|Apr 19, 2007|
|''Source:''|http://tiddlywiki.bidix.info/#PasswordOptionPlugin|
|''Author:''|BidiX (BidiX (at) bidix (dot) info)|
|''License:''|[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D ]]|
|''~CoreVersion:''|2.2.0 (Beta 5)|
***/
//{{{
version.extensions.PasswordOptionPlugin = {
	major: 1, minor: 0, revision: 2, 
	date: new Date(&quot;Apr 19, 2007&quot;),
	source: 'http://tiddlywiki.bidix.info/#PasswordOptionPlugin',
	author: 'BidiX (BidiX (at) bidix (dot) info',
	license: '[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D]]',
	coreVersion: '2.2.0 (Beta 5)'
};

config.macros.option.passwordCheckboxLabel = &quot;Save this password on this computer&quot;;
config.macros.option.passwordInputType = &quot;password&quot;; // password | text
setStylesheet(&quot;.pasOptionInput {width: 11em;}\n&quot;,&quot;passwordInputTypeStyle&quot;);

merge(config.macros.option.types, {
	'pas': {
		elementType: &quot;input&quot;,
		valueField: &quot;value&quot;,
		eventName: &quot;onkeyup&quot;,
		className: &quot;pasOptionInput&quot;,
		typeValue: config.macros.option.passwordInputType,
		create: function(place,type,opt,className,desc) {
			// password field
			config.macros.option.genericCreate(place,'pas',opt,className,desc);
			// checkbox linked with this password &quot;save this password on this computer&quot;
			config.macros.option.genericCreate(place,'chk','chk'+opt,className,desc);			
			// text savePasswordCheckboxLabel
			place.appendChild(document.createTextNode(config.macros.option.passwordCheckboxLabel));
		},
		onChange: config.macros.option.genericOnChange
	}
});

merge(config.optionHandlers['chk'], {
	get: function(name) {
		// is there an option linked with this chk ?
		var opt = name.substr(3);
		if (config.options[opt]) 
			saveOptionCookie(opt);
		return config.options[name] ? &quot;true&quot; : &quot;false&quot;;
	}
});

merge(config.optionHandlers, {
	'pas': {
 		get: function(name) {
			if (config.options[&quot;chk&quot;+name]) {
				return encodeCookie(config.options[name].toString());
			} else {
				return &quot;&quot;;
			}
		},
		set: function(name,value) {config.options[name] = decodeCookie(value);}
	}
});

// need to reload options to load passwordOptions
loadOptionsCookie();

/*
if (!config.options['pasPassword'])
	config.options['pasPassword'] = '';

merge(config.optionsDesc,{
		pasPassword: &quot;Test password&quot;
	});
*/
//}}}</pre>
</div>
<div title="Port Tunneling" creator="rvr" modifier="rvr" created="202302271325" changecount="1">
<pre>Tunneling &amp; Port Forwarding: This is 
* to establish a secure [[SSH]] tunnel between your local machine and a remote server 
* forward traffic from a specified local port to a specified destination host and port through that tunnel.

Format: @@ssh -L [local_address:]local_port:remote_address:remote_port user@remote_host@@
* ''[local_address:]'' is optional and specifies the local network interface to use for the forwarding
* ''local_port'' is the local port number to bind to
* ''remote_address'' is the address of the remote server to forward traffic to
* ''remote_port'' is the port number on the remote server to forward traffic to

Example: ''ssh -L 3307:localhost:3306 user@192.168.1.100''
* traffic sent to port 3307
* on your local (''localhost'') machine traffic 
* is sent to port 3306
* on the remote machine at IP address ''192.168.1.100''
* with a username of ''user''
* which happens to be a ~MySQL database server

Another example real example:
Example: ''ssh -L 6543:127.0.0.1:6543 fredf@51.151.181.41 ''
* first ''6543'' is your local postgres port
* the ''127.0.0.1'' is your local machine aka &quot;localhost&quot;
* the second ''6543'' is the remote port of the postgres server
* the remote postgres is at IP: 51.151.181.41
* the username of that postgres is ''fredf''

If you wanted the remote machine to access you computer, you would use ''-R''.
This is very handy when it comes to debugging. It's like the resource was local and you have cli access to debug.</pre>
</div>
<div title="RPM" creator="rvr" modifier="rvr" created="202301031259" changecount="1">
<pre>RPM Package Manager (RPM).
Used by Red Hat Linux and its derivatives
RPM also refers to the rpm command and .rpm file format. 
You should always prefer using [[yum]] or dnf over rpm when installing, updating, and removing packages.
An RPM Package consists of an archive of files and metadata for installing software.</pre>
</div>
<div title="SIGTERM" creator="rvr" modifier="rvr" created="201904080325" modified="201904080326" changecount="2">
<pre>The SIGTERM signal is a generic signal used to terminate a program.
pgrep &lt;name&gt;
returns #
kill #

A nasty way: SIGKILL is kill -9</pre>
</div>
<div title="SSH" creator="rvr" modifier="rvr" created="201408230914" modified="202302271327" changecount="47">
<pre>Secure Shell (SSH) is a protocol to access remote servers through a command-line interface. 
To connect to a remote box:
&lt;html&gt;&lt;pre&gt;
$ ssh server-name    # Unix assumes you'll use your local username for credentials
******               # type in your password and you're in.
CNTRL-D to exit

$ ssh username@server-name               # To log in as a different user.
$ ssh username@server-name -p &amp;lt;port-#&gt;   # If a different port 

$ ssh -i ~/.ssh/whf/id_rsa username@ip-address -p8888     # If id_rsa is in a different location or filename. Bonus port!
$ ssh -L 6543:127.0.0.1:6543 fredf@51.151.181.41          # Port tunneling
&lt;/pre&gt;&lt;/html&gt;
Test your private key, format: @@ssh-keygen -y -f path/to/&lt;private-key-filename@@  (often id_rsa)
See also:
* [[Port Tunneling]] - Uses the ''-L'' option.
* [[SSH setup]]
* [[SSH Basics]]
* [[ssh-agent]].
</pre>
</div>
<div title="SSH Basics" creator="rvr" modifier="rvr" created="201707050523" modified="202302141114" changecount="6">
<pre>SSH is a protocol allowing secure remote login to a computer on a network using public-key cryptography. 
You may need [[SSH setup]].
To create a public &amp; private key, use: @@ssh-keygen@@
To provide keys to remote servers use: [[ssh-agent]]
To add keys to the above sshagent use: @@ssh-add@@
To see if already have some keys: @@ls ~/.ssh@@
Typically a system has just one key, there are two files:
*id_rsa.pub - this is like a lock, anyone can use to lock something &amp; send it to you.
*id_rsa - this is the key, only you have it. it can unlock the above. Can have a password tired to it.
SSH typically looks for the private key in a file in the home directory (''~/.ssh/id_rsa '').  This is stored in an encrypted form, so we have to enter the passphrase which is used to get the encryption key when we are accessing a encrypted resource. To avoid typing it in all the time, we can use ssh-agent, which for the duration of a login session, keeps the unencrypted key in memory.
Need to set up ssh.
Check if you got some keys already. Go to the directory and look for id_ files
&lt;html&gt;&lt;pre&gt;
$ cd ~/.ssh
$ ls -l
total 12
-rw------- 1 rob rob 3326 Nov 20 18:00 id_rsa
-rw-r--r-- 1 rob rob  743 Nov 20 18:00 id_rsa.pub
-rw-r--r-- 1 rob rob 2652 Nov 21 22:58 known_hosts

# Now test run the password
$ ssh-keygen -y
  Enter file in which the key is (/home/rob/.ssh/id_rsa):  ... &lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="SSH setup" creator="rvr" modifier="rvr" created="201707050524" modified="201712150059" changecount="4">
<pre>How to set up [[SSH]] locally on linux, ubuntu in this case.
#Verify you have it installed: @@ssh -V@@
#See if there are keys: @@ls -a ~/.ssh@@
##You are looking for ''id_*'' files
#Create the keys, run: @@ssh-keygen@@
#Check that its there: @@ls -a ~/.ssh@@
#Check if agent is running: @@ps -e | grep [s]sh-agent@@
#Start ssh-agent: @@ssh-agent /bin/bash@@
#Add it: @@ssh-add ~/.ssh/id_rsa@@
#See what the agent is handling: @@ssh-add -l @@
#Copy id_rsa to add to github etc...

&lt;html&gt;&lt;pre&gt;
$ ssh -V
  OpenSSH_6.6.1p1 Ubuntu-2ubuntu2.3, OpenSSL 1.0.1f 6 Jan 2014
$ ssh-keygen
  Generating public/private rsa key pair.
  Enter file in which to save the key (/home/rob/.ssh/id_rsa):
  Created directory '/home/rob/.ssh'.
  Enter passphrase (empty for no passphrase):
  Your identification has been saved in /home/rob/.ssh/id_rsa.
  Your public key has been saved in /home/rob/.ssh/id_rsa.pub.
$ ls -a ~/.ssh
.  ..  id_rsa  id_rsa.pub
$ ssh-agent /bin/bash
$ ps -e | grep [s]sh-agent
 14087 ?        00:00:00 ssh-agent
$ ssh-add ~/.ssh/id_rsa
  Enter passphrase for /home/rob/.ssh/id_rsa:
  Identity added: /home/rob/.ssh/id_rsa (/home/rob/.ssh/id_rsa)
$ ssh-add -l
  2048 1f:40:3c:a0:3a:d3:c6:50:55:f4:50:63:a8:86:05:7e /home/rob/.ssh/id_rsa (RSA)
$ cat ~/.ssh/id_rsa.pub   # Copy to paste at bitbucket or github...
&lt;/pre&gt;&lt;/html&gt;
Test your key, format: @@ssh-keygen -y -f path/to/&lt;private-key-filename@@  (often id_rsa)
&lt;html&gt;&lt;pre&gt;
$ ssh-keygen -y -f ./id_rsa-u17 
Enter passphrase: 
ssh-rsa ABCDEF....
&lt;/pre&gt;&lt;/html&gt;
Otherwise you'd get something like:  @@...incorrect passphrase supplied to decrypt private key@@</pre>
</div>
<div title="SUID" creator="rvr" modifier="rvr" created="201012092133" modified="201612190412" changecount="9">
<pre>SUID aka setuid. This is another [[permission|permissions]] that compliments the [[executable]] permission. If setuid is set, when the file is executed by a user, the process will have the same rights as the owner of the file!
To change the suid execute [[permissions]] we use the ''chmod'' command . The format is:
 ''chmod [options] permissions file[s]''
&lt;html&gt;&lt;pre&gt;
chmod +s secretfile    # Changes the execute permission under user to &quot;s&quot;.
chmod g+s secretfile   # Changes the execute permission under group to &quot;s&quot;.
&lt;/pre&gt;&lt;/html&gt;In a listing, the execute bit will be identified with an ''s''.

Make the file owned by root and group root, then set the [[sticky bit]], make it executable for all and writable only by root:
&lt;html&gt;&lt;pre&gt;
sudo chown root.root some.rb  
sudo chmod 4755 some.rb 
&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="SiteSubtitle" creator="YourName" modifier="YourName" created="201012090515" changecount="1">
<pre>lotsa linux</pre>
</div>
<div title="SiteTitle" creator="YourName" modifier="YourName" created="201012090514" changecount="1">
<pre>Linux Notes</pre>
</div>
<div title="Standard File Streams" creator="rvr" modifier="rvr" created="201408250641" modified="201605151807" changecount="14">
<pre>Standard File Streams - are communication channels or streams (A file with associated buffering is called a stream) when a command line program is executing. These are automatically assigned (default) and are; ''stdin'', ''stdout'', and ''stderr''. They are also assigned a file descriptor value, to indicate what type of &quot;file&quot; it is.

|!Humans Like|!Description|!Abbrev|!Computers Like|
|''Standard Input''| For reading or input of data for command line (CL) programs, often a keyboard. |''stdin'' |file descriptor = 0|
|''Standard Output''|For writing out from CL programs, typically the screen. |''stdout'' |file descriptor = 1|
|''Standard Error''| For diagnostic messages of CL programs, could be the screen, often a log file. |''stderr'' |file descriptor = 2|

One great feature of standard output - the default destination is easily be [[redirect]]ed.
If other files are opened in addition besides these three, the file descriptor is then 3 so forth.
We can redirect these streams and they often are. See also [[pipe]].
</pre>
</div>
<div title="Synaptic" creator="rvr" modifier="rvr" created="201711042207" modified="201711042227" changecount="2">
<pre>To install the Synaptic package management because the regular package mgmt system I have is broken on Ubuntu17:
&lt;html&gt;&lt;pre&gt;
sudo apt-get update
sudo apt-get install synaptic
&lt;/pre&gt;&lt;/html&gt;
To run under ''Wayland'' you need to:
&lt;html&gt;&lt;pre&gt;
$ xhost +si:localuser:root
$ sudo -H synaptic
[sudo] password for fred:
...
$ xhost -si:localuser:root      # When finished
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="TCP" creator="rvr" modifier="rvr" created="201612141844" modified="201612141929" changecount="7">
<pre>''TCP'' is Transmission Control Protocol, the main internet protocol.  It is how applications provide reliable (handshakes), order checked, and error checked delivery of data (packets). This is where a high degree of data fidelity. This means that there is latency, unlike [[UDP]].
*TCP (and [[UDP]]) provides [[port]]s for upper [[Networking]] layers to access.
*It focuses on ''transport'' - keeps track of all packets.
*Reassembles the packets when it arrives at the destination.
*It reliably sends packets, it requires acknowledgment when sending and receiving packets.
*It can reorder missing packets, ignore duplicate packets
*Reassembles packets into same order as data in the sending system
You'll often see ''TCP/IP'' because they work so closely together.
See also [[Networking]] and [[port]].</pre>
</div>
<div title="TspotSetupPlugin" modifier="YourName" created="200808081041" modified="200808081041" tags="systemConfig">
<pre>/***
Description: Contains the stuff you need to use Tiddlyspot
Note, you also need UploadPlugin, PasswordOptionPlugin and LoadRemoteFileThroughProxy
from http://tiddlywiki.bidix.info for a complete working Tiddlyspot site.
***/
//{{{

// edit this if you are migrating sites or retrofitting an existing TW
config.tiddlyspotSiteId = 'linux.rtfm';

// make it so you can by default see edit controls via http
config.options.chkHttpReadOnly = false;
window.readOnly = false; // make sure of it (for tw 2.2)
window.showBackstage = true; // show backstage too

// disable autosave in d3
if (window.location.protocol != &quot;file:&quot;)
	config.options.chkGTDLazyAutoSave = false;

// tweak shadow tiddlers to add upload button, password entry box etc
with (config.shadowTiddlers) {
	SiteUrl = 'http://'+config.tiddlyspotSiteId+'.tiddlyspot.com';
	SideBarOptions = SideBarOptions.replace(/(&lt;&lt;saveChanges&gt;&gt;)/,&quot;$1&lt;&lt;tiddler TspotSidebar&gt;&gt;&quot;);
	OptionsPanel = OptionsPanel.replace(/^/,&quot;&lt;&lt;tiddler TspotOptions&gt;&gt;&quot;);
	DefaultTiddlers = DefaultTiddlers.replace(/^/,&quot;[[WelcomeToTiddlyspot]] &quot;);
	MainMenu = MainMenu.replace(/^/,&quot;[[WelcomeToTiddlyspot]] &quot;);
}

// create some shadow tiddler content
merge(config.shadowTiddlers,{

'TspotOptions':[
 &quot;tiddlyspot password:&quot;,
 &quot;&lt;&lt;option pasUploadPassword&gt;&gt;&quot;,
 &quot;&quot;
].join(&quot;\n&quot;),

'TspotControls':[
 &quot;| tiddlyspot password:|&lt;&lt;option pasUploadPassword&gt;&gt;|&quot;,
 &quot;| site management:|&lt;&lt;upload http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/store.cgi index.html . .  &quot; + config.tiddlyspotSiteId + &quot;&gt;&gt;//(requires tiddlyspot password)//&lt;br&gt;[[control panel|http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/controlpanel]], [[download (go offline)|http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/download]]|&quot;,
 &quot;| links:|[[tiddlyspot.com|http://tiddlyspot.com/]], [[FAQs|http://faq.tiddlyspot.com/]], [[blog|http://tiddlyspot.blogspot.com/]], email [[support|mailto:support@tiddlyspot.com]] &amp; [[feedback|mailto:feedback@tiddlyspot.com]], [[donate|http://tiddlyspot.com/?page=donate]]|&quot;
].join(&quot;\n&quot;),

'WelcomeToTiddlyspot':[
 &quot;This document is a ~TiddlyWiki from tiddlyspot.com.  A ~TiddlyWiki is an electronic notebook that is great for managing todo lists, personal information, and all sorts of things.&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //What now?// &amp;nbsp;&amp;nbsp;@@ Before you can save any changes, you need to enter your password in the form below.  Then configure privacy and other site settings at your [[control panel|http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/controlpanel]] (your control panel username is //&quot; + config.tiddlyspotSiteId + &quot;//).&quot;,
 &quot;&lt;&lt;tiddler TspotControls&gt;&gt;&quot;,
 &quot;See also GettingStarted.&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //Working online// &amp;nbsp;&amp;nbsp;@@ You can edit this ~TiddlyWiki right now, and save your changes using the \&quot;save to web\&quot; button in the column on the right.&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //Working offline// &amp;nbsp;&amp;nbsp;@@ A fully functioning copy of this ~TiddlyWiki can be saved onto your hard drive or USB stick.  You can make changes and save them locally without being connected to the Internet.  When you're ready to sync up again, just click \&quot;upload\&quot; and your ~TiddlyWiki will be saved back to tiddlyspot.com.&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //Help!// &amp;nbsp;&amp;nbsp;@@ Find out more about ~TiddlyWiki at [[TiddlyWiki.com|http://tiddlywiki.com]].  Also visit [[TiddlyWiki.org|http://tiddlywiki.org]] for documentation on learning and using ~TiddlyWiki. New users are especially welcome on the [[TiddlyWiki mailing list|http://groups.google.com/group/TiddlyWiki]], which is an excellent place to ask questions and get help.  If you have a tiddlyspot related problem email [[tiddlyspot support|mailto:support@tiddlyspot.com]].&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //Enjoy :)// &amp;nbsp;&amp;nbsp;@@ We hope you like using your tiddlyspot.com site.  Please email [[feedback@tiddlyspot.com|mailto:feedback@tiddlyspot.com]] with any comments or suggestions.&quot;
].join(&quot;\n&quot;),

'TspotSidebar':[
 &quot;&lt;&lt;upload http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/store.cgi index.html . .  &quot; + config.tiddlyspotSiteId + &quot;&gt;&gt;&lt;html&gt;&lt;a href='http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/download' class='button'&gt;download&lt;/a&gt;&lt;/html&gt;&quot;
].join(&quot;\n&quot;)

});
//}}}
</pre>
</div>
<div title="UDP" creator="rvr" modifier="rvr" created="201612141919" modified="201612141929" changecount="5">
<pre>''User Datagram Protocol''. This is for sending datagrams (packets) where data is sent unreliably (no handshakes).
*UDP (and [[TCP]]) provides [[port]]s for upper [[Networking]] layers to access.
*Connectionless protocol.
*Packets sent unacknowledged.
*Send small amounts of data at a time.
*No error checking, done by something else if at all.
*Can tolerate loss of some data.
*Good for apps that don't need exact data, like VOIP, or video streaming.
See also [[Networking]] </pre>
</div>
<div title="UID" creator="rvr" modifier="rvr" created="201102042014" modified="201612172146" changecount="6">
<pre>''username'' - your login name
''GID'' - Group Identifier - used to represent a group
''UID'' - User numeric id UID=0 is the root user
''RUID'' - Real User ID - to identify who you actually are
''EUID'' - Effective User ID - used to determine what level of access the current process has
&lt;html&gt;&lt;pre&gt;
# id
uid=1002(rob) gid=1002(rob) groups=1002(rob),1003(webservers)
&lt;/pre&gt;&lt;/html&gt;
Linux kernel deals only with UID.</pre>
</div>
<div title="Ubuntu" creator="rvr" modifier="rvr" created="201501221841" changecount="1">
<pre>The ''Ubuntu'' [[distribution]] is ...</pre>
</div>
<div title="UploadLog" modifier="rvr" created="201012090524" modified="202302272105">
<pre>| !date | !user | !location | !storeUrl | !uploadDir | !toFilename | !backupdir | !origin |
| 23/01/2023 18:42:11 | rvr | [[/|http://linux.rtfm.tiddlyspot.com/]] | [[store.cgi|http://linux.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://linux.rtfm.tiddlyspot.com/index.html]] | . | ok |
| 23/01/2023 19:14:01 | rvr | [[/|http://linux.rtfm.tiddlyspot.com/]] | [[store.cgi|http://linux.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://linux.rtfm.tiddlyspot.com/index.html]] | . |
| 05/02/2023 19:45:04 | rvr | [[/|http://linux.rtfm.tiddlyspot.com/]] | [[store.cgi|http://linux.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://linux.rtfm.tiddlyspot.com/index.html]] | . |
| 13/02/2023 17:40:58 | rvr | [[/|http://linux.rtfm.tiddlyspot.com/]] | [[store.cgi|http://linux.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://linux.rtfm.tiddlyspot.com/index.html]] | . |
| 14/02/2023 12:15:34 | rvr | [[/|http://linux.rtfm.tiddlyspot.com/]] | [[store.cgi|http://linux.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://linux.rtfm.tiddlyspot.com/index.html]] | . | ok |
| 14/02/2023 16:21:22 | rvr | [[/|http://linux.rtfm.tiddlyspot.com/]] | [[store.cgi|http://linux.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://linux.rtfm.tiddlyspot.com/index.html]] | . |
| 19/02/2023 17:07:57 | rvr | [[/|http://linux.rtfm.tiddlyspot.com/]] | [[store.cgi|http://linux.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://linux.rtfm.tiddlyspot.com/index.html]] | . |
| 20/02/2023 09:44:43 | rvr | [[/|http://linux.rtfm.tiddlyspot.com/]] | [[store.cgi|http://linux.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://linux.rtfm.tiddlyspot.com/index.html]] | . |
| 27/02/2023 14:18:43 | rvr | [[/|http://linux.rtfm.tiddlyspot.com/]] | [[store.cgi|http://linux.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://linux.rtfm.tiddlyspot.com/index.html]] | . | ok |
| 27/02/2023 22:05:57 | rvr | [[/|http://linux.rtfm.tiddlyspot.com/]] | [[store.cgi|http://linux.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://linux.rtfm.tiddlyspot.com/index.html]] | . |</pre>
</div>
<div title="UploadPlugin" modifier="YourName" created="200808080918" modified="201012090514" tags="systemConfig">
<pre>/***
|''Name:''|UploadPlugin|
|''Description:''|Save to web a TiddlyWiki|
|''Version:''|4.1.3|
|''Date:''|Feb 24, 2008|
|''Source:''|http://tiddlywiki.bidix.info/#UploadPlugin|
|''Documentation:''|http://tiddlywiki.bidix.info/#UploadPluginDoc|
|''Author:''|BidiX (BidiX (at) bidix (dot) info)|
|''License:''|[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D ]]|
|''~CoreVersion:''|2.2.0|
|''Requires:''|PasswordOptionPlugin|
***/
//{{{
version.extensions.UploadPlugin = {
	major: 4, minor: 1, revision: 3,
	date: new Date(&quot;Feb 24, 2008&quot;),
	source: 'http://tiddlywiki.bidix.info/#UploadPlugin',
	author: 'BidiX (BidiX (at) bidix (dot) info',
	coreVersion: '2.2.0'
};

//
// Environment
//

if (!window.bidix) window.bidix = {}; // bidix namespace
bidix.debugMode = false;	// true to activate both in Plugin and UploadService
	
//
// Upload Macro
//

config.macros.upload = {
// default values
	defaultBackupDir: '',	//no backup
	defaultStoreScript: &quot;store.php&quot;,
	defaultToFilename: &quot;index.html&quot;,
	defaultUploadDir: &quot;.&quot;,
	authenticateUser: true	// UploadService Authenticate User
};
	
config.macros.upload.label = {
	promptOption: &quot;Save and Upload this TiddlyWiki with UploadOptions&quot;,
	promptParamMacro: &quot;Save and Upload this TiddlyWiki in %0&quot;,
	saveLabel: &quot;save to web&quot;, 
	saveToDisk: &quot;save to disk&quot;,
	uploadLabel: &quot;upload&quot;	
};

config.macros.upload.messages = {
	noStoreUrl: &quot;No store URL in parmeters or options&quot;,
	usernameOrPasswordMissing: &quot;Username or password missing&quot;
};

config.macros.upload.handler = function(place,macroName,params) {
	if (readOnly)
		return;
	var label;
	if (document.location.toString().substr(0,4) == &quot;http&quot;) 
		label = this.label.saveLabel;
	else
		label = this.label.uploadLabel;
	var prompt;
	if (params[0]) {
		prompt = this.label.promptParamMacro.toString().format([this.destFile(params[0], 
			(params[1] ? params[1]:bidix.basename(window.location.toString())), params[3])]);
	} else {
		prompt = this.label.promptOption;
	}
	createTiddlyButton(place, label, prompt, function() {config.macros.upload.action(params);}, null, null, this.accessKey);
};

config.macros.upload.action = function(params)
{
		// for missing macro parameter set value from options
		if (!params) params = {};
		var storeUrl = params[0] ? params[0] : config.options.txtUploadStoreUrl;
		var toFilename = params[1] ? params[1] : config.options.txtUploadFilename;
		var backupDir = params[2] ? params[2] : config.options.txtUploadBackupDir;
		var uploadDir = params[3] ? params[3] : config.options.txtUploadDir;
		var username = params[4] ? params[4] : config.options.txtUploadUserName;
		var password = config.options.pasUploadPassword; // for security reason no password as macro parameter	
		// for still missing parameter set default value
		if ((!storeUrl) &amp;&amp; (document.location.toString().substr(0,4) == &quot;http&quot;)) 
			storeUrl = bidix.dirname(document.location.toString())+'/'+config.macros.upload.defaultStoreScript;
		if (storeUrl.substr(0,4) != &quot;http&quot;)
			storeUrl = bidix.dirname(document.location.toString()) +'/'+ storeUrl;
		if (!toFilename)
			toFilename = bidix.basename(window.location.toString());
		if (!toFilename)
			toFilename = config.macros.upload.defaultToFilename;
		if (!uploadDir)
			uploadDir = config.macros.upload.defaultUploadDir;
		if (!backupDir)
			backupDir = config.macros.upload.defaultBackupDir;
		// report error if still missing
		if (!storeUrl) {
			alert(config.macros.upload.messages.noStoreUrl);
			clearMessage();
			return false;
		}
		if (config.macros.upload.authenticateUser &amp;&amp; (!username || !password)) {
			alert(config.macros.upload.messages.usernameOrPasswordMissing);
			clearMessage();
			return false;
		}
		bidix.upload.uploadChanges(false,null,storeUrl, toFilename, uploadDir, backupDir, username, password); 
		return false; 
};

config.macros.upload.destFile = function(storeUrl, toFilename, uploadDir) 
{
	if (!storeUrl)
		return null;
		var dest = bidix.dirname(storeUrl);
		if (uploadDir &amp;&amp; uploadDir != '.')
			dest = dest + '/' + uploadDir;
		dest = dest + '/' + toFilename;
	return dest;
};

//
// uploadOptions Macro
//

config.macros.uploadOptions = {
	handler: function(place,macroName,params) {
		var wizard = new Wizard();
		wizard.createWizard(place,this.wizardTitle);
		wizard.addStep(this.step1Title,this.step1Html);
		var markList = wizard.getElement(&quot;markList&quot;);
		var listWrapper = document.createElement(&quot;div&quot;);
		markList.parentNode.insertBefore(listWrapper,markList);
		wizard.setValue(&quot;listWrapper&quot;,listWrapper);
		this.refreshOptions(listWrapper,false);
		var uploadCaption;
		if (document.location.toString().substr(0,4) == &quot;http&quot;) 
			uploadCaption = config.macros.upload.label.saveLabel;
		else
			uploadCaption = config.macros.upload.label.uploadLabel;
		
		wizard.setButtons([
				{caption: uploadCaption, tooltip: config.macros.upload.label.promptOption, 
					onClick: config.macros.upload.action},
				{caption: this.cancelButton, tooltip: this.cancelButtonPrompt, onClick: this.onCancel}
				
			]);
	},
	options: [
		&quot;txtUploadUserName&quot;,
		&quot;pasUploadPassword&quot;,
		&quot;txtUploadStoreUrl&quot;,
		&quot;txtUploadDir&quot;,
		&quot;txtUploadFilename&quot;,
		&quot;txtUploadBackupDir&quot;,
		&quot;chkUploadLog&quot;,
		&quot;txtUploadLogMaxLine&quot;		
	],
	refreshOptions: function(listWrapper) {
		var opts = [];
		for(i=0; i&lt;this.options.length; i++) {
			var opt = {};
			opts.push();
			opt.option = &quot;&quot;;
			n = this.options[i];
			opt.name = n;
			opt.lowlight = !config.optionsDesc[n];
			opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
			opts.push(opt);
		}
		var listview = ListView.create(listWrapper,opts,this.listViewTemplate);
		for(n=0; n&lt;opts.length; n++) {
			var type = opts[n].name.substr(0,3);
			var h = config.macros.option.types[type];
			if (h &amp;&amp; h.create) {
				h.create(opts[n].colElements['option'],type,opts[n].name,opts[n].name,&quot;no&quot;);
			}
		}
		
	},
	onCancel: function(e)
	{
		backstage.switchTab(null);
		return false;
	},
	
	wizardTitle: &quot;Upload with options&quot;,
	step1Title: &quot;These options are saved in cookies in your browser&quot;,
	step1Html: &quot;&lt;input type='hidden' name='markList'&gt;&lt;/input&gt;&lt;br&gt;&quot;,
	cancelButton: &quot;Cancel&quot;,
	cancelButtonPrompt: &quot;Cancel prompt&quot;,
	listViewTemplate: {
		columns: [
			{name: 'Description', field: 'description', title: &quot;Description&quot;, type: 'WikiText'},
			{name: 'Option', field: 'option', title: &quot;Option&quot;, type: 'String'},
			{name: 'Name', field: 'name', title: &quot;Name&quot;, type: 'String'}
			],
		rowClasses: [
			{className: 'lowlight', field: 'lowlight'} 
			]}
};

//
// upload functions
//

if (!bidix.upload) bidix.upload = {};

if (!bidix.upload.messages) bidix.upload.messages = {
	//from saving
	invalidFileError: &quot;The original file '%0' does not appear to be a valid TiddlyWiki&quot;,
	backupSaved: &quot;Backup saved&quot;,
	backupFailed: &quot;Failed to upload backup file&quot;,
	rssSaved: &quot;RSS feed uploaded&quot;,
	rssFailed: &quot;Failed to upload RSS feed file&quot;,
	emptySaved: &quot;Empty template uploaded&quot;,
	emptyFailed: &quot;Failed to upload empty template file&quot;,
	mainSaved: &quot;Main TiddlyWiki file uploaded&quot;,
	mainFailed: &quot;Failed to upload main TiddlyWiki file. Your changes have not been saved&quot;,
	//specific upload
	loadOriginalHttpPostError: &quot;Can't get original file&quot;,
	aboutToSaveOnHttpPost: 'About to upload on %0 ...',
	storePhpNotFound: &quot;The store script '%0' was not found.&quot;
};

bidix.upload.uploadChanges = function(onlyIfDirty,tiddlers,storeUrl,toFilename,uploadDir,backupDir,username,password)
{
	var callback = function(status,uploadParams,original,url,xhr) {
		if (!status) {
			displayMessage(bidix.upload.messages.loadOriginalHttpPostError);
			return;
		}
		if (bidix.debugMode) 
			alert(original.substr(0,500)+&quot;\n...&quot;);
		// Locate the storeArea div's 
		var posDiv = locateStoreArea(original);
		if((posDiv[0] == -1) || (posDiv[1] == -1)) {
			alert(config.messages.invalidFileError.format([localPath]));
			return;
		}
		bidix.upload.uploadRss(uploadParams,original,posDiv);
	};
	
	if(onlyIfDirty &amp;&amp; !store.isDirty())
		return;
	clearMessage();
	// save on localdisk ?
	if (document.location.toString().substr(0,4) == &quot;file&quot;) {
		var path = document.location.toString();
		var localPath = getLocalPath(path);
		saveChanges();
	}
	// get original
	var uploadParams = new Array(storeUrl,toFilename,uploadDir,backupDir,username,password);
	var originalPath = document.location.toString();
	// If url is a directory : add index.html
	if (originalPath.charAt(originalPath.length-1) == &quot;/&quot;)
		originalPath = originalPath + &quot;index.html&quot;;
	var dest = config.macros.upload.destFile(storeUrl,toFilename,uploadDir);
	var log = new bidix.UploadLog();
	log.startUpload(storeUrl, dest, uploadDir,  backupDir);
	displayMessage(bidix.upload.messages.aboutToSaveOnHttpPost.format([dest]));
	if (bidix.debugMode) 
		alert(&quot;about to execute Http - GET on &quot;+originalPath);
	var r = doHttp(&quot;GET&quot;,originalPath,null,null,username,password,callback,uploadParams,null);
	if (typeof r == &quot;string&quot;)
		displayMessage(r);
	return r;
};

bidix.upload.uploadRss = function(uploadParams,original,posDiv) 
{
	var callback = function(status,params,responseText,url,xhr) {
		if(status) {
			var destfile = responseText.substring(responseText.indexOf(&quot;destfile:&quot;)+9,responseText.indexOf(&quot;\n&quot;, responseText.indexOf(&quot;destfile:&quot;)));
			displayMessage(bidix.upload.messages.rssSaved,bidix.dirname(url)+'/'+destfile);
			bidix.upload.uploadMain(params[0],params[1],params[2]);
		} else {
			displayMessage(bidix.upload.messages.rssFailed);			
		}
	};
	// do uploadRss
	if(config.options.chkGenerateAnRssFeed) {
		var rssPath = uploadParams[1].substr(0,uploadParams[1].lastIndexOf(&quot;.&quot;)) + &quot;.xml&quot;;
		var rssUploadParams = new Array(uploadParams[0],rssPath,uploadParams[2],'',uploadParams[4],uploadParams[5]);
		var rssString = generateRss();
		// no UnicodeToUTF8 conversion needed when location is &quot;file&quot; !!!
		if (document.location.toString().substr(0,4) != &quot;file&quot;)
			rssString = convertUnicodeToUTF8(rssString);	
		bidix.upload.httpUpload(rssUploadParams,rssString,callback,Array(uploadParams,original,posDiv));
	} else {
		bidix.upload.uploadMain(uploadParams,original,posDiv);
	}
};

bidix.upload.uploadMain = function(uploadParams,original,posDiv) 
{
	var callback = function(status,params,responseText,url,xhr) {
		var log = new bidix.UploadLog();
		if(status) {
			// if backupDir specified
			if ((params[3]) &amp;&amp; (responseText.indexOf(&quot;backupfile:&quot;) &gt; -1))  {
				var backupfile = responseText.substring(responseText.indexOf(&quot;backupfile:&quot;)+11,responseText.indexOf(&quot;\n&quot;, responseText.indexOf(&quot;backupfile:&quot;)));
				displayMessage(bidix.upload.messages.backupSaved,bidix.dirname(url)+'/'+backupfile);
			}
			var destfile = responseText.substring(responseText.indexOf(&quot;destfile:&quot;)+9,responseText.indexOf(&quot;\n&quot;, responseText.indexOf(&quot;destfile:&quot;)));
			displayMessage(bidix.upload.messages.mainSaved,bidix.dirname(url)+'/'+destfile);
			store.setDirty(false);
			log.endUpload(&quot;ok&quot;);
		} else {
			alert(bidix.upload.messages.mainFailed);
			displayMessage(bidix.upload.messages.mainFailed);
			log.endUpload(&quot;failed&quot;);			
		}
	};
	// do uploadMain
	var revised = bidix.upload.updateOriginal(original,posDiv);
	bidix.upload.httpUpload(uploadParams,revised,callback,uploadParams);
};

bidix.upload.httpUpload = function(uploadParams,data,callback,params)
{
	var localCallback = function(status,params,responseText,url,xhr) {
		url = (url.indexOf(&quot;nocache=&quot;) &lt; 0 ? url : url.substring(0,url.indexOf(&quot;nocache=&quot;)-1));
		if (xhr.status == 404)
			alert(bidix.upload.messages.storePhpNotFound.format([url]));
		if ((bidix.debugMode) || (responseText.indexOf(&quot;Debug mode&quot;) &gt;= 0 )) {
			alert(responseText);
			if (responseText.indexOf(&quot;Debug mode&quot;) &gt;= 0 )
				responseText = responseText.substring(responseText.indexOf(&quot;\n\n&quot;)+2);
		} else if (responseText.charAt(0) != '0') 
			alert(responseText);
		if (responseText.charAt(0) != '0')
			status = null;
		callback(status,params,responseText,url,xhr);
	};
	// do httpUpload
	var boundary = &quot;---------------------------&quot;+&quot;AaB03x&quot;;	
	var uploadFormName = &quot;UploadPlugin&quot;;
	// compose headers data
	var sheader = &quot;&quot;;
	sheader += &quot;--&quot; + boundary + &quot;\r\nContent-disposition: form-data; name=\&quot;&quot;;
	sheader += uploadFormName +&quot;\&quot;\r\n\r\n&quot;;
	sheader += &quot;backupDir=&quot;+uploadParams[3] +
				&quot;;user=&quot; + uploadParams[4] +
				&quot;;password=&quot; + uploadParams[5] +
				&quot;;uploaddir=&quot; + uploadParams[2];
	if (bidix.debugMode)
		sheader += &quot;;debug=1&quot;;
	sheader += &quot;;;\r\n&quot;; 
	sheader += &quot;\r\n&quot; + &quot;--&quot; + boundary + &quot;\r\n&quot;;
	sheader += &quot;Content-disposition: form-data; name=\&quot;userfile\&quot;; filename=\&quot;&quot;+uploadParams[1]+&quot;\&quot;\r\n&quot;;
	sheader += &quot;Content-Type: text/html;charset=UTF-8&quot; + &quot;\r\n&quot;;
	sheader += &quot;Content-Length: &quot; + data.length + &quot;\r\n\r\n&quot;;
	// compose trailer data
	var strailer = new String();
	strailer = &quot;\r\n--&quot; + boundary + &quot;--\r\n&quot;;
	data = sheader + data + strailer;
	if (bidix.debugMode) alert(&quot;about to execute Http - POST on &quot;+uploadParams[0]+&quot;\n with \n&quot;+data.substr(0,500)+ &quot; ... &quot;);
	var r = doHttp(&quot;POST&quot;,uploadParams[0],data,&quot;multipart/form-data; ;charset=UTF-8; boundary=&quot;+boundary,uploadParams[4],uploadParams[5],localCallback,params,null);
	if (typeof r == &quot;string&quot;)
		displayMessage(r);
	return r;
};

// same as Saving's updateOriginal but without convertUnicodeToUTF8 calls
bidix.upload.updateOriginal = function(original, posDiv)
{
	if (!posDiv)
		posDiv = locateStoreArea(original);
	if((posDiv[0] == -1) || (posDiv[1] == -1)) {
		alert(config.messages.invalidFileError.format([localPath]));
		return;
	}
	var revised = original.substr(0,posDiv[0] + startSaveArea.length) + &quot;\n&quot; +
				store.allTiddlersAsHtml() + &quot;\n&quot; +
				original.substr(posDiv[1]);
	var newSiteTitle = getPageTitle().htmlEncode();
	revised = revised.replaceChunk(&quot;&lt;title&quot;+&quot;&gt;&quot;,&quot;&lt;/title&quot;+&quot;&gt;&quot;,&quot; &quot; + newSiteTitle + &quot; &quot;);
	revised = updateMarkupBlock(revised,&quot;PRE-HEAD&quot;,&quot;MarkupPreHead&quot;);
	revised = updateMarkupBlock(revised,&quot;POST-HEAD&quot;,&quot;MarkupPostHead&quot;);
	revised = updateMarkupBlock(revised,&quot;PRE-BODY&quot;,&quot;MarkupPreBody&quot;);
	revised = updateMarkupBlock(revised,&quot;POST-SCRIPT&quot;,&quot;MarkupPostBody&quot;);
	return revised;
};

//
// UploadLog
// 
// config.options.chkUploadLog :
//		false : no logging
//		true : logging
// config.options.txtUploadLogMaxLine :
//		-1 : no limit
//      0 :  no Log lines but UploadLog is still in place
//		n :  the last n lines are only kept
//		NaN : no limit (-1)

bidix.UploadLog = function() {
	if (!config.options.chkUploadLog) 
		return; // this.tiddler = null
	this.tiddler = store.getTiddler(&quot;UploadLog&quot;);
	if (!this.tiddler) {
		this.tiddler = new Tiddler();
		this.tiddler.title = &quot;UploadLog&quot;;
		this.tiddler.text = &quot;| !date | !user | !location | !storeUrl | !uploadDir | !toFilename | !backupdir | !origin |&quot;;
		this.tiddler.created = new Date();
		this.tiddler.modifier = config.options.txtUserName;
		this.tiddler.modified = new Date();
		store.addTiddler(this.tiddler);
	}
	return this;
};

bidix.UploadLog.prototype.addText = function(text) {
	if (!this.tiddler)
		return;
	// retrieve maxLine when we need it
	var maxLine = parseInt(config.options.txtUploadLogMaxLine,10);
	if (isNaN(maxLine))
		maxLine = -1;
	// add text
	if (maxLine != 0) 
		this.tiddler.text = this.tiddler.text + text;
	// Trunck to maxLine
	if (maxLine &gt;= 0) {
		var textArray = this.tiddler.text.split('\n');
		if (textArray.length &gt; maxLine + 1)
			textArray.splice(1,textArray.length-1-maxLine);
			this.tiddler.text = textArray.join('\n');		
	}
	// update tiddler fields
	this.tiddler.modifier = config.options.txtUserName;
	this.tiddler.modified = new Date();
	store.addTiddler(this.tiddler);
	// refresh and notifiy for immediate update
	story.refreshTiddler(this.tiddler.title);
	store.notify(this.tiddler.title, true);
};

bidix.UploadLog.prototype.startUpload = function(storeUrl, toFilename, uploadDir,  backupDir) {
	if (!this.tiddler)
		return;
	var now = new Date();
	var text = &quot;\n| &quot;;
	var filename = bidix.basename(document.location.toString());
	if (!filename) filename = '/';
	text += now.formatString(&quot;0DD/0MM/YYYY 0hh:0mm:0ss&quot;) +&quot; | &quot;;
	text += config.options.txtUserName + &quot; | &quot;;
	text += &quot;[[&quot;+filename+&quot;|&quot;+location + &quot;]] |&quot;;
	text += &quot; [[&quot; + bidix.basename(storeUrl) + &quot;|&quot; + storeUrl + &quot;]] | &quot;;
	text += uploadDir + &quot; | &quot;;
	text += &quot;[[&quot; + bidix.basename(toFilename) + &quot; | &quot; +toFilename + &quot;]] | &quot;;
	text += backupDir + &quot; |&quot;;
	this.addText(text);
};

bidix.UploadLog.prototype.endUpload = function(status) {
	if (!this.tiddler)
		return;
	this.addText(&quot; &quot;+status+&quot; |&quot;);
};

//
// Utilities
// 

bidix.checkPlugin = function(plugin, major, minor, revision) {
	var ext = version.extensions[plugin];
	if (!
		(ext  &amp;&amp; 
			((ext.major &gt; major) || 
			((ext.major == major) &amp;&amp; (ext.minor &gt; minor))  ||
			((ext.major == major) &amp;&amp; (ext.minor == minor) &amp;&amp; (ext.revision &gt;= revision))))) {
			// write error in PluginManager
			if (pluginInfo)
				pluginInfo.log.push(&quot;Requires &quot; + plugin + &quot; &quot; + major + &quot;.&quot; + minor + &quot;.&quot; + revision);
			eval(plugin); // generate an error : &quot;Error: ReferenceError: xxxx is not defined&quot;
	}
};

bidix.dirname = function(filePath) {
	if (!filePath) 
		return;
	var lastpos;
	if ((lastpos = filePath.lastIndexOf(&quot;/&quot;)) != -1) {
		return filePath.substring(0, lastpos);
	} else {
		return filePath.substring(0, filePath.lastIndexOf(&quot;\\&quot;));
	}
};

bidix.basename = function(filePath) {
	if (!filePath) 
		return;
	var lastpos;
	if ((lastpos = filePath.lastIndexOf(&quot;#&quot;)) != -1) 
		filePath = filePath.substring(0, lastpos);
	if ((lastpos = filePath.lastIndexOf(&quot;/&quot;)) != -1) {
		return filePath.substring(lastpos + 1);
	} else
		return filePath.substring(filePath.lastIndexOf(&quot;\\&quot;)+1);
};

bidix.initOption = function(name,value) {
	if (!config.options[name])
		config.options[name] = value;
};

//
// Initializations
//

// require PasswordOptionPlugin 1.0.1 or better
bidix.checkPlugin(&quot;PasswordOptionPlugin&quot;, 1, 0, 1);

// styleSheet
setStylesheet('.txtUploadStoreUrl, .txtUploadBackupDir, .txtUploadDir {width: 22em;}',&quot;uploadPluginStyles&quot;);

//optionsDesc
merge(config.optionsDesc,{
	txtUploadStoreUrl: &quot;Url of the UploadService script (default: store.php)&quot;,
	txtUploadFilename: &quot;Filename of the uploaded file (default: in index.html)&quot;,
	txtUploadDir: &quot;Relative Directory where to store the file (default: . (downloadService directory))&quot;,
	txtUploadBackupDir: &quot;Relative Directory where to backup the file. If empty no backup. (default: ''(empty))&quot;,
	txtUploadUserName: &quot;Upload Username&quot;,
	pasUploadPassword: &quot;Upload Password&quot;,
	chkUploadLog: &quot;do Logging in UploadLog (default: true)&quot;,
	txtUploadLogMaxLine: &quot;Maximum of lines in UploadLog (default: 10)&quot;
});

// Options Initializations
bidix.initOption('txtUploadStoreUrl','');
bidix.initOption('txtUploadFilename','');
bidix.initOption('txtUploadDir','');
bidix.initOption('txtUploadBackupDir','');
bidix.initOption('txtUploadUserName','');
bidix.initOption('pasUploadPassword','');
bidix.initOption('chkUploadLog',true);
bidix.initOption('txtUploadLogMaxLine','10');


// Backstage
merge(config.tasks,{
	uploadOptions: {text: &quot;upload&quot;, tooltip: &quot;Change UploadOptions and Upload&quot;, content: '&lt;&lt;uploadOptions&gt;&gt;'}
});
config.backstageTasks.push(&quot;uploadOptions&quot;);


//}}}

</pre>
</div>
<div title="Wayland" creator="rvr" modifier="rvr" created="201711042217" modified="201907220400" changecount="8">
<pre>''Wayland'' is the [[display manager]] for Ubuntu 17+.
Found this out because: you can not start graphical applications as root from the terminal. And I was trying and failing to run [[Synaptic]].
Checking:
&lt;html&gt;&lt;pre&gt;
$ echo $XDG_SESSION_TYPE
wayland
&lt;/pre&gt;&lt;/html&gt;Wayland is designed to not allow elevated (sudo -H, gksu ...) permissions with GUI application programs. 
My Ubuntu 18 is back to [[X11|X Window System]].
&lt;html&gt;&lt;pre&gt;
$  echo $XDG_SESSION_TYPE
x11
&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="X Window System" creator="rvr" modifier="rvr" created="201408180433" modified="201907220428" changecount="41">
<pre>''X Window System''  is a windowing system for Unix systems. 
It is built up with:
*[[display server]] - in X it is specifically called [[X server]].
*''display server protocol'' - ''X11''.
*some libraries for development.
(Note: ''~X-Windows'' is not in any official documentation, but has entered common use.)
Official documentation also refers to it as ''X'' or ''X11'' or ''X Window System''.
''X.Org'' or ''Xorg'' is an ''x server'', an implementation for the X Window System - using ''X11'' protocol. It is the current standard.
It is architecture independent, to allow operation over a network to different terminals.
''X11'' is the lastest ''X'' protocol. It is a communication protocol between applications and the windowing system. 
It sets up a Unix/Linux Client Server system, based on the ''X'' protocol.
*It is the foundation that allows for basic graphic elements (moving, creating windows) to be drawn on the display. 
*Also recognizes keyboard &amp; mouse interactions.
*It is generic enough that it can run on many platforms. 
*It is designed to operate over network connections, so has a built in simplicity.
The actual GUI styling is done by ''other'' programs ([[Gnome]] or [[KDE]]) which runs as a [[window manager]] on top of X Windows.
Servers do not need to have X Windows - so its simple to remove X Windows software. When logging into a server you get the shell, there is no X - so you can't use a GUI.
Production servers usually do not have it installed, to make the system lean and secure.
Xorg, ~XFree86 and what we are talking about here, ''X11'' are all [[display server]]s.</pre>
</div>
<div title="X server" creator="rvr" modifier="rvr" created="201501131320" modified="201907220427" changecount="4">
<pre>The X server provides graphical services to applications, sometimes called X clients.
It sits between keyboard/mouse/screen and the x client. (Like a browser or terminal)
It is a [[display server]].</pre>
</div>
<div title="adduser" creator="rvr" modifier="rvr" created="201012091622" modified="201612172225" changecount="24">
<pre>The ''adduser'' command is most often used on Ubuntu.
The ''useradd'' is a low level basic user add command. It's default settings are at: @@/etc/default/useradd@@. If you want anything extra, you'll need to use flags. Run ''man useradd''
To add a user you have to run as root. This will add the user, a similar named group, prompt for a password and a start shell &amp; directory:
&lt;html&gt;&lt;pre&gt;
adduser &amp;lt;new username&amp;gt;			# -g for primary group   -G for secondary group
adduser &amp;lt;new username&amp;gt; &amp;lt;new groupname&amp;gt;

adduser rob
adduser rob coolgroup
&lt;/pre&gt;&lt;/html&gt;To see all users execute:  &quot;''cat [[/etc/passwd]]''&quot;
To look for a specific user: grep &lt;username&gt; /etc/passwd
To add a group to a user see [[useradd]].

Add user to a group, here we are running as root. 
&lt;html&gt;&lt;pre&gt;
# adduser rob
Adding user `rob' ...
Adding new group `rob' (1003) ...
Adding new user `rob' (1002) with group `rob' ...
Creating home directory `/home/rob' ...
Copying files from `/etc/skel' ...

# id rob
uid=1002(rob) gid=1003(rob) groups=1003(rob)
# gpasswd -a rob sudo
Adding user rob to group sudo
# id rob
uid=1002(rob) gid=1003(rob) groups=1003(rob),27(sudo)
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="alias" creator="rvr" modifier="rvr" created="201605152034" modified="202005252243" changecount="8">
<pre>The ''alias'' command is a [[builtin]] command used to make common long commands shorter. To see what commands you have, at the prompt type ''alias''.
Format is: @@alias [name[=value]]@@
&lt;html&gt;&lt;pre&gt;
alias ll='ls -alF'    # common listing 
unalias ll            # To undo an alias
&lt;/pre&gt;&lt;/html&gt;
To list all the aliases: 
&lt;html&gt;&lt;pre&gt;
$ alias
alias cleos='docker exec eosio /opt/eosio/bin/cleos --wallet-url http://localhost:8888'
alias egrep='egrep --color=auto'
alias glog='git log --graph --oneline --decorate'
alias gst='git status'
alias keosd='docker exec eosio /opt/eosio/bin/keosd '
alias 'ps -e | grep $1'
...
&lt;/pre&gt;&lt;/html&gt;
This is persisted in the dot files, like ''.bashrc'' or ''.bash_alias''.</pre>
</div>
<div title="apropos" creator="rvr" modifier="rvr" created="201608170530" modified="201608170530" changecount="3">
<pre>Search command descriptions with search string. Format:  @@apropos &lt;search-string&gt;@@
&lt;html&gt;&lt;pre&gt;
$ apropos &quot;list directory&quot;
dir (1)              - list directory contents
ls (1)               - list directory contents
ntfsls (8)           - list directory contents on an NTFS filesystem
vdir (1)             - list directory contents
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="apt-get" creator="rvr" modifier="rvr" created="201612012021" modified="201705172328" changecount="6">
<pre>The ''apt-get'' package management system is used by Debian based systems, like Ubuntu.
When you use ''apt-get'' it looks through ''/etc/apt/sources.list'' for repos where code lives, looking for what you need.
To get the latest files, run as root: @@apt-get update@@ - it will sync local cache wit the latest files.
To see what is in the cache run: @@apt-cache search nginx@@ - or whatever you want to see.
To install software run: @@apt-get install nginx@@ - and install starts off, you'll be prompted.
To see where it is installed: @@which nginx@@
For custom software, you may need to add a source to this file. </pre>
</div>
<div title="background" creator="rvr" modifier="rvr" created="201605181111" modified="201607020724" changecount="12">
<pre>When we are running an interactive shell, we are in the foreground.
When a command is running, it runs in the foreground. You cannot do anything until it completes.
You can run programs in the background. When you do this, the command runs, but you can still access commands in the foreground.
To place a command in the background, add an ''&quot;&amp;&quot;'', like this: @@&lt;command&gt; &amp;@@
To kill a foreground process: @@&lt;cntl&gt;-c@@
To suspend (ie stop) a running foreground process run: @@&lt;cntl&gt;-z@@
To place a suspended job into the background: @@bg [%num]@@
To put a background job into the foreground: @@fg [%num]@@
To kill any job: @@kill &lt;pid&gt;@@ - if this doesn't work, go for: @@kill -9 &lt;pid&gt;@@
To list jobs: @@jobs@@

&lt;html&gt;&lt;pre&gt;
$ ./big-time-program &amp;       # We are running this is the background because of the &quot;&amp;&quot;
   [4] 8675309               # This means job # 4 and the pid=8675309
$ jobs %4
   [4]+  Running        ./big-time-program &amp;
$ fg 4      #Now the program will be in the foreground
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="bash" creator="rvr" modifier="rvr" created="201510052001" modified="202301031309" changecount="13">
<pre>The Bash shell or ''~Bourne-Again Shell'' is a unix shell and a command language. Bash has two types of variables:
*''Global variables'' or ''system variables'' or [[environment variables]] - available in all shells.  
*''Local variables'' or [[shell variables]] - are only available in that shell.
Variables are traditionally all uppercase and can be displayed with ''env'' or ''printenv''. Variables can be categorized as: String, Integer, Constant, or Array.
How to [[create variables]].
&lt;html&gt;&lt;pre&gt;
$ echo $SHELL
/bin/bash
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="basic commands" creator="rvr" modifier="rvr" created="201501290357" modified="202302191556" changecount="111">
<pre>Here is a list of linux commands, see also 
* [[event designator]]
* [[builtin]]

|!Command|!Description|!Example|
|&amp;#33;&amp;#33;|Repeat last command. See [[event designator]].|&amp;#33;&amp;#33;|
|&amp;#33;cat|Repeat last time command cat was called. Or any other command.|&amp;#33;ca|
|&amp;#33;ca|Repeat last time command starting with &quot;ca&quot; was called. |&amp;#33;cat|
|&amp;#124;|The  [[pipe]], used to take results from one command to another.|cat file.txt &amp;#124; wc|
|[[bzip2|compression]]|Compress files, bz2 extension.|bzip2 *|
|[[bunzip2|compression]]|Unzip ~BZ2 files.|bunzip2  *.bz2|
|''cat''|Catalog - used to view small files.|cat some-file|
|''ctrl-r''|Search through cli history. aka reverse-i-search|ctrl-r ...|
|[[cp|file commands]]|Copy files.|cp file1 file2|
|[[cut]]|Cut out parts of a file. Cut 1st column |cut -c1 test.data|
|[[curl]]|Transfer files|curl -OL http://rtfm.ca/data.txt|
|[[dd]]|Disk to disk copying.|dd if=/dev/sda of=sda.mbr bs=512 count=1|
|[[diff]]|Difference between files.|some example.|
|''du''|Disk usage. h=human readble k=in fb.|du -k|
|[[find]]|Find files.|find . -name bin|
|[[grep]]|Look in files for something|grep food recipe.txt|
|[[gzip|compression]]|Compression utility. To compress everything in current directory.|gzip * |
|[[gunzip|compression]]|Unzips gzipped file.|gunzip gzip-zipped-file|
|[[head]]|Opposite of tail. Can change # lines displayed.|head some-file|
|[[less]]|To see more of a file. Use / and ? to search.|less some-file|
|[[locate]]|Used to find files. See [[find]].|locate fun|
|[[ls]]|List files and directories.|ls -la|
|''mkdir''|Make a directory|mkdir libation|
|[[mv|file commands]]|Rename/move a file or directory |mv some-thing|
|[[ps|process]]|Processes.|ps -ef|
|[[rm|file commands]]|Remove directory forcefully=f  recursively=r|rm -rf yikes-directory|
|[[rm|file commands]]|Remove a file: forcefully=f interactively=i|rm -i|
|''rmdir''|Remove an empty directory|rmdir 2bgone|
|[[rsync]]|Used for backing up data.|rsync source-file dest-file|
|[[sort]]|Sort stuff|sort -u some.file|
|[[shutdown]]|Shutdown the system.|shutdown -r|
|[[SSH]]|Secure shell - login to remote system.|ssh libation.net|
|[[tail]]|Used to print the last 10 lines of a file or log file.|tail log-file|
|''tac''|Used to look at a file backwards, one line at a time.|tac some-file|
|''tr''|Translate command. Turn &quot;sos&quot; into &quot;bob&quot;.|echo &quot;sos&quot; &amp;#124; tr &quot;s&quot; &quot;b&quot;|
|[[tar]]|Used for archival reasons, called a tarball.| |
|''touch''|To create an empty file. Use ''-d'' or ''-t'' to set timestamp. Format for ''-t'': [&amp;#91;CC]YY]~MMDDhhmm[.ss].|touch bite.me -d &quot;June 9, 1961&quot; |
|''tree -d''|View of filesystem (directories only) in a fancy tree format.|tree -d|
|''wc''|Word count - count the lines-words-bytes in a file. |wc ~RomeoAndJuliet.txt|
|''which''|To locate a program.|which rails|
|''whereis''|To also locate a program.|whereis rails|
|''w''|List users on system.||
|''who''|List who is logged system.|who -a  # a=all|
|''wget''|For downloading files from the Internet|wget -O newfile.zip 'https://..../old.file.zip'|
|[[xz]]|Most efficient compression. Used for Kernel.|xz foo|
|[[zip]]|Zip is used to un/zip windows zipped files.|zip lots *|
Maybe you are interested in [[shell commands]]?
Executable programs are usually found in /bin, /usr/bin, /sbin,/usr/sbin, or /opt.</pre>
</div>
<div title="boot process" creator="rvr" modifier="rvr" created="201408180542" modified="201501311920" changecount="15">
<pre>Here is the boot process, its very exciting.

On &amp;rArr; BIOS &amp;rArr; Boot Loader

#Turn computer on (you do this)
#BIOS fires up - Basic Input/Output System initializes . Its on a ROM chip.
##Tests hardware &amp; memory, aka the POST (Power On Self Test).
##From now on the operating system does everything. Control passed to Boot Loader
#[[Boot Loader]] - These pgms are either GRUB or ISOLINUX. Does lots.
Check out [[settings]], as well as [[/boot]]
</pre>
</div>
<div title="builtin" creator="rvr" modifier="rvr" created="201102051724" modified="202302191603" changecount="31">
<pre>A ''builtin'' is a command that is literally built in in the shell. The shell runs it. For performance reasons (forking) or because it needs direct access to shell internals.
You can see which commands are builtin by using the [[type]] command.
Commands (see [[basic commands]])  that are not builtin have to be loaded and run, and that takes time.

Here are some common ones (Bash shell):
|!Command|!Description|!Example|
|[[alias]]|Used to alias for a command.|alias ll = 'la -alF'|
|unalias|Used to remove an alias for a command.|unalias ll|
|cd|Change directory|cd /etc|
|echo|To print out stuff|echo $PATH|
|exit|Leave shell|exit 1|
|help|Help|HELP|
|jobs|List all running or stopped jobs|jobs -s|
|[[history]]|List history of commands|history 10|
|kill|kill|kill -9 &lt;[[PID]]&gt;|
|printf|Print formatted|printf &quot;The user is %s \n&quot; $USER|
|pushd|Push the current directory onto a stack.|pushd /usr/bin|
|popd|Pops the directory at head of stack.|popd|
|pwd|The current working directory|pwd|
|read|Read from standard input|read -p &quot;Name:&quot; name|
|[[set]]|Set shell attributes.|set -x|
|[[type]]|Determine what type of command something is|type -a ll|
Want to see more? Check out https://www.gnu.org/software/bash/manual/html_node/Bash-Builtins.html</pre>
</div>
<div title="bus" creator="rvr" modifier="rvr" created="201606120135" modified="202301031251" changecount="5">
<pre>Computer architecture utilizes a ''bus'' - which describes a communication system that transfers data between components in a computer.
With the advent of ~PCs, there have been various busses. Older ones are kept for backward compatibility. Here they are:
*''ISA'' (Industry Standard Architecture ), the first for 1980s IBM ~PCs, 4.77MHz at 16 bits wide, up to 9 ~MBps. (Megabytes per second)
*''EISA'' - (Extended Industry Standard Architecture ), because ISA needed a speed boost, was 32 bits wide at 8 ~MHz
*''~VL-Bus'' - (Vesa Local Bus), 32 bits wide and the speed matched the processor speed (25-33 ~MHz)! This was best used sparingly, or where speed was needed, like a graphics card.
*''PCI'' - (Peripheral Component Interconnect), created by Intel in the early 1990s. Like ~VL-Bus but also connect to the frontside bus. 
**The frontside bus connects to things like RAM and hard drives, operating at 400-800 ~MHz,
**The backside bus is faster then the frontside, accessing things like cache. Today its mostly builtin to the processor.
**PCI cards use 47 pins, went from 33 to 66 ~MHz and from 32 to 64 bits.</pre>
</div>
<div title="chgrp" creator="rvr" modifier="rvr" created="201012091618" modified="201702170811" changecount="17">
<pre>To change the group [[permissions]] we use the ''chgrp'' command.
In this example we have a file and a folder, both have ''group'' as ''xfiles'' and the ''owner'' is ''rob''.
&lt;html&gt;&lt;pre&gt;
-rw-rw-r--  1 rob  xfiles     0 Feb 16 23:34 fred.flintstone
drwxrwxr-x  2 rob  xfiles  4096 Feb 16 23:34 junk/
&lt;/pre&gt;&lt;/html&gt;
To change the group, format: ''chgrp &lt;new-group&gt; &lt;file|directory&gt;''
&lt;html&gt;&lt;pre&gt;
$ sudo chgrp area52 junk
$ ll
-rw-rw-r--  1 rob  xfiles     0 Feb 16 23:34 fred.flintstone
drwxrwxr-x  2 rob  area52  4096 Feb 16 23:34 junk/
&lt;/pre&gt;&lt;/html&gt;
You can also add a @@-R@@ to recursively change the group thru all subdirectories: @@chgrp -R &lt;new-group&gt; &lt;file|directory&gt;@@
See also [[group]] and [[chown]].
You can also set both owner &amp; group at once, see [[chown]].</pre>
</div>
<div title="chmod" creator="rvr" modifier="rvr" created="201012091712" modified="201612190337" changecount="42">
<pre>The ''chmod'' changes the [[permissions]] of files. A listing looks like:
&lt;html&gt;&lt;pre&gt;
1234567890  # See note below
drwxr-xr-x  2 root root 4096 Oct 31 13:13 Halloween/
&lt;/pre&gt;&lt;/html&gt;Broken down by column...
*1 - is file type - this is a ''d''irectory
*2,3,4 - ''User'' [[permissions]]
*5,6,7 - ''Group'' permissions
*8,9,0 - ''Other'' permissions
''First'': The options are built with up to 3 parts:
*''a'' for all groups
*''u'' for just user 
*''g'' for group
*''o'' for other.
''Second'':
*''+'' to add permission
*''-'' to remove permissions
*''='' to set it equal to
''Lastly'':
*''r''ead
*''w''rite
*e''x''ecute. 
&lt;html&gt;&lt;pre&gt;chmod [options] filename

chmod +r readme        # Changes the read permission for file readme - everyone can read this file.
chmod g+x runme        # Changes the execute permission so all in group can execute this file.
chmod a=rw             # Changes all groups (user, group &amp; other) to be rw. 
chmod 664 index.html   # Changes permissions so that we have: rw-rw-r--
chmod 600 id_rsa       # Changes permissions so that ssh will work. Can't have open permissions!
&lt;/pre&gt;&lt;/html&gt;
Notice use of numbers for options in the final example, this is explained in [[permissions]]. See [[SUID]] for an additional execute permission.

</pre>
</div>
<div title="chown" creator="rvr" modifier="rvr" created="201012091618" modified="201702170811" changecount="17">
<pre>To change the owner [[permissions]] we use the ''chown'' command. 
Here we have a file and a directory, the group is ''xfiles'' and ''area52'', both owned by ''rob''.
&lt;html&gt;&lt;pre&gt;
-rw-rw-r--  1 rob  xfiles     0 Feb 16 23:34 fred.flintstone
drwxrwxr-x  2 rob  area52  4096 Feb 16 23:34 junk/
&lt;/pre&gt;&lt;/html&gt;
To change the owner, the format is: ''chown &lt;new-owner&gt; &lt;file|directory&gt;''
&lt;html&gt;&lt;pre&gt;
$ sudo chown fred junk
$ ll
-rw-rw-r--  1 rob  xfiles     0 Feb 16 23:34 fred.flintstone
drwxrwxr-x  2 fred area52  4096 Feb 16 23:50 junk/
&lt;/pre&gt;&lt;/html&gt;
Note that this in not recursive, so the files inside junk will have the old owner still. 
However, any new files created in directory ''junk'' will have to be done by the new owner, ''fred''.
!!Change recursively through subdirectories
This can be done using format: ''chown &lt;new-name&gt;:&lt;new-group&gt; &lt;file|directory&gt;''
*To change owner in all subdirectories: ''chown -R fred junk'' 
*To change owner AND group in all subdirectories: ''chown -R fred:xfiles junk'' 
&lt;html&gt;&lt;pre&gt;
$ ll
-rw-rw-r--  1 rob  xfiles     0 Feb 16 23:34 fred.flintstone
drwxrwxr-x  2 fred area52  4096 Feb 16 23:55 junk/

$ sudo chown -R rob:xfiles junk
$ ll
-rw-rw-r--  1 rob  xfiles     0 Feb 16 23:34 fred.flintstone
drwxrwxr-x  2 rob  xfiles  4096 Feb 16 23:55 junk/
&lt;/pre&gt;&lt;/html&gt;Note that all files in directory junk will change, as well as subdirectories.
</pre>
</div>
<div title="color" creator="rvr" modifier="rvr" created="201611100700" modified="201711210620" changecount="36">
<pre>For color specs see [[ANSI color codes]].
You need to let the terminal know that you want to use colours, eg [[command prompt]].
#We need to wrap all things with special bash escape sequences, &quot;@@''\[''@@&quot; and &quot;@@''\]''@@&quot; - so when command line wraps we don't have problems. 
#Pick the colour, red=31, green=32, blue=34. 
##To make the color bold, add:  &quot;'';1''&quot; and if you make it &quot;'';0''&quot; you get default scheme.
##Example, for a bold red, it'd be: @@''31;1''@@
#Next sandwich the colour you want between a @@''\e[''@@ and an @@''m''@@.  So red would be: 
##Example, for a bold red, it'd be: @@''\e[31;1m''@@
#As stated in #1 we need to wrap it all up inside: &quot;@@''\[''@@&quot; and &quot;@@''\]''@@&quot;
##Finally, an example, for a bold red, it'd be: @@''\[\e[31;1m\]''@@
#Now we finally add the bash [[command prompt]] value, so  @@''\u''@@ for username.
#End by returning default values, using number ''0'', so: ''@@\e[0m@@''
##A complete line with @@''\u''@@ followed by a @@'':''@@ and finally a @@''\W''@@ would be: @@''~PS1=&quot;\[\e[31;1m\]\u:\[\e[32;1m\]\W&gt; \[\e[0m\]&quot; ''@@   (note: 32=green)

Also, another way, delimited different than above: 
&gt;''~PS1='\[\033[42;1;37m\]\u@\[\033[02;38m\]\W&gt; \[\e[0m\]'''
For sequence: ''42;1;37'' = ''background color;style;;foreground color'' - note can omit background color. so ''02;38'' for example.
#42=red background
#1=bold
#37=white.grey
Background colors all start with 4, foreground with 3
*0=black, so 40=black background
*1=red, so 31=red foreground
*2=green
*3=brown
*4=lite blue
*5=purple
*6=blue
*7=white/grey
''Style'' 
*1=bold
*2=normal
*3=italic
*4=underline
*5=blink (doesn't always work)
*6=??nothing
*7=inverse
*8=empty/invisible
*9=--sthrikethrough
</pre>
</div>
<div title="command prompt" creator="rvr" modifier="rvr" created="201501300029" modified="201905230024" changecount="37">
<pre>The variable for the ''command prompt'' is ''$~PS1'' or &quot;Prompt String 1&quot; There are 4 prompt strings. You can also do [[color]]
The ''$'' is the prompt for a normal user.
The ''#'' is the prompt for the superuser or [[root]] user.
You can shorten the path listing by using: (&quot;''~PROMPT_DIRTRIM=3''&quot;) in @@,bashrc@@ (Use export)
To set a prompt string:
&lt;html&gt;&lt;pre&gt;
# Starting off the prompt is &quot;$&quot;
$ export PS1=&quot;\u$ &quot;  # New prompt is &quot;rob$&quot;
rob$ echo $PS1
\u$

rob$ export PS1=&quot;\u#&quot;
rob#

rob# export PS1=&quot;\u:[\t]$ &quot;
rob:[13:42:50]$ 

# To set it in the profile, use vi or command line:
rob:[13:42:55]$ echo 'export PS1=&quot;[\u@\h \w]\$ &quot;' &gt;&gt; ~/.bashrc

&lt;/pre&gt;&lt;/html&gt;Here are the values to use:
*\u – Username
*\h – Short Hostname
*\H – Fully qualified Hostname
*\w – Full path of the CWD
*\W - Short CWD
*\t - current time 24 hr
*\A - 24hr format HH:MM
*\d - date
*\@ - time 12 hr - with am/pm
*\T - time 12 hr
*\j – the number background jobs
*\v - bash version
*\$ - If uid=0 then # else $
*\# - line # (for history)
*\! - history number of the command 
*\n - new line - for multi-line prompts</pre>
</div>
<div title="commands" creator="rvr" modifier="rvr" created="201408180508" modified="201612061842" changecount="18">
<pre>Commands in unix consist of three parts, and command and two parameters.
*Command - this is a must and the only required one. ie ls for list.
**Usually explain ''what'' to do.
*Arguments - what the command operates on.
**Usually explain ''what to do with it''.
**When you want to run a command - linux only looks in the [[path]] variable. To have linux look in your current directory, you have to specify it by: ./
*Options - start with a dash, a command can have options like -v or &amp;ndash;&amp;ndash;version  ... for the version!
**Some commands use two dashes: @@&amp;#45;-@@
**Usually show ''how'' to do something.

You can rerun previous commands by
*using [[history]]
*using ''cntl-p''
*using the up arrow: ''↑''
*using: ''!!''
*using ''!-1'' - also note you can use ''!-2'' etc
You can also use ''!grep'' to use the last grep command. Use space to expand. (Because you added ''bind Space:magic-space'' to the ''.bashrc'' file)
See [[basic commands]].</pre>
</div>
<div title="compression" creator="rvr" modifier="rvr" created="201502072233" modified="201612101816" changecount="13">
<pre>There are a few different compression programs.
*''bzip2'' - very efficient in compressing lots
**Example: ''{{{gzip -r projectX}}}'' - zips up everything in current directory
*''gzip'' - most frequently used, along with ''gunzip''
** ''$ gzip * $ gzip -r libation'' - compresses all files in the libation directory and all files underneath recursively.
*[[xz]] - most efficient space saving program
*[[zip]] - for un/compressing files from other systems
Compressing takes more time then decompressing, The more efficient the decompression, the longer it takes.
Also, [[tar]] is used to group files in an archive, which is then compress.</pre>
</div>
<div title="console" creator="rvr" modifier="rvr" created="201408180446" modified="201612051935" changecount="4">
<pre>In ancient history the console was a physical thing, attached to a special dedicated port on a computer. It can be a [[terminal]], the only difference is that the console was to a dedicated port, a terminal can also do that but it can also connect as a regular user.
Today linux systems have virtual consoles or [[virtual terminal]]s. These are accessed through key combinations (e.g. Alt+F1 or Ctrl+Alt+F1; ...) and are basic OS services so come ready out of the box to use. 
Interacting with the console is also done using a shell program.</pre>
</div>
<div title="create variables" creator="rvr" modifier="rvr" created="201510052022" modified="202301031309" changecount="11">
<pre>Both [[shell variables]] and [[environment variables]] can be created on the fly.
Typically environment variables are all UPPER case and shell variables are often lowercase. This is convention only.
VARNAME=&quot;value&quot; - to create a shell variable.

&lt;html&gt;&lt;pre&gt;
$ USER=&quot;Rob&quot;              # This is created in current shell only
$ echo $USER              # Print this out
Rob
$ export USER             # Now this variable is available to all child shells
$ export secret=&quot;Shhhh&quot;   # Can create and export in one step
&lt;/pre&gt;&lt;/html&gt;
There are reserved names you cannot use: HOME, MAIL, PATH, ~PS1, ~PS2, UID, BASH, ...</pre>
</div>
<div title="cron" creator="rvr" modifier="rvr" created="201605191814" modified="202301031312" changecount="58">
<pre>''cron'' is a time based scheduling service (daemon). 
Check out https://crontab.guru/
*Used to preform automated jobs and routine maintenance.
*Individual users can have their own ''crontabs''.
*Anticipated to be running 24/7
''anacron'' is used to execute commands periodically, with a frequency specified in days. 
*Does not assume to be running 24/7
''crontab'' is a text configuration file that lists shell commands
*It is edited by @@font-size:2em;crontab -e@@ command - also creates one if none exists.
*The ''cron'' daemon will look at this file &amp; execute commands as necessary
*It is at: @@/var/spool/cron/crontabs@@
The format has 5 fields + command:
|Minute |Hour |Day of month |Month of year |Day-of-week|shell cmd|
|0-59|0-23|1-31|1-12|0-6,  0 is Sunday.|shell cmd|
*A &quot;''*''&quot;  - means all
*There are shortcuts, read man pages. Can be ''@yearly'', ''@daily'', ''@weekly''
*You can separate multiple values with a comma
*@@* * * * /some/test/job@@ - Runs every minute - good to test with, don't panic.
*@@0 * * * * fred /some/hourly/job@@ - As user ''Fred'' - runs hourly at top of hour(0), could also use ''@hourly''.
*@@8 * * * * /some/hourly/job2@@ - Runs hourly at 8 minutes past top of hour.
*@@0 12 * * * /other/daily/job@@ - Runs daily at noon, could also use ''@hourly''
*@@0,15,30,45 * * * * /home/user/fred/break-rocks@@  - Run break-rocks every 15 minutes.
*@@30 8 13 wilma /some/test/job@@ - As user ''Wilma'' - runs at 8:30am on the 13th of the month.
*@@7 1 * * 6 /opt/work/something-big@@ - Run something-big at 1:07am on a Saturday morning, every month.
*@@7 1 * * 6 /opt/work/something-big &gt; /log/big.log 2&gt;&amp;1@@ - Like above but send all output to /log/big.log
|!Command|!Description|
|''crontab &lt;file&gt;''|Run crontab using a &quot;file&quot;.|
|''crontab -l''|List crontab jobs.|
|''crontab -e''|Edit cron jobs.|
|''crontab -r''|Remove all cron jobs.|

To check system logs:  @@ tail -f /var/log/syslog@@
To check cron logs:  @@ cat /var/log/cron.log @@
Check status: @@ps ax | grep cron@@
Check status: @@systemctl status cron@@
Start/Stop service:  @@sudo service cron restart@@

In  Linux Mint: @@service cron status@@


One thing to test is to run a temp job. Add ''* * * * * env &gt; /tmp/env.rob.output'' to cron and see the results with just running ''env''
Also, are you running as root or your username?
Variables in /etc/environment are loaded for cron, not your typical variables!
If you need a certain path, include it in your script. Example:
&lt;html&gt;&lt;pre&gt;
#!/bin/bash
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
...
&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="curl" creator="Rob" modifier="rvr" created="201511211537" modified="201905040019" changecount="21">
<pre>The ''curl'' command is used for transferring files, typically from the interwebs. It has many uses and options, very flexible so check man pages for details.
The form is @@curl [options] [url]@@
Here are some examples:
|!Example|!Description|
|curl -I http://rtfm.ca|Get the HTTP header only. Capital &quot;i&quot; @@I@@|
|curl -O http://rtfm.ca/readme.txt|Pulls file from URL naming it readme.txt in local directory|
|curl  http://rtfm.ca/readme.txt -o some-other-name.blah|Pulls file from URL and renaming it local directory.|
|curl -v http://rtfm.ca|Get the HTTP header only. User (v) Verbose mode, tell us everything.|
If you specify no options, the data will load to the CLI.

The command: @@curl -i http://rtfm.ca/stuff@@
*Option ''&quot;i''&quot; - means to get the ~HTTP-header in the output
*Option ''&quot;I&quot;'' - if used, means to ''only'' get the ~HTTP-header in the output

To download a file to your current directory from a remote site, ''rtfm.ca'':
Command: @@curl -o ~BestOfTimes.txt -OL rtfm.ca/stuff/bot.txt@@
*Option ''&quot;o&quot;'' - is output, what the file will be named locally.
*Option ''&quot;O&quot;'' - is to write output to a local file named like the remote file name, in this case: @@bot.txt@@
*Option ''&quot;L&quot;'' - the the location of the file. Can add path/name, ie @@/home/fred/text/best.times.txt@@</pre>
</div>
<div title="cut" creator="rvr" modifier="rvr" created="201612110655" modified="201612110705" changecount="7">
<pre>Cut is used to cut out parts of a file.
File: ''alpha.text''
{{{1234567890}}}
{{{abcdefghij}}}
{{{zyxwvutsrq}}}

Cutting columns 2-4
&lt;html&gt;&lt;pre&gt;
$ cut -c2-4 alpha.text 
234                          
bcd                          
yxw                          
&lt;/pre&gt;&lt;/html&gt;
Cutting columns 2, 4, 6:
&lt;html&gt;&lt;pre&gt;
$ cut -c2,4,6 alpha.text 
246                            
bdf                            
ywu                                                   
&lt;/pre&gt;&lt;/html&gt;
New file with spaces. The ''cut'' command has more options:
*''-d&quot; &quot;'' - means delimit on spaces.
*''-f'' means field, so ''-f3'' = field 3
&lt;html&gt;&lt;pre&gt;
$ cat omega.text          
  This is line one                
  Wonder about this one           
  Last but not least              
$ cut -d&quot; &quot; -f3 omega.text
  line                            
  this                            
  not                                                                              
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="daemon" creator="rvr" modifier="rvr" created="201605250939" modified="202301031310" changecount="11">
<pre>A daemon is a process that runs in the background, but not just anything in the background. It should not be attached to a terminal. 
There should be a parent [[PID]] as the [[Init]], often a PID of 1.
It is not interactive or under the direct control of a user.
It is activated by the occurrence of a specific event or condition.
You can often differentiate them by name because most daemons end in the letter &quot;''d''&quot; - like [[systemd]] or ''journald'', see [[journalctl]].
It is different from a [[service]], which can interact with a user, such as an apache web server or a postgres SQL db.</pre>
</div>
<div title="dd" creator="rvr" modifier="rvr" created="201502110726" modified="201612060650" changecount="5">
<pre>''dd'' is dIsk to disk copying. Also called &quot;disk destroyer&quot;. 
@@color(red):Be careful with this!!@@ To copy from one entire disk to another: ''{{{dd if=/dev/sda of=/dev/sdb}}}''
To back up your Master Boot Record (the first 512 byte sector on the disk that contains a table describing the partitions on that disk):
''{{{dd if=/dev/sda of=sda.mbr bs=512 count=1}}}''</pre>
</div>
<div title="debug shell" creator="rvr" modifier="rvr" created="201102070313" modified="201102070315" changecount="3">
<pre>Debugging shell commands. There are a couple of ways , include it on the ''shebang'' line: @@#!/bin/bash -x@@. Or enter it in the code using the [[builtin]] command ''set'':
&lt;html&gt;&lt;pre&gt;
#!/bin/bash 
set -x     # Turn debugging on
echo date  # Some shell commands
set +x     # Turn debugging off
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="definitions" creator="rvr" modifier="rvr" created="201408180536" modified="202301031250" changecount="60">
<pre>|!Word|!Description|
|[[kernel]]|the glue between hardware and applications.|
|[[distribution]]|There are 4 basic families: debian, Fedora, SUSE, and Other.]]|
||There are many individual distros, [[Ubuntu]], [[Mint]], ~CentOS, ~OpenSUSE|
|[[Boot Loader]]|The program that loads the OS, ie Grub or ISOLINUX.|
||See also [[boot process]]|
|[[typical filesystem]]|How the directory structure looks.|
|[[service]]|Program that runs as a [[background]] process.|
||Examples are httpd, nfsd, ftpd, ...|
|[[filesystem]]|how the files are stored.|
||ie ext3, ext4, FAT, NTFS, JFS, Btrfs, ...|
||Flash storage filesystems - ubifs, ~JFFS2, YAFFS, ...|
|[[shell]]|Is the CLI that interprets what you type for OS instructions.|
||ie.e bash, zsh, tsch, ...]]|
|[[CLI]]|Command-line-interface. Accessed by shell via ALT+Fn key.|
|''X''|Short for the [[X Window System]]. It is a system for handling the client-server communication in a Linux environment. Works easily in a network.|
|''X11''|The latest X protocol. It encodes things such as graphic primitives, images, pointer motion, and key presses. See [[X Window System]].|
|''Xorg''|Xorg is an open source implementation of X. It includes an X server that uses ''X11'' for client/server communication.|

!The System
|!Word|!Description|
|[[desktop environment]]|A bunch of programs that run under a specific GUI. Runs on top of a [[window manager]]. Consists of a [[window manager]] and a [[session manager]].|
|[[window manager]]|Part of [[desktop environment]]. Controls window placement and appearance.|
|[[session manager]]|Part of [[desktop environment]]. State of your desktop.|
|[[X Window System]]|Is a windowing system that gives a basic framework for ~GUIs on most Linux systems. aka ''X'' or ''X11''. Communicates via [[display server]].|
|[[display server]]|This sits between the GUI and the [[kernel]]. Serves the graphical environment. Part of [[X Window System]].|
|[[display manager]]|Starts up the graphical system, and can ask you to login. Keeps track of graphical environment. Starts the [[desktop environment]]. Last part of [[boot process]].|
|[[kernel]]|Ya, the ''kernel''.|

</pre>
</div>
<div title="desktop environment" creator="rvr" modifier="rvr" created="201501131324" modified="202008110505" changecount="27">
<pre>The desktop environment consists of:
*a [[session manager]], which starts and maintains the components of the graphical session.
*a [[window manager]], which controls the placement and movement of windows, window title-bars, and controls.
*lots of software, fonts, icons, and a set of utilities
Examples include.
*[[KDE]] - the most popular desktop. Used in Mandriva and Suse.
*[[Gnome]] - The grandpa. Used in ~CentOS, Fedors, Ubuntu18.
*Unity - developed for [[Ubuntu]], based on Gnome. Built for simplicity.
*Cinnamon - [[Mint]], based on Gnome 3, the flagship for Mint. Heavy on 3D and resources.
*Mate - [[Mint]], based on Gnome 2, lighter on computer resources.
*Xfce - Very lightweight and configurable. Lighter than Cinnamon and Mate. Aims to consume minimal resources. Xubuntu.
*Lxde - Lightweight X11 desktop environment. Meant for older machines. Consume minimal resources.
What do you have?
&lt;html&gt;&lt;pre&gt;
$ env | grep XDG_CURRENT_DESKTOP
  XDG_CURRENT_DESKTOP=ubuntu:GNOME

~$ echo $XDG_CURRENT_DESKTOP
ubuntu:GNOME

&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="desktop manager" creator="rvr" modifier="rvr" created="201501131343" modified="201501222013" changecount="5">
<pre>See [[desktop environment]]. This is what is usually meant by ''desktop manager''.</pre>
</div>
<div title="detemine machine" creator="rvr" modifier="rvr" created="201612081912" modified="202007182340" changecount="5">
<pre>What shell or machine are you running? Note that you may have to try different commands!
You can also [[determine hardware]].
&lt;html&gt;&lt;pre&gt;
$ echo $SHELL
/bin/bash

$ bash --version
GNU bash, version 4.3.11(1)-release (x86_64-pc-linux-gnu)

$ uname -r      #s=name   n=hostname   r=release number   v=kernel version  m=hardware type  p=processor  o=o/s 
3.10.0-327.36.3.el7.x86_64

$ uname -a    # a=all
Linux test.rtfm.ca 3.10.0-327.36.3.el7.x86_64 #1 SMP Mon Oct 24 16:09:20 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux

$ cat /etc/issue
Debian GNU/Linux 5.0 \n \l

$ cat /etc/redhat-release
CentOS Linux release 7.2.1511 (Core)

$ cat /etc/os-release
NAME=&quot;CentOS Linux&quot;
VERSION=&quot;7 (Core)&quot;

$  cat /proc/version
Linux version 2.6.35.4-rscloud (root@bui...

$ lsb_release -a
  Distributor ID:	Ubuntu
  Description:	Ubuntu 14.04.4 LTS
  Release:	14.04
  Codename:	trusty

$ inxi -Fxz    # Linux Mint specific - loads of info
System:    Host: fred-mint Kernel: 4.4.0-128-generic x86_64 (64 bit gcc: 5.4.0)
...

$ whoami
root

$ host rtfm.ca
  rfm.ca has address 198.27.68.115

$ nslookup rfm.ca
  Server:		173.203.4.9
  Address:	173.203.4.9#53
&lt;/pre&gt;&lt;/html&gt;Looking at setting up a linux box? See [[setup machine]].</pre>
</div>
<div title="determine hardware" creator="YourName" modifier="rvr" created="202007182339" modified="202007182343" changecount="6">
<pre>What hardware do ya have?
&lt;html&gt;&lt;pre&gt;
$ sudo apt-get install inxi
$ inxi -F
  System:    Host: rxr-tmate Kernel: 4.15.0-58-generic x86_64 bits: 64 Desktop: Gnome 3.28.4
           Distro: Ubuntu 18.04.2 LTS
  Machine:   Device: laptop System: Acer product: TravelMate P259-G2-MG v: V1.32 serial: N/A
  ...
&lt;/pre&gt;&lt;/html&gt;
Tons of info: ''@@sudo lshw@@''
Basic info: ''@@sudo lshw -short@@''</pre>
</div>
<div title="device" creator="rvr" modifier="rvr" created="201606120146" modified="202301031303" changecount="16">
<pre>To see all your devices:
&lt;html&gt;&lt;pre&gt;
$ ls -la /sys/bus/pci/devices      # Just show last 5
...
lrwxrwxrwx 1 root root 0 juin  11 15:44 0000:00:1f.0 -&gt; ../../../devices/pci0000:00/0000:00:1f.0
lrwxrwxrwx 1 root root 0 juin  11 15:44 0000:00:1f.2 -&gt; ../../../devices/pci0000:00/0000:00:1f.2
lrwxrwxrwx 1 root root 0 juin  11 15:44 0000:00:1f.3 -&gt; ../../../devices/pci0000:00/0000:00:1f.3   # This one
lrwxrwxrwx 1 root root 0 juin  11 15:44 0000:01:00.0 -&gt; ../../../devices/pci0000:00/0000:00:1c.0/0000:01:00.0
lrwxrwxrwx 1 root root 0 juin  11 15:44 0000:02:00.0 -&gt; ../../../devices/pci0000:00/0000:00:1c.1/0000:02:00.0
&lt;/pre&gt;&lt;/html&gt;
Examining an entry: ''0000:00:1f.3'', it tells us:
*''0000'' - PCI domain
*''00'' - bus number the device is attached to
*''1f'' - the device number
*''3'' - PCI device function
NOTE: If you have too many ''unknown'' classes, run: @@sudo update-pciids@@

!!Running lspci
&lt;html&gt;&lt;pre&gt;
$ lspci | tail -5
00:1f.0 ISA bridge: Intel Corporation HM76 Express Chipset LPC Controller (rev 04)
00:1f.2 SATA controller: Intel Corporation 7 Series Chipset Family 6-port SATA Controller [AHCI mode] (rev 04)
00:1f.3 SMBus: Intel Corporation 7 Series/C210 Series Chipset Family SMBus Controller (rev 04)
01:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller (rev 09)
02:00.0 Network controller: Qualcomm Atheros AR9485 Wireless Network Adapter (rev 01)

$ lspci -n | tail -5      # -n - Show PCI vendor and device codes as numbers instead of looking them up in the PCI ID list.
00:1f.0 0601: 8086:1e59 (rev 04)
00:1f.2 0106: 8086:1e03 (rev 04)
00:1f.3 0c05: 8086:1e22 (rev 04)
01:00.0 0200: 10ec:8168 (rev 09)
02:00.0 0280: 168c:0032 (rev 01)
&lt;/pre&gt;&lt;/html&gt;
Examining the same entry as above: ''00:1f.3 0c05: 8086:1e22 (rev 04)'', it tells us:
*''00:1f.3 0c05'' = bus number (00), device number (1f) and function (0)
*''0c05'' - device class  (Class 0c05 is ~SMBus Serial Controller)
*''8086'' - vendor ID   (See: http://pci-ids.ucw.cz/read/PC?restrict=8 - you get Intel)
*''1e22'' - device ID  (See: http://pcidatabase.com/search.php?device_search_str=1e22 - ~SM-Bus Controller of the Intel Z77 Chipset)

To further drill down, we ''cd'' into ''0000:00:1f.3'' and display one or more pseudo-device entries:
&lt;html&gt;&lt;pre&gt;
$ cd /sys/bus/pci/devices/0000:00:1f.3
$ ll
total 0
drwxr-xr-x  3 root root    0 juin  11 15:44 ./
drwxr-xr-x 17 root root    0 juin  11 15:44 ../
-rw-r--r--  1 root root 4096 juin  11 19:00 broken_parity_status
-r--r--r--  1 root root 4096 juin  11 15:45 class
-rw-r--r--  1 root root  256 juin  11 15:45 config
-r--r--r--  1 root root 4096 juin  11 19:00 consistent_dma_mask_bits
-rw-r--r--  1 root root 4096 juin  11 19:00 d3cold_allowed
-r--r--r--  1 root root 4096 juin  11 15:50 device
-r--r--r--  1 root root 4096 juin  11 19:00 dma_mask_bits
-rw-r--r--  1 root root 4096 juin  11 19:00 driver_override
...
&lt;/pre&gt;&lt;/html&gt;
And to view, just run: ''cat''
&lt;html&gt;&lt;pre&gt;
$ cat device 
0x1e22
$ cat class
0x0c0500
...
&lt;/pre&gt;&lt;/html&gt;
For a little more ''lspci'' see [[device]]</pre>
</div>
<div title="df" creator="rvr" modifier="rvr" created="201905040024" modified="202005260138" changecount="2">
<pre>The ''df'' command shows how much space you have used.
Use @@-h@@ to make it &quot;human readable&quot;. We like MB and GB rather than bytes.
To omit [[snap]] installed stuff, use: @@df -h -x squashfs@@
</pre>
</div>
<div title="diff" creator="rvr" modifier="rvr" created="201502072156" modified="201604111557" changecount="12">
<pre>The ''diff'' command is for finding differences between two files. Format is: ''{{{ diff file-1 file-2  &lt;switches&gt; }}}''
Here are the switches you can use:
*''-c'' : shows 3 lines of ''context'' between differences.
*''-r'' : ''recursively'' search thru subdirectories.
*''-i'' : ''ignore'' case of the letters.
*''-w'' : ignore ''whitespace''.
Often updates are done by ''patches''. The ''diff'' command is used to make a patch. A patch is the ''differences'' between the old file and the updated file. A typical patch is created by the command:  {{{diff -Nur originalfile newfile &gt; patchfile}}}
To install a patch on a single file: {{{patch originalfile patchfile}}}
To install a patch over a directory: {{{patch -p1 &lt; patchfile}}}
See also [[kdiff3]]</pre>
</div>
<div title="diff examples" creator="rvr" modifier="rvr" created="201502010715" modified="201601100812" changecount="5">
<pre>Here are some [[diff]] examples.
|!Command|!Description|!Explanation|
Maybe not.</pre>
</div>
<div title="display manager" creator="rvr" modifier="rvr" created="201501131320" modified="201907220254" changecount="19">
<pre>The ''display manager'' is responsible for starting the graphics system, logging in the user, and starting the user’s desktop environment. 
You can often select from a choice of [[desktop environment]]s when logging in to the system.
A ''display manager'' is aka login manager. Runs as root, or as a dedicated or [[service user]].
The display manager (aka X Display Manager) starts a session on an [[X server]], logs in the user, and starts the [[desktop environment]]. It also keeps track of the displays. It handles:
*display management (displays being provided)
*loads [[X server]]
*manage graphical logins
*fires up [[desktop environment]] after login.
These can be:
*gdm - default display manager for [[Gnome]] 
*xdm - the default Display Manager for X Window System
*kdm - default display manager for KDE
*lightdm - default display manager for [[Ubuntu]]
It looks like the display manager for Ubuntu17 is [[Wayland]].
One way to see is:
&lt;html&gt;&lt;pre&gt;
$ cat /etc/X11/default-display-manager
/usr/sbin/gdm3
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="display server" creator="rvr" modifier="rvr" created="201501131411" modified="201907220358" changecount="13">
<pre>The ''display server'' keeps track of input and output of its clients to and from the rest of the OS. It is the only program that talks to the [[window manager]]. It also is in between the GUI and the [[kernel]]. 
This software can be:
*Xorg Server - standard for *nix (implements ''X11'' protocol)
*~KWin
*[[Wayland]] - uses different protocol called &quot;Wayland&quot;, It's not X11.
**Meant to replace X11, with open source &amp; be simplier.
*~SurfaceFlinger (Google Android)
*Quartz Compositor (~MacOS)
*Desktop Window Manager (MS Windows)</pre>
</div>
<div title="distribution" creator="rvr" modifier="rvr" created="201501131038" modified="201501221843" changecount="7">
<pre>A ''distribution'' or ''distro'' is the [[kernel]] plus a whole pile of other stuff: software, tools, manuals. games, GUI software, and package management. There are three types of these things:
*embedded (eg phones, etc)
*server (eg, RHEL, ...)
*desktop (eg. [[Ubuntu]], [[Mint]], ...)
Distributions often come with code names, like [[Mint]] 17.1 is code named &quot;Rebecca&quot;.</pre>
</div>
<div title="documentation" creator="rvr" modifier="rvr" created="201501260619" modified="201612071833" changecount="11">
<pre>There are a few places to get documentation
*[[man pages]] 
*help command &amp;ndash;&amp;ndash;help
*use ''whereis'', [[locate]] or [[find]]
*GNU info system, see:  [[info]]
*GNOME: gnome-help
*KDE: khelpcenter
*package documentation:
**''/usr/doc/packagename''
**''/usr/share/doc/packagename''
**''/usr/share/doc/packages/packagename''
*online, like:  https://www.gentoo.org/doc/en/ or https://help.ubuntu.com/ or  https://www.centos.org/docs/ ...
*Run command: 
**@@rpm -ql packagename | grep doc@@
**@@rpm -ql packagename | grep README@@</pre>
</div>
<div title="echo" creator="rvr" modifier="rvr" created="201709302108" modified="201905040029" changecount="6">
<pre>The ''echo'' command is used to print to the linux command line.
&lt;html&gt;&lt;pre&gt;
$ echo &quot;hello&quot;   # =&gt; hello
$ echo &quot;Hello&quot;   # =&gt; Hello
$ echo $FLASK_ENV  # =&gt; Print out environment var
&lt;/pre&gt;&lt;/html&gt;
To enable special characters use the ''e'' switch:
&lt;html&gt;&lt;pre&gt;
$ echo -e &quot;Hello world\r\nGoodbye cruel world&quot;
Hello world
Goodbye cruel world
&lt;/pre&gt;&lt;/html&gt;
It can also be used to write to a file.
*Creates file if there is none.
*The @@&gt;@@ overwrites contents of existing file. 
*The @@&gt;&gt;@@ appends to file.
&lt;html&gt;&lt;pre&gt;
$ echo &quot;First line&quot; &gt; first.one   
&lt;/pre&gt;&lt;/html&gt;
See also [[&gt; and &gt;&gt;]]
</pre>
</div>
<div title="environment variables" creator="rvr" modifier="rvr" created="201502120344" modified="202211091130" changecount="34">
<pre>Bash shells don't rigidly define environment variables vs [[shell variables]], other shells do. I will artificially separate the two for this wiki.
''environment variables'' (aka system variables) are read by the command [[shell]], like Bash, and made shell variables from that point on.
Common Environment Variables
|!Variable|!Description|
|EDITOR|The edit program to run.|
|MAIL|The path to mail directory.|
|HOME|The users Home directory.|
|HOSTNAME|The FQDN.|
|LOGNAME|The login name of the user.|
|OLDPWD|The previous working directory.|
|PATH|A colon separated list of directories to search for commands.|
|PWD|The present working directory.|
|USER|The username.|
Some are set  by the system and some are custom created by the user. You can see what they are by issuing either:
*''set'' - used for  [[shell variables]].
*''env'' or ''printenv'' - an environment shell command used to display env variables.
*''echo'' - used to display vars, but prefix with a &quot;''$''&quot;
*[[export]] - used to set env vars from the command line, applies to all future shells, but gone after reboot.

&lt;html&gt;&lt;pre&gt;
&gt; env
SHELL=/bin/bash
TERM=xterm
USER=rob
...
&gt; echo $SHELL
/bin/bash
&lt;/pre&gt;&lt;/html&gt;
See also [[magic vars]]. Probably the most important env var is [[path]]. Some environment operations:
|!Command|!Description|
|some-variable=value|Set a variable.|
|echo $PATH|See what variable $PATH is.|
|ROB=&quot;True&quot;|Set variable ''ROB'', ie $ROB equal to ''True''.|
|rob=&quot;Fabulous&quot;|Set variable $rob to what he is.|
|export Rob=&quot;Other&quot;|Set variable ''$Rob'', for this shell and subsequent shells.|
To add premanently, edit the  ''~/.bashrc'' file and add the line export VARIABLE=value. Then type ''@@source ~/.bashrc@@'' to run the file.
Some special values are:
*''echo $HOME'' - your [[home]] directory.
*''pwd'' - your present working directory
Check out the [[path]] variable.</pre>
</div>
<div title="event designator" creator="rvr" modifier="rvr" created="202301231736" modified="202301231812" changecount="14">
<pre>Event Designator refer to the command line entries in the history list.


|!Command|!Description|
|&amp;#33;n|Get command line entry from history - line #n|
|&amp;#33;&amp;#33;|Get previous command plus arguments.|
|&amp;#33;-1|Also get previous command plus arguments.|
|&amp;#33;:0|Get just the command|
|&amp;#33;:1|Get First argument.|
|&amp;#33;:2|Get second argument.|
|&amp;#33;:n|Get nth argument.|
|ESC+.|Get first argument of last command.|
|&amp;#33;''string''|Get most recent command starting with ''string''.|
|&amp;#33;#|The entire command line typed so far.|
|^''strA''^''strB''^|Quick subs. Repeat the last command, replacing ''strA'' with ''strB''.|

See also [[magic vars]].   !:1</pre>
</div>
<div title="examples" creator="rvr" modifier="rvr" created="201501311810" modified="201502010714" changecount="3">
<pre>Listing examples of many things:
*[[ls examples]]
*[[ps examples]]
*[[diff examples]]</pre>
</div>
<div title="executable" creator="rvr" modifier="rvr" created="201611280830" changecount="1">
<pre>To make the file executable: @@chmod +x &lt;filename.sh&gt;@@
To run the file enter: ./&lt;filename.sh&gt;</pre>
</div>
<div title="export" creator="rvr" modifier="rvr" created="201102070448" modified="202211091138" changecount="17">
<pre>Export makes available variables and functions to other programs and other shells. But only while the shell is active. 
To always have this set, add to [[profile]].
&lt;html&gt;&lt;pre&gt;
rob@latest:~$ echo $a

rob@latest:~$ a=apple
rob@latest:~$ echo $a   # a is only in this shell
apple
rob@latest:~$ sh     # Enter another shell
sh-3.2$ echo $a      # &quot;a&quot; is not available to this new shell
                     # See! Nothing!
sh-3.2$ b=banana
sh-3.2$ echo $b
banana
sh-3.2$ export b     # Export this for other shells
sh-3.2$ sh           # Enter another shell!
sh-3.2$ echo $b      # And there we have it
banana
&lt;/pre&gt;&lt;/html&gt;
To survive after reboot, add to [[profile]].
You can also:
&lt;html&gt;&lt;pre&gt;
$ echo &quot;export SOMETHING=$HOME/something&quot; &gt;&gt; ~/.bash_profile
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="ffmpeg" creator="rvr" modifier="rvr" created="201804091514" modified="202301031304" changecount="8">
<pre>We use ''ffmpeg'' to convert video files.
@@ffmpeg -i ~SomeBigVideoFile.mp4 -s 640x480 -c:a copy ~SmallerVideoFile.mp4@@

mp4 -&gt; mp3: @@ffmpeg -i a2z.qwerty.mp4 qwerty.mp3@@

Rotate video 90 degrees CCW
@@ffmpeg -i some-video.mp4 -vf &quot;transpose=2&quot;  -codec:a copy out.mp4@@

rem For the transpose parameter you can pass:

rem 0 = 90CounterCLockwise and Vertical Flip (default)
rem 1 = 90Clockwise
rem 2 = 90CounterClockwise
rem 3 = 90Clockwise and Vertical Flip

rem To rotate 180 degrees, instead use &quot;transpose=2,transpose=2&quot;

rem Using -codec:a copy will simply copy the audio instead of reencoding it.


- - - fix - - -
ffmpeg -i yourvideoname.mp4 -s 640x480 -c:a copy resizedvideo.mp4

ffmpeg -i Goldilocks\ and\ the\ Three\ Bears.mp4 -s 640x480 -c:a copy Goldilocks.mp4
ffmpeg -i Jack\ and\ the\ Beanstalk.mp4 -s 640x480 -c:a copy Jack.mp4

ffmpeg -i Jack.mp4 


ffmpeg -i input.mp4 -i image.png -filter_complex &quot;[0:v][1:v] overlay=25:25:enable='between(t,0,20)'&quot; -pix_fmt yuv420p -c:a copy output.mp4

enable='between(t,0,20)' - means we want the image to show between second 0 and 20
overlay=25:25  - means we want to position the image 25px to the right and 25px down, 

ffmpeg -y -loop 1 -framerate 60 -t 5 -i sample-out3.jpg -f lavfi -t 5 -i aevalsrc=0 -vf settb=1/60000 -video_track_timescale 60000 -c:v libx264 -pix_fmt yuv420p playervid.mp4</pre>
</div>
<div title="file" creator="rvr" modifier="rvr" created="201101211845" modified="201612081906" changecount="8">
<pre>!!Files
Files can be renamed, deleted, changed. Check out [[file commands]].
To see what kind of file we have...
&lt;html&gt;&lt;pre&gt;
$ file junk.txt
junk.txt: ASCII text
&lt;/pre&gt;&lt;/html&gt;
!!File Definition
A unix file is built of two parts - data and filename
*the data part is associated with an [[inode]], which consists of permissions etc and a data address, which points to the data.
*the filename part contains a filename and an ''inode #''.
See also [[inode example]].</pre>
</div>
<div title="file commands" creator="rvr" modifier="rvr" created="201511151435" modified="201609081619" changecount="47">
<pre>Rename, copy, and remove (delete) a file and directories:
Format: ''&lt;command&gt;  [option]  &amp;lt;source&gt;  &amp;lt;destination&gt;'' - note that destination can be a directory.
&lt;html&gt;&lt;pre&gt;
mv oldfilename.txt newfilename.txt    # move file, similar to rename!
cp somefilename.txt copiedfile.txt    # copy file
cp anotherfilename.txt  /tmp          # Copy file to /tmp directory
cp * /home/fred/documents             # Copy all files to directory
cp -i                                 # Copy in interactive mode
cp -r src_dir dest_dir                # Copy all files from src_dir to dest_dir. Need -r for recursive &amp; directories.
cp -R * /home/wilma/documents         # Copy all files and recursively all subfolders &amp; docs, to directory
touch something.txt                   # File something.txt created

rm xfile.txt      # File is deleted
rm *.txt          # Removes all .txt file!
rm *.txt -i       # Confirm each file by using (i)nteractive
rm *.txt -f       # Don't ask to confirm each file by using (f)orce
rm -rf &amp;lt;dir&gt;      # Remove directory and all subdirectories. Yikes!
&lt;/pre&gt;&lt;/html&gt;
Options:
*''v'' - verbose
*''p'' - preserve attributes (date/time)

Actually for a mass rename:
&lt;html&gt;&lt;pre&gt;
rename 's/\.html$/\.txt/' *.html
rename 's/.html$/.txt/' *.html    # Rename all &quot;html&quot; files to &quot;txt&quot;
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="file type" creator="rvr" modifier="rvr" created="201012091654" modified="201012091654" changecount="3">
<pre>Here are the file types:
*d  - directory
*l  - symbolic link
*s  - socket
*p  -  named pipe
*-  (dash) - regular file
*c - character (unbuffered) device file special
*b - block (buffered) device file special</pre>
</div>
<div title="filesystem" creator="rvr" modifier="rvr" created="201408180540" modified="202301031250" changecount="24">
<pre>A filesystem is used to store information on a device in a certain way. it
*organizes data to be easily located
*preserves integrity (the same when saved and retrieved)
*is easily accessible
Linux follows the FHS - or File System Hierarchy Standard. 
*There is a root directory, the topmost directory. 
*Subdirectories follow certain patterns
*A standard is followed so that different distros are kept in line. (See [[typical filesystem]])
**The /tmp folder is always in the same place.
**The /bin directory has binaries ...See [[typical filesystem]]
OS files and data are stored in [[partition]]s. To use a filesystem, it needs to be [[mount]]ed, called a mount point.
The linux filesystem can handle many different types of filesystems:
*traditional ones (ie disk) like: 
*ext2 - circa 1992, solid, stable, well used.
*ext3 - like ext2 but adds journaling (makes complete/incomplete for file transactions)
*ext4 - circa 2008, backward compatible, volumes to 1exobyte, 4B files, files to 16TB
*Reiser, XFS, Btrfs, JFS, etc
*other ~OSs like: vfat, ntfs, hfs.
*flash storage filesystems like: ubifs, ~JFFS2, YAFFS, etc
*database filesystems
*special purpose filesystems like: procfs, sysfs, tmpfs, debugfs, etc..
Linux uses the FHS or Filesystem Hierarchy Standard. Check out [[typical filesystem]].
There are also [[hidden]] files.
See also [[NFS]].</pre>
</div>
<div title="find" creator="rvr" modifier="rvr" created="201408290501" modified="201906230044" changecount="54">
<pre>The ''find'' command is used to find things, and so is [[locate]]. Find searches real time, has more options, and is slower. Without any parameters, it finds everything in the current directory and all subfolders.
The format is: @@''find &lt;where to look&gt; &lt;criteria&gt; &lt;what to do&gt;''@@
Some examples, :
|!Command|!Description|
|find (same as find .)|Finds all files and directories in current directory and all subdirectories.|
|find /|Finds everything, from root on down. Everything.|
|find /home|Finds everything, from ''home'' directory on down.|
|find ./banana (or find banana)|Finds everything is current directory if it has a &quot;banana&quot; folder.|
|find . -name &quot;fred*&quot; |Find all files in current directory and down that start with &quot;fred&quot;.|
|find . -iname &quot;fred*&quot; |Like above, but case insensitive.|
|find .  &amp;#124; grep fred|Like above but includes directory path names.|
|find . -name &quot;*.bin&quot;|Find all bin files in current directory (.) and all subdirectories.|
|find . -maxdepth 2  -name &quot;*.bin&quot;|Like above but only go down 2 directories.|
|find . -name -not &quot;*.txt&quot;|Find all files in current directory (.) and all subdirectories that are ''NOT'' &quot;txt&quot; files.|
|find . -type d -name &quot;fred*&quot;|Find all ''d''irectories starting with &quot;fred&quot;.|
|find . -type f -name &quot;fred*&quot;|Find all ''f''iles starting with &quot;fred&quot;.|
|find /rails -type d -name config|Find only directories in /rails that are named &quot;config&quot;|
|find . -type f -name &quot;*.rb&quot;|Find all ruby files ina directory|
|find . -type f -perm 0666 |Find all the files whose permissions are 666.|
|find . -type d -newer abc.txt|Find all directories newer than file abc.txt.|
|find . -mtime +42|Find all files in current directory that are older than 42 days.|
|find / -ctime 3|Find based on time, -ctime is when the [[inode]] meta-data changed (3 days ago)|
|find / -ctime +3|Find based on time, -ctime is when the [[inode]] meta-data changed (3 days or more ago)|
|find / -size +10M  -print 2&gt;/dev/null |Find files larger than 10MB, send &quot;permission denied&quot; errors to null.|
|find -name &quot;*.swp&quot; -exec rm {} ’;’|Find and remove all files that end with .swp.|
|find -name &quot;*.swp&quot; -ok rm {} ’;’|Find and remove all files that end with .swp BUT ask before each remove.|
|find . -iname &quot;bite.me&quot; -print 2&gt;/dev/null|Find in current directory the file &quot;bite.me&quot;, ignore all errors. (ie &quot;permission denied&quot;)|
|find . -iname &quot;bite.me&quot; -print 2&gt;/dev/null &gt; README|Find in current directory the file &quot;bite.me&quot;, all errors to file README.|
See also [[locate]]
If you are feeling adventurous you can run commands against the ''find'' command.
&lt;html&gt;&lt;pre&gt;
# To find and remove all files that end with .swp:
$ find -name &quot;*.swp&quot; -exec rm {} ’;’ 
&lt;/pre&gt;&lt;/html&gt;
The brackets &quot;{}&quot; are a placeholder for the results of the find command.
&lt;html&gt;&lt;pre&gt;
# Find all files in all subdirectories modified in the last 12 hours (1/2 day)
$ find . -type f -mtime -.5 -exec ls -l {} \;

# Place in a file (1 day window):
$ find . -type f -mtime -1 -exec ls -l {} \; &gt; a.txt
&lt;/pre&gt;&lt;/html&gt;

See [[grep]].</pre>
</div>
<div title="firewall - CentOS" creator="rvr" modifier="rvr" created="201611181938" modified="201612130748" changecount="19">
<pre>Linux uses [[iptables]] for the firewall.
You may have setup a firewall, but it may not be running (see [[service]]).
See also [[service - CentOS]].
The daemon to manage firewall rules: @@''firewalld''@@
The command to change firewall rules: @@'' firewall-cmd''@@

&lt;html&gt;&lt;pre&gt;
$ sudo firewall-cmd --zone=public --add-port=88/tcp --permanent     # Permanent to take it survive a boot.
$ sudo firewall-cmd --reload
$ sudo firewall-cmd --list-all
public (default, active)
  interfaces: eth0 eth1
  sources: 
  services: dhcpv6-client https
  ports: 3000/tcp 88/tcp 26532/tcp
  masquerade: no
  forward-ports: 
&lt;/pre&gt;&lt;/html&gt;
If it is not installed, installit: @@yum install firewalld@@
To see what ports are opened use [[netstat]] like: @@netstat -lnt@@
To check if [[port]] 3000 is open: @@&lt;/dev/tcp/localhost/3000 &amp;&amp; echo Port is open || echo Port is closed@@
See open ports: @@''lsof -i''@@
See port and program name, use [[netstat]]: @@netstat -tulon@@</pre>
</div>
<div title="grep" creator="rvr" modifier="rvr" created="201102200349" modified="201906172140" changecount="36">
<pre>The ''grep'' command is used to find a substring in a file. It is very powerful. It prints out ''lines'' with the word in ''bold''.
Here are some basics..
|grep -A4 -B2 foo |Will find &quot;foo&quot; and give the 2 ''B''efore lines and 4 ''A''fter lines.|
|grep fantasic poem.txt|Will find all the lines with &quot;fantastic&quot; in file &quot;poem.txt&quot;, output to terminal.|
|grep apple *|Look for  &quot;apple&quot; in current directory.|
|grep fan poem.*|Look for all words with &quot;fan&quot; in them in file named &quot;poem.&lt;anything&gt;&quot;. Even words like zin''fan''del.|
|grep foo -i poem.txt|Case-insensitive, so would find word &quot;Food&quot;. (I prefer the switches right after &quot;grep&quot;, not like this line.)|
|grep -v the poem.txt|Find every line that does NOT have &quot;the&quot; in it. The v is for in''v''erse.|
|grep -n bar *.text|Find words with &quot;bar&quot; in them and print line number. For all ''text'' files.|
|grep -c bar *.txt|Count the lines with &quot;bar&quot; in them and print the ''line number''. For all ''txt'' files.|
|grep -r &quot;some phrase&quot; |Search for &quot;some phrase&quot; in every file, recursively thru directories.|
|grep -ri &quot;some phrase&quot; |Probably case is not important, so add the &quot;i&quot;.|
|grep -E &quot;foo&amp;#124;bar&quot; |Will find &quot;foo&quot; or &quot;bar&quot;.|
|egrep &quot;foo&amp;#124;bar&quot; |Same as above. Will find &quot;foo&quot; or &quot;bar&quot;.|
Flags, can be combined:
*''-i'' - case insensitive
*''-n'' - file line number
*''-c'' - count the number of lines
*''-v'' - the inVerse
*''-A#'' - the number of lines After the hit, so @@-A5@@ = 5 lines after
*''-B#'' - the number of lines Beforethe hit, so @@-B2@@ = 2 lines before
See also [[pipe]].</pre>
</div>
<div title="group" creator="rvr" modifier="rvr" created="201012091802" modified="201612081941" changecount="11">
<pre>A group is a way of managing multiple users - to give them access to resources. See [[/etc/group]]. A [[user]] can belong to numerous groups. You can list the groups that you have by the ''groups'' command. You can see the groups by issuing the ''groups'' command at the prompt.
&lt;html&gt;&lt;pre&gt;$ groups
rob admin rvr
&lt;/pre&gt;&lt;/html&gt;You can see that the current user belongs to 3 different groups. You can see all the groups by issuing cat-ing the group file:
&lt;html&gt;&lt;pre&gt;$ cat /etc/group
tesco:x:1001:
rob:x:1002:
rvr:x:1003:rob
&lt;/pre&gt;&lt;/html&gt;Format of the above is the following:
&lt;groupname&gt;:&lt;encrypted password&gt;:&lt;group ID&gt;:&lt;list of usernames belonging&gt;. You'll notice that the group rvr has user rob as belonging to it.
To change user and group see [[useradd]].</pre>
</div>
<div title="groupadd" creator="rvr" modifier="rvr" created="201012091622" modified="201612172257" changecount="15">
<pre>The primitive is ''groupadd''.
The script one is ''addgroup''
Have to run as root, also appears that you can use ''groupadd'' or [[usermod|useradd]] too. 
Format: ''addgroup &lt;options&gt; &lt;new groupname&gt;''
&lt;html&gt;&lt;pre&gt;addgroup coolgroup
&lt;/pre&gt;&lt;/html&gt;To see what groups a user belongs to issue:
&lt;html&gt;&lt;pre&gt;#groups rob
rob webservers
# id -G
1002 1003
&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="groupdel" creator="rvr" modifier="rvr" created="201102080342" modified="202301031308" changecount="2">
<pre>To delete a group:
&lt;html&gt;&lt;pre&gt;
delgroup &amp;lt;groupname&amp;gt;
&lt;/pre&gt;&lt;/html&gt;See also [[adduser]] and [[addgroup|adduser]]</pre>
</div>
<div title="grub" creator="rvr" modifier="rvr" created="202005260159" modified="202005260207" changecount="3">
<pre>''grub'' is a bootloader for when you have a partitioned drive. 
It sits on a drive, so you have to have access to that drive (device) first - then you can open the [[Boot Loader]].
Then you can access grub and pick windows or linux.</pre>
</div>
<div title="head" creator="rvr" modifier="rvr" created="201501311838" modified="201501311846" changecount="6">
<pre>To list the head or start of some data, use the command like: @@head &lt;options&gt; &lt;files&gt;@@
To list the first 42 lines of file Meaning.life use: @@head -42 Meaning.life@@
To list first 10 lines of two files: @@head ~FileOne ~FileTwo@@ Note: 10 is default.
To list first 7 bytes, try: @@head -c 7 read.me@@</pre>
</div>
<div title="hidden" creator="rvr" modifier="rvr" created="201501151326" modified="201501151326" changecount="2">
<pre>In Linux, ''hidden'' files start with a period. These are typically configuration files but can be many things, like the trash or other system files.
*Trash -  ''.local/share/Trash/files/''
</pre>
</div>
<div title="history" creator="Rob" modifier="rvr" created="201511211803" modified="202302191607" changecount="29">
<pre>The ''history'' command shows the commands entered in the terminal. They will be numbered so you can recall them.
If setup properly in .bashrc - placing a space before the command will render it invisible to ''history''. This is good for entering passwords etc.
Running ''&quot;history | less&quot;'' allows you to easily look thru them.

|!Command|!Description|
|HISTSIZE|Number of commands retained during a session.|
|HISTFILESIZE|Number of lines stored at end of your session.|
|history|Lists every command done.|
|history n|Lists the last &quot;n&quot; commands.|
|history -d x|Deletes the ''x-th'' history command.|
|history &amp;#124; grep xinput|Lists the &quot;xinput&quot; commands.|
|history -c|Clear out all commands|
|cntl-p|Run previous command.|
|cntl-r|Search through commands.|
|cntl-g|Cancel search.|
|&amp;#33;n (n=1, or 2,...)|Execute history command number &quot;n&quot;.|
|&amp;#33;n (n=-1, or -2,...)|Execute previous history command etc.|
|&amp;#33;git|Execute the previous &quot;git&quot; command. And etc.|

To export the history file size: @@export HISTFILESIZE=2000@@
To export the history commands with a timestamp: @@export HISTTIMEFORMAT='%F %T '@@
You can change HISTSIZE and HISTFILESIZE in your [[profile]].
History info can be in:
*''~/.bash_history''
*''~/.history''
*''~/.histfile''

You can also use the ''fc'' command to print out a range of history
&lt;html&gt;&lt;pre&gt;
fc -l 24 42   # List history commands from #24 to #42
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="home" creator="rvr" modifier="rvr" created="202301031033" modified="202301031041" changecount="4">
<pre>The home directory is where the files are kept that are processed during login. The directory is specified in the [[/etc/passwd]] file.
These files include [[profile]] and ''.bashrc''
Each user on the system will have a ''home'' directory off of [[root]]. For user ''wilma'' there will be a ''/home/wilma''

See [[typical filesystem]].</pre>
</div>
<div title="id" creator="rvr" modifier="rvr" created="201012091807" modified="201012091808" changecount="3">
<pre>Use the ''id'' command to find out information about a user:
&lt;html&gt;&lt;pre&gt;$ id &lt;username&gt;
uid=1002(rob) gid=1002(rob) groups=1002(rob),1003(webservers)
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="important.service" creator="rvr" modifier="rvr" created="202005241524" modified="202005250318" changecount="24">
<pre>A service file is used by [[systemd]] to run a service. You can create a custom one to run something that is important to you. It should be in directory: ''/etc/systemd/system''
&lt;html&gt;&lt;pre&gt;
[Unit]
Description=This is really important
Wants=some.srv.this.needs.loaded.service another.service     (all starts at same moment)
Requires=some.srv.it.needs.running.service                   (if this doesn't start - yours won't start)
After=this.srv.starts.after.your.service

[Service]
Type=simple
User=username-run-as
Group=group-run-as
Environment=SOMEVAR=42
WorkingDirectory=/
ExecStart=/something-important.sh
TimeOut=15sec
Restart=always
RestartSec=42sec

[Install]
WantedBy=multi-user.target
&lt;/pre&gt;&lt;/html&gt;There are lots more settings.

The script should include how to run it, otherwise the line ''~ExecStart'' should have path, like: @@''/bin/bash /root/something-important.sh''@@
Example of file ''something-important.sh''
&lt;html&gt;&lt;pre&gt;
#!/usr/bin/env bash

while true; do
  echo 'hello world'
  sleep 5
done
&lt;/pre&gt;&lt;/html&gt;
Let's do this:
&lt;html&gt;&lt;pre&gt;$ sudo chmod +x something-important.sh        # Of course this has to be executable: 
$ systemctl start something-important         # Now we launch.
$ journalctl -f                               # Let's see if it worked.
May 24 19:53:45 rob-tmate something-important.sh[26807]: hello world
May 24 19:53:50 rob-tmate something-important.sh[26807]: hello world
^c

$ systemctl status something-important
● something-important.service - This is really important
   Loaded: loaded (/etc/systemd/system/something-important.service; disabled; vendor preset: enabled)
   Active: active (running) since Sun 2020-05-24 19:53:15 PDT; 7min ago
 Main PID: 26807 (bash)
    Tasks: 3 (limit: 4915)
   CGroup: /system.slice/something-important.service
           ├─26807 bash /something-important.sh
           └─27188 sleep 5

May 24 20:00:26 fred-tmate something-important.sh[26807]: hello world
May 24 20:00:31 fred-tmate something-important.sh[26807]: hello world
May 24 20:00:36 fred-tmate something-important.sh[26807]: hello world
May 24 20:00:41 fred-tmate something-important.sh[26807]: hello world

$ systemctl stop something-important
$ systemctl status something-important
● something-important.service - This is really important
   Loaded: loaded (/etc/systemd/system/something-important.service; disabled; vendor preset: enabled)
   Active: inactive (dead)


May 24 20:02:16 fred-tmate something-important.sh[26807]: hello world
May 24 20:02:21 fred-tmate something-important.sh[26807]: hello world
May 24 20:02:25 fred-tmate systemd[1]: Stopping This is really important...
May 24 20:02:25 fred-tmate systemd[1]: Stopped This is really important.
&lt;/pre&gt;&lt;/html&gt;
Excellent.</pre>
</div>
<div title="info" creator="rvr" modifier="rvr" created="201501260647" modified="201612070709" changecount="8">
<pre>Type ''info'' into the command line. Use arrow keys to navigate.
Or go ''info &lt;topic-name&gt;''. Topics are called nodes.
*''q'' to quit
*''h'' for help
*''?'' for help
*''d'' to goto main menu
This is a newer or updated [[man pages]].</pre>
</div>
<div title="inode" creator="rvr" modifier="rvr" created="201408290604" modified="201501290658" changecount="8">
<pre>The ''inode'' (aka index node) is a fundamental concept in the Linux and UNIX filesystem. It is a data structure to hold information about the file, date, size, permissions, etc. The information an inode has is listed below, note that a ''filename'' is not included.
*filesize
*Device ID
*User ID of the file
*Group ID of the file
*permissions for: owner, group and others
*File protection flags
*Timestamps for creation, modification etc
*[[Llink|link]] counter to determine the number of hard links
*Pointers to the blocks storing file’s contents

See [[inode example]].</pre>
</div>
<div title="inode example" creator="rvr" modifier="rvr" created="201501290654" modified="201501290700" changecount="3">
<pre>When a file has been hard [[link]]ed, a listing will show that the ''inode'' number is the same as well, the &quot;2&quot; indicates two filenames are used for it. To list an [[inode]] number use the flag ''-i'', ie ''ls -i''. See [[ls]] command.
&lt;html&gt;&lt;pre&gt;
$ ls -l
#Start with a regular file
-rw-rw-r-- 1 rob rob 29 Jan 28 20:26 apple.txt

# Notice the &quot;2&quot;. Now make a hard link.
$ ln apple.txt banana.txt
$ ls -l
-rw-rw-r--  2 rob rob   29 Jan 28 20:26 apple.txt
-rw-rw-r--  2 rob rob   29 Jan 28 20:26 banana.txt

#Add a another file and..
$ ls -li
total 8
438035 -rw-rw-r-- 2 rob rob 29 Jan 28 20:26 apple.txt
438035 -rw-rw-r-- 2 rob rob 29 Jan 28 20:26 banana.txt
438034 -rw-rw-r-- 1 rob rob  0 Jan 28 20:30 carrot.txt

#Now add a soft link
$ ln -s apple.txt durian.txt
$ ls -li
438035 -rw-rw-r-- 2 rob rob 29 Jan 28 20:26 apple.txt
438035 -rw-rw-r-- 2 rob rob 29 Jan 28 20:26 banana.txt
438034 -rw-rw-r-- 1 rob rob  0 Jan 28 20:30 carrot.txt
438036 lrwxrwxrwx 1 rob rob  9 Jan 28 20:43 durian.txt -&gt; apple.txt


&lt;/pre&gt;&lt;/html&gt;

Find: -atime  and  -ctime  and -mtime</pre>
</div>
<div title="installation" creator="rvr" modifier="rvr" created="201501131335" modified="201501131337" changecount="3">
<pre>There are many things to consider about installation, depending upon the [[distribution]].
The [[partition]] layout needs to be determined:
*one big partition
*one large partition plus one swap partition.
*many partitions for space sensitive things like ''/var'' and ''/home''</pre>
</div>
<div title="iptables" creator="rvr" modifier="rvr" created="201102022215" modified="201611302148" changecount="14">
<pre>Are ''iptables'' running? Check via: ''serve iptables status'' - see [[service]].
See what you have set up currently:
&lt;html&gt;&lt;pre&gt;
iptables -L
&lt;/pre&gt;&lt;/html&gt;Make your changes and then save them
&lt;html&gt;&lt;pre&gt;
iptables-save &gt; /etc/iptables.conf
&lt;/pre&gt;&lt;/html&gt;
Now edit the network file: ''/etc/network/interfaces''  and add ''pre-up iptables-restore &lt; /etc/iptables.conf''.
The relevant part of the file ''network'' will look like:
&lt;html&gt;&lt;pre&gt;
iface eth0 inet static
    address 184.106.96.43
    netmask 255.255.255.0
    gateway 184.106.96.1
    dns-nameservers 173.203.4.8 173.203.4.9
    &lt;b&gt;pre-up iptables-restore &amp;lt; /etc/iptables.conf &lt;/b&gt;
&lt;/pre&gt;&lt;/html&gt;To see [[port]]s use [[netstat]].</pre>
</div>
<div title="journal" creator="rvr" modifier="rvr" created="202005241539" changecount="1">
<pre>The ''journal'' lists output from [[systemctl]].</pre>
</div>
<div title="journalctl" creator="rvr" modifier="rvr" created="201611100632" modified="202005241539" changecount="15">
<pre>A [[journal]] is a collection of logs into one location. This is done via [[systemd]]. 
The ''journald'' does this work and ''journalctl'' is how we access this information.
&lt;html&gt;&lt;pre&gt;
$ journalctl                       # List all logs starting with oldest
$ journalctl -x                    # Explain
$ journalctl -f                    # Latest entries
$ journalctl -r                    # Reverse listing
$ journalctl -n 42                 # Latest 42 entries
$ journalctl -u puppet             # By &quot;unit&quot; 
$ journalclt &amp;#45;no-pager             # No paging, use to pipe
$ journalctl -&amp;#45;since &quot;1 hour ago&quot;  # All logs since 1 hour ago
$ journalctl -&amp;#45;until yesterday     # All logs until yesterday
$ journalctl &amp;#45;-list-boots          # List all reboots
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="kdiff3" creator="rvr" modifier="rvr" created="201502072202" modified="201903181646" changecount="19">
<pre>@@kdiff3@@ has not been updated in a while. Check out [[meld]].

Like the [[diff]] command this command compares 2 files to a third base file. It will show the changes in each compared to the base.
Format is: ''{{{ kdiff3 file-1 base-file file-2  &lt;switches&gt; }}}''
!!Typical Use
You have two files and want to see and/or merge differences.
Select the two directories that you want to compare, and click compare.
Kdiff3 will compare both directories and give some stats on the files that are same and different.
To ''start'' the merge of individual files, click the 4 arrows in a diamond button.
Kdiff3 will compare the first file with differences, showing a popup of stats - # of conflicts.
There will be 3 split windows. Top with the directories and files. Middle with the files in questions. Bottom window will be the new output file.
You can move up and down using the up/down triangle.
You can move to top/bottom using up/down triangle with a bar at the triangle tip.
You'll see buttons labelled @@A@@ and a @@B@@ and a @@C@@ - these are used to merge.
''Merge'' - Note what the output file will be, typically it will be &quot;B&quot;. Kdiff3 will also create some &quot;.orig&quot; files as a backup.
 we'll choose &quot;B&quot;, that is &quot;Select lines from B to merge into A&quot;.
So click on ''B''.
You'll see in the bottom window the code from middle window &quot;B&quot; file placed there, along with a &quot;B&quot; in the LHS column.
Select the down diamond button to go to the next conflict.
Repeat the above as need be. You can also &quot;add&quot; new code.
@@...finish &amp; fix@@
Select from menu &quot;Merge&quot; -&gt; 
If there are conflicts, you'll be notified with popup window. We'll say that there are conflicts.
You'll see in 2nd (middle) split window the code in question.
You'll see in 3rd (bottom) split window: @@color:red;? &lt;Merge Conflicts&gt; @@
If you click on &quot;A&quot;, then the code from &quot;A&quot; will be placed there. &quot;B&quot; will give &quot;B&quot; code.
Click on &quot;A&quot; or &quot;B&quot; and the change should appear.
If you are happy, click the down triangle to go to next conflict.

If you cannot merge, then you have a conflict.
File A is the file we want to be up to date.
File B has some changes we want to merge into File A.</pre>
</div>
<div title="kernel" creator="rvr" modifier="rvr" created="201501131035" modified="201612131754" changecount="4">
<pre>The ''kernel'' is the core of the Linux OS. 
It is the lowest level software, performs all low level tasks.
The Linux kernel is a Unix like operating system.
Responsible for all software and applications running.</pre>
</div>
<div title="less" creator="Rob" modifier="rvr" created="201511211606" modified="201612070704" changecount="13">
<pre>The ''less'' command is interactive, it is used to examine the contents of a file. Format: @@less some-file@@
Here are the commands:
*''spacebar'' - forward one page
*''&amp;#8593; &amp;#8595; '' - up/down one line
*''ctrl-f'' - forward aone page
*''ctrl-b'' - backward one page
*''/'' - search for something, /food looks for the word food
**''n'' for next occurrence of food
**''N'' for PREVIOUS occurrence of food
*''G'' or ''&gt;'' - goto end of file
*''1G'' or ''g'' or ''&lt;'' - goto start of file
*''42G'' - goto line 42
*''h'' - for help
*''q'' - to quit</pre>
</div>
<div title="link" creator="rvr" modifier="YourName" created="201101211825" modified="202302051844" changecount="18">
<pre>A ''soft link'' aka ''symbolic link'' contains a reference to another file or directory. Soft links can also be created pointing to directories, avoid this for hard links.
A ''hard link'' associates a name with the actual data ([[inode]] - see [[file]]). Many different files (links) can point to the same file (data), so deleting one file (meaning the filename+pointer to data)  means that you still have the original data with the other link. Picture a file meaning: a filename + pointer to data in another location - so deleting a file only deletes the data if no other pointers are pointing to that data!
&lt;html&gt;&lt;pre&gt;
  $ ln -s data.txt slink.txt     # soft link
  $ ln more.txt hlink.txt        # hard link

  $ ln -s /home/fred/projects/bite goto    # soft link to directory &quot;.../bite&quot;. Just type &quot;goto&quot;
  $ ln -s /home/fred/bookproj ./bookproj   # a link to a directory. Just type &quot;bookproj&quot;

&lt;/pre&gt;&lt;/html&gt;If you delete the original file - the soft link will be broken but the hard link will still have a link to the data.

</pre>
</div>
<div title="locate" creator="rvr" modifier="rvr" created="201408250715" modified="201604091119" changecount="10">
<pre>The utility program ''locate'' is used to find files (much faster than [[find]], especially in large systems)). It accesses a database created by ''updatedb'' (you can run it anytime), which runs once a day updating itself. It can return many file names depending upon what you are searching for. You can further shorten that list by using [[pipe]] and [[grep]].

&lt;html&gt;&lt;pre&gt;
$ locate fun | grep free                 # Finds all files with fun and then it looks for free in them.
$ locate index.html | grep tardigrade    # Finds files named &quot;index.html&quot; and looks for &quot;tardigrade&quot; in them
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="login" creator="rvr" modifier="rvr" created="201102051817" modified="201705120119" changecount="13">
<pre>In linux, there are some different logins that can happen. A good description is at [[startup]].
Typically, for a regular interactive login, these are the steps:
*When you login, a [[home]] directory is assigned, as well a shell is assigned. This can be seen in the [[/etc/passwd]] file.
*The first thing that is run is [[/etc/profile]] - which is system wide. Typically this will also source (ie call) the file ''/etc/bash.bashrc''
*Next, typically is ''$HOME/.bash_profile'' or ''$HOME/.bash_login'' and finally ''$HOME/.profile'' - thats all.
*Often, these will source ''$HOME/.bashrc''. (See [[profile]])
To login as a different user. from the command shell: ''su user-name''. You will be prompted for a password.</pre>
</div>
<div title="logs" creator="rvr" modifier="rvr" created="201607010803" modified="202004230729" changecount="11">
<pre>Log files are stored in txt in directory: @@''/var/log''@@
There is a log file for practically everything.
System logs are directed by the config files in: ''/etc/rsyslog.d/*.conf''
Most system logs end up as: ''/var/log/[[syslog]]''
Messages are at:  ''/var/log/messages''
Running [[daemon]]s place their output here.
The line that does this: @@*.*;auth,authpriv.none	 -/var/log/syslog@@

To look for info in these places, use [[grep]]: @@grep &lt;some-string&gt; /var/log/* @@
</pre>
</div>
<div title="ls" creator="rvr" modifier="rvr" created="201501290704" modified="201605090748" changecount="18">
<pre>The ''list'' command is ''ls''. There are some [[ls examples]].
There are many [[flags|ls flags]] that can control the output.
Here is a typical example and an explanation of the results. Hidden files are not shown with the basic command below.
&lt;html&gt;&lt;pre&gt;
$ ls -li
 total 48
 438035 -rw-rw-r-- 2 csnord csnord 65 Jan 28 20:47 apple.txt
 438035 -rw-rw-r-- 2 csnord csnord 65 Jan 28 20:47 banana.txt
 438034 -rw-rw-r-- 1 csnord csnord 0 Jan 28 20:30 carrot.txt
 438036 lrwxrwxrwx 1 csnord csnord 9 Jan 28 20:43 durian.txt -&gt; apple.txt
 438043 -rw-rw-r-- 1 csnord csnord 37182 Jan 28 22:40 egg.txt
#inode  permission lnk owner grp   size  mod-datetime filename
&lt;/pre&gt;&lt;/html&gt;Explain:
*[[inode]] - the number
*[[permissions]] - file permissions
*[[link]] count
*[[owner]]
*[[group]]
*file size in bytes, sometimes shown as blocks - 1 block=1024 bytes.
*Modification time.
*filename
We also have flags:
*-cmin, 
*-amin
*-mmin</pre>
</div>
<div title="ls examples" creator="rvr" modifier="rvr" created="201501311811" modified="202302131638" changecount="24">
<pre>Some [[ls]] examples:
|!Command|!Description|!Explanation|
|ls -la|List all files including hidden ones|The &quot;l&quot; switch means in a one-per-line list and &quot;a&quot; means all aka gimme hidden files.|
|ls -d */|List only directories|The -d means only list directory names not contents, but to exclude files use the ''*/''.|
|ls -d */ .*/|List all directories|This is like above but also listing hidden directories.|
|ls -rtl|List (r) by (t)ime and (l) format.|List entries in reverse time long format.|
|ls -a &amp;#124; [[grep]] &quot;^\.&quot;|List files starting^^1^^ with a dot. (Hidden)|The &quot;^&quot; means first character, and we have to delimit the [[regex]] dot with a &quot;\&quot;.|
|ls -a &amp;#124; grep &quot;rc$&quot;|List all files ending in &quot;rc&quot;|Using the &quot;$&quot; is [[regex]] for matching the end of a string.|
^^1^^ If we had listed using @@-la@@ then the first character is not a dot but a file description! Not what we want.

To list showing ''octal'' permissions: @@stat -c &quot;%A %a %n&quot; *@@
*%A Access rights in human readable form
*%a Access rights in octal
*%n File name

You ca also run @@''tree''@@ to see a fancy directory  listing.</pre>
</div>
<div title="ls flags" creator="rvr" modifier="rvr" created="201501290740" modified="201612051948" changecount="6">
<pre>The ''list'' command has many flags or switches. The are preceded by a dash ''-'' and can be combined.
|!Switch|!Description|
|a|Gimme hidden files.|
|h|Human readable form. Filesize that is.|
|i|Inode - give us the number.|
|l|L is for long.|
|n|Show GUI and UID in numberic and not alphanumeric.|
|t|Time - sorted on modification time.|
|r|Lowercase r for reverse order.|
|R|Uppercase R for recursively, ie down thru the folders.|
|p|Indicate if a file by appending a slash: @@/@@|</pre>
</div>
<div title="lsof" creator="rvr" modifier="rvr" created="202005250551" modified="202005250554" changecount="4">
<pre>List of open files: ''lsof''
See open files: @@''lsof''@@
See open [[port]]s: @@''lsof -i''@@
With a specific [[PID]]  @@''lsof -p &lt;pid&gt;''@@
With a specific PID from previous command@@''lsof -p $!''@@
What? That last one uses [[magic vars]].</pre>
</div>
<div title="lspci" creator="rvr" modifier="rvr" created="201606120059" modified="202302141520" changecount="18">
<pre>The command ''lspci'' (part of pciutils package) lists information about the [[PCI]] [[bus]] and all [[device]]s in the system. (''PCI'' = Peripheral Component Interconnect, see [[bus]].)  This includes video cards as well as ether net cards. The following are the different switches you can run for the ''lspci'' command:
&lt;html&gt;&lt;pre&gt;
$ lspci
00:00.0 Host bridge: Intel Corporation 3rd Gen Core processor DRAM Controller (rev 09)
00:02.0 VGA compatible controller: Intel Corporation 3rd Gen Core processor Graphics Controller (rev 09)
00:14.0 USB controller: Intel Corporation 7 Series/C210 Series Chipset Family USB xHCI Host Controller (rev 04)
00:16.0 Communication controller: Intel Corporation 7 Series/C210 Series Chipset Family MEI Controller #1 (rev 04)
00:1a.0 USB controller: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #2 (rev 04)
00:1b.0 Audio device: Intel Corporation 7 Series/C210 Series Chipset Family High Definition Audio Controller (rev 04)
00:1c.0 PCI bridge: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 1 (rev c4)
00:1c.1 PCI bridge: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 2 (rev c4)
00:1d.0 USB controller: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #1 (rev 04)
00:1f.0 ISA bridge: Intel Corporation HM76 Express Chipset LPC Controller (rev 04)
00:1f.2 SATA controller: Intel Corporation 7 Series Chipset Family 6-port SATA Controller [AHCI mode] (rev 04)
00:1f.3 SMBus: Intel Corporation 7 Series/C210 Series Chipset Family SMBus Controller (rev 04)
01:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller (rev 09)
02:00.0 Network controller: Qualcomm Atheros AR9485 Wireless Network Adapter (rev 01)

$ lspci -m
...
00:1f.0 &quot;ISA bridge&quot; &quot;Intel Corporation&quot; &quot;HM76 Express Chipset LPC Controller&quot; -r04 &quot;Samsung Electronics Co Ltd&quot; &quot;Device c0d8&quot;
00:1f.2 &quot;SATA controller&quot; &quot;Intel Corporation&quot; &quot;7 Series Chipset Family 6-port SATA Controller [AHCI mode]&quot; -r04 -p01 &quot;Samsung Electronics Co Ltd&quot; &quot;Device c0d8&quot;
00:1f.3 &quot;SMBus&quot; &quot;Intel Corporation&quot; &quot;7 Series/C210 Series Chipset Family SMBus Controller&quot; -r04 &quot;Samsung Electronics Co Ltd&quot; &quot;Device c0d8&quot;
01:00.0 &quot;Ethernet controller&quot; &quot;Realtek Semiconductor Co., Ltd.&quot; &quot;RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller&quot; -r09 &quot;Samsung Electronics Co Ltd&quot; &quot;Device c0d8&quot;
02:00.0 &quot;Network controller&quot; &quot;Qualcomm Atheros&quot; &quot;AR9485 Wireless Network Adapter&quot; -r01 &quot;Samsung Electronics Co Ltd&quot; &quot;Device 4105&quot;

$ lspci -v   # Only list the last one
...
02:00.0 Network controller: Qualcomm Atheros AR9485 Wireless Network Adapter (rev 01)
	Subsystem: Samsung Electronics Co Ltd Device 4105
	Flags: bus master, fast devsel, latency 0, IRQ 17
	Memory at c0000000 (64-bit, non-prefetchable) [size=512K]
	Expansion ROM at c0080000 [disabled] [size=64K]
	Capabilities: &lt;access denied&gt;
	Kernel driver in use: ath9k

$ lspci -n   # Only list last 5 
....
00:1f.0 0601: 8086:1e59 (rev 04)
00:1f.2 0106: 8086:1e03 (rev 04)
00:1f.3 0c05: 8086:1e22 (rev 04)
01:00.0 0200: 10ec:8168 (rev 09)
02:00.0 0280: 168c:0032 (rev 01)
&lt;/pre&gt;&lt;/html&gt;
Examining the same entry as above: ''00:1f.3 0c05: 8086:1e22 (rev 04)'', it tells us:
*''00:1f.3 0c05'' = bus number (00), device number (1f) and function (0)
*''0c05'' - device class  (Class 0c05 is ~SMBus Serial Controller)
*''8086'' - vendor ID   (See: http://pci-ids.ucw.cz/read/PC?restrict=8 - you get Intel)
*''1e22'' - device ID  (See: http://pcidatabase.com/search.php?device_search_str=1e22 - ~SM-Bus Controller of the Intel Z77 Chipset)
To verify the above descriptions, try using the ''-nn'' switch:
&lt;html&gt;&lt;pre&gt;
$ lspci -nn
...
00:1f.0 ISA bridge [0601]: Intel Corporation HM76 Express Chipset LPC Controller [8086:1e59] (rev 04)
00:1f.2 SATA controller [0106]: Intel Corporation 7 Series Chipset Family 6-port SATA Controller [AHCI mode] [8086:1e03] (rev 04)
00:1f.3 SMBus [0c05]: Intel Corporation 7 Series/C210 Series Chipset Family SMBus Controller [8086:1e22] (rev 04)
01:00.0 Ethernet controller [0200]: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller [10ec:8168] (rev 09)
02:00.0 Network controller [0280]: Qualcomm Atheros AR9485 Wireless Network Adapter [168c:0032] (rev 01)
&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="magic vars" creator="rvr" modifier="rvr" created="201104280545" modified="202301031243" changecount="19">
<pre>Magic variables and parameters - bash shell.
This will need cleaning up if I need to do more work in this area.
Am mixing ''bash parameters'' @@color:red;vs@@ ''bash characters''
|!Variable|!Meaning|!Example|!Description|
|$!|PID of last background process|
|$#|Number of command line arguments (params)|$# -lt 2|Less than 2 options?|
|$- |used to get current option flags.|$- == *i*|Is there an &quot;-i&quot; option?|
|$0|script name|
|$1|first argument, $2 = 2nd etc ...|
|$*|all command line arguments|
|$$|PID of shell|
|$?|Status code of last command|
|$_|Hmm, too much info..|</pre>
</div>
<div title="mail" creator="rvr" modifier="rvr" created="201102042114" changecount="1">
<pre>You can mail stuff:
&lt;html&gt;&lt;pre&gt;
top -b -n1 | mail -s 'Process snapshot' rob@rtfm.ca
&lt;/pre&gt;&lt;/html&gt;
''b'' is for batch
''n'' for number of iterations</pre>
</div>
<div title="man pages" creator="rvr" modifier="rvr" created="201501260626" modified="201612071823" changecount="24">
<pre>The ''manual'' pages come with many programs and utilities. See also [[info]] and [[documentation]].  These are often converted into web pages and other formats.
Man pages are often long, so they are piped through a terminal pager program like [[less]] to display a page at a time. You can press @@h@@ inside ''less'' for help.

&lt;html&gt;&lt;pre&gt;
man -h   # Help.  You can also simply type &quot;help&quot;.
man -k  &amp;lt;something&gt;   # search for a subject  ... can use the following &quot;apropos&quot; command...
apropos &amp;lt;something&gt;   # Same as above command
man -f   # like whatis
man -a   # All man pages in sequence with the given name in all chapters.
&lt;/pre&gt;&lt;/html&gt; 
You can search man pages:
&lt;html&gt;&lt;pre&gt;
$ whatis passwd
sslpasswd (1ssl)     - compute password hashes
passwd (1)           - update user's authentication tokens
&lt;/pre&gt;&lt;/html&gt; 
Man pages are organized into 9 chapters. When you run &quot;man -f &lt;command&gt;&quot;, you will get a list which also shows chapter. 
You can view a specific chapter by using: ''man 3 printf ''
To move
*enter - one line
*spacebar - one page
*g - top of page
*G - bottom of page
*q - quit
*h - help! yes, there is!</pre>
</div>
<div title="meld" creator="rvr" modifier="rvr" created="201711042155" changecount="1">
<pre>''Meld'' is a visual diff and merge tool, similar to [[kdiff3]].</pre>
</div>
<div title="memory" creator="rvr" modifier="rvr" created="201611250349" modified="202005241538" changecount="5">
<pre>You can get the memory in your machine:
&lt;html&gt;&lt;pre&gt;
$ free -m
              total        used        free      shared  buff/cache   available
Mem:            991         255         122          12         613         529
Swap:          2047           0        2047

$ vmstat -s | grep memory
      1015348 K total memory
       262524 K used memory
       389032 K active memory
       311048 K inactive memory
       124452 K free memory
          872 K buffer memory
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="mount" creator="rvr" modifier="rvr" created="201501310159" modified="201905040020" changecount="38">
<pre>The command ''mount'' is used to mount a [[filesystem]]. A filesystem is mounted at a ''mount point'', which is a directory. Typical ''mount points'' are &quot;/home&quot; or  &quot;/&quot;, which is aka root. The mount command is: @@mount &lt;[[device node|/dev]]&gt; &lt;mount point&gt;@@
*mount /dev/sda1 ''/'' . . . &quot;/dev/sda1&quot; is the device node and &quot;/&quot; is the mount point.
*mount  /dev/sda5 ''/home''
*mount  /dev/sda6 ''/var''
The command (can only be run by root user) to mount the ''/home'' directory would be: @@''mount /dev/sda5 /home''@@
The command to mount a network (server=rtfm.ca) resource: @@mount rtfm.ca:/libation /mnt/nfs/libation@@
To see what is mounted run command: @@mount@@ 
To see how much free (df=disk free) space there is: @@df -Th@@ See [[df]].
You can set up devices to load on bootup, edit the [[/etc/fstab]] table.</pre>
</div>
<div title="nano" creator="rvr" modifier="rvr" created="201612130432" changecount="1">
<pre>''nano'' is an editor, so is [[vi]].
It is a text based editor, good to know when a GUI editor is not an option.
cntl+k - delete/cut whole line
cntl+u - paste whole line
cntl+x - exit file quit/save
</pre>
</div>
<div title="netstat" creator="rvr" modifier="rvr" created="201611140004" modified="202005250550" changecount="25">
<pre>To see [[port]] and program name: 
*''netstat -tulpn''   (only servers)
*''netstat -tp''      (w/o servers)
|!Switch|!Description|
|-a|List *all* ports.|
|-at|List *all* tcp ports.  Change &quot;t&quot; to &quot;u&quot; for UDP.|
|-lt|Listening TCP [[port]]s. Change &quot;t&quot; to &quot;u&quot; for UDP.|
|-n|Display numbers.|
|-s|Lists stats for each protocol.|
|-p|Add PID/Program column to output.|
|-i|List interfaces.|
|-ie|List interfaces expanded.|
Use grep to help: @@netstat -ap | grep ssh@@
See open [[port]]s: @@''lsof -i''@@
Check out [[lsof]]


</pre>
</div>
<div title="network configuration" creator="rvr" modifier="rvr" created="201501221927" modified="202301031249" changecount="5">
<pre>Network configuration is done through network configuration files. These vary from [[distro|distribution]] to distro, so there is a network manager utility. It will list all wired and wireless connections. It will also handle passwords and setting up ~VPNs.
For wired connections, the manager will use DHCP (Dynamic Host Control Protocol) to setup network settings. If it is static and doesn't use DHCP, you can setup the network settings up using the manager. You can also manage the MAC address. For wireless, it does not hook up automatically, but allows you to select and manage them.
Network manager can also setup mobile broadband connection and ~VPNs (~OpenVPN Cisco ~OpenConnect ~IPSec)</pre>
</div>
<div title="nobody" creator="rvr" modifier="rvr" created="201012091615" modified="201012091705" changecount="4">
<pre>When a web client connects to a server, the web server assigns it the user ''nobody''. Since this does not belong to any group, it therefore inherits the [[permissions]] that [[other]] (aka world) has.</pre>
</div>
<div title="openssl" creator="rvr" modifier="rvr" created="201611250426" modified="202301031134" changecount="16">
<pre>We can use ''openssl'' to create a hashed password. We are salting the password. 
* we use the ''-1'' switch = ~MD5 based BSD password algorithm 1
* the ''-5'' switch is the more secure ~SHA256 algorithm
* the ''-6'' switch is the more secure ~SHA512 algorithm
* that same password gives different hash if salt changes.
* the salt is in the hashed password
* we can include the password on the command line
&lt;html&gt;&lt;pre&gt;
// password = 'qwerty'

$ openssl passwd -1 -salt xxx
  Password: 
  $1$xxx$RhVx/IygzUHHIrES.bHKl0

$ openssl passwd -1 -salt zzz
  Password: 
  $1$zzz$Y88DD0SUQqdthOx1o644F.

$ openssl passwd -1 -salt zzz
  Password: 
  $1$zzz$Y88DD0SUQqdthOx1o644F.

$ openssl passwd -1 -salt zzz qwerty
  $1$zzz$Y88DD0SUQqdthOx1o644F.

$ openssl passwd -5 -salt zzz qwerty
 $5$zzz$uwYJEmmCsbsaX9Z0qfhjxOvav8/qXdube.ZZkVVw4bA

$ openssl passwd -6 -salt zzz qwerty
  $6$zzz$Gm6VhQytwdf2sF2BTDcfcXYO5SS/4SfbgZ17sR3ZvADrAik0sX5KWdlMkrViGm4lKMo/t5X2zvCCbwUn57IXi0

&lt;/pre&gt;&lt;/html&gt; </pre>
</div>
<div title="other" creator="rvr" modifier="rvr" created="201012091635" modified="202301031319" changecount="4">
<pre>A file belongs to a [[user]] and a [[group]]. If someone belongs to neither of these then it is an ''other''. This is often referred to as ''world'' as it means everyone else in the world.</pre>
</div>
<div title="owner" creator="rvr" modifier="rvr" created="201607092348" modified="201607092348" changecount="2">
<pre>In order for dropbox to be able to upload a file from your system, it has to have the ''owner'' as yourself (your logged-in id), not ''root''.</pre>
</div>
<div title="package management commands" creator="rvr" modifier="rvr" created="201501301912" modified="202301031319" changecount="57">
<pre>Here are some [[Package Management]] command examples. Note that you'll install as root, so use ''sudo''.
*[[rpm|RPM]] - used for when we have downloaded packages and want to install
*[[apt-get]] - used to install on Ubuntu
*[[yum]] - uses online repositories to get packages.
**use ''dpkg'' to install packages that you have locally, they are @@*.deb@@ files.
**&quot;yum update&quot; - updates all packages, and &quot;yum upgrade&quot; does that PLUS removes obsolute packages.
|!Operation|!RPM|!Debian|
|Install a package|rpm -i foo.rpm |dpkg &amp;dash;&amp;dash;install foo.deb|
|Install a package with dependencies from repository|yum install foo |[[apt-get]] install foo|
|Remove a package |rpm -e foo.rpm |dpkg &amp;dash;&amp;dash;remove foo.deb|
|Remove a package (uninstall) | |apt-get remove foo|
|Remove a package and dependencies using repository|yum remove foo |apt-get purge foo|
|Remove all unnecessary files||apt-get autoremove|
|Search for a package|yum search foo |apt-cache search foo|
|Update kernel | |apt-get dist-upgrade|
|Update package to a newer version |rpm -U foo.rpm |dpkg &amp;dash;&amp;dash;install foo.deb|
|Update package using repository and resolving dependencies|yum update foo |apt-get upgrade|
|Update package to resolve (fix) dependencies| |apt-get -f upgrade foo|
|Updateall packages|yum update |apt-get upgrade |
|Upgrade all packages+remove obsolete|yum upgrade ||
|Update package info (sources)||apt-get update|
|Check package|yum check-update foo | |
|Clean up  install package|yum clean packages | |
|Clean up all temp install files|yum clean all | |
|Show all installed packages |rpm -qa or yum list installed|dpkg &amp;dash;&amp;dash;list|
|Get information about an installed package including files|rpm -qil foo |dpkg &amp;dash;&amp;dash;listfiles foo|
|Show available package with &quot;foo&quot; in name |yum list foo |apt-cache search foo|
|Show all available packages |yum list |apt-cache search|
|Show installed packages | |dpkg -&amp;#45;get-selections|
|Show installed packages | |apt list -&amp;#45;installed |
|What packages does a file belong to? |rpm -qf file |dpkg &amp;dash;&amp;dash;search file|

Flags to use for RPM:
*''-h'' - show progress, status
*''-i'' - install
*''-e'' - uninstall
*''-v'' - verbose
*''-q'' - query
*''-qi'' - query+information
*''-qR'' - query+Required packages
To remove  stale packages: @@sudo apt-get autoremove@@
To get a list of locally packages installed: @@dpkg -&amp;dash;get-selections | grep -v deinstall@@
To check for a specific package:@@dpkg &amp;dash;-get-selections | grep &lt;packagename&gt;@@
Some [[package management examples]].
</pre>
</div>
<div title="package management examples" creator="rvr" modifier="rvr" created="201611292114" modified="202301031259" changecount="5">
<pre>Here are some package management examples.
&lt;html&gt;&lt;pre&gt;
# rpm -qi yum
  Name        : yum
  Version     : 3.4.3
  Release     : 132.el7.centos.0.1
  Architecture: noarch 
  ...

# yum install httpd.x86_64      (Installs apache)
  Loaded plugins: fastestmirror
  ... many lines ...
  Complete!

# yum check-update httpd
  Loaded plugins: fastestmirror
  ...

&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="partition" creator="rvr" modifier="rvr" created="201501131048" modified="201501311748" changecount="16">
<pre>A ''partition'' is a logical division on a hard disk drive (HDD). There is a [[mount]] point, like a windows Drive letter. The base directory where linux is stored is a forward slash ''/'', whereas windows uses the drive letter like ''c:''.
Linux uses the &quot;/&quot; character to separate paths.
If something bad happens on one partition, it does not affect other partitions.
The [[root]] directory, [[/usr]], and ''/tmp'' directories are typically on different partitions. To see what partitions you have try:
&lt;html&gt;&lt;pre&gt;
$ cat /proc/partitions
major minor  #blocks  name
  11    0    1048575  sr0
   8    0   13631488  sda
   8    1   10217472  sda1
   8    2          1  sda2
   8    5    3410944  sda5
&lt;/pre&gt;&lt;/html&gt;
See [[/proc]].</pre>
</div>
<div title="passwd" creator="rvr" modifier="rvr" created="201012091818" modified="201611250425" changecount="3">
<pre>To change your password:
&lt;html&gt;&lt;pre&gt;
passwd rob	# Change password for user rob
&lt;/pre&gt;&lt;/html&gt;
To see password status:
&lt;html&gt;&lt;pre&gt;
$ passwd -S rob
rob P 10/10/2015 0 99999 7 -1
&lt;/pre&gt;&lt;/html&gt;
This means:
*P - password is good. L=locked NP=No password
*10/10/2015 - when password changed/created
0 99999 - password expiry age in days: min max
7 - password change warning
-1 - inactivity period
You can create a hashed password using [[openssl]].
</pre>
</div>
<div title="path" creator="rvr" modifier="rvr" created="201012122311" modified="201612051954" changecount="20">
<pre>In Linux, there are relative and absolute paths.
''Absolute'' paths start with a &quot;/&quot; and starts at the [[root]] and goes down the tree.
''Relative'' paths start in the current directory and never start with a &quot;/&quot;.
Current directory &quot;.&quot; (single dot)
Parent directory &quot;..&quot; (double dot)
Home directory &quot;~&quot;
The ''PATH'' [[environment variables]] is scanned whenever a command is given to run a program or a script. It looks in the ''PATH''.
To make this permanent, add the ''path'' in a file like ''.bashrc'', like:
&lt;html&gt;&lt;pre&gt;
$ PATH=$PATH:/some/new/path    # To add to $PATH
$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/some/new/path
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="permissions" creator="rvr" modifier="rvr" created="201012091631" modified="202301031318" changecount="53">
<pre>Linux uses permissions to determine who has access to what resources. These resources could be directories, files or executables.	There are three types of permissions:
*''r''ead
*''w''rite
*e''x''ecute
Every file belongs to a [[user]] and a [[group]]. Access is controlled by 
*[[user]] - typically the user who created the file
*[[group]] - the group the resource belongs to
*[[other]] - any user who is not in the group, aka world.
Each resource has the following has 10 pieces of information about the permissions, which can be seen when doing a listing (ls -l):
&lt;html&gt;&lt;pre&gt;
#1234567890    Owner  Group  FSz  Date         Name
 ----------    ------ ------ ---- ------------ ---------
 drwxr-xr-x  4 root   robert 4096 Dec  9 01:04 packages
 -rw-r--r--  1 qwerty robert  140 Nov 19  2007 .something
&lt;/pre&gt;&lt;/html&gt;The permissions (ie ''drwxrwxrwx'') are broken down like:
*[[file type]] - column 1 - this is a dash (''-'') for a regular file, ''d'' for directory and ''l'' for link, [[more|file type]].
*''user permissions'' - column 2-4 - ''r''ead, ''w''rite and e''x''ecute. A dash (''-'') here indicates no permission.
*''group permissions'' - column 5-7 - ''r''ead, ''w''rite and e''x''ecute. A dash (''-'') here indicates no permission.
*''other permissions'' - column 8-10 - ''r''ead, ''w''rite and e''x''ecute. A dash (''-'') here indicates no permission.
They are also represented by an alternative 3-digit numeric method:
&lt;html&gt;&lt;pre&gt;
0 = ---   3 = -wx  6 = rw-       rwx rw- r-x    rw-rw-r-x
1 = --x   4 = r--  7 = rwx       7   6   5      6  6  5
2 = -w-   5 = r-x
&lt;/pre&gt;&lt;/html&gt;So the first digit is for the user permissions, followed by group &amp; other permissions.
In the e''x''ecute column an ''s'' indicates a [[setuid|SUID]].
To check all permissions on a path: '' namei -om /path/to/check''
&lt;html&gt;&lt;pre&gt;
$ namei /home/user/www -om   
f: /home/user/www                     
 dr-xr-xr-x root root /               
 drwxr-xr-x root root home            
 drwx-----x user user user            
&lt;/pre&gt;&lt;/html&gt;

</pre>
</div>
<div title="pipe" creator="rvr" modifier="rvr" created="201408250705" modified="202302141519" changecount="26">
<pre>A ''pipe'' is used to send the standard output (''stdout'') of one program or command as the input of another program or command.
&lt;html&gt;&lt;pre&gt;$ programA | ProgramB | programC&lt;/pre&gt;&lt;/html&gt;The cool thing is that programB does not have to wait for programA to finish before getting any data. Very efficient.
Do a list of all files pipe output (''stdout'') to input (''stdin'') of grep which outputs (''stdout'') all files with secret in the filename.&lt;html&gt;&lt;pre&gt;
$ ls | grep secret      
&lt;/pre&gt;&lt;/html&gt;
Note that the above are ''anonymous pipes''.
See also  [[redirect]]ed.
You need to understand [[Standard File Streams]].
Often used with the [[ps|process]] command.</pre>
</div>
<div title="port" creator="rvr" modifier="rvr" created="201611291925" modified="201612141935" changecount="24">
<pre>An IP identifies a computer while a port is used to distinguish an application or service on that machine. See also [[Networking]].
The combination of IP address, port and protocol is called a ''socket''.
It is a value from 0 to 65535, and requires it to be [[TCP]] or [[UDP]].
Ports 
*0-1023 are reserved for specific applications and are assigned specifically.
*1024-49151 are registered ports for organizations
*49152 -65535 are designated dynamic ports, for temporary connections

|!Service|!Port|!Description|
|qotd	|17/tcp|Quote of the day.|
|ftp|20/tcp  21/tcp|File transmission protocol.|
|ssh|22/tcp|Secure shell.|
|telnet|23/tcp|Telnet.|
|smtp|25/tcp|Sendmail, mail|
|domain|53/tcp|Bind, named|
|http|80/tcp|Apache, World wide web.|
|https	|443/tcp|Secure http.|

[[TCP]] vs [[IP]] vs ''UDP''
*''tcp''=Transmission Control Protocol, the main internet protocol. 
**It is how applications provide reliable (handshakes), order checked, and error checked delivery of data (packets). 
**It focuses on ''transport''.
*''udp''=User Datagram Protocol. This is for sending datagrams (packets). 
**These are unreliable (no handshakes), small, and connectionless.  
**It focuses on ''transport''.
*''ip''=Internet Protocol. This handles the ''address'' of where the packets get sent. 
**Focus on ''routing'' the packets.

See open ports: @@''lsof -i''@@
See port and program name, use [[netstat]]: @@netstat -tulon@@</pre>
</div>
<div title="process" creator="rvr" modifier="rvr" created="201102042004" modified="202005250556" changecount="30">
<pre>The ''process'' command: ''ps'' is used to see what processes are running. ''TTY'' - is terminal process is running on. You can see by typing in @@''tty''@@
There is lots of history with this command, there is a merger of 3 flavours, so some flags in the following table appear to duplicate each other.
*''UNIX'': leading dashes
*''BSD'': no leading dash
*''GNU'': two leading dashes
&lt;html&gt;&lt;pre&gt;
$ ps -f
UID        PID  PPID  C STIME TTY          TIME CMD
rob      30765 10421  0 14:46 pts/12   00:00:00 bash
rob      30888 30765  0 15:01 pts/12   00:00:00 ps -f

$ ps -aurob   # User fred
  PID TTY          TIME CMD
 2023 ?        00:00:25 gnome-keyring-d
 2027 ?        00:00:00 init

$ ps -auroot  # User root
  PID TTY          TIME CMD
    1 ?        00:00:01 init
    2 ?        00:00:00 kthreadd

$ ps -aux   # All users
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.0  33872  4372 ?        Ss   mai25   0:01 /sbin/init
syslog     909  0.0  0.0 255848  2824 ?        Ssl  mai25   0:00 rsyslogd
postgres  1541  0.0  0.0 107668  3796 ?        Ss   mai25   0:00 postgres: stats collector process 
&lt;/pre&gt;&lt;/html&gt;
|!Switch|!Description|
|-e|Show all processes, minimal columns.|
|u|Show user oriented format.|
|-u &lt;username&gt;|Show processes for username.|
|U &lt;username&gt;|Show lots more info on process for username.|
|aux|Show all processes for all users, lots of columns.|
|f|forest  - shows parent-child path, nice!|
|-f|Show full format listing.|
|-F|Show even more full format listing.|
|-&amp;dash;forest|To see child parent relationshio.|
|l|display in long format|
|-l|long format|
|-p &lt;pid&gt;|Show process for specific pid.|

See [[ps examples]].
To see a terminal-graphical view: @@pstree@@
To see a real time system usage: @@[[top]]@@ or @@htop@@
</pre>
</div>
<div title="profile" creator="rvr" modifier="rvr" created="201102051827" modified="202301031035" changecount="10">
<pre>The ''profile'' is a hidden file and is in the [[home]] directory. It is: ''~/.profile''
There are profiles that run automatically when you [[login]]. If you make a change to your profile (''$HOME/.profile'') you will need to source it to see the changes you have made.
Note that different distros will use different profile. Ubuntu uses ''~/.profile'' and many other distros use ''~/.bash_profile''.
On my Ubuntu system my ''~/.profile'' calls ''~/.bashrc''  </pre>
</div>
<div title="ps examples" creator="rvr" modifier="rvr" created="201501311822" modified="201611132346" changecount="21">
<pre>Some [[process]] examples.
|!Command|!Description|!Explanation|
|ps aux|Gimme everything|&quot;a&quot;=BSD style ... a=all processes, u = show process user  x=unattached processes.|
|ps -ef|Gimme everything|-e to display all process and -f to display full format.|
|ps -ef &amp;#124; head -5|Gimme first 5|Pipe to [[head]] to get first 5.|
|ps -f -u rob|Whats user Rob running?|To see what user Rob is running use &quot;-u&quot;.|
|ps -fu rob|Same as above|To see what user Rob is running use &quot;-u&quot;.|
|ps -ef &amp;#124; wc|Give us a line/word/letter count.|Example output:    295    3883   98685|
|ps -ef &amp;#124; grep apache|Only list &quot;apache&quot; processes|Use [[grep]] to look for word &quot;apache&quot;.|
|ps aux  &amp;#45-sort=-%cpu &amp;#124; grep -m 11 -v `whoami` |Top 10 time wasters.|Get top 10 cpu users and sort'em.|</pre>
</div>
<div title="quoting" creator="rvr" modifier="rvr" created="201102070549" modified="201102070554" changecount="5">
<pre>Here goes:
|!Quote|!Description|!Example|!Output|
|single|Everything in single quotes is NOT changed|echo '$USER is cool'|$USER is cool|
|double|Things in double quotes can have variable substitution&quot;|echo &quot;$USER is cool&quot;|rob is cool|
|backslash|Used to delimit special characters like $ and quote|echo &quot;File is \&quot;File\&quot;&quot;|File is &quot;File&quot;|

You can also use backslash + character to create special formatting like newline &quot;\n&quot;. Using ''echo'' you need to use the ''-e'' option.
&lt;html&gt;&lt;pre&gt;
$ echo -e &quot;Gimme a \n new line&quot;
Gimme a
 new line

$ echo  &quot;Gimme a \n new line&quot;
Gimme a \n new line

$ printf &quot;Gimme a new \nline&quot;     # -e not needed with printf
Gimme a new
line
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="redirect" creator="rvr" modifier="rvr" created="201408250659" modified="201607310034" changecount="30">
<pre>I/O Redirection - the three [[Standard File Streams]] can all be redirected. 
''&gt;'' - is used to redirect standard ''output'', from a command to a file (somewhere else besides the default). Can be used for ''stdin'' or ''stderr''. This ''overwrites'' old data.
''&lt;'' - is used to redirect ''input'' from a file to a command (from somewhere else besides the default).
''&gt;&gt;'' - is used to redirect standard output to a file and ''append''.
''1&gt; file'' - redirects stdout to file.
''2&gt; file'' - redirects stderr to file.
''&amp;&gt;file'' - is to redirect both output streams - stdout and stderr - to the file.
''2&gt;&amp;1'' - There is a shorthand notation to put anything written to ''stderr'' (file descriptor 2) in the same place as ''stdout'' (file descriptor 1). 
''2&gt;/dev/null'' - Redirect error messages to bit bucket.
&lt;html&gt;&lt;pre&gt;
$ some_program &lt; input-file     # Input supplied from a file, not the keyboard.
$ other_program &gt; output-file   # Output sent to an output file.
$ yap_program 2&gt; error-file     # Error output to yet another file
$ last_program &gt; yaf-file 2&gt;&amp;1  # Both output &amp; errors goto yet another file

$ ls junk 2&gt; /dev/null         # Send error to bit bucket  (null device)
$ ls *.bat &gt; bat.files         # Have a listing of all bat files in the file: bat.file.
$ ls *.bat 1&gt; bat.files        # Same as above, redirest stdout.
$ ls *.bat 2&gt; bat.error        # Redirect errors to file: bat.error.
$ ls *.bat &gt; bat.both 2&gt;&amp;1     # Redirect stdout &amp; stderr to file: bat.both.
$ ls bat.* &gt;&gt; bat.files        # Append to file
$ sort &lt; bat.files             # Sort the file. Could also be &quot;sort bat.files&quot;
$ sort &lt; bat.files &gt; sorted.bats   # Sort the file and then places results in sorted.bats
&lt;/pre&gt;&lt;/html&gt;
For reference: http://www.catonmat.net/blog/bash-one-liners-explained-part-three/</pre>
</div>
<div title="regex" creator="rvr" modifier="rvr" created="201211200526" modified="202301031248" changecount="37">
<pre>Regular expressions or ''regex'' is a pattern used to search for text. 

I will move this to http://misc.rtfm.tiddlyspot.com/

And will clean it up.
All chars match themselves except specific ones: ''., |, (, ), [, \, ^, {, +, $, *, and ?'' unless delimited by a backslash. Here they are defined:
|!Character|!Description|
|.|Appearing outside brackets, matches any single character except a newline. (With the /m option, it matches newline, too).|
|*|Matches one or more characters.|
|?|Matched zero or one of the preceding characters.|
|^|Matches the beginning of a line.|
|[^ ]|When in [ ], the ^ means logical NOT.|
|$|Matches the end of a line.|
|\|Escapes special characters.|
|\A|Matches the beginning of the string.|
|\z|Matches the end of the string.|
|\Z|Matches the end of the string unless the string ends with a “\n”, in which case it matches just before the “\n”.|
|\b|Match word boundaries.|
|\B|Match nonword boundaries.|
|( )|Puts info in groups.|
|[nn]|Matches any single numbers between the brackets, [34] - looks for 3 or 4 .|
|[n-n]|Matches any single numbers between in range, [2-4] - looks for 2, 3 or 4 .|
|[a]|A character class matches any single character between the brackets.|
|[aaa]|Matches character between the brackets. [ae] - looks for a or e.|
|[a-a]|Matches character in range. [a-mN-Z] - looks for a to m and N to Z.|
|mang*|Matches zero or more occurrences of mang.|
|mang+|Matches one or more occurrences of mang.|
|mang?|Matches zero or one occurrence of mang.|
|re1 vb re2|vb=vertical bar, Matches either re1 or re2, it has a low precedence.|

Another table:
|!Sequence|!As [ ... ]|!Meaning|
|\d|[0-9]|Digit character|
|\D|[^0-9]|Nondigit|
|\s|[\s\t\r\n\f]|Whitespace character|
|\S|[^\s\t\r\n\f]|Nonwhitespace character|
|\w|[~A-Za-z0-9_]|Word character|
|\W|[^~A-Za-z0-9_]|Nonword character|
How about some examples? Go [[here|regex examples]] or [[there|regex email example]].

!This needs cleaning up.
Regular Expressions aka ''regex'' are used to find patterns in strings.
A pattern is ''/pattern/ options''. 
|!Operator|!Description|
|/&lt;string&gt;/|The &lt;string&gt; is the string we want to seach for.|
|g|To search for all occurrences.|
|i|To ignore case in search.|
''Example:''&lt;html&gt;&lt;pre&gt;
String to seach through : abc=&quot;Madam, I'm adam&quot;
The string to search for: /adam/gi                 # search for all occurances of &quot;adam&quot; in string abc
The regex code will be  : abc.match(&quot;/adam/gi')    # Will return &quot;2&quot;
&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="regex email example" creator="rvr" modifier="rvr" created="201509281545" modified="202007050656" changecount="2">
<pre>To use regex to filter out bad emails.
Given: ''~VALID_EMAIL_REGEX = /\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i''
You can check out: http://www.rubular.com/
|!Expression|!Meaning|
|/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i  |full regex|
|/ |start of regex|
|\A |match start of a string|
|[\w+\-.]+ |at least one word character, plus, hyphen, or dot|
|@ |literal “at sign”|
|[a-z\d\-.]+ |at least one letter, digit, hyphen, or dot|
|\.  |literal dot|
|[a-z]+  |t least one letter|
|\z  |match end of a string|
|/ |end of regex|
|i |case-insensitive|
&lt;html&gt;&lt;pre&gt;

&lt;/pre&gt;&lt;/html&gt;


&lt;html&gt;&lt;pre&gt;

&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="regex examples" creator="rvr" modifier="rvr" created="201509281544" modified="202301031210" changecount="6">
<pre>Here are some examples of [[regex]].
&lt;html&gt;&lt;pre&gt;
abc=&quot;Madam, I'm Adam. 1 2 3&quot;

abc.match(/\d+/gi)  # Find all numbers in a string
abc.match(/\s+/gi)  # Find all spaces in a string
abc.match(/\S/gi)   # Match everything that is not a space

  puts  &quot;libations are us&quot; =~ /s are u/      # it returns 8 - the starting position.

  string = &quot;(313) 736-5245&quot;  
  phone_re = /\((\d{3})\)\s+(\d{3})-(\d{4})/  

  puts phone_re.match(string)  # Will return &quot;(313) 736-5245&quot;. A MatchData object when true else returns nil.
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="root" creator="rvr" modifier="rvr" created="201408230946" modified="201608301846" changecount="14">
<pre>There are two roots going on:
*The root directory of the linux OS is designated as a &quot;/&quot;. See [[typical filesystem]].
*The ''root'' account. To become superuser or root, issue the [[su]] command.
In Ubuntu, the ''root'' user is not set. You can use [[sudo]] to have permission to do things that the ''root'' account can do.
You can setup/change a ''root'' account: @@sudo passwd root@@
To drop into the ''root'' account, enter: @@su -@@
The ''root'' account has access to the systems administrative account, often called the superuser. Used for stopping, starting, or installing system applications. You can use [[sudo]] for short term access.

</pre>
</div>
<div title="rsync" creator="rvr" modifier="rvr" created="201502072225" modified="201502110732" changecount="8">
<pre>The command ''rsync'' is used to backup or sync files, typically on different systems. It can backup across systems. It finds the difference and only syncs that, saving network time.
It is a very destructive command, so you may want to add the switch ''-dry-run''. 
Basic format: ''{{{ rsync source-file dest-file }}}''
Complex format: ''{{{ rsync -r project-X archive-machine:archives/project-X }}}''
You could also use the ''cp'' (copy) command, but its not as powerful.</pre>
</div>
<div title="scp" creator="rvr" modifier="rvr" created="201102082334" modified="201510052048" changecount="18">
<pre>Use ''scp'' to copy from machine to machine. On windows use putty's winscp: pscp.exe
Here we copy from local windows box to linux server, format is:
@@pcsp.exe &lt;local-path-file&gt; &lt;username&gt;@&lt;host&gt;:&lt;to-path&gt;@@
&lt;html&gt;&lt;pre&gt;
c:&amp;gt;pscp.exe c:\Users\rob\Desktop\UbuntuWindowsShared\favicon.ico rob@184.106.96.43:/home/rob
rob@184.106.96.43's password:
favicon.ico               | 1 kB |   1.4 kB/s | ETA: 00:00:00 | 100%
&lt;/pre&gt;&lt;/html&gt;
To scp a file in *nix.
&lt;html&gt;&lt;pre&gt;
$scp somefile username@server:/home/username/      # Copy somefile  from local to remote
$scp username@server:/home/username/somefile  .    # Copy somefile  from remote to local - notice the dot.
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="script" creator="rvr" modifier="rvr" created="201601100815" modified="201612130533" changecount="10">
<pre>You can write shell ''scripts''.
Needs to be cleaned up.
*and [[shell misc]]
*and [[shell commands]]
*and [[shell programming]]
*[[script example 1]]
Here is my first one called ''hello'':
&lt;html&gt;&lt;pre&gt;
#!/bin/bash
clear
echo &quot;Hello World!&quot;
&lt;/pre&gt;&lt;/html&gt;
To make it run, you'll need to [[chmod]], like this: @@chmod 755 hello@@
To run it you'll need to tell linux where it is (current directory: ''./'')+ the name of the script, ''hello'', like this: ''@@./hello@@''
To make this a bit easier, create a ''/bin'' directory, add it to the [[path]] in ''~./bashrc'' and place this script there.</pre>
</div>
<div title="script example 1" creator="rvr" modifier="rvr" created="201612130532" modified="201612130533" changecount="3">
<pre>Here is an example [[script]]. It has a few things like variables and an @@if@@ statement:
&lt;html&gt;&lt;pre&gt;
$ cat carrot.sh
#!/bin/bash
#Stuff
location=$1
filename=$2

if [ -z &quot;$location&quot; ]
then
  echo &quot;Give a good location.&quot;
  exit 0
fi

if [ -z &quot;$filename&quot; ]
then
  echo &quot;Gimme a filename.&quot;
  exit 0
fi

ls $location &gt;  $filename
echo &quot;Script is complete and indexed directory: $location.&quot;
echo &quot;===========================&quot;
cat $filename
&lt;/pre&gt;&lt;/html&gt;
See also [[shell misc]].</pre>
</div>
<div title="sendmail" creator="rvr" modifier="rvr" created="201611230005" modified="201611230009" changecount="3">
<pre>Linux comes with ''sendmail'', more often then not.
This will send an email using a file for the subject and text.
&lt;html&gt;&lt;pre&gt;
$ cat email.txt 
Subject: Hello World!

This is a test email.
-rob

$ sendmail rob@rtfm.ca  &lt; email.txt 
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="service" creator="rvr" modifier="rvr" created="201605250934" modified="201612011754" changecount="9">
<pre>A ''service'' is an application that runs in the background. It is either waiting to be used, or running tasks. 
Service actions:
*start - ''service nginx start''
*stop - ''service apache stop''
*restart - ''service puppetmaster restart''
*status - ''system iptables status''
For other actions, please try to use [[systemctl]]. Maybe it's preferred.

To see what services are running: @@service &amp;dash;-status-all@@
It is different from a [[daemon]] which has no user interaction, like print spoolers.
See also [[service - CentOS]]
</pre>
</div>
<div title="service - CentOS" creator="rvr" modifier="rvr" created="201611282322" modified="201612131749" changecount="6">
<pre>In ~CentOS, we have a slightly different service than Ubuntu.
This command [[systemctl]] handles [[kernel]] and other processes. See [[systemd]].
Here is how to install a service (firewall) and how to get it going:
|!Command|!Description|
|yum install firewalld|Install the firewall service.|
|systemctl nmask firewalld|Mask or disable the firewall service.|
|systemctl unmask firewalld|Unmask the firewall service.|
|systemctl disable firewalld|Disable the firewall service.|
|systemctl enable firewalld|Enable the firewall service.|
|systemctl start firewalld|Start the firewall service.|
To see all services: @@systemctl -a@@


</pre>
</div>
<div title="service user" creator="rvr" modifier="rvr" created="201907220256" changecount="1">
<pre>A ''service user'' or dedicated user is designed to be tired to a service.
That way, if that user is compromised, then the damage will be associated with that user and not have access to other resources.
A ''psql:psql'' user:group will only have access to that group.</pre>
</div>
<div title="session manager" creator="rvr" modifier="rvr" created="201501131326" modified="201907220258" changecount="4">
<pre>A ''session manager'': starts, restores, and maintains the components of the graphical session. Think &quot;state-of-the-desktop&quot;.
It is the program that actually controls your session. It runs under your account:group. See [[service user]].</pre>
</div>
<div title="set" creator="rvr" modifier="rvr" created="202301041600" modified="202301041606" changecount="3">
<pre>Set [[builtin]] commands, allow:
* change the values of shell options 
* set positional parameters
* display the names and values of shell variables
|!Command|!Description|
|set -e|Exit asap if we have non-zero state. 0=success 1=failure|
|set -u|Unset variables and parameters throw error.|
|set -x|Print a trace of simple commands before execution. For debugging.|

A same script could be:
&lt;html&gt;&lt;pre&gt;
#!/usr/bin/env bash
set -x
set -e
...
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="settings" creator="rvr" modifier="rvr" created="201501221918" modified="201501222007" changecount="5">
<pre>There are a number of settings for linux.
Linux uses Coordinated Universal Time (''UTC'') for its own internal time keeping.
Setting local time using Internet servers, done auto at setup: Network Time Protocol (NTP), this is at ''/etc/ntp.conf''</pre>
</div>
<div title="setup machine" creator="rvr" modifier="rvr" created="201102262217" modified="202301031307" changecount="9">
<pre>Here are the basic steps:
#Figure out what type of users you will have and create groups using [[addgroup|adduser]].
#Next add users to these groups using [[useradd]] or [[addgroup|adduser]].
&lt;html&gt;&lt;pre&gt;
$ groupadd webuser
$ useradd -g webuser rob
&lt;/pre&gt;&lt;/html&gt;
You may also want to check out:
*[[network configuration]]
*[[settings]]
*[[software]]</pre>
</div>
<div title="shell" creator="rvr" modifier="rvr" created="201102050237" modified="202301031205" changecount="18">
<pre>The ''shell'' is the command line interface for linux. Often it is the [[bash]] shell that is used. It is configured in a [[startup]] sequence. It stands between you and the linux [[kernel]]. 
*A shell is either ''interactive'' or ''non-interactive''
** ''interactive shell '' - reads user input typed on a keyboard, runs in the current shell and waits for further instructions.
** ''non-interactive shell '' - executes commands read from a file in a new subshell. Also runs [[Init]] and [[startup]].
*Shells can manage foreground and [[background]] processes, and keep a history of commands. 
*The [[bash]] shell is one of the more common shells. 
*To see what shells are available on your system, enter @@cat /etc/shells@@
*To see what shell you have enter @@echo $SHELL@@
*The shell will have a [[command prompt]] to accept your [[commands]].
See also:
*[[console]] and [[terminal]]
*[[shell commands]]
*[[shell programming]]
If you have made a change of some new program or information, open a new shell or type: @@source ~/.bashrc@@ to update the current shell.</pre>
</div>
<div title="shell commands" creator="rvr" modifier="rvr" created="201102051718" modified="202301041605" changecount="28">
<pre>Shell commands ...  see also [[basic commands]].
See [[shell programming]] and and [[shell misc]].
There are [[builtin]] shell commands.

To write a file like ''install.sh'' the first line should tell what shell to invoke, here is the one for the bash shell: @@#!/bin/bash@@
To [[debug shell]] commands: @@#!/bin/bash -x@@ 
You need to make the file [[executable]]: @@chmod +x &lt;filename.sh&gt;@@
To run the file enter: @@./&lt;filename.sh&gt;@@
When you want to run a command - linux only looks in the [[path]] variable. To have linux in your current directory, you have to specify it by: @@''./''@@
See [[shell variables]] and [[quoting]].</pre>
</div>
<div title="shell example 1" creator="rvr" modifier="rvr" created="201704110633" modified="201704110653" changecount="10">
<pre>Some examples
!!Read in 2 variables:
*''-p'' for prompt
*''-e -i'' to read and provide default
&lt;html&gt;&lt;pre&gt;
#Example1
read -p 'Enter a number : ' x
read -p 'Enter another (default 22): ' -e -i 22 y
printf &quot;We have read in a $x and a $y \n&quot;
&lt;/pre&gt;&lt;/html&gt;Output:&lt;html&gt;&lt;pre&gt;$ ./Example1
Enter a number : 34
Enter another (default 22): 22
We have read in a 34 and a 22 

&lt;/pre&gt;&lt;/html&gt;As a note, we could have done it all at once: @@./a.a &lt;&amp;lt;&lt; '7 8'@@</pre>
</div>
<div title="shell misc" creator="YourName" modifier="rvr" created="201104262109" modified="201710302312" changecount="36">
<pre>A bunch of shell [[script]] points:
*First line should be: @@#!/bin/bash@@. The ''shhBang'' is @@#!@@
**We'll be using the [[bash]] shell: ''/bin/bash'' 
*To make file executable: @@chmod +x filename@@ or @@chmod 755 filename@@
*To execute the script: @@./filename.sh@@ if executable or @@sh filename.sh@@ if not executable
*single quotes are ''strong'' - wysiwyg, doesn't expand meta characters
*double quotes are weak - expands meta characters like $HOME
*To pass information, use piping or command line arguments or &quot;source&quot; by using dot-scriptname, ie  @@. script-name.sh@@
*Use backtic (') to execute shell commands: echo `wc some.file`
*For math use ''expr'', so @@expr 1 +1@@
*Loops are done via: ''for'', ''while'', ''until''.
**Use ''do'' ... ''done'' for scope for command.
*Conditionals are done via: ''if''
*''&amp;&amp;'' for @@and@@ and ''||'' for @@or@@.
*Brace expansion @@{ ... }@@  ex {a..g}  =&gt; a b c d e f g
*Sub shell @@( ... )@@, often followed by @@&amp;@@ to run in [[background]]
*To exit a script: ''Exit 0''
Example script to launch ''mongod'', 
File: ''start.sh'' - make sure you run: @@chmod +x start.sh@@
&lt;html&gt;&lt;pre&gt;
#!/bin/bash
mongod --config ~/data/mongo_yaml.conf --rest
&lt;/pre&gt;&lt;/html&gt;To run this baby: @@./start.sh@@
Example script
&lt;html&gt;&lt;pre&gt;#!/bin/bash
FRUIT=( 'apple', 'banana', 'coconut', 'doughnut'  )
COUNT=${#FRUIT[@]}
for (( i=0;i&lt;$COUNT;i++)); do
    echo ${FRUIT[${i}]}
done 
&lt;/pre&gt;&lt;/html&gt;
Another example:
&lt;html&gt;&lt;pre&gt;
t$ cat apple.sh
#!/bin/bash

for i in `seq 2 3 11`
  do
   echo &quot;We have $i&quot;
  done
exit 0
$ ./apple.sh
  We have 2
  We have 5
  We have 8
  We have 11
&lt;/pre&gt;&lt;/html&gt;
See also [[script example 1]]
See also [[command prompt]].</pre>
</div>
<div title="shell programming" creator="rvr" modifier="rvr" created="201412131004" modified="202005252243" changecount="14">
<pre>Some stuff. More examples: [[shell example 1]]
Se also [[shell commands]] and [[shell misc]].

Create a file, &quot;hello&quot;
&lt;html&gt;&lt;pre&gt;
# First try
echo hello world
&lt;/pre&gt;&lt;/html&gt;
File must be executable, then you run it:
&lt;html&gt;&lt;pre&gt;
&gt; chmod +x file-name
&gt; ./hello
hello world
&lt;/pre&gt;&lt;/html&gt;
This runs in a subshell, so doing a change directory will be lost upon exiting of script. You'd have to run this as: ''. myChange'' for it to work.
&lt;html&gt;&lt;pre&gt;
# myChange
cd ~/to/some/directory
&lt;/pre&gt;&lt;/html&gt;or you could use [[alias]] do this: ''alias myChange=&quot;cd /to/some/directory&quot;''

 See also [[command prompt]].</pre>
</div>
<div title="shell variables" creator="rvr" modifier="rvr" created="201102070415" modified="201605180853" changecount="36">
<pre>Bash shells don't rigidly define [[environment variables]] vs shell variables, but other shells do. I will artificially separate the two for this wiki.
''environment variables'' (aka system variables) are read by the command [[shell]], like Bash, and made shell variables from that point on.
Shell variables or local variables are ones that are user created and only available within the scope they are created. Here are typical shell variables:
|!Shell Variable|!Description|
|UID|The UID of the current user.|
|~PS1|The primary prompt string.|
|~BASH_VERSION|The bash version. To see, run: echo $~BASH_VERSION|
|COLUMNS|How many columns on the screen. Resize screen &amp; it changes.|
|HISTFILESIZE|Number of lines of command history stored to a file.|
|HOSTNAME|The hostname of the computer at this time.|
|SHELLOPTS|Shell options that can be set with the set option.|
To see what the value for the variable is, use ''echo''
*Format: @@echo $&lt;shell-var&gt;@@
*Example: @@echo $COLUMNS@@
To create &amp; delete shell vars, with bonus environment var...
&lt;html&gt;&lt;pre&gt;
$ HIW='Hello World!'   # Set a shell var
$ set | grep HIW       # Look for a shell var
   HIW='Hello World!'  # Success
$ printenv | grep HIW  # Look for an env var - nothing
$ echo HIW
   HIW
$ echo $HIW            # We need to use a $ to tell the system we want a variable.
   Hello World!        # What we wanted to see
$ export HIW           # Export meaning make it an environment variable.
$ printenv | grep HIW  # Check if it is an env var now.
   HIW=Hello World!    # Yes.
$ export -n HIW        # Undo the damage, ie undo making it an env var
$ printenv | grep HIW  # Now returns nothing
$ unset HIW            # Unset this as a system var
$ echo $HIW            # Now returns nothing

&lt;/pre&gt;&lt;/html&gt;

 See also [[magic vars]]. Here is file ''test.sh''
&lt;html&gt;&lt;pre&gt;
#!/bin/bash
printf &quot;Hello user %s \n&quot; $USER
read -p &quot;Enter something: &quot; xvar  # Reads from command line
printf &quot;You entered %s \n&quot; $xvar 
var1=&quot;test&quot;
echo ${var1:=qwerty9}  # This will print &quot;test&quot;
echo ${var2:=changed}  # This will print &quot;changed&quot; AND assign var2=changed
echo ${var3:-changed}  # This will print &quot;changed&quot; BUT NOT assign var3=changed
&lt;/pre&gt;&lt;/html&gt;

Here is a sample run:
&lt;html&gt;&lt;pre&gt;
$ ./test.sh
Hello user rob
Enter something: hello
You entered hello
test
changed
&lt;/pre&lt;/html&gt;May want to look at [[quoting]].
To get parameter variables, use $1 for the first, $2 for the second. So, file.sh:
&lt;html&gt;&lt;pre&gt;
#!/bin/bash
test = ${2:?Error: need two parameters}
echo -e &quot;Hello there $1&quot;
echo -e &quot;your favorite number is $2&quot;
&lt;/pre&gt;&lt;/html&gt;
&lt;html&gt;&lt;pre&gt;
$ ./rob.sh rob 42
Hello there rob
your favorite nunber is 42
$ ./rob.sh rob 
./rob.sh: line 2: 2: Error: need two parameters

&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="shutdown" creator="rvr" modifier="rvr" created="201102022228" modified="202301031207" changecount="11">
<pre>There are many ways to shutdown from the command line. Or you can use the GUI. You can also [[suspend]].

|!Command|!Description|
|reboot|Shutdown and reboot.|
|init 6|Shutdown and reboot.|
|shutdown|Best way and preferred way to do it. |
|shutdown -r|Shutdown and reboot|
|shutdown -r now|Shutdown now and reboot|
|shutdown -c|Cancel shutdown|
|shutdown -h|Shutdown and halt|
|shutdown &amp;#45;-help|Shutdown help|
|shutdown -h 10:00 &quot;Shutting down at 10!&quot;|Shutdown and halt, give message to users. logged in.|
|poweroff|Sends an ACPI signal which instructs the system to power down.|
|halt|Instructs the hardware to stop all CPU functions.|
|init 0|Shutdown, like halt.|

These require root access.
The [[Init]] process will then control shutting down or rebooting the system. </pre>
</div>
<div title="snap" creator="rvr" modifier="rvr" created="202005260141" changecount="1">
<pre>''Snap'' is like a docker for linux.
They are packaged up to run on any system.</pre>
</div>
<div title="software" creator="rvr" modifier="rvr" created="201501221949" modified="202301031313" changecount="2">
<pre>Installing and updating software.
A ''package'' in Linux provides a piece of the system. Packages rely on other packages and these dependencies must be met. There is a utility that handles the unpacking and checking of these packages. See [[Package Management]].
</pre>
</div>
<div title="sort" creator="rvr" modifier="rvr" created="201605111241" changecount="1">
<pre>Sort sorts.
Will sort on first column in the file to be sorted.
Sort entire file: @@sort some.file@@
Omit duplicates: @@sort -u some.file@@
Reverse order: @@sort -r some.file@@
Sort on 2nd field: @@sort -k2 some.file@@</pre>
</div>
<div title="ssh-agent" creator="YourName" modifier="rvr" created="202302141104" modified="202302141115" changecount="5">
<pre>''ssh-agent'' is a key manager for [[SSH]]. It performs many tasks:
* it holds keys and certificates in memory, unencrypted.
* it is used by ssh.
* when ssh first runs, ''ssh-agent'' fires up and runs in background.
* it is separate from [ssh]].
* it does ''not'' write key info to disk.
* all it does is: '' sign a message''

When an ssh session fires up, there is a handshake. Here are the steps:
* Your machine (client) sends over its public key to another machine (server).
* The machine (server) generates and returns a brief message for the client for it to sign using its private key.
* The client asks the ''ssh-agent'' to sign the message and forwards the result back to the server.
* The server checks the signature using the client's public key.
* The server now has proof that the client is in possession of their private key.

The ''ssh-agent'' makes it so we don't have to enter the private key to sign a message.</pre>
</div>
<div title="startup" creator="rvr" modifier="rvr" created="201502120326" modified="201612060624" changecount="30">
<pre>There is a ''startup'' routine when a [[shell]] is invoked. 
We can have a combo of either: (login OR non-login) AND (interactive OR non-interactive) :
*a regular login - authenticated a user, a [[home]] directory is assigned.
**It checks: ''/etc/profile'' then the first login shell configuration file in the user's home directory.
**The choices are: ~/.bash_profile,  ~/.bash_login, and ~/.profile and nothing more(?).
*a non-login - we spawn a session, first checks: ''/etc/bashrc'' and then  ''~/.bashrc''
*an interactive session - attached to a terminal. Can force different rc file using ''&amp;dash;-norc'' option.
**see also [[virtual terminal]]
*a non-interactive session - not attached to a terminal, looks for environmental variable ''~BASH_ENV''
Here is the list:
*configuration in [[/etc]] sets global settings.
**''/etc/environment'' - this file will be used to set environment variables.
*initialization files in the users home directory will override global settings. This includes
**setting the [[command prompt]]
**command line shortcuts
**setting defaults like text editor
**setting the [[path]] to execuatable programs
The order of the ''startup'' files for the Bash shell is:
#[[/etc/profile]] is read first
##''/etc/bash.bashrc'' - the default Ubuntu'' /etc/profile'' sources ''/etc/bash.bashrc''
#~/.bash_profile is looked at next.
#~/.bash_login follows, and finally
#~/.profile 
Bash will find and process the first of the above files and then ignore the rest.
The above is done on initial ''startup''. Invoking a shell once you are up and running wil only use the ''~/.bashrc'' profile.
See also [[environment variables]].
.</pre>
</div>
<div title="sticky bit" creator="rvr" modifier="rvr" created="201612190415" modified="201612190434" changecount="11">
<pre>The ''sticky bit'' means that only the creator can delete the file in a 777 directory.
File permissions of 777 means that everybody can add and delete files.
*''/tmp'' - contains temp files that get turfed on reboot
*''/var'' - contains files that often change, like logs and mail.
*''/var/tmp'' -contains files that don't get deleted on reboot.
You set the ''sticky but'' via command: @@chmod o+t &lt;dir name&gt;@@
The sticky bit means that ''only'' the creator of the folder can delete it.
&lt;html&gt;&lt;pre&gt;
$ ll   
  drwxrwxr-x. 2 biteme biteme 6 Dec 19 04:20 jupiter  
$ chmod o+t jupiter/   
$ ll   
  drwxrwxr-t. 2 biteme biteme 6 Dec 19 04:20 jupiter
&lt;/pre&gt;&lt;/html&gt;
The ''sticky bit'' [[permissions]] - you'll see a@@t@@ in the last column.
&lt;html&gt;&lt;pre&gt;
$ ll                                                                         
drwxrwxr-t. 2 biteme biteme 6 Dec 19 04:20 jupiter      # Has sticky bit
$ chmod 777 jupiter/               # This chmod removes sticky bit
$ ll                                                                         
drwxrwxrwx. 2 biteme biteme 6 Dec 19 04:20 jupiter    
$ chmod 0777 jupiter/             # This chmod is the same as above chmod!
$ ll                                                                         
drwxrwxrwx. 2 biteme biteme 6 Dec 19 04:20 jupiter    
$ chmod 1777 jupiter/             # This chmod ADDS sticky bit, with leading 1
$ ll                                                                        
drwxrwxrwt. 2 biteme biteme 6 Dec 19 04:20 jupiter    
&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="su" creator="rvr" modifier="rvr" created="201102042138" modified="202301022003" changecount="12">
<pre>Substitute user or substitute user - to become someone else. See also [[sudo]].
&lt;html&gt;&lt;pre&gt;
rvr@adam$ su rob      # You become rob, keeping your environment as is.
rvr@adam$ su - rob    # You become rob, the dash means &quot;gimme the environment that rob would see''

rob@adam$ su          # You become root - some distros don't allow this...use &quot;sudo su&quot;
rob@adam$ whoami      # If you forget who who are
&lt;/pre&gt;&lt;/html&gt;To exit this shell, enter ''exit''.</pre>
</div>
<div title="subnet" creator="rvr" modifier="rvr" created="201612142218" changecount="1">
<pre>A portion of a network that shares a common address component. 
On TCP/IP networks, subnets are defined as all devices whose [[IP]] addresses have the same prefix. 
For example, all devices with IP addresses that start with 100.100.100. would be part of the same subnet. Dividing a network into subnets is useful for both security and performance reasons. IP networks are divided using a subnet mask.</pre>
</div>
<div title="subnet mask" creator="rvr" modifier="rvr" created="201612142145" modified="201612142247" changecount="15">
<pre>An IP address has two components, a network address and the host address. 
A [[subnet]] mask separates the IP address into the network and host addresses.
A subnet mask is a 32-bit number that masks an IP address, and divides the IP address into network address and host address. 
A subnet Mask is made by setting network bits to all &quot;1&quot;s and setting host bits to all &quot;0&quot;s. 
There one for each of class: (see [[IP Address Classes]] ) 
*Class A - 8-bits 
**Subnet mask is 255.0.0.0
**Network address is first octet, a number between 1 and 126. Allows for 126 hosts.
**Node address is the remaining 3 octets. Allows for 16.7 million nodes.
*Class B - 16-bits 
**Subnet mask is 255.255.0.0
**First octet is a number between 128 and 192. 
**Network address is first 2 octets. Allows for 16,384 hosts.
**Node address is the remaining 2 octets. Allows for 65,534 million nodes.
*Class C - 24-bits 
**Subnet mask is 255.255.255.0
**First octet is a number between 192 and 223. 
**Network address is first 3 octets. Allows for 2,097,152 hosts.
**Node address is the remaining 2 octets. Allows for 254 nodes.
For example, consider the IP address 150.215.017.009. Assuming this is part of a Class B network, the first two numbers (150.215) represent the Class B network address, and the second two numbers (017.009) identify a particular host on this network.
There is a shorthand
192.168.1.1/24 - indicates that 24 bits are used for the subnet mask. </pre>
</div>
<div title="sudo" creator="rvr" modifier="rvr" created="201102262228" modified="201605191851" changecount="16">
<pre>Sudo means ''substitute user do'' - to allows users to run commands that they normally do not have permissions for. Sudo generally is root (superuser). The list of users authorized is listed in ''/etc/sudoers''. The results of running under ''sudo'' get logged in ''/var/log/messages''
A typical session could be:
&lt;html&gt;&lt;pre&gt;
$ do-some-important-task
  do-some-important-task: Permission denied
$ sudo do-some-important-task
  Password:
  mission-accomplished...
&lt;/pre&gt;&lt;/html&gt;
To see what commands you can do: @@sudo -l@@
To run a command as root: @@ sudo &lt;command&gt;@@
To launch a new shell as root: @@ sudo -s@@
To run command as fred: @@ sudo -u fred &lt;command&gt;@@
To become root for an entire session: @@ sudo su -@@   # Dash means with &quot;root&quot; environment.

To setup ''sudo'' if not done, make sure there is a ''/etc/sudoers.d/'' directory and for user ''rob'':
&lt;html&gt;&lt;pre&gt;
$ su   (I didn't have su in Ubuntu setup, so had to do &quot;sudo su&quot;)
$ echo &quot;rob ALL=(ALL) ALL&quot; &gt; /etc/sudoers.d/rob
$ chmod 440 /etc/sudoers.d/rob
&lt;/pre&gt;&lt;/html&gt;
You can edit the ''/etc/sudoers'' file by using: @@sudo visudo@@
Here are some typical examples, follow this format: @@user host=(users) [NOPASSWD:]commands@@
NOTE: The user in brackets below is what user the command will run under.
adminuser ALL=(ALL) NOPASSWD:ALL
rob postgres=(root) /etc/init.d/postgres
</pre>
</div>
<div title="suspend" creator="rvr" modifier="rvr" created="201501131452" modified="201501131453" changecount="2">
<pre>Suspending the computer aka sleeping, saves system state, loads this in RAM and avoids the [[boot process]] when starting up again, saving time. It also minimizes power used. Not all computers have suspend capabilities.</pre>
</div>
<div title="syslog" creator="rvr" modifier="rvr" created="201612131852" modified="201612131907" changecount="3">
<pre>There are many ways of looking at system logs.
I'll organize this later.
To look for info in these places, use [[grep]] and [[less]]: 
*@@grep &lt;some-string&gt; /var/log/* @@
*@@grep &lt;some-string&gt; /var/log/* @@
*@@dmsg | less@@
</pre>
</div>
<div title="system accounts" creator="rvr" modifier="rvr" created="201612160246" modified="202005241518" changecount="3">
<pre>System accounts are not for logging in. They are used by services running on the system. Examples are ssh server, db, ftp, mail, etc. Typically accounts are #1-999.
System accounts are used by system [[service]]s.</pre>
</div>
<div title="system admin" creator="rvr" modifier="rvr" created="201612110621" modified="201612110653" changecount="14">
<pre>Linux has a lot of information that is accessed at the command line.
Any system admin will have to know where to look for this and how to access it.
Configuration files are in text, so the [[basic commands]] one needs are: 
''cat'', [[cut]], [[head]], [[tail]], [[less]],[[find]], [[grep]], and [[pipe]]. Of course [[vi]] or ''vim''.

There are also places you need to know like:
*[[/etc/passwd]]
*[[/etc/group]]
*[[logs]] and [[journalctl]]
*[[profile]] files when you [[login]]

System state via [[systemctl]] 
The [[shell]] and [[environment variables]] and [[shell variables]]. Also [[redirect]].</pre>
</div>
<div title="systemctl" creator="rvr" modifier="rvr" created="201612011817" modified="202301031208" changecount="29">
<pre>''systemctl'' handles the [[systemd]] system and is the system manager that is the new standard for Linux. 
The ''systemctl'' command is the central management tool for controlling the [[Init]] system.
An ''init'' system is to initialize the components that must be started after the Linux kernel is booted. 
The [[Init]] system is also used to manage services and daemons for the server at any point while the system is running.
In ''systemd'', the target of most actions are &quot;units&quot;, which are resources that systemd knows how to manage. Units are categorized by the type of resource they represent and they are defined with files known as unit files. The type of each unit can be inferred from the suffix on the end of the file.
Any output generated goes into the [[journal]].

For service management tasks, the target unit will be service units, which have unit files with a suffix of .service. To see a list of all installed services:
&lt;html&gt;&lt;pre&gt;
# systemctl start &amp;lt;name.service&gt;   - note that you can drop the .service, as systemd figures that out.
# systemctl start &amp;lt;name&gt;
# systemctl stop &amp;lt;name&gt;
# systemctl restart &amp;lt;name&gt;
# systemctl reload &amp;lt;name&gt;
# systemctl status &amp;lt;name&gt;
# systemctl is-active &amp;lt;name&gt;
# systemctl cat &amp;lt;name&gt;    # List the service file

To have programs run from startup
# systemctl enable &amp;lt;name&gt;
# systemctl disable &amp;lt;name&gt;
&lt;/pre&gt;&lt;/html&gt;
See [[systemctl status]]
Overall system commands:
&lt;html&gt;&lt;pre&gt;
# systemctl status
# systemctl list-units         # What systemctl knows about
# systemctl --state=failed     # To see reasons for problems
# systemctl list-unit-files    # use /xxx to search for xxx.
# systemctl list-units -&amp;dash;all   # What systemctl knows about, but more
# systemctl list-units -&amp;#45type service -&amp;#45all
# systemctl list-unit-files -&amp;#45;type=service
# systemctl list-unit-files --state=enabled
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="systemctl status" creator="rvr" modifier="rvr" created="201612011841" changecount="1">
<pre>The ''systemctl status'' command provides important information There are a few keys things to see..
*Description of servise
*Is it loaded and enabled (to launch at boot)
*Is it active or disabled or activating
*docs, pid, and a few lines of the log file
&lt;html&gt;&lt;pre&gt;
# systemctl status sshd
● sshd.service - OpenSSH server daemon
   Loaded: loaded (/usr/lib/systemd/system/sshd.service; enabled; vendor preset: enabled)
   Active: active (running) since Thu 2016-12-01 17:43:25 UTC; 54min ago
     Docs: man:sshd(8)
           man:sshd_config(5)
 Main PID: 1230 (sshd)
   CGroup: /system.slice/sshd.service
           └─1230 /usr/sbin/sshd -D

Dec 01 17:43:25 secret.biteme.com systemd[1]: Started OpenSSH server daemon.
Dec 01 17:43:25 secret.biteme.com systemd[1]: Starting OpenSSH server daemon...
Dec 01 17:43:26 secret.biteme.com sshd[1230]: Server listening on 0.0.0.0 port 22.
Dec 01 17:43:26 secret.biteme.com sshd[1230]: Server listening on :: port 22.
Dec 01 17:45:41 secret.biteme.com sshd[3278]: Accepted password for user from 42.42.42.42 port 37600 ssh2

&lt;/pre&gt;&lt;/html&gt;

</pre>
</div>
<div title="systemd" creator="rvr" modifier="rvr" created="201611131724" modified="202301031208" changecount="33">
<pre>Systemd is the [[Init]] daemon as well it handles daemons journald, logind and networkd, and many other low-level components.
It used for centralized management to log all kernel and other processes (like puppet) and ''systemctl'' is how we access this info.
A system that collects and manages these logs is known as the journal. See [[journalctl]].
!!Start Programs
You can use ''systemd'' to start programs. Systemd will look for unit files to run. Let's do one:
#Goto directory: ''cd /etc/systemd/system''
#Create a ''service'' file like [[important.service]]
##Have some [[shell]] script to run.
#Use [[systemctl]] to start/stop/enable etc.
#Run: @@systemctl start something-important@@
#Check if successful: @@journalctl -f @@

</pre>
</div>
<div title="tail" creator="Rob" modifier="Rob" created="201511211602" changecount="1">
<pre>Tail, print out the tail of a file. Default is 10 lines. Examples:
*''tail abc.txt -n 42'' - print out last 42 lines
*''tail abc.log -f'' - Follow, I like &quot;forever&quot;, useful for log files.</pre>
</div>
<div title="tar" creator="rvr" modifier="rvr" created="201502110720" modified="201612101845" changecount="17">
<pre>''tar'' stands for &quot;tape archive&quot;. It allows you to create or extract files (and compress if you choose) from an archive file. It simply bundles a group of files and/or directories. Starting with a dash ''&quot;-&quot;'' is optional.
*''c'' - create
*''x'' - extract
*''t'' - list
*''v'' - verbose
*''z'' - use compression
*''f'' - use this file
|!Command|!Description|
|tar -cf all.tar . |Compress everything in current directory (except all.tar - you'll get message).|
|tar -cf biteme.tar apple.txt banana.doc carrot.pdf |Compress 3 fruit files into a biteme tar file.|
|tar -xvf mydir.tar |Extract all the files in mydir.tar into the current directory. Use ''v''erbose output.|
|tar -zcf mydir.tar.gz mydir |Create the tar archive of everything in mydir, and compress with ''gzip'' (-z).|
|tar -jcvf mydir.tar.bz2 mydir  |Create the archive and compress with ''bzip2''  (-j). Use ''v''erbose output.|
|tar -xvf mydir.tar.gz  |Extract all the files in mydir.tar.gz into the current directory. Note you do not have to tell tar it is in gzip format.|
Often ''tar'' is use with [[compression]], and the ''-j'' and ''-z'' flags use [[compression]].</pre>
</div>
<div title="terminal" creator="rvr" modifier="rvr" created="201408180424" modified="201408230912" changecount="5">
<pre>Commands done in a GUI screen in Linux typically have a counterpart in the command line through something called a terminal. A terminal refers to a wrapper program which runs a [[shell]]. You can get to the command line by using terminal emulators. There are a few like: gnome-terminal, xterm, rxvt, konsole, and terminator. 
When logging into machines remotely you are presented with a terminal, which is a command line interface [[CLI]].
In the olden days, the terminal was physical! Hence, today we have terminals or virtual terminals.
</pre>
</div>
<div title="theme" creator="rvr" modifier="rvr" created="201501151338" modified="201501151501" changecount="2">
<pre>The [[Graphical Desktop]] comes with a ''theme''. This theme can be changed, which will change the look and feel of the screen, windows, and controls.
There are many themes at: http://art.gnome.org/themes/</pre>
</div>
<div title="top" creator="rvr" modifier="rvr" created="201102042118" modified="202005252304" changecount="6">
<pre>The ''top'' command shows the current of the machine, listing processes and live information.
To set different refresh rates use the ''d'' switch: @@''top -d .1''@@ to refresh every 1/10 second.
Use htop for a more interative top. Install: 
&lt;html&gt;&lt;pre&gt;apt-get install htop&lt;/pre&gt;&lt;/html&gt;
You can use ''@@SHIFT + &gt;@@'' to go to different columns to sort, as well as ''@@SHIFT + &lt;@@'' to go the left.</pre>
</div>
<div title="type" creator="rvr" modifier="rvr" created="201102070331" modified="201501290518" changecount="3">
<pre>Find out about commands use ''type'':
&lt;html&gt;&lt;pre&gt;
$ type -a pwd
pwd is a shell builtin
pwd is /bin/pwd
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="typical filesystem" creator="rvr" modifier="rvr" created="201501311617" modified="202301031244" changecount="40">
<pre>Here is a typical Linux [[filesystem]] layout. Note that the root is a single forward slash ''/''.
Use the ''tree -d'' command to see the top-down view of the filesystem.
*''/'' (root)
**''[[/bin]]''      . . . Essential user binaries - common linux commands like: ps, ls, ping, and cp.
**''[[/boot]]''     . . . Static bootloader files 
**''[[/dev]]''      . . . Device files - any device attached to the system.
**''[[/etc]]''      . . . Configuration files, used by all programs. Also start/stop scripts for programs.
***''/fstab''     . . . filesystem table. 
***''/group''     . . . group config. 
***''/passwd''     . . . passwords. 
***''/shadow''     . . . shadow passwords. 
***''/gshadow''    . . . shadow passwords for groups. 
***''/profile''     . . . system startup programs. 
**''/[[home]]''     . . . Home directories, where users store personal data
**''[[/lib]]''      . . . Essential system libraries, contains library files that supports the binaries located under /bin and /sbin
**''[[/media]]''    . . . Removeable media, usb, ~CDs, etc
**''/mnt''      . . . Mount directory. Temporary mount directory where sysadmins can mount filesystems.
**''/opt''      . . . Optional. No set use, but often it is installed software like adobe, google, brave, xnconvert, sublime text.
**''[[/proc]]''     . . . System information, process information (see ps command)
**''/root''     . . . This is the folder for the [[root]] user.
**''/sbin''     . . . System binaries, typically used by the system or admin like: iptables, reboot, fdisk, and ifconfig.
**''/srv''      . . . Service data, typically for servers. Not often used now.
**''/sys''  . . . Pseudo files about the system, can be altered and also used for debugging.
**''/tmp''      . . . Temporary files, here and then gone.
**[[/usr]]      . . . User programs, the binaries, libraries, documentation, and source-code.
***''/x11rc''  . . . X Window configuration files; generally obsolete.
***''/bin''  . . .   This is the primary directory of executable commands on the system. [[EOS|http://http://eos.rtfm.tiddlyspot.com/]] binaries like ''/usr/bin/cleos''
***''/games''  . . . Essential and mission critical application
***''/include''  . . . Header files used to compile applications.
***''/lib''  . . . Libraries for programs in /usr/bin and /usr/sbin.
***''/lib64''  . . . Like /lib but for 64-bit libraries for 64-bit programs 
***''/local''  . . .  Data and programs specific to the local machine.
****''/bin''
****''/etc''
****''/include''
****''/lib''
****''/sbin''
***''/sbin'' . . .   Non-essential system binaries, such as system daemons.
***''/share''  . . .  Shared data used by applications. Man pages.
***''/src''  . . . Source code, usually for the Linux kernel.
**''/var''     . . . Variable files, typically logs or db files
***''/cache''
***''/lib''
***''/log''
***''/mail''
***''/opt''
***''/spool''
***''/tmp'' - this folder, the files don't get deleted on reboot.</pre>
</div>
<div title="user" creator="rvr" modifier="rvr" created="201502110745" modified="201704040406" changecount="16">
<pre>The ''user'' is an important part of linux. Use ''{{{who -a}}}'' to find out who is logged in and ''{{{whoami}}}'' to see who you are. Also typing ''{{{id}}}'' will provide lots of info. You are assigned a unique user id  [[UID]] and GID in [[/etc/passwd]] and [[/etc/group]]. These ID's can start at number 500, but typically it starts at 1000.
Users are organized into [[group]]s.
This is all done for organization and assigned permissions etc to groups of users. Here are some commands:
*cat [[/etc/passwd]] - to list all users
**@@cat /etc/passwd | grep fred@@  - to see if there is a fred
*[[useradd]] - to add users
*[[userdel]] - to delete users
*[[groupadd]] - to add groups
*[[groupdel]] - to delete groups</pre>
</div>
<div title="useradd" creator="rvr" modifier="rvr" created="201012091821" modified="201902282141" changecount="13">
<pre>Use the ''useradd'' command to add new users. Can also use [[adduser]].
Use the ''usermod'' command to modify user information.
&lt;html&gt;&lt;pre&gt;
sudo adduser test               # You have to have authority to add a user.
useradd -g developers rob  	# To add a user rob to group developers - primary group (-g).
userdel -r rob			# remove user rob. -r to remove directory
&lt;/pre&gt;&lt;/html&gt;For suse, you will have to run: ''{{{sudo /usr/sbin/useradd turkey}}}''
The ''usermod'' command is used to modify user information.
&lt;html&gt;&lt;pre&gt;
usermod -a -G ftp rob	  # To add (-a) existing user rob to (-G) secondary group ftp
usermod -g biteme please  # Change existing user please primary group to biteme
usermod -aG docker rob    # Add rob to group docker
usermod -l rob bigcheese  # Change user &quot;rob&quot; to &quot;bigcheese&quot;
&lt;/pre&gt;&lt;/html&gt;See also [[group]]</pre>
</div>
<div title="userdel" creator="rvr" modifier="rvr" created="201102080340" modified="201612172241" changecount="7">
<pre>To delete a user:
&lt;html&gt;&lt;pre&gt;
deluser &amp;lt;username&amp;gt;     # Command to delete a user. Does not delete home directory
deluser &amp;lt;username&amp;gt; -r   # Command to delete a user AND home directory
userdel &amp;lt;username&amp;gt;     # Script to delete a user
&lt;/pre&gt;&lt;/html&gt;See also [[adduser]]</pre>
</div>
<div title="utility programs" creator="rvr" modifier="rvr" created="201408250712" changecount="1">
<pre>There are some great ''utility programs''.

|!Program|!Description|!Example|
|[[locate]]|Ya, locate something|$ locate zip|</pre>
</div>
<div title="vi" creator="rvr" modifier="rvr" created="201510200809" modified="201612130440" changecount="34">
<pre>The ''vi'' is a popular editor, and ''vim'' is an updated one. See also [[nano]].
There are two modes: ''command'' mode and ''insert'' mode.
To enter a command, in ''command'' mode enter a colon '':'' You should be at teh command line at bottom of screen.

|!Command|!Description|
|vi file-name|Edit file-name|
|w|Save file and stay in editor.|
|wq|Save file and quit editor.|
|q!|Quit file and quit editor, abandon all changes.|
|42|Goto line 42 - or pick another number.|
|o|open	o=open line for input below  O=open line above|
|set nu|Turn on line number. Use &quot;nonu&quot; to turn off.|
|help|For help.|

These operators are for line mode, that is they are not prefaced with a colon '':''.
|!Operator|!Description|
|~ |Reverse case.|
|i|Insert at cursor. |
|I|Insert at start of line. (should see &quot;&amp;dash;-insert-&amp;dash;&quot; at bottom.)|
|a|Append at next letter right (like insert).|
|A|Append at EOL.|
|cw|Change word, to right of cursor.|
|cc|Change whole line.|
|C|Change text from current position to EOL.|
|d|Delete character.|
|D|Delete to EOL.|
|dw|Delete a word.|
|dd|Delete a line.|
|x|Delete character.|
|w|for word|
|b|backward|
|r|Replace a character. |
|R|Replace lots more. |
|yy|Yank or copy current line.|
|yw|Yank a word. y33 = yank 3 words.|
|p|Paste - something you have yanked, or deleted!|
|u|undo|
|$|EOL|
|L|Line (end of screen)|
|0|BOL|
|G|Global, EOF|
|ctrl-u|up ½ screen|
|ctrl-d|down ½ screen|
|ctrl-b|back one screen|
|ctrl-f|forward one screen|
|ctrl-R|Redo last command.|

|!Command|!Description|
|/&lt;pattern&gt;|Search for a pattern. Use ?&lt;pattern&gt; to go backwards. n=next word N=previous word.|
|:s/containers/container_types/g|change all occurances on current line|
|:%s/containers/container_types/g|change very occurance on every line|
|:#,#s/containers/container_types/g|change betweens line # and #.|</pre>
</div>
<div title="virtual terminal" creator="rvr" modifier="rvr" created="201408180438" modified="202301031306" changecount="13">
<pre>Virtual Terminals (VT) are console sessions that use the entire display of a graphical environment. That is - they do not use [[X Window System]]. Such terminals are considered &quot;virtual&quot; because although there can be multiple active terminals, only one terminal remains visible at a time. A VT is not quite the same as a command line terminal window; you can have many of those visible at once on a graphical desktop.
~VT1 &amp; ~VT7 are used for GUI environments. Use ''~Cntl-Alt-&lt;~FnKey&gt;'' to change to different ~VTs. Function Key 1 is Fn1 to get to ~VT1.</pre>
</div>
<div title="web permissions" creator="rvr" modifier="rvr" created="201012091602" modified="201502120330" changecount="13">
<pre>Typical settings for [[home]] directory - you have complete access to the directory and the world can only execute this file.: &lt;html&gt;&lt;pre&gt;chmod 701 public_html     # which would be rwx --- --x&lt;/pre&gt;&lt;/html&gt;
Typical settings for a typical ''file'' - you can read &amp; write to the file and that the web server can get the document.: &lt;html&gt;&lt;pre&gt;chmod 604 some_document.html     # which is rw- --- r--&lt;/pre&gt;&lt;/html&gt;
Typical settings for a ''script file'': &lt;html&gt;&lt;pre&gt;chmod 755 some_document.pl    # (which is rwxr-xr-x)&lt;/pre&gt;&lt;/html&gt;
See [[chown]] to change owner permission.
See [[chgrp]] to change group permission.</pre>
</div>
<div title="widgets" creator="rvr" modifier="rvr" created="201612041758" modified="201907220349" changecount="6">
<pre>Widgets handle GUI menus, icons, etc. 
Widgets are a toolset for GUI features like creating windows, menus, and dialog boxes etc.
The two most popular are Qt and GTK+.  GTK+ aka gimp toolset.
[[KDE]] use the Qt.
[[Gnome]] use the GTK+.</pre>
</div>
<div title="wifi" creator="rvr" modifier="rvr" created="201606120028" modified="202301031317" changecount="8">
<pre>Having ''wifi'' connections problems at one location.
To see what wifi I have conenction to: @@sudo iwlist wlan0 scan | grep ESSID@@
To see : @@iw wlan0 scan@@
To see wifi connection status : @@iw wlan0 link@@
To reboot the [[service]]: @@sudo service network-manager restart@@
Need to learn a little more.</pre>
</div>
<div title="wildcards" creator="rvr" modifier="rvr" created="201408280936" modified="202301031227" changecount="18">
<pre>These are used to find things in commands like ls, rm, and cp.
|!Character|!Description|
|?|Matches a single character.|
|*|Matches any sequence of characters.|
|[set-of-chars]|Matches any occurrence of a single character.|
|[!set-of-chars]|Matches any character not in set-of-chars.|
|[a-n]|Match a range, use a dash: ''-''. &quot;a-n&quot; matches anything from &quot;a&quot; to &quot;an&quot;.|

!!Some examples:
Match a single character that is a vowel: ''[aeiouy]''
Match any word ending in a vowel: ''*[aeiouy]''
Match any word starting in a vowel: ''[aeiouy]*''

Can also use named character classes, in format: ''[&amp;#91;:xxxx:]&amp;#93;''
'':lower:'' - lowercase letters
'':upper:'' - uppercase letters
'':alpha:'' - ''ls *[&amp;#91;:alpha:]&amp;#93;''  - looks for a-z ~A-Z
'':digit:'' - ''ls *[&amp;#91;:digit:]&amp;#93;'' - list everything that ends in a number.
'':alnum:'' - alphanumeric meaning alpha+digits 
'':punct:'' - punctuation characters

To match wildcard character - use a backslash. &quot;\?&quot;
See also [[quoting]].</pre>
</div>
<div title="window manager" creator="rvr" modifier="rvr" created="201501131326" modified="201907220358" changecount="8">
<pre>The ''window manager'': controls the placement and appearance of windows, window title-bars, and controls. Some examples include:
*Afterstep
*Mutter
*kwin
*Enlightenment - also a [[Wayland]] compositor.
*fvwm
*metacity
*sawfish
*~WindowMaker
''X11'' window managers only talk to the [[display server]], not directly to the hardware.</pre>
</div>
<div title="write to file" creator="rvr" modifier="rvr" created="201709302102" modified="201709302105" changecount="4">
<pre>We can use [[echo]] to write to a file.
&lt;html&gt;&lt;pre&gt;
echo &quot;First line&quot; &gt; first.one    # Creates file if not there, overwrites contents of existing file.
echo &quot;First line&quot; &gt;&gt; next.one    # Creates file if not there, appends text.
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="xinput" creator="rvr" modifier="rvr" created="201610270651" modified="201612041731" changecount="9">
<pre>To change device parameters.
I couldn't get my mouse to change speed, so...
&lt;html&gt;&lt;pre&gt;
$ xinput --list --short
⎡ Virtual core pointer                    	id=2	[master pointer  (3)]
⎜   ↳ Virtual core XTEST pointer              	id=4	[slave  pointer  (2)]
⎜   ↳ HP HP Link-5 micro dongle               	id=10	[slave  pointer  (2)]
⎜   ↳ SynPS/2 Synaptics TouchPad              	id=13	[slave  pointer  (2)]
⎣ Virtual core keyboard                   	id=3	[master keyboard (2)]
    ↳ Virtual core XTEST keyboard             	id=5	[slave  keyboard (3)]
    ↳ Power Button                            	id=6	[slave  keyboard (3)]
    ↳ Video Bus                               	id=7	[slave  keyboard (3)]
    ↳ Power Button                            	id=8	[slave  keyboard (3)]
    ↳ HP HP Link-5 micro dongle               	id=9	[slave  keyboard (3)]
    ↳ WebCam SC-13HDL11939N                   	id=11	[slave  keyboard (3)]
    ↳ AT Translated Set 2 keyboard            	id=12	[slave  keyboard (3)]
&lt;/pre&gt;&lt;/html&gt;
You can see my mouse is id=10, so the settings...
&lt;html&gt;&lt;pre&gt;
$ xinput --list-props 10
Device 'HP HP Link-5 micro dongle':
	Device Enabled (139):	1
	Coordinate Transformation Matrix (141):	1.000000, 0.000000, 0.000000, 0.000000, 1.000000, 0.000000, 0.000000, 0.000000, 1.000000
	Device Accel Profile (267):	0
	Device Accel Constant Deceleration (268):	1.000000
	Device Accel Adaptive Deceleration (269):	1.000000
	Device Accel Velocity Scaling (270):	10.000000
	Device Product ID (257):	1008, 41991
	Device Node (258):	&quot;/dev/input/event6&quot;
...
&lt;/pre&gt;&lt;/html&gt;
Change that speed!
&lt;html&gt;&lt;pre&gt;
$ xinput --set-prop 10 &quot;Device Accel Constant Deceleration&quot; 3
...
	Device Accel Profile (267):	0
	Device Accel Constant Deceleration (268):	3.000000
...
&lt;/pre&gt;&lt;/html&gt;
Also, check inputs, stripped down:
&lt;html&gt;&lt;pre&gt;
$ xinput get-feedbacks 10
  2 feedback classes
  KbdFeedbackClass id=0
   ...
  PtrFeedbackClass id=0
	accelNum is 2
	accelDenom is 1
	threshold is 8
$ xinput set-ptr-feedback 10 8 4 1
$ xinput get-feedbacks 10
  2 feedback classes
  KbdFeedbackClass id=0
    ...
  PtrFeedbackClass id=0
	accelNum is 4
	accelDenom is 1
	threshold is 8
&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="xz" creator="rvr" modifier="rvr" created="201502110710" modified="201502110720" changecount="3">
<pre>''xz'' is the most space efficient compression utility used by Linux to compress the Linux kernel. The speed is slow, but compression is high. Compressed files have a .xz extension.
|!Command|!Explanation|
|xz *|Compress all of the files in the current directory and replace each file with one with a .xz extension.|
|xz -dk bar.xz|Decompress bar.xz into  bar and don't remove bar.xz even if decompression is successful.|
|xz -dcf a.txt b.txt.xz &gt; abcd.txt|Decompress a mix of compressed and uncompressed files to standard output, using a single command.|
|xz -d *.xz|Decompress the files compressed using xz|</pre>
</div>
<div title="yum" creator="rvr" modifier="rvr" created="201611292122" modified="201611292122" changecount="2">
<pre>YUM is ''Yellowdog Updater Modified'' - is an open source command-line as well as graphical based package management tool for RPM (~RedHat Package Manager) based Linux systems. It allows users and system administrator to easily install, update, remove or search software packages.
It st
In ''/etc/yum.repos.d/'' we have repo files. These show where resources are and how to get them.
To update these: @@yum update@@</pre>
</div>
<div title="zip" creator="rvr" modifier="rvr" created="201502110715" modified="201612101833" changecount="6">
<pre>Zip is used for windows zipped files.
|!Command|!Description|
|zip backup * |Compresses all files in the current directory and places them in the file backup.zip.|
|zip -r backup.zip ~|Archives your login directory (~) and all files and directories under it in the file backup.zip.|
|unzip backup.zip|Extracts all files in the file backup.zip and places them in the current directory.|
There are many options.
*''-l'' - to only list
*''-d'' - to specify a directory to unzip to
*''-t'' - to do crc check
*''-r'' - to recursively grab files in a directory to zip
&lt;html&gt;&lt;pre&gt;
$ zip allzip.zip *.rb    
  adding: controller.rb (deflated 75%)      
  adding: logparser.rb (deflated 42%)       
  adding: model.rb (deflated 63%)           
  adding: view.rb (deflated 70%)      

$ unzip -l allzip.zip       
Archive:  allzip.zip                          
  Length      Date    Time    Name            
---------  ---------- -----   ----            
     3267  01-31-2015 00:31   controller.rb   
      143  01-31-2015 00:31   logparser.rb    
     1808  01-31-2015 00:31   model.rb        
     3016  01-31-2015 00:31   view.rb         
---------                     -------         
     8234                     4 files               
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="~" creator="Rob" modifier="Rob" created="201511211813" changecount="1">
<pre>The ''~'' or tilde, is used to denote your home directory.
Therefore, ''Users/fred/sites/projects'' is the same as ''~/sites/projects''</pre>
</div>
</div>
<!--POST-STOREAREA-->
<!--POST-BODY-START-->
<!--POST-BODY-END-->
<script id="jsArea" type="text/javascript">
//<![CDATA[
//
// Please note:
//
// * This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments
//   in the project Subversion repository at http://svn.tiddlywiki.org/Trunk/core/
//
// * You should never need to modify this source code directly. TiddlyWiki is carefully designed to allow deep customisation
//   without changing the core code. Please consult the development group at http://groups.google.com/group/TiddlyWikiDev
//

//--
//-- Configuration repository
//--

// Miscellaneous options
var config = {
	numRssItems: 20, // Number of items in the RSS feed
	animDuration: 400, // Duration of UI animations in milliseconds
	cascadeFast: 20, // Speed for cascade animations (higher == slower)
	cascadeSlow: 60, // Speed for EasterEgg cascade animations
	cascadeDepth: 5, // Depth of cascade animation
	locale: "en" // W3C language tag
};

// Hashmap of alternative parsers for the wikifier
config.parsers = {};

// Adaptors
config.adaptors = {};
config.defaultAdaptor = null;

// Backstage tasks
config.tasks = {};

// Annotations
config.annotations = {};

// Custom fields to be automatically added to new tiddlers
config.defaultCustomFields = {};

// Messages
config.messages = {
	messageClose: {},
	dates: {},
	tiddlerPopup: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
	chkRegExpSearch: false,
	chkCaseSensitiveSearch: false,
	chkIncrementalSearch: true,
	chkAnimate: true,
	chkSaveBackups: true,
	chkAutoSave: false,
	chkGenerateAnRssFeed: false,
	chkSaveEmptyTemplate: false,
	chkOpenInNewWindow: true,
	chkToggleLinks: false,
	chkHttpReadOnly: true,
	chkForceMinorUpdate: false,
	chkConfirmDelete: true,
	chkInsertTabs: false,
	chkUsePreForStorage: true, // Whether to use <pre> format for storage
	chkDisplayInstrumentation: false,
	txtBackupFolder: "",
	txtEditorFocus: "text",
	txtMainTab: "tabTimeline",
	txtMoreTab: "moreTabAll",
	txtMaxEditRows: "30",
	txtFileSystemCharSet: "UTF-8",
	txtTheme: ""
	};
config.optionsDesc = {};

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
	1: "ViewTemplate",
	2: "EditTemplate"
};

// More messages (rather a legacy layout that should not really be like this)
config.views = {
	wikified: {
		tag: {}
	},
	editor: {
		tagChooser: {}
	}
};

// Backstage tasks
config.backstageTasks = ["save","sync","importTask","tweak","upgrade","plugins"];

// Extensions
config.extensions = {};

// Macros; each has a 'handler' member that is inserted later
config.macros = {
	today: {},
	version: {},
	search: {sizeTextbox: 15},
	tiddler: {},
	tag: {},
	tags: {},
	tagging: {},
	timeline: {},
	allTags: {},
	list: {
		all: {},
		missing: {},
		orphans: {},
		shadowed: {},
		touched: {},
		filter: {}
	},
	closeAll: {},
	permaview: {},
	saveChanges: {},
	slider: {},
	option: {},
	options: {},
	newTiddler: {},
	newJournal: {},
	tabs: {},
	gradient: {},
	message: {},
	view: {defaultView: "text"},
	edit: {},
	tagChooser: {},
	toolbar: {},
	plugins: {},
	refreshDisplay: {},
	importTiddlers: {},
	upgrade: {
		source: "http://www.tiddlywiki.com/upgrade/",
		backupExtension: "pre.core.upgrade"
	},
	sync: {},
	annotations: {}
};

// Commands supported by the toolbar macro
config.commands = {
	closeTiddler: {},
	closeOthers: {},
	editTiddler: {},
	saveTiddler: {hideReadOnly: true},
	cancelTiddler: {},
	deleteTiddler: {hideReadOnly: true},
	permalink: {},
	references: {type: "popup"},
	jump: {type: "popup"},
	syncing: {type: "popup"},
	fields: {type: "popup"}
};

// Browser detection... In a very few places, there's nothing else for it but to know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
	isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
	isGecko: navigator.product == "Gecko" && config.userAgent.indexOf("WebKit") == -1,
	ieVersion: /MSIE (\d.\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
	isSafari: config.userAgent.indexOf("applewebkit") != -1,
	isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
	firefoxDate: /gecko\/(\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
	isOpera: config.userAgent.indexOf("opera") != -1,
	isLinux: config.userAgent.indexOf("linux") != -1,
	isUnix: config.userAgent.indexOf("x11") != -1,
	isMac: config.userAgent.indexOf("mac") != -1,
	isWindows: config.userAgent.indexOf("win") != -1
};

// Basic regular expressions
config.textPrimitives = {
	upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
	lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
	anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
	anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
};
if(config.browser.isBadSafari) {
	config.textPrimitives = {
		upperLetter: "[A-Z\u00c0-\u00de]",
		lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
		anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
		anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
	};
}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.sectionSeparator = "##";
config.textPrimitives.urlPattern = "(?:file|http|https|mailto|ftp|irc|news|data):[^\\s'\"]+(?:/|\\b)";
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
	config.textPrimitives.lowerLetter + "+" +
	config.textPrimitives.upperLetter +
	config.textPrimitives.anyLetter + "*)|(?:" +
	config.textPrimitives.upperLetter + "{2,}" +
	config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,"mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp("("+ config.textPrimitives.wikiLink + ")|(?:" +
	config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");

config.glyphs = {
	browsers: [
		function() {return config.browser.isIE;},
		function() {return true;}
	],
	currBrowser: null,
	codes: {
		downTriangle: ["\u25BC","\u25BE"],
		downArrow: ["\u2193","\u2193"],
		bentArrowLeft: ["\u2190","\u21A9"],
		bentArrowRight: ["\u2192","\u21AA"]
	}
};

//--
//-- Shadow tiddlers
//--

config.shadowTiddlers = {
	StyleSheet: "",
	MarkupPreHead: "",
	MarkupPostHead: "",
	MarkupPreBody: "",
	MarkupPostBody: "",
	TabTimeline: '<<timeline>>',
	TabAll: '<<list all>>',
	TabTags: '<<allTags excludeLists>>',
	TabMoreMissing: '<<list missing>>',
	TabMoreOrphans: '<<list orphans>>',
	TabMoreShadowed: '<<list shadowed>>',
	AdvancedOptions: '<<options>>',
	PluginManager: '<<plugins>>',
	ToolbarCommands: '|~ViewToolbar|closeTiddler closeOthers +editTiddler > fields syncing permalink references jump|\n|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|',
	WindowTitle: '<<tiddler SiteTitle>> - <<tiddler SiteSubtitle>>'
};

//--
//-- Translateable strings
//--

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options,{
	txtUserName: "YourName"});

merge(config.tasks,{
	save: {text: "save", tooltip: "Save your changes to this TiddlyWiki", action: saveChanges},
	sync: {text: "sync", tooltip: "Synchronise changes with other TiddlyWiki files and servers", content: '<<sync>>'},
	importTask: {text: "import", tooltip: "Import tiddlers and plugins from other TiddlyWiki files and servers", content: '<<importTiddlers>>'},
	tweak: {text: "tweak", tooltip: "Tweak the appearance and behaviour of TiddlyWiki", content: '<<options>>'},
	upgrade: {text: "upgrade", tooltip: "Upgrade TiddlyWiki core code", content: '<<upgrade>>'},
	plugins: {text: "plugins", tooltip: "Manage installed plugins", content: '<<plugins>>'}
});

// Options that can be set in the options panel and/or cookies
merge(config.optionsDesc,{
	txtUserName: "Username for signing your edits",
	chkRegExpSearch: "Enable regular expressions for searches",
	chkCaseSensitiveSearch: "Case-sensitive searching",
	chkIncrementalSearch: "Incremental key-by-key searching",
	chkAnimate: "Enable animations",
	chkSaveBackups: "Keep backup file when saving changes",
	chkAutoSave: "Automatically save changes",
	chkGenerateAnRssFeed: "Generate an RSS feed when saving changes",
	chkSaveEmptyTemplate: "Generate an empty template when saving changes",
	chkOpenInNewWindow: "Open external links in a new window",
	chkToggleLinks: "Clicking on links to open tiddlers causes them to close",
	chkHttpReadOnly: "Hide editing features when viewed over HTTP",
	chkForceMinorUpdate: "Don't update modifier username and date when editing tiddlers",
	chkConfirmDelete: "Require confirmation before deleting tiddlers",
	chkInsertTabs: "Use the tab key to insert tab characters instead of moving between fields",
	txtBackupFolder: "Name of folder to use for backups",
	txtMaxEditRows: "Maximum number of rows in edit boxes",
	txtTheme: "Name of the theme to use",
	txtFileSystemCharSet: "Default character set for saving changes (Firefox/Mozilla only)"});

merge(config.messages,{
	customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
	pluginError: "Error: %0",
	pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
	pluginForced: "Executed because forced via 'systemConfigForce' tag",
	pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
	nothingSelected: "Nothing is selected. You must select one or more items first",
	savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#Download for details",
	subtitleUnknown: "(unknown)",
	undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
	shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
	tiddlerLinkTooltip: "%0 - %1, %2",
	externalLinkTooltip: "External link to %0",
	noTags: "There are no tagged tiddlers",
	notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
	cantSaveError: "It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",
	invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
	backupSaved: "Backup saved",
	backupFailed: "Failed to save backup file",
	rssSaved: "RSS feed saved",
	rssFailed: "Failed to save RSS feed file",
	emptySaved: "Empty template saved",
	emptyFailed: "Failed to save empty template file",
	mainSaved: "Main TiddlyWiki file saved",
	mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
	macroError: "Error in macro <<\%0>>",
	macroErrorDetails: "Error while executing macro <<\%0>>:\n%1",
	missingMacro: "No such macro",
	overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
	unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
	confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
	saveInstructions: "SaveChanges",
	unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
	tiddlerSaveError: "Error when saving tiddler '%0'",
	tiddlerLoadError: "Error when loading tiddler '%0'",
	wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
	invalidFieldName: "Invalid field name %0",
	fieldCannotBeChanged: "Field '%0' cannot be changed",
	loadingMissingTiddler: "Attempting to retrieve the tiddler '%0' from the '%1' server at:\n\n'%2' in the workspace '%3'",
	upgradeDone: "The upgrade to version %0 is now complete\n\nClick 'OK' to reload the newly upgraded TiddlyWiki",
	invalidCookie: "Invalid cookie '%0'"});

merge(config.messages.messageClose,{
	text: "close",
	tooltip: "close this message area"});

config.messages.backstage = {
	open: {text: "backstage", tooltip: "Open the backstage area to perform authoring and editing tasks"},
	close: {text: "close", tooltip: "Close the backstage area"},
	prompt: "backstage: ",
	decal: {
		edit: {text: "edit", tooltip: "Edit the tiddler '%0'"}
	}
};

config.messages.listView = {
	tiddlerTooltip: "Click for the full text of this tiddler",
	previewUnavailable: "(preview not available)"
};

config.messages.dates.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
// suffixes for dates, eg "1st","2nd","3rd"..."30th","31st"
config.messages.dates.daySuffixes = ["st","nd","rd","th","th","th","th","th","th","th",
		"th","th","th","th","th","th","th","th","th","th",
		"st","nd","rd","th","th","th","th","th","th","th",
		"st"];
config.messages.dates.am = "am";
config.messages.dates.pm = "pm";

merge(config.messages.tiddlerPopup,{
	});

merge(config.views.wikified.tag,{
	labelNoTags: "no tags",
	labelTags: "tags: ",
	openTag: "Open tag '%0'",
	tooltip: "Show tiddlers tagged with '%0'",
	openAllText: "Open all",
	openAllTooltip: "Open all of these tiddlers",
	popupNone: "No other tiddlers tagged with '%0'"});

merge(config.views.wikified,{
	defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
	defaultModifier: "(missing)",
	shadowModifier: "(built-in shadow tiddler)",
	dateFormat: "DD MMM YYYY",
	createdPrompt: "created"});

merge(config.views.editor,{
	tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
	defaultText: "Type the text for '%0'"});

merge(config.views.editor.tagChooser,{
	text: "tags",
	tooltip: "Choose existing tags to add to this tiddler",
	popupNone: "There are no tags defined",
	tagTooltip: "Add the tag '%0'"});

merge(config.messages,{
	sizeTemplates:
		[
		{unit: 1024*1024*1024, template: "%0\u00a0GB"},
		{unit: 1024*1024, template: "%0\u00a0MB"},
		{unit: 1024, template: "%0\u00a0KB"},
		{unit: 1, template: "%0\u00a0B"}
		]});

merge(config.macros.search,{
	label: "search",
	prompt: "Search this TiddlyWiki",
	accessKey: "F",
	successMsg: "%0 tiddlers found matching %1",
	failureMsg: "No tiddlers found matching %0"});

merge(config.macros.tagging,{
	label: "tagging: ",
	labelNotTag: "not tagging",
	tooltip: "List of tiddlers tagged with '%0'"});

merge(config.macros.timeline,{
	dateFormat: "DD MMM YYYY"});

merge(config.macros.allTags,{
	tooltip: "Show tiddlers tagged with '%0'",
	noTags: "There are no tagged tiddlers"});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";
config.macros.list.touched.prompt = "Tiddlers that have been modified locally";

merge(config.macros.closeAll,{
	label: "close all",
	prompt: "Close all displayed tiddlers (except any that are being edited)"});

merge(config.macros.permaview,{
	label: "permaview",
	prompt: "Link to an URL that retrieves all the currently displayed tiddlers"});

merge(config.macros.saveChanges,{
	label: "save changes",
	prompt: "Save all tiddlers to create a new TiddlyWiki",
	accessKey: "S"});

merge(config.macros.newTiddler,{
	label: "new tiddler",
	prompt: "Create a new tiddler",
	title: "New Tiddler",
	accessKey: "N"});

merge(config.macros.newJournal,{
	label: "new journal",
	prompt: "Create a new tiddler from the current date and time",
	accessKey: "J"});

merge(config.macros.options,{
	wizardTitle: "Tweak advanced options",
	step1Title: "These options are saved in cookies in your browser",
	step1Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>",
	unknownDescription: "//(unknown)//",
	listViewTemplate: {
		columns: [
			{name: 'Option', field: 'option', title: "Option", type: 'String'},
			{name: 'Description', field: 'description', title: "Description", type: 'WikiText'},
			{name: 'Name', field: 'name', title: "Name", type: 'String'}
			],
		rowClasses: [
			{className: 'lowlight', field: 'lowlight'}
			]}
	});

merge(config.macros.plugins,{
	wizardTitle: "Manage plugins",
	step1Title: "Currently loaded plugins",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	skippedText: "(This plugin has not been executed because it was added since startup)",
	noPluginText: "There are no plugins installed",
	confirmDeleteText: "Are you sure you want to delete these plugins:\n\n%0",
	removeLabel: "remove systemConfig tag",
	removePrompt: "Remove systemConfig tag",
	deleteLabel: "delete",
	deletePrompt: "Delete these tiddlers forever",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Description', field: 'Description', title: "Description", type: 'String'},
			{name: 'Version', field: 'Version', title: "Version", type: 'String'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox'},
			{name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
			],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
			]}
	});

merge(config.macros.toolbar,{
	moreLabel: "more",
	morePrompt: "Show additional commands",
	lessLabel: "less",
	lessPrompt: "Hide additional commands",
	separator: "|"
	});

merge(config.macros.refreshDisplay,{
	label: "refresh",
	prompt: "Redraw the entire TiddlyWiki display"
	});

merge(config.macros.importTiddlers,{
	readOnlyWarning: "You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL",
	wizardTitle: "Import tiddlers from another file or server",
	step1Title: "Step 1: Locate the server or TiddlyWiki file",
	step1Html: "Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>",
	openLabel: "open",
	openPrompt: "Open the connection to this file or server",
	statusOpenHost: "Opening the host",
	statusGetWorkspaceList: "Getting the list of available workspaces",
	step2Title: "Step 2: Choose the workspace",
	step2Html: "Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel this import",
	statusOpenWorkspace: "Opening the workspace",
	statusGetTiddlerList: "Getting the list of available tiddlers",
	errorGettingTiddlerList: "Error getting list of tiddlers, click Cancel to try again",
	step3Title: "Step 3: Choose the tiddlers to import",
	step3Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>",
	importLabel: "import",
	importPrompt: "Import these tiddlers",
	confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
	step4Title: "Step 4: Importing %0 tiddler(s)",
	step4Html: "<input type='hidden' name='markReport'></input>", // DO NOT TRANSLATE
	doneLabel: "done",
	donePrompt: "Close this wizard",
	statusDoingImport: "Importing tiddlers",
	statusDoneImport: "All tiddlers imported",
	systemServerNamePattern: "%2 on %1",
	systemServerNamePatternNoWorkspace: "%1",
	confirmOverwriteSaveTiddler: "The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged",
	serverSaveTemplate: "|''Type:''|%0|\n|''URL:''|%1|\n|''Workspace:''|%2|\n\nThis tiddler was automatically created to record the details of this server",
	serverSaveModifier: "(System)",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Tags', field: 'tags', title: "Tags", type: 'Tags'}
			],
		rowClasses: [
			]}
	});

merge(config.macros.upgrade,{
	wizardTitle: "Upgrade TiddlyWiki core code",
	step1Title: "Update or repair this TiddlyWiki to the latest release",
	step1Html: "You are about to upgrade to the latest release of the TiddlyWiki core code (from <a href='%0' class='externalLink' target='_blank'>%1</a>). Your content will be preserved across the upgrade.<br><br>Note that core upgrades have been known to interfere with older plugins. If you run into problems with the upgraded file, see <a href='http://www.tiddlywiki.org/wiki/CoreUpgrades' class='externalLink' target='_blank'>http://www.tiddlywiki.org/wiki/CoreUpgrades</a>",
	errorCantUpgrade: "Unable to upgrade this TiddlyWiki. You can only perform upgrades on TiddlyWiki files stored locally",
	errorNotSaved: "You must save changes before you can perform an upgrade",
	step2Title: "Confirm the upgrade details",
	step2Html_downgrade: "You are about to downgrade to TiddlyWiki version %0 from %1.<br><br>Downgrading to an earlier version of the core code is not recommended",
	step2Html_restore: "This TiddlyWiki appears to be already using the latest version of the core code (%0).<br><br>You can continue to upgrade anyway to ensure that the core code hasn't been corrupted or damaged",
	step2Html_upgrade: "You are about to upgrade to TiddlyWiki version %0 from %1",
	upgradeLabel: "upgrade",
	upgradePrompt: "Prepare for the upgrade process",
	statusPreparingBackup: "Preparing backup",
	statusSavingBackup: "Saving backup file",
	errorSavingBackup: "There was a problem saving the backup file",
	statusLoadingCore: "Loading core code",
	errorLoadingCore: "Error loading the core code",
	errorCoreFormat: "Error with the new core code",
	statusSavingCore: "Saving the new core code",
	statusReloadingCore: "Reloading the new core code",
	startLabel: "start",
	startPrompt: "Start the upgrade process",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel the upgrade process",
	step3Title: "Upgrade cancelled",
	step3Html: "You have cancelled the upgrade process"
	});

merge(config.macros.sync,{
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Server Type', field: 'serverType', title: "Server type", type: 'String'},
			{name: 'Server Host', field: 'serverHost', title: "Server host", type: 'String'},
			{name: 'Server Workspace', field: 'serverWorkspace', title: "Server workspace", type: 'String'},
			{name: 'Status', field: 'status', title: "Synchronisation status", type: 'String'},
			{name: 'Server URL', field: 'serverUrl', title: "Server URL", text: "View", type: 'Link'}
			],
		rowClasses: [
			],
		buttons: [
			{caption: "Sync these tiddlers", name: 'sync'}
			]},
	wizardTitle: "Synchronize with external servers and files",
	step1Title: "Choose the tiddlers you want to synchronize",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	syncLabel: "sync",
	syncPrompt: "Sync these tiddlers",
	hasChanged: "Changed while unplugged",
	hasNotChanged: "Unchanged while unplugged",
	syncStatusList: {
		none: {text: "...", display:null, className:'notChanged'},
		changedServer: {text: "Changed on server", display:null, className:'changedServer'},
		changedLocally: {text: "Changed while unplugged", display:null, className:'changedLocally'},
		changedBoth: {text: "Changed while unplugged and on server", display:null, className:'changedBoth'},
		notFound: {text: "Not found on server", display:null, className:'notFound'},
		putToServer: {text: "Saved update on server", display:null, className:'putToServer'},
		gotFromServer: {text: "Retrieved update from server", display:null, className:'gotFromServer'}
		}
	});

merge(config.macros.annotations,{
	});

merge(config.commands.closeTiddler,{
	text: "close",
	tooltip: "Close this tiddler"});

merge(config.commands.closeOthers,{
	text: "close others",
	tooltip: "Close all other tiddlers"});

merge(config.commands.editTiddler,{
	text: "edit",
	tooltip: "Edit this tiddler",
	readOnlyText: "view",
	readOnlyTooltip: "View the source of this tiddler"});

merge(config.commands.saveTiddler,{
	text: "done",
	tooltip: "Save changes to this tiddler"});

merge(config.commands.cancelTiddler,{
	text: "cancel",
	tooltip: "Undo changes to this tiddler",
	warning: "Are you sure you want to abandon your changes to '%0'?",
	readOnlyText: "done",
	readOnlyTooltip: "View this tiddler normally"});

merge(config.commands.deleteTiddler,{
	text: "delete",
	tooltip: "Delete this tiddler",
	warning: "Are you sure you want to delete '%0'?"});

merge(config.commands.permalink,{
	text: "permalink",
	tooltip: "Permalink for this tiddler"});

merge(config.commands.references,{
	text: "references",
	tooltip: "Show tiddlers that link to this one",
	popupNone: "No references"});

merge(config.commands.jump,{
	text: "jump",
	tooltip: "Jump to another open tiddler"});

merge(config.commands.syncing,{
	text: "syncing",
	tooltip: "Control synchronisation of this tiddler with a server or external file",
	currentlySyncing: "<div>Currently syncing via <span class='popupHighlight'>'%0'</span> to:</"+"div><div>host: <span class='popupHighlight'>%1</span></"+"div><div>workspace: <span class='popupHighlight'>%2</span></"+"div>", // Note escaping of closing <div> tag
	notCurrentlySyncing: "Not currently syncing",
	captionUnSync: "Stop synchronising this tiddler",
	chooseServer: "Synchronise this tiddler with another server:",
	currServerMarker: "\u25cf ",
	notCurrServerMarker: "  "});

merge(config.commands.fields,{
	text: "fields",
	tooltip: "Show the extended fields of this tiddler",
	emptyText: "There are no extended fields for this tiddler",
	listViewTemplate: {
		columns: [
			{name: 'Field', field: 'field', title: "Field", type: 'String'},
			{name: 'Value', field: 'value', title: "Value", type: 'String'}
			],
		rowClasses: [
			],
		buttons: [
			]}});

merge(config.shadowTiddlers,{
	DefaultTiddlers: "[[GettingStarted]]",
	MainMenu: "[[GettingStarted]]",
	SiteTitle: "My TiddlyWiki",
	SiteSubtitle: "a reusable non-linear personal web notebook",
	SiteUrl: "",
	SideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal "DD MMM YYYY" "journal">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel "options \u00bb" "Change TiddlyWiki advanced options">>',
	SideBarTabs: '<<tabs txtMainTab "Timeline" "Timeline" TabTimeline "All" "All tiddlers" TabAll "Tags" "All tags" TabTags "More" "More lists" TabMore>>',
	TabMore: '<<tabs txtMoreTab "Missing" "Missing tiddlers" TabMoreMissing "Orphans" "Orphaned tiddlers" TabMoreOrphans "Shadowed" "Shadowed tiddlers" TabMoreShadowed>>'
	});

merge(config.annotations,{
	AdvancedOptions: "This shadow tiddler provides access to several advanced options",
	ColorPalette: "These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface",
	DefaultTiddlers: "The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up",
	EditTemplate: "The HTML template in this shadow tiddler determines how tiddlers look while they are being edited",
	GettingStarted: "This shadow tiddler provides basic usage instructions",
	ImportTiddlers: "This shadow tiddler provides access to importing tiddlers",
	MainMenu: "This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen",
	MarkupPreHead: "This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file",
	MarkupPostHead: "This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file",
	MarkupPreBody: "This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file",
	MarkupPostBody: "This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately after the script block",
	OptionsPanel: "This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar",
	PageTemplate: "The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout",
	PluginManager: "This shadow tiddler provides access to the plugin manager",
	SideBarOptions: "This shadow tiddler is used as the contents of the option panel in the right-hand sidebar",
	SideBarTabs: "This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar",
	SiteSubtitle: "This shadow tiddler is used as the second part of the page title",
	SiteTitle: "This shadow tiddler is used as the first part of the page title",
	SiteUrl: "This shadow tiddler should be set to the full target URL for publication",
	StyleSheetColors: "This shadow tiddler contains CSS definitions related to the color of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheet: "This tiddler can contain custom CSS definitions",
	StyleSheetLayout: "This shadow tiddler contains CSS definitions related to the layout of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheetLocale: "This shadow tiddler contains CSS definitions related to the translation locale",
	StyleSheetPrint: "This shadow tiddler contains CSS definitions for printing",
	TabAll: "This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar",
	TabMore: "This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar",
	TabMoreMissing: "This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar",
	TabMoreOrphans: "This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar",
	TabMoreShadowed: "This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar",
	TabTags: "This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar",
	TabTimeline: "This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar",
	ToolbarCommands: "This shadow tiddler determines which commands are shown in tiddler toolbars",
	ViewTemplate: "The HTML template in this shadow tiddler determines how tiddlers look"
	});

//--
//-- Main
//--

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
var anim = typeof Animator == "function" ? new Animator() : null; // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var showBackstage; // Whether to include the backstage area
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()

// Whether to use the JavaSaver applet
var useJavaSaver = (config.browser.isSafari || config.browser.isOpera) && (document.location.toString().substr(0,4) != "http");

// Starting up
function main()
{
	var t10,t9,t8,t7,t6,t5,t4,t3,t2,t1,t0 = new Date();
	startingUp = true;
	var doc = jQuery(document);
	jQuery.noConflict();
	window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};
	params = getParameters();
	if(params)
		params = params.parseParams("open",null,false);
	store = new TiddlyWiki();
	invokeParamifier(params,"oninit");
	story = new Story("tiddlerDisplay","tiddler");
	addEvent(document,"click",Popup.onDocumentClick);
	saveTest();
	loadOptionsCookie();
	for(var s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
	t1 = new Date();
	loadShadowTiddlers();
	doc.trigger("loadShadows");
	t2 = new Date();
	store.loadFromDiv("storeArea","store",true);
	doc.trigger("loadTiddlers");
	t3 = new Date();
	invokeParamifier(params,"onload");
	t4 = new Date();
	readOnly = (window.location.protocol == "file:") ? false : config.options.chkHttpReadOnly;
	var pluginProblem = loadPlugins();
	doc.trigger("loadPlugins");
	t5 = new Date();
	formatter = new Formatter(config.formatters);
	invokeParamifier(params,"onconfig");
	story.switchTheme(config.options.txtTheme);
	showBackstage = showBackstage !== undefined ? showBackstage : !readOnly;
	t6 = new Date();
	for(var m in config.macros) {
		if(config.macros[m].init)
			config.macros[m].init();
	}
	t7 = new Date();
	store.notifyAll();
	t8 = new Date();
	restart();
	refreshDisplay();
	t9 = new Date();
	if(pluginProblem) {
		story.displayTiddler(null,"PluginManager");
		displayMessage(config.messages.customConfigError);
	}
	if(showBackstage)
		backstage.init();
	t10 = new Date();
	if(config.options.chkDisplayInstrumentation) {
		displayMessage("LoadShadows " + (t2-t1) + " ms");
		displayMessage("LoadFromDiv " + (t3-t2) + " ms");
		displayMessage("LoadPlugins " + (t5-t4) + " ms");
		displayMessage("Macro init " + (t7-t6) + " ms");
		displayMessage("Notify " + (t8-t7) + " ms");
		displayMessage("Restart " + (t9-t8) + " ms");
		displayMessage("Total: " + (t10-t0) + " ms");
	}
	startingUp = false;
	doc.trigger("startup");
}

// Called on unload. All functions called conditionally since they themselves may have been unloaded.
function unload()
{
	if(window.checkUnsavedChanges)
		checkUnsavedChanges();
	if(window.scrubNodes)
		scrubNodes(document.body);
}

// Restarting
function restart()
{
	invokeParamifier(params,"onstart");
	if(story.isEmpty()) {
		story.displayDefaultTiddlers();
	}
	window.scrollTo(0,0);
}

function saveTest()
{
	var s = document.getElementById("saveTest");
	if(s.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	s.appendChild(document.createTextNode("savetest"));
}

function loadShadowTiddlers()
{
	var shadows = new TiddlyWiki();
	shadows.loadFromDiv("shadowArea","shadows",true);
	shadows.forEachTiddler(function(title,tiddler){config.shadowTiddlers[title] = tiddler.text;});
	delete shadows;
}

function loadPlugins()
{
	if(safeMode)
		return false;
	var tiddlers = store.getTaggedTiddlers("systemConfig");
	var toLoad = [];
	var nLoaded = 0;
	var map = {};
	var nPlugins = tiddlers.length;
	installedPlugins = [];
	for(var i=0; i<nPlugins; i++) {
		var p = getPluginInfo(tiddlers[i]);
		installedPlugins[i] = p;
		var n = p.Name || p.title;
		if(n)
			map[n] = p;
		n = p.Source;
		if(n)
			map[n] = p;
	}
	var visit = function(p) {
		if(!p || p.done)
			return;
		p.done = 1;
		var reqs = p.Requires;
		if(reqs) {
			reqs = reqs.readBracketedList();
			for(var i=0; i<reqs.length; i++)
				visit(map[reqs[i]]);
		}
		toLoad.push(p);
	};
	for(i=0; i<nPlugins; i++)
		visit(installedPlugins[i]);
	for(i=0; i<toLoad.length; i++) {
		p = toLoad[i];
		pluginInfo = p;
		tiddler = p.tiddler;
		if(isPluginExecutable(p)) {
			if(isPluginEnabled(p)) {
				p.executed = true;
				var startTime = new Date();
				try {
					if(tiddler.text)
						window.eval(tiddler.text);
					nLoaded++;
				} catch(ex) {
					p.log.push(config.messages.pluginError.format([exceptionText(ex)]));
					p.error = true;
					if(!console.tiddlywiki) {
						console.log("error evaluating " + tiddler.title, ex);
					}
				}
				pluginInfo.startupTime = String((new Date()) - startTime) + "ms";
			} else {
				nPlugins--;
			}
		} else {
			p.warning = true;
		}
	}
	return nLoaded != nPlugins;
}

function getPluginInfo(tiddler)
{
	var p = store.getTiddlerSlices(tiddler.title,["Name","Description","Version","Requires","CoreVersion","Date","Source","Author","License","Browsers"]);
	p.tiddler = tiddler;
	p.title = tiddler.title;
	p.log = [];
	return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigForce")) {
		plugin.log.push(config.messages.pluginForced);
		return true;
	}
	if(plugin["CoreVersion"]) {
		var coreVersion = plugin["CoreVersion"].split(".");
		var w = parseInt(coreVersion[0],10) - version.major;
		if(w == 0 && coreVersion[1])
			w = parseInt(coreVersion[1],10) - version.minor;
		if(w == 0 && coreVersion[2])
			w = parseInt(coreVersion[2],10) - version.revision;
		if(w > 0) {
			plugin.log.push(config.messages.pluginVersionError);
			return false;
		}
	}
	return true;
}

function isPluginEnabled(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigDisable")) {
		plugin.log.push(config.messages.pluginDisabled);
		return false;
	}
	return true;
}

function invokeMacro(place,macro,params,wikifier,tiddler)
{
	try {
		var m = config.macros[macro];
		if(m && m.handler) {
			var tiddlerElem = story.findContainingTiddler(place);
			window.tiddler = tiddlerElem ? store.getTiddler(tiddlerElem.getAttribute("tiddler")) : null;
			window.place = place;
			m.handler(place,macro,m.noPreParse?null:params.readMacroParams(),wikifier,params,tiddler);
		} else {
			createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
		}
	} catch(ex) {
		createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
	}
}

//--
//-- Paramifiers
//--

function getParameters()
{
	var p = null;
	if(window.location.hash) {
		p = decodeURIComponent(window.location.hash.substr(1));
		if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < "20051111")
			p = convertUTF8ToUnicode(p);
	}
	return p;
}

function invokeParamifier(params,handler)
{
	if(!params || params.length == undefined || params.length <= 1)
		return;
	for(var i=1; i<params.length; i++) {
		var p = config.paramifiers[params[i].name];
		if(p && p[handler] instanceof Function)
			p[handler](params[i].value);
		else {
			var h = config.optionHandlers[params[i].name.substr(0,3)];
			if(h && h.set instanceof Function)
				h.set(params[i].name,params[i].value);
		}
	}
}

config.paramifiers = {};

config.paramifiers.start = {
	oninit: function(v) {
		safeMode = v.toLowerCase() == "safe";
	}
};

config.paramifiers.open = {
	onstart: function(v) {
		if(!readOnly || store.tiddlerExists(v) || store.isShadowTiddler(v))
			story.displayTiddler("bottom",v,null,false,null);
	}
};

config.paramifiers.story = {
	onstart: function(v) {
		var list = store.getTiddlerText(v,"").parseParams("open",null,false);
		invokeParamifier(list,"onstart");
	}
};

config.paramifiers.search = {
	onstart: function(v) {
		story.search(v,false,false);
	}
};

config.paramifiers.searchRegExp = {
	onstart: function(v) {
		story.prototype.search(v,false,true);
	}
};

config.paramifiers.tag = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers("[tag["+v+"]]"),null,false,null);
	}
};

config.paramifiers.newTiddler = {
	onstart: function(v) {
		if(!readOnly) {
			story.displayTiddler(null,v,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(v,"text");
		}
	}
};

config.paramifiers.newJournal = {
	onstart: function(v) {
		if(!readOnly) {
			var now = new Date();
			var title = now.formatString(v.trim());
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(title,"text");
		}
	}
};

config.paramifiers.readOnly = {
	onconfig: function(v) {
		var p = v.toLowerCase();
		readOnly = p == "yes" ? true : (p == "no" ? false : readOnly);
	}
};

config.paramifiers.theme = {
	onconfig: function(v) {
		story.switchTheme(v);
	}
};

config.paramifiers.upgrade = {
	onstart: function(v) {
		upgradeFrom(v);
	}
};

config.paramifiers.recent= {
	onstart: function(v) {
		var titles=[];
		var tiddlers=store.getTiddlers("modified","excludeLists").reverse();
		for(var i=0; i<v && i<tiddlers.length; i++)
			titles.push(tiddlers[i].title);
		story.displayTiddlers(null,titles);
	}
};

config.paramifiers.filter = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers(v),null,false);
	}
};

//--
//-- Formatter helpers
//--

function Formatter(formatters)
{
	this.formatters = [];
	var pattern = [];
	for(var n=0; n<formatters.length; n++) {
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
	}
	this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

	createElementAndWikify: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
	},

	inlineCssHelper: function(w)
	{
		var styles = [];
		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var s,v;
			if(lookaheadMatch[1]) {
				s = lookaheadMatch[1].unDash();
				v = lookaheadMatch[2];
			} else {
				s = lookaheadMatch[3].unDash();
				v = lookaheadMatch[4];
			}
			if(s=="bgcolor")
				s = "backgroundColor";
			styles.push({style: s, value: v});
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		}
		return styles;
	},

	applyCssHelper: function(e,styles)
	{
		for(var t=0; t< styles.length; t++) {
			try {
				e.style[styles[t].style] = styles[t].value;
			} catch (ex) {
			}
		}
	},

	enclosedTextHelper: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var text = lookaheadMatch[1];
			if(config.browser.isIE)
				text = text.replace(/\n/g,"\r");
			createTiddlyElement(w.output,this.element,null,null,text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	},

	isExternalLink: function(link)
	{
		if(store.tiddlerExists(link) || store.isShadowTiddler(link)) {
			return false;
		}
		var urlRegExp = new RegExp(config.textPrimitives.urlPattern,"mg");
		if(urlRegExp.exec(link)) {
			return true;
		}
		if(link.indexOf(".")!=-1 || link.indexOf("\\")!=-1 || link.indexOf("/")!=-1 || link.indexOf("#")!=-1) {
			return true;
		}
		return false;
	}

};

//--
//-- Standard formatters
//--

config.formatters = [
{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
	rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
	cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
	cellTermRegExp: /((?:\x20*)\|)/mg,
	rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},
	handler: function(w)
	{
		var table = createTiddlyElement(w.output,"table",null,"twtable");
		var prevColumns = [];
		var currRowType = null;
		var rowContainer;
		var rowCount = 0;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var nextRowType = lookaheadMatch[2];
			if(nextRowType == "k") {
				table.className = lookaheadMatch[1];
				w.nextMatch += lookaheadMatch[0].length+1;
			} else {
				if(nextRowType != currRowType) {
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
					currRowType = nextRowType;
				}
				if(currRowType == "c") {
					// Caption
					w.nextMatch++;
					if(rowContainer != table.firstChild)
						table.insertBefore(rowContainer,table.firstChild);
					rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
					w.subWikifyTerm(rowContainer,this.rowTermRegExp);
				} else {
					var theRow = createTiddlyElement(rowContainer,"tr",null,(rowCount&1)?"oddRow":"evenRow");
					theRow.onmouseover = function() {addClass(this,"hoverRow");};
					theRow.onmouseout = function() {removeClass(this,"hoverRow");};
					this.rowHandler(w,theRow,prevColumns);
					rowCount++;
				}
			}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	},
	rowHandler: function(w,e,prevColumns)
	{
		var col = 0;
		var colSpanCount = 1;
		var prevCell = null;
		this.cellRegExp.lastIndex = w.nextMatch;
		var cellMatch = this.cellRegExp.exec(w.source);
		while(cellMatch && cellMatch.index == w.nextMatch) {
			if(cellMatch[1] == "~") {
				// Rowspan
				var last = prevColumns[col];
				if(last) {
					last.rowSpanCount++;
					last.element.setAttribute("rowspan",last.rowSpanCount);
					last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
					last.element.valign = "center";
					if(colSpanCount > 1) {
						last.element.setAttribute("colspan",colSpanCount);
						last.element.setAttribute("colSpan",colSpanCount); // Needed for IE
						colSpanCount = 1;
					}
				}
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[1] == ">") {
				// Colspan
				colSpanCount++;
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[2]) {
				// End of row
				if(prevCell && colSpanCount > 1) {
					prevCell.setAttribute("colspan",colSpanCount);
					prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
				}
				w.nextMatch = this.cellRegExp.lastIndex;
				break;
			} else {
				// Cell
				w.nextMatch++;
				var styles = config.formatterHelpers.inlineCssHelper(w);
				var spaceLeft = false;
				var chr = w.source.substr(w.nextMatch,1);
				while(chr == " ") {
					spaceLeft = true;
					w.nextMatch++;
					chr = w.source.substr(w.nextMatch,1);
				}
				var cell;
				if(chr == "!") {
					cell = createTiddlyElement(e,"th");
					w.nextMatch++;
				} else {
					cell = createTiddlyElement(e,"td");
				}
				prevCell = cell;
				prevColumns[col] = {rowSpanCount:1,element:cell};
				if(colSpanCount > 1) {
					cell.setAttribute("colspan",colSpanCount);
					cell.setAttribute("colSpan",colSpanCount); // Needed for IE
					colSpanCount = 1;
				}
				config.formatterHelpers.applyCssHelper(cell,styles);
				w.subWikifyTerm(cell,this.cellTermRegExp);
				if(w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
					cell.align = spaceLeft ? "center" : "left";
				else if(spaceLeft)
					cell.align = "right";
				w.nextMatch--;
			}
			col++;
			this.cellRegExp.lastIndex = w.nextMatch;
			cellMatch = this.cellRegExp.exec(w.source);
		}
	}
},

{
	name: "heading",
	match: "^!{1,6}",
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
	}
},

{
	name: "list",
	match: "^(?:[\\*#;:]+)",
	lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0, currType = null;
		var listLevel, listType, itemType, baseType;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			if(lookaheadMatch[1]) {
				listType = "ul";
				itemType = "li";
			} else if(lookaheadMatch[2]) {
				listType = "ol";
				itemType = "li";
			} else if(lookaheadMatch[3]) {
				listType = "dl";
				itemType = "dt";
			} else if(lookaheadMatch[4]) {
				listType = "dl";
				itemType = "dd";
			}
			if(!baseType)
				baseType = listType;
			listLevel = lookaheadMatch[0].length;
			w.nextMatch += lookaheadMatch[0].length;
			var t;
			if(listLevel > currLevel) {
				for(t=currLevel; t<listLevel; t++) {
					var target = (currLevel == 0) ? stack[stack.length-1] : stack[stack.length-1].lastChild;
					stack.push(createTiddlyElement(target,listType));
				}
			} else if(listType!=baseType && listLevel==1) {
				w.nextMatch -= lookaheadMatch[0].length;
				return;
			} else if(listLevel < currLevel) {
				for(t=currLevel; t>listLevel; t--)
					stack.pop();
			} else if(listLevel == currLevel && listType != currType) {
				stack.pop();
				stack.push(createTiddlyElement(stack[stack.length-1].lastChild,listType));
			}
			currLevel = listLevel;
			currType = listType;
			var e = createTiddlyElement(stack[stack.length-1],itemType);
			w.subWikifyTerm(e,this.termRegExp);
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	termRegExp: /(^<<<(\n|$))/mg,
	element: "blockquote",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "quoteByLine",
	match: "^>+",
	lookaheadRegExp: /^>+/mg,
	termRegExp: /(\n)/mg,
	element: "blockquote",
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var t;
		do {
			if(newLevel > currLevel) {
				for(t=currLevel; t<newLevel; t++)
					stack.push(createTiddlyElement(stack[stack.length-1],this.element));
			} else if(newLevel < currLevel) {
				for(t=currLevel; t>newLevel; t--)
					stack.pop();
			}
			currLevel = newLevel;
			w.subWikifyTerm(stack[stack.length-1],this.termRegExp);
			createTiddlyElement(stack[stack.length-1],"br");
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched) {
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
			}
		} while(matched);
	}
},

{
	name: "rule",
	match: "^----+$\\n?|<hr ?/?>\\n?",
	handler: function(w)
	{
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "monospacedByLine",
	match: "^(?:/\\*\\{\\{\\{\\*/|\\{\\{\\{|//\\{\\{\\{|<!--\\{\\{\\{-->)\\n",
	element: "pre",
	handler: function(w)
	{
		switch(w.matchText) {
		case "/*{{{*/\n": // CSS
			this.lookaheadRegExp = /\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\*\}\}\}\*\/$\n?)/mg;
			break;
		case "{{{\n": // monospaced block
			this.lookaheadRegExp = /^\{\{\{\n((?:^[^\n]*\n)+?)(^\f*\}\}\}$\n?)/mg;
			break;
		case "//{{{\n": // plugin
			this.lookaheadRegExp = /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\/\}\}\}$\n?)/mg;
			break;
		case "<!--{{{-->\n": //template
			this.lookaheadRegExp = /<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^\f*<!--\}\}\}-->$\n?)/mg;
			break;
		default:
			break;
		}
		config.formatterHelpers.enclosedTextHelper.call(this,w);
	}
},

{
	name: "wikifyComment",
	match: "^(?:/\\*\\*\\*|<!---)\\n",
	handler: function(w)
	{
		var termRegExp = (w.matchText == "/***\n") ? (/(^\*\*\*\/\n)/mg) : (/(^--->\n)/mg);
		w.subWikifyTerm(w.output,termRegExp);
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
		}
	}
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e;
			var text = lookaheadMatch[1];
			if(lookaheadMatch[3]) {
				// Pretty bracketted link
				var link = lookaheadMatch[3];
				e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link)) ?
						createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
			} else {
				// Simple bracketted link
				e = createTiddlyLink(w.output,text,false,null,w.isStatic,w.tiddler);
			}
			createTiddlyText(e,text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "wikiLink",
	match: config.textPrimitives.unWikiLink+"?"+config.textPrimitives.wikiLink,
	handler: function(w)
	{
		if(w.matchText.substr(0,1) == config.textPrimitives.unWikiLink) {
			w.outputText(w.output,w.matchStart+1,w.nextMatch);
			return;
		}
		if(w.matchStart > 0) {
			var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,"mg");
			preRegExp.lastIndex = w.matchStart-1;
			var preMatch = preRegExp.exec(w.source);
			if(preMatch.index == w.matchStart-1) {
				w.outputText(w.output,w.matchStart,w.nextMatch);
				return;
			}
		}
		if(w.autoLinkWikiWords || store.isShadowTiddler(w.matchText)) {
			var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic,w.tiddler);
			w.outputText(link,w.matchStart,w.nextMatch);
		} else {
			w.outputText(w.output,w.matchStart,w.nextMatch);
		}
	}
},

{
	name: "urlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w)
	{
		w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[[<>]?[Ii][Mm][Gg]\\[",
	lookaheadRegExp: /\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e = w.output;
			if(lookaheadMatch[5]) {
				var link = lookaheadMatch[5];
				e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
				addClass(e,"imageLink");
			}
			var img = createTiddlyElement(e,"img");
			if(lookaheadMatch[1])
				img.align = "left";
			else if(lookaheadMatch[2])
				img.align = "right";
			if(lookaheadMatch[3]) {
				img.title = lookaheadMatch[3];
				img.setAttribute("alt",lookaheadMatch[3]);
			}
			img.src = lookaheadMatch[4];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "commentByBlock",
	match: "/%",
	lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
},

{
	name: "characterFormat",
	match: "''|//|__|\\^\\^|~~|--(?!\\s|$)|\\{\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "''":
			w.subWikifyTerm(w.output.appendChild(document.createElement("strong")),/('')/mg);
			break;
		case "//":
			w.subWikifyTerm(createTiddlyElement(w.output,"em"),/(\/\/)/mg);
			break;
		case "__":
			w.subWikifyTerm(createTiddlyElement(w.output,"u"),/(__)/mg);
			break;
		case "^^":
			w.subWikifyTerm(createTiddlyElement(w.output,"sup"),/(\^\^)/mg);
			break;
		case "~~":
			w.subWikifyTerm(createTiddlyElement(w.output,"sub"),/(~~)/mg);
			break;
		case "--":
			w.subWikifyTerm(createTiddlyElement(w.output,"strike"),/(--)/mg);
			break;
		case "{{{":
			var lookaheadRegExp = /\{\{\{((?:.|\n)*?)\}\}\}/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
				createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
				w.nextMatch = lookaheadRegExp.lastIndex;
			}
			break;
		}
	}
},

{
	name: "customFormat",
	match: "@@|\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "@@":
			var e = createTiddlyElement(w.output,"span");
			var styles = config.formatterHelpers.inlineCssHelper(w);
			if(styles.length == 0)
				e.className = "marked";
			else
				config.formatterHelpers.applyCssHelper(e,styles);
			w.subWikifyTerm(e,/(@@)/mg);
			break;
		case "{{":
			var lookaheadRegExp = /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch) {
				w.nextMatch = lookaheadRegExp.lastIndex;
				e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
				w.subWikifyTerm(e,/(\}\}\})/mg);
			}
			break;
		}
	}
},

{
	name: "mdash",
	match: "--",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
	}
},

{
	name: "lineBreak",
	match: "\\n|<br ?/?>",
	handler: function(w)
	{
		createTiddlyElement(w.output,"br");
	}
},

{
	name: "rawText",
	match: "\"{3}|<nowiki>",
	lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "htmlEntitiesEncoding",
	match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = w.matchText;
	}
}

];

//--
//-- Wikifier
//--

function getParser(tiddler,format)
{
	if(tiddler) {
		if(!format)
			format = tiddler.fields["wikiformat"];
		var i;
		if(format) {
			for(i in config.parsers) {
				if(format == config.parsers[i].format)
					return config.parsers[i];
			}
		} else {
			for(i in config.parsers) {
				if(tiddler.isTagged(config.parsers[i].formatTag))
					return config.parsers[i];
			}
		}
	}
	return formatter;
}

function wikify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		var t0 = new Date();
		wikifier.subWikify(output);
		if(tiddler && config.options.chkDisplayInstrumentation)
			displayMessage("wikify:" +tiddler.title+ " in " + (new Date()-t0) + " ms");
	}
}

function wikifyStatic(source,highlightRegExp,tiddler,format)
{
	var e = createTiddlyElement(document.body,"pre");
	e.style.display = "none";
	var html = "";
	if(source && source != "") {
		if(!tiddler)
			tiddler = new Tiddler("temp");
		var wikifier = new Wikifier(source,getParser(tiddler,format),highlightRegExp,tiddler);
		wikifier.isStatic = true;
		wikifier.subWikify(e);
		html = e.innerHTML;
		removeNode(e);
	}
	return html;
}

function wikifyPlain(title,theStore,limit)
{
	if(!theStore)
		theStore = store;
	if(theStore.tiddlerExists(title) || theStore.isShadowTiddler(title)) {
		return wikifyPlainText(theStore.getTiddlerText(title),limit,tiddler);
	} else {
		return "";
	}
}

function wikifyPlainText(text,limit,tiddler)
{
	if(limit > 0)
		text = text.substr(0,limit);
	var wikifier = new Wikifier(text,formatter,null,tiddler);
	return wikifier.wikifyPlain();
}

function highlightify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);
		wikifier.outputText(output,0,source.length);
	}
}

function Wikifier(source,formatter,highlightRegExp,tiddler)
{
	this.source = source;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;
	this.isStatic = false;
	if(highlightRegExp) {
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(source);
	}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	this.subWikify(e);
	var text = getPlainText(e);
	removeNode(e);
	return text;
};

Wikifier.prototype.subWikify = function(output,terminator)
{
	try {
		if(terminator)
			this.subWikifyTerm(output,new RegExp("(" + terminator + ")","mg"));
		else
			this.subWikifyUnterm(output);
	} catch(ex) {
		showException(ex);
	}
};

Wikifier.prototype.subWikifyUnterm = function(output)
{
	var oldOutput = this.output;
	this.output = output;
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	while(formatterMatch) {
		// Output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters for the handler
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)
{
	var oldOutput = this.output;
	this.output = output;
	terminatorRegExp.lastIndex = this.nextMatch;
	var terminatorMatch = terminatorRegExp.exec(this.source);
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	while(terminatorMatch || formatterMatch) {
		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {
			if(terminatorMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,terminatorMatch.index);
			this.matchText = terminatorMatch[1];
			this.matchLength = terminatorMatch[1].length;
			this.matchStart = terminatorMatch.index;
			this.nextMatch = this.matchStart + this.matchLength;
			this.output = oldOutput;
			return;
		}
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		terminatorRegExp.lastIndex = this.nextMatch;
		terminatorMatch = terminatorRegExp.exec(this.source);
		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos)) {
		if(this.highlightMatch.index > startPos) {
			createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
			startPos = this.highlightMatch.index;
		}
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
		var theHighlight = createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		if(startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
	}
	if(startPos < endPos) {
		createTiddlyText(place,this.source.substring(startPos,endPos));
	}
};

//--
//-- Macro definitions
//--

config.macros.today.handler = function(place,macroName,params)
{
	var now = new Date();
	var text = params[0] ? now.formatString(params[0].trim()) : now.toLocaleString();
	jQuery("<span/>").text(text).appendTo(place);
};

config.macros.version.handler = function(place)
{
	jQuery("<span/>").text(formatVersion()).appendTo(place);
};

config.macros.list.handler = function(place,macroName,params)
{
	var type = params[0] || "all";
	var list = document.createElement("ul");
	place.appendChild(list);
	if(this[type].prompt)
		createTiddlyElement(list,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	for(var t = 0; t < results.length; t++) {
		var li = document.createElement("li");
		list.appendChild(li);
		createTiddlyLink(li,typeof results[t] == "string" ? results[t] : results[t].title,true);
	}
};

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
};

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
};

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
};

config.macros.list.shadowed.handler = function(params)
{
	return store.getShadowed();
};

config.macros.list.touched.handler = function(params)
{
	return store.getTouched();
};

config.macros.list.filter.handler = function(params)
{
	var filter = params[1];
	var results = [];
	if(filter) {
		var tiddlers = store.filterTiddlers(filter);
		for(var t=0; t<tiddlers.length; t++)
			results.push(tiddlers[t].title);
	}
	return results;
};

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags(params[0]);
	var ul = createTiddlyElement(place,"ul");
	if(tags.length == 0)
		createTiddlyElement(ul,"li",null,"listTitle",this.noTags);
	for(var t=0; t<tags.length; t++) {
		var title = tags[t][0];
		var info = getTiddlyLinkInfo(title);
		var li = createTiddlyElement(ul,"li");
		var btn = createTiddlyButton(li,title + " (" + tags[t][1] + ")",this.tooltip.format([title]),onClickTag,info.classes);
		btn.setAttribute("tag",title);
		btn.setAttribute("refresh","link");
		btn.setAttribute("tiddlyLink",title);
		if(params[1]) {
			btn.setAttribute("sortby",params[1]);
		}
	}
};

config.macros.timeline.handler = function(place,macroName,params)
{
	var field = params[0] || "modified";
	var tiddlers = store.reverseLookup("tags","excludeLists",false,field);
	var lastDay = "";
	var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1])) : 0;
	var dateFormat = params[2] || this.dateFormat;
	for(var t=tiddlers.length-1; t>=last; t--) {
		var tiddler = tiddlers[t];
		var theDay = tiddler[field].convertToLocalYYYYMMDDHHMM().substr(0,8);
		if(theDay != lastDay) {
			var ul = document.createElement("ul");
			addClass(ul,"timeline");
			place.appendChild(ul);
			createTiddlyElement(ul,"li",null,"listTitle",tiddler[field].formatString(dateFormat));
			lastDay = theDay;
		}
		createTiddlyElement(ul,"li",null,"listLink").appendChild(createTiddlyLink(place,tiddler.title,true));
	}
};

config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("name",null,true,false,true);
	var names = params[0]["name"];
	var tiddlerName = names[0];
	var className = names[1] || null;
	var args = params[0]["with"];
	var wrapper = createTiddlyElement(place,"span",null,className,null,{
		refresh: "content", tiddler: tiddlerName
	});
	if(args!==undefined)
		wrapper.setAttribute("args","[["+args.join("]] [[")+"]]");
	this.transclude(wrapper,tiddlerName,args);
};

config.macros.tiddler.transclude = function(wrapper,tiddlerName,args)
{
	var text = store.getTiddlerText(tiddlerName);
	if(!text)
		return;
	var stack = config.macros.tiddler.tiddlerStack;
	if(stack.indexOf(tiddlerName) !== -1)
		return;
	stack.push(tiddlerName);
	try {
		if(typeof args == "string")
			args = args.readBracketedList();
		var n = args ? Math.min(args.length,9) : 0;
		for(var i=0; i<n; i++) {
			var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
			text = text.replace(placeholderRE,args[i]);
		}
		config.macros.tiddler.renderText(wrapper,text,tiddlerName,params);
	} finally {
		stack.pop();
	}
};

config.macros.tiddler.renderText = function(place,text,tiddlerName,params)
{
	wikify(text,place,null,store.getTiddler(tiddlerName));
};

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
	createTagButton(place,params[0],null,params[1],params[2]);
	if(params[3]) {
		btn.setAttribute('sortby',params[3]);
	}
};

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title && store.tiddlerExists(title))
		tiddler = store.getTiddler(title);
	var sep = getParam(params,"sep"," ");
	var lingo = config.views.wikified.tag;
	var label = null;
	for(var t=0; t<tiddler.tags.length; t++) {
		var tag = store.getTiddler(tiddler.tags[t]);
		if(!tag || !tag.tags.contains("excludeLists")) {
			if(!label)
				label = createTiddlyElement(ul,"li",null,"listTitle",lingo.labelTags.format([tiddler.title]));
			createTagButton(createTiddlyElement(ul,"li"),tiddler.tags[t],tiddler.title);
			if(t<tiddler.tags.length-1)
				createTiddlyText(ul,sep);
		}
	}
	if(!label)
		createTiddlyElement(ul,"li",null,"listTitle",lingo.labelNoTags.format([tiddler.title]));
};

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title == "" && tiddler instanceof Tiddler)
		title = tiddler.title;
	var sep = getParam(params,"sep"," ");
	ul.setAttribute("title",this.tooltip.format([title]));
	var tagged = store.getTaggedTiddlers(title);
	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
	createTiddlyElement(ul,"li",null,"listTitle",prompt.format([title,tagged.length]));
	for(var t=0; t<tagged.length; t++) {
		createTiddlyLink(createTiddlyElement(ul,"li"),tagged[t].title,true);
		if(t<tagged.length-1)
			createTiddlyText(ul,sep);
	}
};

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.closeAll.onClick = function(e)
{
	story.closeAllTiddlers();
	return false;
};

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.permaview.onClick = function(e)
{
	story.permaView();
	return false;
};

config.macros.saveChanges.handler = function(place,macroName,params)
{
	if(!readOnly)
		createTiddlyButton(place,params[0] || this.label,params[1] || this.prompt,this.onClick,null,null,this.accessKey);
};

config.macros.saveChanges.onClick = function(e)
{
	saveChanges();
	return false;
};

config.macros.slider.onClickSlider = function(ev)
{
	var e = ev || window.event;
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(config.options.chkAnimate && anim && typeof Slider == "function")
		anim.startAnimating(new Slider(n,!isOpen,null,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOptionCookie(cookie);
	return false;
};

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
	var c = cookie || "";
	var btn = createTiddlyButton(place,title,tooltip,this.onClickSlider);
	var panel = createTiddlyElement(null,"div",null,"sliderPanel");
	panel.setAttribute("cookie",c);
	panel.style.display = config.options[c] ? "block" : "none";
	place.appendChild(panel);
	return panel;
};

config.macros.slider.handler = function(place,macroName,params)
{
	var panel = this.createSlider(place,params[0],params[2],params[3]);
	var text = store.getTiddlerText(params[1]);
	panel.setAttribute("refresh","content");
	panel.setAttribute("tiddler",params[1]);
	if(text)
		wikify(text,panel,null,store.getTiddler(params[1]));
};

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var panel = wikifier ? createTiddlyElement(place,"div",null,"gradient") : place;
	panel.style.position = "relative";
	panel.style.overflow = "hidden";
	panel.style.zIndex = "0";
	if(wikifier) {
		var styles = config.formatterHelpers.inlineCssHelper(wikifier);
		config.formatterHelpers.applyCssHelper(panel,styles);
	}
	params = paramString.parseParams("color");
	var locolors = [], hicolors = [];
	for(var t=2; t<params.length; t++) {
		var c = params[t].value;
		if(params[t].name == "snap") {
			hicolors[hicolors.length-1] = c;
		} else {
			locolors.push(c);
			hicolors.push(c);
		}
	}
	drawGradient(panel,params[1].value != "vert",locolors,hicolors);
	if(wikifier)
		wikifier.subWikify(panel,">>");
	if(document.all) {
		panel.style.height = "100%";
		panel.style.width = "100%";
	}
};

config.macros.message.handler = function(place,macroName,params)
{
	if(params[0]) {
		var names = params[0].split(".");
		var lookupMessage = function(root,nameIndex) {
				if(names[nameIndex] in root) {
					if(nameIndex < names.length-1)
						return (lookupMessage(root[names[nameIndex]],nameIndex+1));
					else
						return root[names[nameIndex]];
				} else
					return null;
			};
		var m = lookupMessage(config,0);
		if(m == null)
			m = lookupMessage(window,0);
		createTiddlyText(place,m.toString().format(params.splice(1)));
	}
};


config.macros.view.views = {
	text: function(value,place,params,wikifier,paramString,tiddler) {
		highlightify(value,place,highlightHack,tiddler);
	},
	link: function(value,place,params,wikifier,paramString,tiddler) {
		createTiddlyLink(place,value,true);
	},
	wikified: function(value,place,params,wikifier,paramString,tiddler) {
		if(params[2])
			value=params[2].unescapeLineBreaks().format([value]);
		wikify(value,place,highlightHack,tiddler);
	},
	date: function(value,place,params,wikifier,paramString,tiddler) {
		value = Date.convertFromYYYYMMDDHHMM(value);
		createTiddlyText(place,value.formatString(params[2] ? params[2] : config.views.wikified.dateFormat));
	}
};

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if((tiddler instanceof Tiddler) && params[0]) {
		var value = store.getValue(tiddler,params[0]);
		if(value) {
			var type = params[1] || config.macros.view.defaultView;
			var handler = config.macros.view.views[type];
			if(handler)
				handler(value,place,params,wikifier,paramString,tiddler);
		}
	}
};

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var field = params[0];
	var rows = params[1] || 0;
	var defVal = params[2] || '';
	if((tiddler instanceof Tiddler) && field) {
		story.setDirty(tiddler.title,true);
		var e,v;
		if(field != "text" && !rows) {
			e = createTiddlyElement(null,"input",null,null,null,{
				type: "text", edit: field, size: "40", autocomplete: "off"
			});
			e.value = store.getValue(tiddler,field) || defVal;
			place.appendChild(e);
		} else {
			var wrapper1 = createTiddlyElement(null,"fieldset",null,"fieldsetFix");
			var wrapper2 = createTiddlyElement(wrapper1,"div");
			e = createTiddlyElement(wrapper2,"textarea");
			e.value = v = store.getValue(tiddler,field) || defVal;
			rows = rows || 10;
			var lines = v.match(/\n/mg);
			var maxLines = Math.max(parseInt(config.options.txtMaxEditRows),5);
			if(lines != null && lines.length > rows)
				rows = lines.length + 5;
			rows = Math.min(rows,maxLines);
			e.setAttribute("rows",rows);
			e.setAttribute("edit",field);
			place.appendChild(wrapper1);
		}
		if(tiddler.isReadOnly()) {
			e.setAttribute("readOnly","readOnly");
			addClass(e,"readOnly");
		}
		return e;
	}
};

config.macros.tagChooser.onClick = function(ev)
{
	var e = ev || window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags(this.getAttribute("tags"));
	if(tags.length == 0)
		jQuery("<li/>").text(lingo.popupNone).appendTo(popup);
	for(var t=0; t<tags.length; t++) {
		var tag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
		tag.setAttribute("tag",tags[t][0]);
		tag.setAttribute("tiddler",this.getAttribute("tiddler"));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
};

config.macros.tagChooser.onTagClick = function(ev)
{
	var e = ev || window.event;
	if(e.metaKey || e.ctrlKey) stopEvent(e); //# keep popup open on CTRL-click
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(!readOnly)
		story.setTiddlerTag(title,tag,0);
	return false;
};

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(tiddler instanceof Tiddler) {
		var lingo = config.views.editor.tagChooser;
		var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
		btn.setAttribute("tiddler",tiddler.title);
		btn.setAttribute("tags",params[0]);
	}
};

config.macros.refreshDisplay.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.refreshDisplay.onClick = function(e)
{
	refreshAll();
	return false;
};

config.macros.annotations.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var title = tiddler ? tiddler.title : null;
	var a = title ? config.annotations[title] : null;
	if(!tiddler || !title || !a)
		return;
	var text = a.format([title]);
	wikify(text,createTiddlyElement(place,"div",null,"annotation"),null,tiddler);
};

//--
//-- NewTiddler and NewJournal macros
//--

config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)
{
	var tags = [];
	for(var t=1; t<params.length; t++) {
		if((params[t].name == "anon" && t != 1) || (params[t].name == "tag"))
			tags.push(params[t].value);
	}
	label = getParam(params,"label",label);
	prompt = getParam(params,"prompt",prompt);
	accessKey = getParam(params,"accessKey",accessKey);
	newFocus = getParam(params,"focus",newFocus);
	var customFields = getParam(params,"fields","");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);
	btn.setAttribute("newTitle",title);
	btn.setAttribute("isJournal",isJournal ? "true" : "false");
	if(tags.length > 0)
		btn.setAttribute("params",tags.join("|"));
	btn.setAttribute("newFocus",newFocus);
	btn.setAttribute("newTemplate",getParam(params,"template",DEFAULT_EDIT_TEMPLATE));
	if(customFields !== "")
		btn.setAttribute("customFields",customFields);
	var text = getParam(params,"text");
	if(text !== undefined)
		btn.setAttribute("newText",text);
	return btn;
};

config.macros.newTiddler.onClickNewTiddler = function()
{
	var title = this.getAttribute("newTitle");
	if(this.getAttribute("isJournal") == "true") {
		title = new Date().formatString(title.trim());
	}
	var params = this.getAttribute("params");
	var tags = params ? params.split("|") : [];
	var focus = this.getAttribute("newFocus");
	var template = this.getAttribute("newTemplate");
	var customFields = this.getAttribute("customFields");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	story.displayTiddler(null,title,template,false,null,null);
	var tiddlerElem = story.getTiddler(title);
	if(customFields)
		story.addCustomFields(tiddlerElem,customFields);
	var text = this.getAttribute("newText");
	if(typeof text == "string" && story.getTiddlerField(title,"text"))
		story.getTiddlerField(title,"text").value = text.format([title]);
	for(var t=0;t<tags.length;t++)
		story.setTiddlerTag(title,tags[t],+1);
	story.focusTiddler(title,focus);
	return false;
};

config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
		title = getParam(params,"title",title);
		this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"title",false);
	}
};

config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : config.macros.timeline.dateFormat;
		title = getParam(params,"title",title);
		config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"text",true);
	}
};

//--
//-- Search macro
//--

config.macros.search.handler = function(place,macroName,params)
{
	var searchTimeout = null;
	var btn = createTiddlyButton(place,this.label,this.prompt,this.onClick,"searchButton");
	var txt = createTiddlyElement(null,"input",null,"txtOptionInput searchField");
	if(params[0])
		txt.value = params[0];
	if(config.browser.isSafari) {
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
	} else {
		txt.setAttribute("type","text");
	}
	place.appendChild(txt);
	txt.onkeyup = this.onKeyPress;
	txt.onfocus = this.onFocus;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("accessKey",params[1] || this.accessKey);
	txt.setAttribute("autocomplete","off");
	txt.setAttribute("lastSearchText","");
};

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
	if(txt.value.length > 0) {
		story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
		txt.setAttribute("lastSearchText",txt.value);
	}
};

config.macros.search.onClick = function(e)
{
	config.macros.search.doSearch(this.nextSibling);
	return false;
};

config.macros.search.onKeyPress = function(ev)
{
	var me = config.macros.search;
	var e = ev || window.event;
	switch(e.keyCode) {
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
			me.doSearch(this);
			break;
		case 27: // Escape
			this.value = "";
			clearMessage();
			break;
	}
	if(config.options.chkIncrementalSearch) {
		if(this.value.length > 2) {
			if(this.value != this.getAttribute("lastSearchText")) {
				if(me.timeout)
					clearTimeout(me.timeout);
				var txt = this;
				me.timeout = setTimeout(function() {me.doSearch(txt);},500);
			}
		} else {
			if(me.timeout)
				clearTimeout(me.timeout);
		}
	}
};

config.macros.search.onFocus = function(e)
{
	this.select();
};

//--
//-- Tabs macro
//--

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(null,"div",null,"tabsetWrapper " + cookie);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset");
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	for(var t=0; t<numTabs; t++) {
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		createTiddlyElement(tab,"span",null,null," ",{style:"font-size:0pt;line-height:0px"});
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
	}
	if(!validTab)
		config.options[cookie] = params[1];
	place.appendChild(wrapper);
	this.switchTab(tabset,config.options[cookie]);
};

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
	return false;
};

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null;
	var nodes = tabset.childNodes;
	for(var t=0; t<nodes.length; t++) {
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab) {
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
		} else {
			nodes[t].className = "tab tabUnselected";
		}
	}
	if(theTab) {
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			removeNode(tabset.nextSibling);
		var tabContent = createTiddlyElement(null,"div",null,"tabContents");
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		var contentTitle = theTab.getAttribute("content");
		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
		if(cookie) {
			config.options[cookie] = tab;
			saveOptionCookie(cookie);
		}
	}
};

//--
//-- Tiddler toolbar
//--

// Create a toolbar command button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,className)
{
	if(typeof commandName != "string") {
		var c = null;
		for(var t in config.commands) {
			if(config.commands[t] == commandName)
				c = t;
		}
		commandName = c;
	}
	if((tiddler instanceof Tiddler) && (typeof commandName == "string")) {
		var command = config.commands[commandName];
		if(command.isEnabled ? command.isEnabled(tiddler) : this.isCommandEnabled(command,tiddler)) {
			var text = command.getText ? command.getText(tiddler) : this.getCommandText(command,tiddler);
			var tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command,tiddler);
			var cmd;
			switch(command.type) {
			case "popup":
				cmd = this.onClickPopup;
				break;
			case "command":
			default:
				cmd = this.onClickCommand;
				break;
			}
			var btn = createTiddlyButton(null,text,tooltip,cmd);
			btn.setAttribute("commandName",commandName);
			btn.setAttribute("tiddler",tiddler.title);
			addClass(btn,"command_" + commandName);
			if(className)
				addClass(btn,className);
			place.appendChild(btn);
		}
	}
};

config.macros.toolbar.isCommandEnabled = function(command,tiddler)
{
	var title = tiddler.title;
	var ro = tiddler.isReadOnly();
	var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
	return (!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow);
};

config.macros.toolbar.getCommandText = function(command,tiddler)
{
	return tiddler.isReadOnly() && command.readOnlyText || command.text;
};

config.macros.toolbar.getCommandTooltip = function(command,tiddler)
{
	return tiddler.isReadOnly() && command.readOnlyTooltip || command.tooltip;
};

config.macros.toolbar.onClickCommand = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var command = config.commands[this.getAttribute("commandName")];
	return command.handler(e,this,this.getAttribute("tiddler"));
};

config.macros.toolbar.onClickPopup = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var popup = Popup.create(this);
	var command = config.commands[this.getAttribute("commandName")];
	var title = this.getAttribute("tiddler");
	var tiddler = store.fetchTiddler(title);
	popup.setAttribute("tiddler",title);
	command.handlePopup(popup,title);
	Popup.show();
	return false;
};

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,className,event)
{
	var children = place.getElementsByTagName("a");
	for(var t=0; t<children.length; t++) {
		var c = children[t];
		if(hasClass(c,className) && c.getAttribute && c.getAttribute("commandName")) {
			if(c.onclick instanceof Function)
				c.onclick.call(c,event);
			break;
		}
	}
};

config.macros.toolbar.onClickMore = function(ev)
{
	var e = this.nextSibling;
	e.style.display = "inline";
	this.style.display = "none";
	return false;
};

config.macros.toolbar.onClickLess = function(ev)
{
	var e = this.parentNode;
	var m = e.previousSibling;
	e.style.display = "none";
	m.style.display = "inline";
	return false;
};

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	for(var t=0; t<params.length; t++) {
		var c = params[t];
		switch(c) {
		case "!":
			createTiddlyText(place,this.separator);
			break;
		case "*":
			createTiddlyElement(place,"br");
			break;
		case "<":
			var btn = createTiddlyButton(place,this.lessLabel,this.lessPrompt,config.macros.toolbar.onClickLess);
			addClass(btn,"lessCommand");
			break;
		case ">":
			var btn = createTiddlyButton(place,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore);
			addClass(btn,"moreCommand");
			var e = createTiddlyElement(place,"span",null,"moreCommand");
			e.style.display = "none";
			place = e;
			break;
		default:
			var className = "";
			switch(c.substr(0,1)) {
			case "+":
				className = "defaultCommand";
				c = c.substr(1);
				break;
			case "-":
				className = "cancelCommand";
				c = c.substr(1);
				break;
			}
			if(c in config.commands) {
				this.createCommand(place,c,tiddler,className);
			} else {
				this.customCommand(place,c,wikifier,tiddler);
			}
			break;
		}
	}
};

// Overrideable function to extend toolbar handler
config.macros.toolbar.customCommand = function(place,command,wikifier,tiddler)
{
}

//--
//-- Menu and toolbar commands
//--

config.commands.closeTiddler.handler = function(event,src,title)
{
	if(story.isDirty(title) && !readOnly) {
		if(!confirm(config.commands.cancelTiddler.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.closeTiddler(title,true);
	return false;
};

config.commands.closeOthers.handler = function(event,src,title)
{
	story.closeAllTiddlers(title);
	return false;
};

config.commands.editTiddler.handler = function(event,src,title)
{
	clearMessage();
	var tiddlerElem = story.getTiddler(title);
	var fields = tiddlerElem.getAttribute("tiddlyFields");
	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,fields);
	story.focusTiddler(title,config.options.txtEditorFocus||"text");
	return false;
};

config.commands.saveTiddler.handler = function(event,src,title)
{
	var newTitle = story.saveTiddler(title,event.shiftKey);
	if(newTitle)
		story.displayTiddler(null,newTitle);
	return false;
};

config.commands.cancelTiddler.handler = function(event,src,title)
{
	if(story.hasChanges(title) && !readOnly) {
		if(!confirm(this.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.displayTiddler(null,title);
	return false;
};

config.commands.deleteTiddler.handler = function(event,src,title)
{
	var deleteIt = true;
	if(config.options.chkConfirmDelete)
		deleteIt = confirm(this.warning.format([title]));
	if(deleteIt) {
		store.removeTiddler(title);
		story.closeTiddler(title,true);
		autoSaveChanges();
	}
	return false;
};

config.commands.permalink.handler = function(event,src,title)
{
	var t = encodeURIComponent(String.encodeTiddlyLink(title));
	if(window.location.hash != t)
		window.location.hash = t;
	return false;
};

config.commands.references.handlePopup = function(popup,title)
{
	var references = store.getReferringTiddlers(title);
	var c = false;
	for(var r=0; r<references.length; r++) {
		if(references[r].title != title && !references[r].isTagged("excludeLists")) {
			createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
			c = true;
		}
	}
	if(!c)
		createTiddlyElement(popup,"li",null,"disabled",this.popupNone);
};

config.commands.jump.handlePopup = function(popup,title)
{
	story.forEachTiddler(function(title,element) {
		createTiddlyLink(createTiddlyElement(popup,"li"),title,true,null,false,null,true);
		});
};

config.commands.syncing.handlePopup = function(popup,title)
{
	var me = config.commands.syncing;
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var serverType = tiddler.getServerType();
	var serverHost = tiddler.fields["server.host"];
	var serverWorkspace = tiddler.fields["server.workspace"];
	if(!serverWorkspace)
		serverWorkspace = "";
	if(serverType) {
		var e = createTiddlyElement(popup,"li",null,"popupMessage");
		e.innerHTML = me.currentlySyncing.format([serverType,serverHost,serverWorkspace]);
	} else {
		createTiddlyElement(popup,"li",null,"popupMessage",me.notCurrentlySyncing);
	}
	if(serverType) {
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var btn = createTiddlyButton(createTiddlyElement(popup,"li"),this.captionUnSync,null,me.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type","");
	}
	createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
	createTiddlyElement(popup,"li",null,"popupMessage",me.chooseServer);
	var feeds = store.getTaggedTiddlers("systemServer","title");
	for(var t=0; t<feeds.length; t++) {
		var f = feeds[t];
		var feedServerType = store.getTiddlerSlice(f.title,"Type");
		if(!feedServerType)
			feedServerType = "file";
		var feedServerHost = store.getTiddlerSlice(f.title,"URL");
		if(!feedServerHost)
			feedServerHost = "";
		var feedServerWorkspace = store.getTiddlerSlice(f.title,"Workspace");
		if(!feedServerWorkspace)
			feedServerWorkspace = "";
		var caption = f.title;
		if(serverType == feedServerType && serverHost == feedServerHost && serverWorkspace == feedServerWorkspace) {
			caption = me.currServerMarker + caption;
		} else {
			caption = me.notCurrServerMarker + caption;
		}
		btn = createTiddlyButton(createTiddlyElement(popup,"li"),caption,null,me.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type",feedServerType);
		btn.setAttribute("server.host",feedServerHost);
		btn.setAttribute("server.workspace",feedServerWorkspace);
	}
};

config.commands.syncing.onChooseServer = function(e)
{
	var tiddler = this.getAttribute("tiddler");
	var serverType = this.getAttribute("server.type");
	if(serverType) {
		store.addTiddlerFields(tiddler,{
			"server.type": serverType,
			"server.host": this.getAttribute("server.host"),
			"server.workspace": this.getAttribute("server.workspace")
			});
	} else {
		store.setValue(tiddler,"server",null);
	}
	return false;
};

config.commands.fields.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var items = [];
	store.forEachField(tiddler,function(tiddler,fieldName,value){items.push({field:fieldName,value:value});},true);
	items.sort(function(a,b) {return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1);});
	if(items.length > 0)
		ListView.create(popup,items,this.listViewTemplate);
	else
		createTiddlyElement(popup,"div",null,null,this.emptyText);
};

//--
//-- Tiddler() object
//--

function Tiddler(title)
{
	this.title = title;
	this.text = "";
	this.creator = null;
	this.modifier = null;
	this.created = new Date();
	this.modified = this.created;
	this.links = [];
	this.linksUpdated = false;
	this.tags = [];
	this.fields = {};
	return this;
}

Tiddler.prototype.getLinks = function()
{
	if(this.linksUpdated==false)
		this.changed();
	return this.links;
};

// Returns the fields that are inherited in string field:"value" field2:"value2" format
Tiddler.prototype.getInheritedFields = function()
{
	var f = {};
	for(var i in this.fields) {
		if(i=="server.host" || i=="server.workspace" || i=="wikiformat"|| i=="server.type") {
			f[i] = this.fields[i];
		}
	}
	return String.encodeHashMap(f);
};

// Increment the changeCount of a tiddler
Tiddler.prototype.incChangeCount = function()
{
	var c = this.fields['changecount'];
	c = c ? parseInt(c,10) : 0;
	this.fields['changecount'] = String(c+1);
};

// Clear the changeCount of a tiddler
Tiddler.prototype.clearChangeCount = function()
{
	if(this.fields['changecount']) {
		delete this.fields['changecount'];
	}
};

Tiddler.prototype.doNotSave = function()
{
	return this.fields['doNotSave'];
};

// Returns true if the tiddler has been updated since the tiddler was created or downloaded
Tiddler.prototype.isTouched = function()
{
	var changeCount = this.fields['changecount'];
	if(changeCount === undefined)
		changeCount = 0;
	return changeCount > 0;
};

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields,creator)
{
	this.assign(title,text,modifier,modified,tags,created,fields,creator);
	this.changed();
	return this;
};

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields,creator)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(creator != undefined)
		this.creator = creator;
	if(created != undefined)
		this.created = created;
	if(fields != undefined)
		this.fields = fields;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else if(this.tags == undefined)
		this.tags = [];
	return this;
};

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	return String.encodeTiddlyLinkList(this.tags);
};

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
	return this.tags.indexOf(tag) != -1;
};

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	return text ? text.unescapeLineBreaks() : "";
};

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.escapeLineBreaks();
};

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var text = this.text;
	// remove 'quoted' text before scanning tiddler source
	text = text.replace(/\/%((?:.|\n)*?)%\//g,"").
		replace(/\{{3}((?:.|\n)*?)\}{3}/g,"").
		replace(/"""((?:.|\n)*?)"""/g,"").
		replace(/\<nowiki\>((?:.|\n)*?)\<\/nowiki\>/g,"").
		replace(/\<html\>((?:.|\n)*?)\<\/html\>/g,"").
		replace(/\<script((?:.|\n)*?)\<\/script\>/g,"");
	var t = this.autoLinkWikiWords() ? 0 : 1;
	var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;
	tiddlerLinkRegExp.lastIndex = 0;
	var formatMatch = tiddlerLinkRegExp.exec(text);
	while(formatMatch) {
		var lastIndex = tiddlerLinkRegExp.lastIndex;
		if(t==0 && formatMatch[1] && formatMatch[1] != this.title) {
			// wikiWordLink
			if(formatMatch.index > 0) {
				var preRegExp = new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
				preRegExp.lastIndex = formatMatch.index-1;
				var preMatch = preRegExp.exec(text);
				if(preMatch.index != formatMatch.index-1)
					this.links.pushUnique(formatMatch[1]);
			} else {
				this.links.pushUnique(formatMatch[1]);
			}
		}
		else if(formatMatch[2-t] && !config.formatterHelpers.isExternalLink(formatMatch[3-t])) // titledBrackettedLink
			this.links.pushUnique(formatMatch[3-t]);
		else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink
			this.links.pushUnique(formatMatch[4-t]);
		tiddlerLinkRegExp.lastIndex = lastIndex;
		formatMatch = tiddlerLinkRegExp.exec(text);
	}
	this.linksUpdated = true;
};

Tiddler.prototype.getSubtitle = function()
{
	var modifier = this.modifier;
	if(!modifier)
		modifier = config.messages.subtitleUnknown;
	var modified = this.modified;
	if(modified)
		modified = modified.toLocaleString();
	else
		modified = config.messages.subtitleUnknown;
	return config.messages.tiddlerLinkTooltip.format([this.title,modifier,modified]);
};

Tiddler.prototype.isReadOnly = function()
{
	return readOnly;
};

Tiddler.prototype.autoLinkWikiWords = function()
{
	return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
};

Tiddler.prototype.getServerType = function()
{
	var serverType = null;
	if(this.fields['server.type'])
		serverType = this.fields['server.type'];
	if(!serverType)
		serverType = this.fields['wikiformat'];
	if(serverType && !config.adaptors[serverType])
		serverType = null;
	return serverType;
};

Tiddler.prototype.getAdaptor = function()
{
	var serverType = this.getServerType();
	return serverType ? new config.adaptors[serverType]() : null;
};

//--
//-- TiddlyWiki() object contains Tiddler()s
//--

function TiddlyWiki()
{
	var tiddlers = {}; // Hashmap by name of tiddlers
	this.tiddlersUpdated = false;
	this.namedNotifications = []; // Array of {name:,notify:} of notification functions
	this.notificationLevel = 0;
	this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
	this.clear = function() {
		tiddlers = {};
		this.setDirty(false);
	};
	this.fetchTiddler = function(title) {
		var t = tiddlers[title];
		return t instanceof Tiddler ? t : null;
	};
	this.deleteTiddler = function(title) {
		delete this.slices[title];
		delete tiddlers[title];
	};
	this.addTiddler = function(tiddler) {
		delete this.slices[tiddler.title];
		tiddlers[tiddler.title] = tiddler;
	};
	this.forEachTiddler = function(callback) {
		for(var t in tiddlers) {
			var tiddler = tiddlers[t];
			if(tiddler instanceof Tiddler)
				callback.call(this,t,tiddler);
		}
	};
}

TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
};

TiddlyWiki.prototype.isDirty = function()
{
	return this.dirty;
};

TiddlyWiki.prototype.tiddlerExists = function(title)
{
	var t = this.fetchTiddler(title);
	return t != undefined;
};

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
	return config.shadowTiddlers[title] === undefined ? false : true;
};

TiddlyWiki.prototype.createTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler) {
		tiddler = new Tiddler(title);
		this.addTiddler(tiddler);
		this.setDirty(true);
	}
	return tiddler;
};

TiddlyWiki.prototype.getTiddler = function(title)
{
	var t = this.fetchTiddler(title);
	if(t != undefined)
		return t;
	else
		return null;
};

TiddlyWiki.prototype.getShadowTiddlerText = function(title)
{
	if(typeof config.shadowTiddlers[title] == "string")
		return config.shadowTiddlers[title];
	else
		return "";
};

// Retrieve tiddler contents
TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	if(!title)
		return defaultText;
	var pos = title.indexOf(config.textPrimitives.sectionSeparator);
	var section = null;
	if(pos != -1) {
		section = title.substr(pos + config.textPrimitives.sectionSeparator.length);
		title = title.substr(0,pos);
	}
	pos = title.indexOf(config.textPrimitives.sliceSeparator);
	if(pos != -1) {
		var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
		if(slice)
			return slice;
	}
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		if(!section)
			return tiddler.text;
		var re = new RegExp("(^!{1,6}[ \t]*" + section.escapeRegExp() + "[ \t]*\n)","mg");
		re.lastIndex = 0;
		var match = re.exec(tiddler.text);
		if(match) {
			var t = tiddler.text.substr(match.index+match[1].length);
			var re2 = /^!/mg;
			re2.lastIndex = 0;
			match = re2.exec(t); //# search for the next heading
			if(match)
				t = t.substr(0,match.index-1);//# don't include final \n
			return t;
		}
		return defaultText;
	}
	if(this.isShadowTiddler(title))
		return this.getShadowTiddlerText(title);
	if(defaultText != undefined)
		return defaultText;
	return null;
};

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,null);
	if(text == null)
		return defaultText;
	var textOut = [];
	var lastPos = 0;
	do {
		var match = bracketRegExp.exec(text);
		if(match) {
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1]) {
				if(depth <= 0)
					textOut.push(match[1]);
				else
					textOut.push(this.getRecursiveTiddlerText(match[1],"",depth-1));
			}
			lastPos = match.index + match[0].length;
		} else {
			textOut.push(text.substr(lastPos));
		}
	} while(match);
	return textOut.join("");
};

TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]+)[\t\x20]*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|[\t\x20]*([^\n]+)[\t\x20]*\|$)/gm;

// @internal
TiddlyWiki.prototype.calcAllSlices = function(title)
{
	var slices = {};
	var text = this.getTiddlerText(title,"");
	this.slicesRE.lastIndex = 0;
	var m = this.slicesRE.exec(text);
	while(m) {
		if(m[2])
			slices[m[2]] = m[3];
		else
			slices[m[5]] = m[6];
		m = this.slicesRE.exec(text);
	}
	return slices;
};

// Returns the slice of text of the given name
TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)
{
	var slices = this.slices[title];
	if(!slices) {
		slices = this.calcAllSlices(title);
		this.slices[title] = slices;
	}
	return slices[sliceName];
};

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)
{
	var r = {};
	for(var t=0; t<sliceNames.length; t++) {
		var slice = this.getTiddlerSlice(title,sliceNames[t]);
		if(slice)
			r[sliceNames[t]] = slice;
	}
	return r;
};

TiddlyWiki.prototype.suspendNotifications = function()
{
	this.notificationLevel--;
};

TiddlyWiki.prototype.resumeNotifications = function()
{
	this.notificationLevel++;
};

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	if(!this.notificationLevel) {
		for(var t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if((n.name == null && doBlanket) || (n.name == title))
				n.notify(title);
		}
	}
};

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	if(!this.notificationLevel) {
		for(var t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if(n.name)
				n.notify(n.name);
		}
	}
};

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	for(var i=0; i<this.namedNotifications.length; i++) {
		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
			return this;
	}
	this.namedNotifications.push({name: title, notify: fn});
	return this;
};

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		this.deleteTiddler(title);
		this.notify(title,true);
		this.setDirty(true);
	}
};

// Reset the sync status of a freshly synced tiddler
TiddlyWiki.prototype.resetTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		tiddler.clearChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		var t = tiddler.tags.indexOf(tag);
		if(t != -1)
			tiddler.tags.splice(t,1);
		if(status)
			tiddler.tags.push(tag);
		tiddler.changed();
		tiddler.incChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.addTiddlerFields = function(title,fields)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler)
		return;
	merge(tiddler.fields,fields);
	tiddler.changed();
	tiddler.incChangeCount();
	this.notify(title,true);
	this.setDirty(true);
};

// Store tiddler in TiddlyWiki instance
TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created,creator)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		created = created || tiddler.created; // Preserve created date
		creator = creator || tiddler.creator;
		this.deleteTiddler(title);
	} else {
		created = created || modified;
		tiddler = new Tiddler();
	}
	fields = merge({},fields);
	tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields,creator);
	this.addTiddler(tiddler);
	if(clearChangeCount)
		tiddler.clearChangeCount();
	else
		tiddler.incChangeCount();
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	this.setDirty(true);
	return tiddler;
};

TiddlyWiki.prototype.incChangeCount = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		tiddler.incChangeCount();
};

TiddlyWiki.prototype.getLoader = function()
{
	if(!this.loader)
		this.loader = new TW21Loader();
	return this.loader;
};

TiddlyWiki.prototype.getSaver = function()
{
	if(!this.saver)
		this.saver = new TW21Saver();
	return this.saver;
};

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
	return this.getSaver().externalize(store);
};

// Load contents of a TiddlyWiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)
{
	this.idPrefix = idPrefix;
	var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
	if(!storeElem)
		return;
	var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);
	this.setDirty(false);
	if(!noUpdate) {
		for(var i = 0;i<tiddlers.length; i++)
			tiddlers[i].changed();
	}
	jQuery(document).trigger("loadTiddlers");
};

// Load contents of a TiddlyWiki from a string
// Returns null if there's an error
TiddlyWiki.prototype.importTiddlyWiki = function(text)
{
	var posDiv = locateStoreArea(text);
	if(!posDiv)
		return null;
	var content = "<" + "html><" + "body>" + text.substring(posDiv[0],posDiv[1] + endSaveArea.length) + "<" + "/body><" + "/html>";
	// Create the iframe
	var iframe = document.createElement("iframe");
	iframe.style.display = "none";
	document.body.appendChild(iframe);
	var doc = iframe.document;
	if(iframe.contentDocument)
		doc = iframe.contentDocument; // For NS6
	else if(iframe.contentWindow)
		doc = iframe.contentWindow.document; // For IE5.5 and IE6
	// Put the content in the iframe
	doc.open();
	doc.writeln(content);
	doc.close();
	// Load the content into a TiddlyWiki() object
	var storeArea = doc.getElementById("storeArea");
	this.loadFromDiv(storeArea,"store");
	// Get rid of the iframe
	iframe.parentNode.removeChild(iframe);
	return this;
};

TiddlyWiki.prototype.updateTiddlers = function()
{
	this.tiddlersUpdated = true;
	this.forEachTiddler(function(title,tiddler) {
		tiddler.changed();
	});
};

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag,match)
{
	var candidates = this.reverseLookup("tags",excludeTag,!!match);
	var results = [];
	for(var t=0; t<candidates.length; t++) {
		if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
			results.push(candidates[t]);
	}
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Returns a list of all tags in use
//   excludeTag - if present, excludes tags that are themselves tagged with excludeTag
// Returns an array of arrays where [tag][0] is the name of the tag and [tag][1] is the number of occurances
TiddlyWiki.prototype.getTags = function(excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		for(var g=0; g<tiddler.tags.length; g++) {
			var tag = tiddler.tags[g];
			var n = true;
			for(var c=0; c<results.length; c++) {
				if(results[c][0] == tag) {
					n = false;
					results[c][1]++;
				}
			}
			if(n && excludeTag) {
				var t = this.fetchTiddler(tag);
				if(t && t.isTagged(excludeTag))
					n = false;
			}
			if(n)
				results.push([tag,1]);
		}
	});
	results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});
	return results;
};

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
};

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	return this.reverseLookup("links",title,true,sortField);
};

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		var f = !lookupMatch;
		for(var lookup=0; lookup<tiddler[lookupField].length; lookup++) {
			if(tiddler[lookupField][lookup] == lookupValue)
				f = lookupMatch;
		}
		if(f)
			results.push(tiddler);
	});
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
			results.push(tiddler);
	});
	if(field)
		results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});
	return results;
};

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function(sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(tiddler.isTagged("excludeMissing") || tiddler.isTagged("systemConfig"))
			return;
		for(var n=0; n<tiddler.links.length;n++) {
			var link = tiddler.links[n];
			if(this.fetchTiddler(link) == null && !this.isShadowTiddler(link))
				results.pushUnique(link);
		}
	});
	results.sort();
	return results;
};

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
			results.push(title);
	});
	results.sort();
	return results;
};

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
	var results = [];
	for(var t in config.shadowTiddlers) {
		if(this.isShadowTiddler(t))
			results.push(t);
	}
	results.sort();
	return results;
};

// Return an array of tiddlers that have been touched since they were downloaded or created
TiddlyWiki.prototype.getTouched = function()
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(tiddler.isTouched())
			results.push(tiddler);
		});
	results.sort();
	return results;
};

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler)
{
	var t = (typeof tiddler == "string") ? this.getTiddler(tiddler) : tiddler;
	return t instanceof Tiddler ? t : null;
};

// Filter a list of tiddlers
TiddlyWiki.prototype.filterTiddlers = function(filter)
{
	var results = [];
	if(filter) {
		var tiddler;
		var re = /([^\s\[\]]+)|(?:\[([ \w]+)\[([^\]]+)\]\])|(?:\[\[([^\]]+)\]\])/mg;
		var match = re.exec(filter);
		while(match) {
			if(match[1] || match[4]) {
				var title = match[1] || match[4];
				tiddler = this.fetchTiddler(title);
				if(tiddler) {
					results.pushUnique(tiddler);
				} else if(this.isShadowTiddler(title)) {
					tiddler = new Tiddler();
					tiddler.set(title,this.getTiddlerText(title));
					results.pushUnique(tiddler);
				} else {
					results.pushUnique(new Tiddler(title));
				}
			} else if(match[2]) {
				switch(match[2]) {
					case "tag":
						var matched = this.getTaggedTiddlers(match[3]);
						for(var m = 0; m < matched.length; m++)
							results.pushUnique(matched[m]);
						break;
					case "sort":
						results = this.sortTiddlers(results,match[3]);
						break;
				}
			}
			match = re.exec(filter);
		}
	}
	return results;
};

// Sort a list of tiddlers
TiddlyWiki.prototype.sortTiddlers = function(tiddlers,field)
{
	var asc = +1;
	switch(field.substr(0,1)) {
	case "-":
		asc = -1;
		// Note: this fall-through is intentional
		/*jsl:fallthru*/
	case "+":
		field = field.substr(1);
		break;
	}
	if(TiddlyWiki.standardFieldAccess[field])
		tiddlers.sort(function(a,b) {return a[field] < b[field] ? -asc : (a[field] == b[field] ? 0 : asc);});
	else
		tiddlers.sort(function(a,b) {return a.fields[field] < b.fields[field] ? -asc : (a.fields[field] == b.fields[field] ? 0 : +asc);});
	return tiddlers;
};

// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by "."
TiddlyWiki.isValidFieldName = function(name)
{
	var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
	return match && (match[0] == name);
};

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name)
{
	if(!TiddlyWiki.isValidFieldName(name))
		throw config.messages.invalidFieldName.format([name]);
};

function StringFieldAccess(n,readOnly)
{
	this.set = readOnly ?
			function(t,v) {if(v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);} :
			function(t,v) {if(v != t[n]) {t[n] = v; return true;}};
	this.get = function(t) {return t[n];};
}

function DateFieldAccess(n)
{
	this.set = function(t,v) {
		var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v);
		if(d != t[n]) {
			t[n] = d; return true;
		}
	};
	this.get = function(t) {return t[n].convertToYYYYMMDDHHMM();};
}

function LinksFieldAccess(n)
{
	this.set = function(t,v) {
		var s = (typeof v == "string") ? v.readBracketedList() : v;
		if(s.toString() != t[n].toString()) {
			t[n] = s; return true;
		}
	};
	this.get = function(t) {return String.encodeTiddlyLinkList(t[n]);};
}

TiddlyWiki.standardFieldAccess = {
	// The set functions return true when setting the data has changed the value.
	"title":    new StringFieldAccess("title",true),
	// Handle the "tiddler" field name as the title
	"tiddler":  new StringFieldAccess("title",true),
	"text":     new StringFieldAccess("text"),
	"modifier": new StringFieldAccess("modifier"),
	"modified": new DateFieldAccess("modified"),
	"creator":  new StringFieldAccess("creator"),
	"created":  new DateFieldAccess("created"),
	"tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name)
{
	return TiddlyWiki.standardFieldAccess[name] != undefined;
};

// Sets the value of the given field of the tiddler to the value.
// Setting an ExtendedField's value to null or undefined removes the field.
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddler,fieldName,value)
{
	TiddlyWiki.checkFieldName(fieldName);
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return;
	fieldName = fieldName.toLowerCase();
	var isRemove = (value === undefined) || (value === null);
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		if(isRemove)
			// don't remove StandardFields
			return;
		var h = TiddlyWiki.standardFieldAccess[fieldName];
		if(!h.set(t,value))
			return;
	} else {
		var oldValue = t.fields[fieldName];
		if(isRemove) {
			if(oldValue !== undefined) {
				// deletes a single field
				delete t.fields[fieldName];
			} else {
				// no concrete value is defined for the fieldName
				// so we guess this is a namespace path.
				// delete all fields in a namespace
				var re = new RegExp("^"+fieldName+"\\.");
				var dirty = false;
				for(var n in t.fields) {
					if(n.match(re)) {
						delete t.fields[n];
						dirty = true;
					}
				}
				if(!dirty)
					return;
			}
		} else {
			// the "normal" set case. value is defined (not null/undefined)
			// For convenience provide a nicer conversion Date->String
			value = value instanceof Date ? value.convertToYYYYMMDDHHMMSSMMM() : String(value);
			if(oldValue == value)
				return;
			t.fields[fieldName] = value;
		}
	}
	// When we are here the tiddler/store really was changed.
	this.notify(t.title,true);
	if(!fieldName.match(/^temp\./))
		this.setDirty(true);
};

// Returns the value of the given field of the tiddler.
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddler,fieldName)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	fieldName = fieldName.toLowerCase();
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		return accessor.get(t);
	}
	return t.fields[fieldName];
};

// Calls the callback function for every field in the tiddler.
// When callback function returns a non-false value the iteration stops
// and that value is returned.
// The order of the fields is not defined.
// @param callback a function(tiddler,fieldName,value).
TiddlyWiki.prototype.forEachField = function(tiddler,callback,onlyExtendedFields)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	var n,result;
	for(n in t.fields) {
		result = callback(t,n,t.fields[n]);
		if(result)
			return result;
		}
	if(onlyExtendedFields)
		return undefined;
	for(n in TiddlyWiki.standardFieldAccess) {
		if(n == "tiddler")
			// even though the "title" field can also be referenced through the name "tiddler"
			// we only visit this field once.
			continue;
		result = callback(t,n,TiddlyWiki.standardFieldAccess[n].get(t));
		if(result)
			return result;
	}
	return undefined;
};

//--
//-- Story functions
//--

function Story(containerId,idPrefix)
{
	this.container = containerId;
	this.idPrefix = idPrefix;
	this.highlightRegExp = null;
	this.tiddlerId = function(title) {
		var id = this.idPrefix + title;
		return id==this.container ? this.idPrefix + "_" + title : id;
	};
	this.containerId = function() {
		return this.container;
	};
}

Story.prototype.getTiddler = function(title)
{
	return document.getElementById(this.tiddlerId(title));
};

Story.prototype.getContainer = function()
{
	return document.getElementById(this.containerId());
};

Story.prototype.forEachTiddler = function(fn)
{
	var place = this.getContainer();
	if(!place)
		return;
	var e = place.firstChild;
	while(e) {
		var n = e.nextSibling;
		var title = e.getAttribute("tiddler");
		fn.call(this,title,e);
		e = n;
	}
};

Story.prototype.displayDefaultTiddlers = function()
{
	this.displayTiddlers(null,store.filterTiddlers(store.getTiddlerText("DefaultTiddlers")));
};

Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,unused,customFields,toggle)
{
	for(var t = titles.length-1;t>=0;t--)
		this.displayTiddler(srcElement,titles[t],template,animate,unused,customFields);
};

Story.prototype.displayTiddler = function(srcElement,tiddler,template,animate,unused,customFields,toggle,animationSrc)
{
	var title = (tiddler instanceof Tiddler) ? tiddler.title : tiddler;
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(toggle) {
			if(tiddlerElem.getAttribute("dirty") != "true")
				this.closeTiddler(title,true);
		} else {
			this.refreshTiddler(title,template,false,customFields);
		}
	} else {
		var place = this.getContainer();
		var before = this.positionTiddler(srcElement);
		tiddlerElem = this.createTiddler(place,before,title,template,customFields);
	}
	if(animationSrc && typeof animationSrc !== "string") {
		srcElement = animationSrc;
	}
	if(srcElement && typeof srcElement !== "string") {
		if(config.options.chkAnimate && (animate == undefined || animate == true) && anim && typeof Zoomer == "function" && typeof Scroller == "function")
			anim.startAnimating(new Zoomer(title,srcElement,tiddlerElem),new Scroller(tiddlerElem));
		else
			window.scrollTo(0,ensureVisible(tiddlerElem));
	}
	return tiddlerElem;
};

Story.prototype.positionTiddler = function(srcElement)
{
	var place = this.getContainer();
	var before = null;
	if(typeof srcElement == "string") {
		switch(srcElement) {
		case "top":
			before = place.firstChild;
			break;
		case "bottom":
			before = null;
			break;
		}
	} else {
		var after = this.findContainingTiddler(srcElement);
		if(after == null) {
			before = place.firstChild;
		} else if(after.nextSibling) {
			before = after.nextSibling;
			if(before.nodeType != 1)
				before = null;
		}
	}
	return before;
};

Story.prototype.createTiddler = function(place,before,title,template,customFields)
{
	var tiddlerElem = createTiddlyElement(null,"div",this.tiddlerId(title),"tiddler");
	tiddlerElem.setAttribute("refresh","tiddler");
	if(customFields)
		tiddlerElem.setAttribute("tiddlyFields",customFields);
	place.insertBefore(tiddlerElem,before);
	var defaultText = null;
	if(!store.tiddlerExists(title) && !store.isShadowTiddler(title))
		defaultText = this.loadMissingTiddler(title,customFields,tiddlerElem);
	this.refreshTiddler(title,template,false,customFields,defaultText);
	return tiddlerElem;
};

Story.prototype.loadMissingTiddler = function(title,fields,tiddlerElem)
{
	var getTiddlerCallback = function(context)
	{
		if(context.status) {
			var t = context.tiddler;
			if(!t.created)
				t.created = new Date();
			if(!t.modified)
				t.modified = t.created;
			store.saveTiddler(t.title,t.title,t.text,t.modifier,t.modified,t.tags,t.fields,true,t.created,t.creator);
			autoSaveChanges();
		} else {
			story.refreshTiddler(context.title,null,true);
		}
		context.adaptor.close();
		delete context.adaptor;
	};
	var tiddler = new Tiddler(title);
	tiddler.fields = typeof fields == "string" ? fields.decodeHashMap() : fields||{};
	var context = {serverType:tiddler.getServerType()};
	if(!context.serverType)
		return;
	context.host = tiddler.fields['server.host'];
	context.workspace = tiddler.fields['server.workspace'];
	var adaptor = new config.adaptors[context.serverType];
	adaptor.getTiddler(title,context,null,getTiddlerCallback);
	return config.messages.loadingMissingTiddler.format([title,context.serverType,context.host,context.workspace]);
};

Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	if(!template)
		template = DEFAULT_VIEW_TEMPLATE;
	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
		template = config.tiddlerTemplates[template];
	return template;
};

Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
	return store.getRecursiveTiddlerText(template,null,10);
};

Story.prototype.refreshTiddler = function(title,template,force,customFields,defaultText)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(tiddlerElem.getAttribute("dirty") == "true" && !force)
			return tiddlerElem;
		template = this.chooseTemplateForTiddler(title,template);
		var currTemplate = tiddlerElem.getAttribute("template");
		if((template != currTemplate) || force) {
			var tiddler = store.getTiddler(title);
			if(!tiddler) {
				tiddler = new Tiddler();
				if(store.isShadowTiddler(title)) {
					var tags = [];
					tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,tags,version.date);
				} else {
					var text = template=="EditTemplate" ?
								config.views.editor.defaultText.format([title]) :
								config.views.wikified.defaultText.format([title]);
					text = defaultText || text;
					var fields = customFields ? customFields.decodeHashMap() : null;
					tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date,fields);
				}
			}
			tiddlerElem.setAttribute("tags",tiddler.tags.join(" "));
			tiddlerElem.setAttribute("tiddler",title);
			tiddlerElem.setAttribute("template",template);
			tiddlerElem.onmouseover = this.onTiddlerMouseOver;
			tiddlerElem.onmouseout = this.onTiddlerMouseOut;
			tiddlerElem.ondblclick = this.onTiddlerDblClick;
			tiddlerElem[window.event?"onkeydown":"onkeypress"] = this.onTiddlerKeyPress;
			tiddlerElem.innerHTML = this.getTemplateForTiddler(title,template,tiddler);
			applyHtmlMacros(tiddlerElem,tiddler);
			if(store.getTaggedTiddlers(title).length > 0)
				addClass(tiddlerElem,"isTag");
			else
				removeClass(tiddlerElem,"isTag");
			if(store.tiddlerExists(title)) {
				removeClass(tiddlerElem,"shadow");
				removeClass(tiddlerElem,"missing");
			} else {
				addClass(tiddlerElem, store.isShadowTiddler(title) ? "shadow" : "missing");
			}
			if(customFields)
				this.addCustomFields(tiddlerElem,customFields);
			forceReflow();
		}
	}
	return tiddlerElem;
};

Story.prototype.addCustomFields = function(place,customFields)
{
	var fields = customFields.decodeHashMap();
	var w = createTiddlyElement(place,"div",null,"customFields");
	w.style.display = "none";
	for(var t in fields) {
		var e = document.createElement("input");
		e.setAttribute("type","text");
		e.setAttribute("value",fields[t]);
		w.appendChild(e);
		e.setAttribute("edit",t);
	}
};

Story.prototype.refreshAllTiddlers = function(force)
{
	var e = this.getContainer().firstChild;
	while(e) {
		var template = e.getAttribute("template");
		if(template && e.getAttribute("dirty") != "true") {
			this.refreshTiddler(e.getAttribute("tiddler"),force ? null : template,true);
		}
		e = e.nextSibling;
	}
};

Story.prototype.onTiddlerMouseOver = function(e)
{
	addClass(this, "selected");
};

Story.prototype.onTiddlerMouseOut = function(e)
{
	removeClass(this,"selected");
};

Story.prototype.onTiddlerDblClick = function(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	if(target && target.nodeName.toLowerCase() != "input" && target.nodeName.toLowerCase() != "textarea") {
		if(document.selection && document.selection.empty)
			document.selection.empty();
		config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
		e.cancelBubble = true;
		if(e.stopPropagation) e.stopPropagation();
		return true;
	}
	return false;
};

Story.prototype.onTiddlerKeyPress = function(ev)
{
	var e = ev || window.event;
	clearMessage();
	var consume = false;
	var title = this.getAttribute("tiddler");
	var target = resolveTarget(e);
	switch(e.keyCode) {
	case 9: // Tab
		if(config.options.chkInsertTabs && target.tagName.toLowerCase() == "textarea") {
			replaceSelection(target,String.fromCharCode(9));
			consume = true;
		}
		if(config.isOpera) {
			target.onblur = function() {
				this.focus();
				this.onblur = null;
			};
		}
		break;
	case 13: // Ctrl-Enter
	case 10: // Ctrl-Enter on IE PC
	case 77: // Ctrl-Enter is "M" on some platforms
		if(e.ctrlKey) {
			blurElement(this);
			config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
			consume = true;
		}
		break;
	case 27: // Escape
		blurElement(this);
		config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
		consume = true;
		break;
	}
	e.cancelBubble = consume;
	if(consume) {
		if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
		e.returnValue = true; // Cancel The Event in IE
		if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz
	}
	return !consume;
};

Story.prototype.getTiddlerField = function(title,field)
{
	var tiddlerElem = this.getTiddler(title);
	var e = null;
	if(tiddlerElem ) {
		var children = tiddlerElem.getElementsByTagName("*");
		for(var t=0; t<children.length; t++) {
			var c = children[t];
			if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea") {
				if(!e)
					e = c;
				if(c.getAttribute("edit") == field)
					e = c;
			}
		}
	}
	return e;
};

Story.prototype.focusTiddler = function(title,field)
{
	var e = this.getTiddlerField(title,field);
	if(e) {
		e.focus();
		e.select();
	}
};

Story.prototype.blurTiddler = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem && tiddlerElem.focus && tiddlerElem.blur) {
		tiddlerElem.focus();
		tiddlerElem.blur();
	}
};

Story.prototype.setTiddlerField = function(title,tag,mode,field)
{
	var c = this.getTiddlerField(title,field);
	var tags = c.value.readBracketedList();
	tags.setItem(tag,mode);
	c.value = String.encodeTiddlyLinkList(tags);
};

Story.prototype.setTiddlerTag = function(title,tag,mode)
{
	this.setTiddlerField(title,tag,mode,"tags");
};

Story.prototype.closeTiddler = function(title,animate,unused)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		clearMessage();
		this.scrubTiddler(tiddlerElem);
		if(config.options.chkAnimate && animate && anim && typeof Slider == "function")
			anim.startAnimating(new Slider(tiddlerElem,false,null,"all"));
		else {
			removeNode(tiddlerElem);
			forceReflow();
		}
	}
};

Story.prototype.scrubTiddler = function(tiddlerElem)
{
	tiddlerElem.id = null;
};

Story.prototype.setDirty = function(title,dirty)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		tiddlerElem.setAttribute("dirty",dirty ? "true" : "false");
};

Story.prototype.isDirty = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		return tiddlerElem.getAttribute("dirty") == "true";
	return null;
};

Story.prototype.areAnyDirty = function()
{
	var r = false;
	this.forEachTiddler(function(title,element) {
		if(this.isDirty(title))
			r = true;
	});
	return r;
};

Story.prototype.closeAllTiddlers = function(exclude)
{
	clearMessage();
	this.forEachTiddler(function(title,element) {
		if((title != exclude) && element.getAttribute("dirty") != "true")
			this.closeTiddler(title);
	});
	window.scrollTo(0,ensureVisible(this.container));
};

Story.prototype.isEmpty = function()
{
	var place = this.getContainer();
	return place && place.firstChild == null;
};

Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
	this.closeAllTiddlers();
	highlightHack = new RegExp(useRegExp ? text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
	var matches = store.search(highlightHack,"title","excludeSearch");
	this.displayTiddlers(null,matches);
	highlightHack = null;
	var q = useRegExp ? "/" : "'";
	if(matches.length > 0)
		displayMessage(config.macros.search.successMsg.format([matches.length.toString(),q + text + q]));
	else
		displayMessage(config.macros.search.failureMsg.format([q + text + q]));
};

Story.prototype.findContainingTiddler = function(e)
{
	while(e && !hasClass(e,"tiddler")) {
		e = hasClass(e,"popup") && Popup.stack[0] ? Popup.stack[0].root : e.parentNode;
	}
	return e;
};

Story.prototype.gatherSaveFields = function(e,fields)
{
	if(e && e.getAttribute) {
		var f = e.getAttribute("edit");
		if(f)
			fields[f] = e.value.replace(/\r/mg,"");
		if(e.hasChildNodes()) {
			var c = e.childNodes;
			for(var t=0; t<c.length; t++)
				this.gatherSaveFields(c[t],fields);
		}
	}
};

Story.prototype.hasChanges = function(title)
{
	var e = this.getTiddler(title);
	if(e) {
		var fields = {};
		this.gatherSaveFields(e,fields);
		if(store.fetchTiddler(title)) {
			for(var n in fields) {
				if(store.getValue(title,n) != fields[n]) //# tiddler changed
					return true;
			}
		} else {
			if(store.isShadowTiddler(title) && store.getShadowTiddlerText(title) == fields.text) { //# not checking for title or tags
				return false;
			} else { //# changed shadow or new tiddler
				return true;
			}
		}
	}
	return false;
};

Story.prototype.saveTiddler = function(title,minorUpdate)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		var fields = {};
		this.gatherSaveFields(tiddlerElem,fields);
		var newTitle = fields.title || title;
		if(!store.tiddlerExists(newTitle)) {
			newTitle = newTitle.trim();
			var creator = config.options.txtUserName;
		}
		if(store.tiddlerExists(newTitle) && newTitle != title) {
			if(!confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
				return null;
		}
		if(newTitle != title)
			this.closeTiddler(newTitle,false);
		tiddlerElem.id = this.tiddlerId(newTitle);
		tiddlerElem.setAttribute("tiddler",newTitle);
		tiddlerElem.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
		tiddlerElem.setAttribute("dirty","false");
		if(config.options.chkForceMinorUpdate)
			minorUpdate = !minorUpdate;
		if(!store.tiddlerExists(newTitle))
			minorUpdate = false;
		var newDate = new Date();
		if(store.tiddlerExists(title)) {
			var t = store.fetchTiddler(title);
			var extendedFields = t.fields;
			creator = t.creator;
		} else {
			extendedFields = merge({},config.defaultCustomFields);
		}
		for(var n in fields) {
			if(!TiddlyWiki.isStandardField(n))
				extendedFields[n] = fields[n];
		}
		var tiddler = store.saveTiddler(title,newTitle,fields.text,minorUpdate ? undefined : config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags,extendedFields,null,null,creator);
		autoSaveChanges(null,[tiddler]);
		return newTitle;
	}
	return null;
};

Story.prototype.permaView = function()
{
	var links = [];
	this.forEachTiddler(function(title,element) {
		links.push(String.encodeTiddlyLink(title));
	});
	var t = encodeURIComponent(links.join(" "));
	if(t == "")
		t = "#";
	if(window.location.hash != t)
		window.location.hash = t;
};

Story.prototype.switchTheme = function(theme)
{
	if(safeMode)
		return;

	var isAvailable = function(title) {
		var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
		if(s!=-1)
			title = title.substr(0,s);
		return store.tiddlerExists(title) || store.isShadowTiddler(title);
	};

	var getSlice = function(theme,slice) {
		var r;
		if(readOnly)
			r = store.getTiddlerSlice(theme,slice+"ReadOnly") || store.getTiddlerSlice(theme,"Web"+slice);
		r = r || store.getTiddlerSlice(theme,slice);
		if(r && r.indexOf(config.textPrimitives.sectionSeparator)==0)
			r = theme + r;
		return isAvailable(r) ? r : slice;
	};

	var replaceNotification = function(i,name,theme,slice) {
		var newName = getSlice(theme,slice);
		if(name!=newName && store.namedNotifications[i].name==name) {
			store.namedNotifications[i].name = newName;
			return newName;
		}
		return name;
	};

	var pt = config.refresherData.pageTemplate;
	var vi = DEFAULT_VIEW_TEMPLATE;
	var vt = config.tiddlerTemplates[vi];
	var ei = DEFAULT_EDIT_TEMPLATE;
	var et = config.tiddlerTemplates[ei];

	for(var i=0; i<config.notifyTiddlers.length; i++) {
		var name = config.notifyTiddlers[i].name;
		switch(name) {
		case "PageTemplate":
			config.refresherData.pageTemplate = replaceNotification(i,config.refresherData.pageTemplate,theme,name);
			break;
		case "StyleSheet":
			removeStyleSheet(config.refresherData.styleSheet);
			config.refresherData.styleSheet = replaceNotification(i,config.refresherData.styleSheet,theme,name);
			break;
		case "ColorPalette":
			config.refresherData.colorPalette = replaceNotification(i,config.refresherData.colorPalette,theme,name);
			break;
		default:
			break;
		}
	}
	config.tiddlerTemplates[vi] = getSlice(theme,"ViewTemplate");
	config.tiddlerTemplates[ei] = getSlice(theme,"EditTemplate");
	if(!startingUp) {
		if(config.refresherData.pageTemplate!=pt || config.tiddlerTemplates[vi]!=vt || config.tiddlerTemplates[ei]!=et) {
			refreshAll();
			this.refreshAllTiddlers(true);
		} else {
			setStylesheet(store.getRecursiveTiddlerText(config.refresherData.styleSheet,"",10),config.refreshers.styleSheet);
		}
		config.options.txtTheme = theme;
		saveOptionCookie("txtTheme");
	}
};

//--
//-- Backstage
//--

var backstage = {
	area: null,
	toolbar: null,
	button: null,
	showButton: null,
	hideButton: null,
	cloak: null,
	panel: null,
	panelBody: null,
	panelFooter: null,
	currTabName: null,
	currTabElem: null,
	content: null,

	init: function() {
		var cmb = config.messages.backstage;
		this.area = document.getElementById("backstageArea");
		this.toolbar = jQuery("#backstageToolbar").empty()[0];
		this.button = jQuery("#backstageButton").empty()[0];
		this.button.style.display = "block";
		var t = cmb.open.text + " " + glyph("bentArrowLeft");
		this.showButton = createTiddlyButton(this.button,t,cmb.open.tooltip,
						function(e) {backstage.show(); return false;},null,"backstageShow");
		t = glyph("bentArrowRight") + " " + cmb.close.text;
		this.hideButton = createTiddlyButton(this.button,t,cmb.close.tooltip,
						function(e) {backstage.hide(); return false;},null,"backstageHide");
		this.cloak = document.getElementById("backstageCloak");
		this.panel = document.getElementById("backstagePanel");
		this.panelFooter = createTiddlyElement(this.panel,"div",null,"backstagePanelFooter");
		this.panelBody = createTiddlyElement(this.panel,"div",null,"backstagePanelBody");
		this.cloak.onmousedown = function(e) {backstage.switchTab(null);};
		createTiddlyText(this.toolbar,cmb.prompt);
		for(t=0; t<config.backstageTasks.length; t++) {
			var taskName = config.backstageTasks[t];
			var task = config.tasks[taskName];
			var handler = task.action ? this.onClickCommand : this.onClickTab;
			var text = task.text + (task.action ? "" : glyph("downTriangle"));
			var btn = createTiddlyButton(this.toolbar,text,task.tooltip,handler,"backstageTab");
			addClass(btn,task.action ? "backstageAction" : "backstageTask");
			btn.setAttribute("task", taskName);
			}
		this.content = document.getElementById("contentWrapper");
		if(config.options.chkBackstage)
			this.show();
		else
			this.hide();
	},

	isVisible: function() {
		return this.area ? this.area.style.display == "block" : false;
	},

	show: function() {
		this.area.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.toolbar.style.left = findWindowWidth() + "px";
			var p = [{style: "left", start: findWindowWidth(), end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p));
		} else {
			backstage.area.style.left = "0px";
		}
		jQuery(this.showButton).hide();
		jQuery(this.hideButton).show();
		config.options.chkBackstage = true;
		saveOptionCookie("chkBackstage");
		addClass(this.content,"backstageVisible");
	},

	hide: function() {
		if(this.currTabElem) {
			this.switchTab(null);
		} else {
			backstage.toolbar.style.left = "0px";
			if(anim && config.options.chkAnimate) {
				var p = [{style: "left", start: 0, end: findWindowWidth(), template: "%0px"}];
				var c = function(element,properties) {backstage.area.style.display = "none";};
				anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p,c));
			} else {
				this.area.style.display = "none";
			}
			this.showButton.style.display = "block";
			this.hideButton.style.display = "none";
			config.options.chkBackstage = false;
			saveOptionCookie("chkBackstage");
			removeClass(this.content, "backstageVisible");
		}
	},

	onClickCommand: function(e) {
		var task = config.tasks[this.getAttribute("task")];
		if(task.action) {
			backstage.switchTab(null);
			task.action();
		}
		return false;
	},

	onClickTab: function(e) {
		backstage.switchTab(this.getAttribute("task"));
		return false;
	},

	// Switch to a given tab, or none if null is passed
	switchTab: function(tabName) {
		var tabElem = null;
		var e = this.toolbar.firstChild;
		while(e)
			{
			if(e.getAttribute && e.getAttribute("task") == tabName)
				tabElem = e;
			e = e.nextSibling;
			}
		if(tabName == backstage.currTabName) {
			backstage.hidePanel();
			return;
		}
		if(backstage.currTabElem) {
			removeClass(this.currTabElem, "backstageSelTab");
		}
		if(tabElem && tabName) {
			backstage.preparePanel();
			addClass(tabElem,"backstageSelTab");
			var task = config.tasks[tabName];
			wikify(task.content,backstage.panelBody,null,null);
			backstage.showPanel();
		} else if(backstage.currTabElem) {
			backstage.hidePanel();
		}
		backstage.currTabName = tabName;
		backstage.currTabElem = tabElem;
	},

	isPanelVisible: function() {
		return backstage.panel ? backstage.panel.style.display == "block" : false;
	},

	preparePanel: function() {
		backstage.cloak.style.height = findWindowHeight() + "px";
		backstage.cloak.style.display = "block";
		removeChildren(backstage.panelBody);
		return backstage.panelBody;
	},

	showPanel: function() {
		backstage.panel.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.panel.style.top = (-backstage.panel.offsetHeight) + "px";
			var p = [{style: "top", start: -backstage.panel.offsetHeight, end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p),new Scroller(backstage.panel,false));
		} else {
			backstage.panel.style.top = "0px";
		}
		return backstage.panelBody;
	},

	hidePanel: function() {
		if(backstage.currTabElem)
			removeClass(backstage.currTabElem, "backstageSelTab");
		backstage.currTabElem = null;
		backstage.currTabName = null;
		if(anim && config.options.chkAnimate) {
			var p = [
				{style: "top", start: 0, end: -(backstage.panel.offsetHeight), template: "%0px"},
				{style: "display", atEnd: "none"}
			];
			var c = function(element,properties) {backstage.cloak.style.display = "none";};
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p,c));
		} else {
			jQuery([backstage.panel,backstage.cloak]).hide();
		}
	}
};

config.macros.backstage = {};

config.macros.backstage.handler = function(place,macroName,params)
{
	var backstageTask = config.tasks[params[0]];
	if(backstageTask)
		createTiddlyButton(place,backstageTask.text,backstageTask.tooltip,function(e) {backstage.switchTab(params[0]); return false;});
};

//--
//-- ImportTiddlers macro
//--

config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(readOnly) {
		createTiddlyElement(place,"div",null,"marked",this.readOnlyWarning);
		return;
	}
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	this.restart(w);
};

config.macros.importTiddlers.onCancel = function(e)
{
	var wizard = new Wizard(this);
	var place = wizard.clear();
	config.macros.importTiddlers.restart(wizard);
	return false;
};

config.macros.importTiddlers.onClose = function(e)
{
	backstage.hidePanel();
	return false;
};

config.macros.importTiddlers.restart = function(wizard)
{
	var me = config.macros.importTiddlers;
	wizard.addStep(this.step1Title,this.step1Html);
	var s = wizard.getElement("selTypes");
	for(var t in config.adaptors) {
		var e = createTiddlyElement(s,"option",null,null,config.adaptors[t].serverLabel ? config.adaptors[t].serverLabel : t);
		e.value = t;
	}
	if(config.defaultAdaptor)
		s.value = config.defaultAdaptor;
	s = wizard.getElement("selFeeds");
	var feeds = this.getFeeds();
	for(t in feeds) {
		e = createTiddlyElement(s,"option",null,null,t);
		e.value = t;
	}
	wizard.setValue("feeds",feeds);
	s.onchange = me.onFeedChange;
	var fileInput = wizard.getElement("txtBrowse");
	fileInput.onchange = me.onBrowseChange;
	fileInput.onkeyup = me.onBrowseChange;
	wizard.setButtons([{caption: this.openLabel, tooltip: this.openPrompt, onClick: me.onOpen}]);
	wizard.formElem.action = "javascript:;";
	wizard.formElem.onsubmit = function() {
		if(!this.txtPath || this.txtPath.value.length) //# check for manually entered path in first step
			this.lastChild.firstChild.onclick();
	};
};

config.macros.importTiddlers.getFeeds = function()
{
	var feeds = {};
	var tagged = store.getTaggedTiddlers("systemServer","title");
	for(var t=0; t<tagged.length; t++) {
		var title = tagged[t].title;
		var serverType = store.getTiddlerSlice(title,"Type");
		if(!serverType)
			serverType = "file";
		feeds[title] = {title: title,
						url: store.getTiddlerSlice(title,"URL"),
						workspace: store.getTiddlerSlice(title,"Workspace"),
						workspaceList: store.getTiddlerSlice(title,"WorkspaceList"),
						tiddlerFilter: store.getTiddlerSlice(title,"TiddlerFilter"),
						serverType: serverType,
						description: store.getTiddlerSlice(title,"Description")};
	}
	return feeds;
};

config.macros.importTiddlers.onFeedChange = function(e)
{
	var wizard = new Wizard(this);
	var selTypes = wizard.getElement("selTypes");
	var fileInput = wizard.getElement("txtPath");
	var feeds = wizard.getValue("feeds");
	var f = feeds[this.value];
	if(f) {
		selTypes.value = f.serverType;
		fileInput.value = f.url;
		wizard.setValue("feedName",f.serverType);
		wizard.setValue("feedHost",f.url);
		wizard.setValue("feedWorkspace",f.workspace);
		wizard.setValue("feedWorkspaceList",f.workspaceList);
		wizard.setValue("feedTiddlerFilter",f.tiddlerFilter);
	}
	return false;
};

config.macros.importTiddlers.onBrowseChange = function(e)
{
	var wizard = new Wizard(this);
	if(this.files && this.files[0]) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalFileRead");
		} catch (ex) {
			showException(ex);
		}
	}
	var fileInput = wizard.getElement("txtPath");
	fileInput.value = config.macros.importTiddlers.getURLFromLocalPath(this.value);
	var serverType = wizard.getElement("selTypes");
	serverType.value = "file";
	return true;
};

config.macros.importTiddlers.getURLFromLocalPath = function(v)
{
	if(!v || !v.length)
		return v;
	v = v.replace(/\\/g,"/"); // use "/" for cross-platform consistency
	var u;
	var t = v.split(":");
	var p = t[1] || t[0]; // remove drive letter (if any)
	if(t[1] && (t[0] == "http" || t[0] == "https" || t[0] == "file")) {
		u = v;
	} else if(p.substr(0,1)=="/") {
		u = document.location.protocol + "//" + document.location.hostname + (t[1] ? "/" : "") + v;
	} else {
		var c = document.location.href.replace(/\\/g,"/");
		var pos = c.lastIndexOf("/");
		if(pos!=-1)
			c = c.substr(0,pos); // remove filename
		u = c + "/" + p;
	}
	return u;
};

config.macros.importTiddlers.onOpen = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	var url = fileInput.value;
	var serverType = wizard.getElement("selTypes").value || config.defaultAdaptor;
	var adaptor = new config.adaptors[serverType]();
	wizard.setValue("adaptor",adaptor);
	wizard.setValue("serverType",serverType);
	wizard.setValue("host",url);
	var ret = adaptor.openHost(url,null,wizard,me.onOpenHost);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenHost);
	return false;
};

config.macros.importTiddlers.onOpenHost = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	var adaptor = wizard.getValue("adaptor");
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenHost: " + context.statusText);
	var ret = adaptor.getWorkspaceList(context,wizard,me.onGetWorkspaceList);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusGetWorkspaceList);
};

config.macros.importTiddlers.onGetWorkspaceList = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onGetWorkspaceList: " + context.statusText);
	wizard.setValue("context",context);
	var workspace = wizard.getValue("feedWorkspace");
	if(!workspace && context.workspaces.length==1)
		workspace = context.workspaces[0].title;
	if(workspace) {
		var ret = context.adaptor.openWorkspace(workspace,context,wizard,me.onOpenWorkspace);
		if(ret !== true)
			displayMessage(ret);
		wizard.setValue("workspace",workspace);
		wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenWorkspace);
		return;
	}
	wizard.addStep(me.step2Title,me.step2Html);
	var s = wizard.getElement("selWorkspace");
	s.onchange = me.onWorkspaceChange;
	for(var t=0; t<context.workspaces.length; t++) {
		var e = createTiddlyElement(s,"option",null,null,context.workspaces[t].title);
		e.value = context.workspaces[t].title;
	}
	var workspaceList = wizard.getValue("feedWorkspaceList");
	if(workspaceList) {
		var list = workspaceList.parseParams("workspace",null,false,true);
		for(var n=1; n<list.length; n++) {
			if(context.workspaces.findByField("title",list[n].value) == null) {
				e = createTiddlyElement(s,"option",null,null,list[n].value);
				e.value = list[n].value;
			}
		}
	}
	if(workspace) {
		t = wizard.getElement("txtWorkspace");
		t.value = workspace;
	}
	wizard.setButtons([{caption: me.openLabel, tooltip: me.openPrompt, onClick: me.onChooseWorkspace}]);
};

config.macros.importTiddlers.onWorkspaceChange = function(e)
{
	var wizard = new Wizard(this);
	var t = wizard.getElement("txtWorkspace");
	t.value = this.value;
	this.selectedIndex = 0;
	return false;
};

config.macros.importTiddlers.onChooseWorkspace = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	var adaptor = wizard.getValue("adaptor");
	var workspace = wizard.getElement("txtWorkspace").value;
	wizard.setValue("workspace",workspace);
	var context = wizard.getValue("context");
	var ret = adaptor.openWorkspace(workspace,context,wizard,me.onOpenWorkspace);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenWorkspace);
	return false;
};

config.macros.importTiddlers.onOpenWorkspace = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenWorkspace: " + context.statusText);
	var adaptor = wizard.getValue("adaptor");
	var ret = adaptor.getTiddlerList(context,wizard,me.onGetTiddlerList,wizard.getValue("feedTiddlerFilter"));
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusGetTiddlerList);
};

config.macros.importTiddlers.onGetTiddlerList = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true) {
		wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.errorGettingTiddlerList);
		return;
	}
	// Extract data for the listview
	var listedTiddlers = [];
	if(context.tiddlers) {
		for(var n=0; n<context.tiddlers.length; n++) {
			var tiddler = context.tiddlers[n];
			listedTiddlers.push({
				title: tiddler.title,
				modified: tiddler.modified,
				modifier: tiddler.modifier,
				text: tiddler.text ? wikifyPlainText(tiddler.text,100) : "",
				tags: tiddler.tags,
				size: tiddler.text ? tiddler.text.length : 0,
				tiddler: tiddler
			});
		}
	}
	listedTiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	// Display the listview
	wizard.addStep(me.step3Title,me.step3Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	var listView = ListView.create(listWrapper,listedTiddlers,me.listViewTemplate);
	wizard.setValue("listView",listView);
	wizard.setValue("context",context);
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler");
	txtSaveTiddler.value = me.generateSystemServerName(wizard);
	wizard.setButtons([
			{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel},
			{caption: me.importLabel, tooltip: me.importPrompt, onClick: me.doImport}
		]);
};

config.macros.importTiddlers.generateSystemServerName = function(wizard)
{
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var pattern = config.macros.importTiddlers[workspace ? "systemServerNamePattern" : "systemServerNamePatternNoWorkspace"];
	return pattern.format([serverType,host,workspace]);
};

config.macros.importTiddlers.saveServerTiddler = function(wizard)
{
	var me = config.macros.importTiddlers;
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler").value;
	if(store.tiddlerExists(txtSaveTiddler)) {
		if(!confirm(me.confirmOverwriteSaveTiddler.format([txtSaveTiddler])))
			return;
		store.suspendNotifications();
		store.removeTiddler(txtSaveTiddler);
		store.resumeNotifications();
	}
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var text = me.serverSaveTemplate.format([serverType,host,workspace]);
	store.saveTiddler(txtSaveTiddler,txtSaveTiddler,text,me.serverSaveModifier,new Date(),["systemServer"]);
};

config.macros.importTiddlers.doImport = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	if(wizard.getElement("chkSave").checked)
		me.saveServerTiddler(wizard);
	var chkSync = wizard.getElement("chkSync").checked;
	wizard.setValue("sync",chkSync);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	var adaptor = wizard.getValue("adaptor");
	var overwrite = [];
	var t;
	for(t=0; t<rowNames.length; t++) {
		if(store.tiddlerExists(rowNames[t]))
			overwrite.push(rowNames[t]);
	}
	if(overwrite.length > 0) {
		if(!confirm(me.confirmOverwriteText.format([overwrite.join(", ")])))
			return false;
	}
	wizard.addStep(me.step4Title.format([rowNames.length]),me.step4Html);
	for(t=0; t<rowNames.length; t++) {
		var link = document.createElement("div");
		createTiddlyLink(link,rowNames[t],true);
		var place = wizard.getElement("markReport");
		place.parentNode.insertBefore(link,place);
	}
	wizard.setValue("remainingImports",rowNames.length);
	wizard.setButtons([
			{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}
		],me.statusDoingImport);
	var wizardContext = wizard.getValue("context");
	var tiddlers = wizardContext ? wizardContext.tiddlers : [];
	for(t=0; t<rowNames.length; t++) {
		var context = {
			allowSynchronous:true,
			tiddler:tiddlers[tiddlers.findByField("title",rowNames[t])]
		};
		adaptor.getTiddler(rowNames[t],context,wizard,me.onGetTiddler);
	}
	return false;
};

config.macros.importTiddlers.onGetTiddler = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(!context.status)
		displayMessage("Error in importTiddlers.onGetTiddler: " + context.statusText);
	var tiddler = context.tiddler;
	store.suspendNotifications();
	store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
	if(!wizard.getValue("sync")) {
		store.setValue(tiddler.title,'server',null);
	}
	store.resumeNotifications();
	if(!context.isSynchronous)
		store.notify(tiddler.title,true);
	var remainingImports = wizard.getValue("remainingImports")-1;
	wizard.setValue("remainingImports",remainingImports);
	if(remainingImports == 0) {
		if(context.isSynchronous) {
			store.notifyAll();
			refreshDisplay();
		}
		wizard.setButtons([
				{caption: me.doneLabel, tooltip: me.donePrompt, onClick: me.onClose}
			],me.statusDoneImport);
		autoSaveChanges();
	}
};

//--
//-- Upgrade macro
//--

config.macros.upgrade.handler = function(place)
{
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	w.addStep(this.step1Title,this.step1Html.format([this.source,this.source]));
	w.setButtons([{caption: this.upgradeLabel, tooltip: this.upgradePrompt, onClick: this.onClickUpgrade}]);
};

config.macros.upgrade.onClickUpgrade = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	if(window.location.protocol != "file:") {
		alert(me.errorCantUpgrade);
		return false;
	}
	if(story.areAnyDirty() || store.isDirty()) {
		alert(me.errorNotSaved);
		return false;
	}
	var localPath = getLocalPath(document.location.toString());
	var backupPath = getBackupPath(localPath,me.backupExtension);
	w.setValue("backupPath",backupPath);
	w.setButtons([],me.statusPreparingBackup);
	var original = loadOriginal(localPath);
	w.setButtons([],me.statusSavingBackup);
	var backup = copyFile(backupPath,localPath);
	if(!backup)
		backup = saveFile(backupPath,original);
	if(!backup) {
		w.setButtons([],me.errorSavingBackup);
		alert(me.errorSavingBackup);
		return false;
	}
	w.setButtons([],me.statusLoadingCore);
	var load = loadRemoteFile(me.source,me.onLoadCore,w);
	if(typeof load == "string") {
		w.setButtons([],me.errorLoadingCore);
		alert(me.errorLoadingCore);
		return false;
	}
	return false;
};

config.macros.upgrade.onLoadCore = function(status,params,responseText,url,xhr)
{
	var me = config.macros.upgrade;
	var w = params;
	var errMsg;
	if(!status)
		errMsg = me.errorLoadingCore;
	var newVer = me.extractVersion(responseText);
	if(!newVer)
		errMsg = me.errorCoreFormat;
	if(errMsg) {
		w.setButtons([],errMsg);
		alert(errMsg);
		return;
	}
	var onStartUpgrade = function(e) {
		w.setButtons([],me.statusSavingCore);
		var localPath = getLocalPath(document.location.toString());
		saveFile(localPath,responseText);
		w.setButtons([],me.statusReloadingCore);
		var backupPath = w.getValue("backupPath");
		var newLoc = document.location.toString() + "?time=" + new Date().convertToYYYYMMDDHHMM() + "#upgrade:[[" + encodeURI(backupPath) + "]]";
		window.setTimeout(function () {window.location = newLoc;},10);
	};
	var step2 = [me.step2Html_downgrade,me.step2Html_restore,me.step2Html_upgrade][compareVersions(version,newVer) + 1];
	w.addStep(me.step2Title,step2.format([formatVersion(newVer),formatVersion(version)]));
	w.setButtons([{caption: me.startLabel, tooltip: me.startPrompt, onClick: onStartUpgrade},{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}]);
};

config.macros.upgrade.onCancel = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	w.addStep(me.step3Title,me.step3Html);
	w.setButtons([]);
	return false;
};

config.macros.upgrade.extractVersion = function(upgradeFile)
{
	var re = /^var version = \{title: "([^"]+)", major: (\d+), minor: (\d+), revision: (\d+)(, beta: (\d+)){0,1}, date: new Date\("([^"]+)"\)/mg;
	var m = re.exec(upgradeFile);
	return  m ? {title: m[1], major: m[2], minor: m[3], revision: m[4], beta: m[6], date: new Date(m[7])} : null;
};

function upgradeFrom(path)
{
	var importStore = new TiddlyWiki();
	var tw = loadFile(path);
	if(window.netscape !== undefined)
		tw = convertUTF8ToUnicode(tw);
	importStore.importTiddlyWiki(tw);
	importStore.forEachTiddler(function(title,tiddler) {
		if(!store.getTiddler(title)) {
			store.addTiddler(tiddler);
		}
	});
	refreshDisplay();
	saveChanges(); //# To create appropriate Markup* sections
	alert(config.messages.upgradeDone.format([formatVersion()]));
	window.location = window.location.toString().substr(0,window.location.toString().lastIndexOf("?"));
}

//--
//-- Sync macro
//--

// Synchronisation handlers
config.syncers = {};

// Sync state.
var currSync = null;

// sync macro
config.macros.sync.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!wikifier.isStatic)
		this.startSync(place);
};

config.macros.sync.cancelSync = function()
{
	currSync = null;
};

config.macros.sync.startSync = function(place)
{
	if(currSync)
		config.macros.sync.cancelSync();
	currSync = {};
	currSync.syncList = this.getSyncableTiddlers();
	currSync.syncTasks = this.createSyncTasks(currSync.syncList);
	this.preProcessSyncableTiddlers(currSync.syncList);
	var wizard = new Wizard();
	currSync.wizard = wizard;
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	currSync.listView = ListView.create(listWrapper,currSync.syncList,this.listViewTemplate);
	this.processSyncableTiddlers(currSync.syncList);
	wizard.setButtons([{caption: this.syncLabel, tooltip: this.syncPrompt, onClick: this.doSync}]);
};

config.macros.sync.getSyncableTiddlers = function()
{
	var list = [];
	store.forEachTiddler(function(title,tiddler) {
		var syncItem = {};
		syncItem.serverType = tiddler.getServerType();
		syncItem.serverHost = tiddler.fields['server.host'];
		if(syncItem.serverType && syncItem.serverHost) {
			syncItem.adaptor = new config.adaptors[syncItem.serverType];
			syncItem.serverHost = syncItem.adaptor.fullHostName(syncItem.serverHost);
			syncItem.serverWorkspace = tiddler.fields['server.workspace'];
			syncItem.tiddler = tiddler;
			syncItem.title = tiddler.title;
			syncItem.isTouched = tiddler.isTouched();
			syncItem.selected = syncItem.isTouched;
			syncItem.syncStatus = config.macros.sync.syncStatusList[syncItem.isTouched ? "changedLocally" : "none"];
			syncItem.status = syncItem.syncStatus.text;
			list.push(syncItem);
		}
		});
	list.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	return list;
};

config.macros.sync.preProcessSyncableTiddlers = function(syncList)
{
	for(var i=0; i<syncList.length; i++) {
		var si = syncList[i];
		si.serverUrl = si.adaptor.generateTiddlerInfo(si.tiddler).uri;
	}
};

config.macros.sync.processSyncableTiddlers = function(syncList)
{
	for(var i=0; i<syncList.length; i++) {
		var si = syncList[i];
		if(si.syncStatus.display)
			si.rowElement.style.display = si.syncStatus.display;
		if(si.syncStatus.className)
			si.rowElement.className = si.syncStatus.className;
	}
};

config.macros.sync.createSyncTasks = function(syncList)
{
	var syncTasks = [];
	for(var i=0; i<syncList.length; i++) {
		var si = syncList[i];
		var r = null;
		for(var j=0; j<syncTasks.length; j++) {
			var cst = syncTasks[j];
			if(si.serverType == cst.serverType && si.serverHost == cst.serverHost && si.serverWorkspace == cst.serverWorkspace)
				r = cst;
		}
		if(r) {
			si.syncTask = r;
			r.syncItems.push(si);
		} else {
			si.syncTask = this.createSyncTask(si);
			syncTasks.push(si.syncTask);
		}
	}
	return syncTasks;
};

config.macros.sync.createSyncTask = function(syncItem)
{
	var st = {};
	st.serverType = syncItem.serverType;
	st.serverHost = syncItem.serverHost;
	st.serverWorkspace = syncItem.serverWorkspace;
	st.syncItems = [syncItem];

	var openWorkspaceCallback = function(context,syncItems) {
		if(context.status) {
			context.adaptor.getTiddlerList(context,syncItems,getTiddlerListCallback);
			return true;
		}
		displayMessage(context.statusText);
		return false;
	};

	var getTiddlerListCallback = function(context,sycnItems) {
		var me = config.macros.sync;
		if(!context.status) {
			displayMessage(context.statusText);
			return false;
		}
		syncItems = context.userParams;
		var tiddlers = context.tiddlers;
		for(var i=0; i<syncItems.length; i++) {
			var si = syncItems[i];
			var f = tiddlers.findByField("title",si.title);
			if(f !== null) {
				if(tiddlers[f].fields['server.page.revision'] > si.tiddler.fields['server.page.revision']) {
					si.syncStatus = me.syncStatusList[si.isTouched ? 'changedBoth' : 'changedServer'];
				}
			} else {
				si.syncStatus = me.syncStatusList.notFound;
			}
			me.updateSyncStatus(si);
		}
		return true;
	};
	var context = {host:st.serverHost,workspace:st.serverWorkspace};
	syncItem.adaptor.openHost(st.serverHost);
	syncItem.adaptor.openWorkspace(st.serverWorkspace,context,st.syncItems,openWorkspaceCallback);
	return st;
};

config.macros.sync.updateSyncStatus = function(syncItem)
{
	var e = syncItem.colElements["status"];
	removeChildren(e);
	createTiddlyText(e,syncItem.syncStatus.text);
	if(syncItem.syncStatus.display)
		syncItem.rowElement.style.display = syncItem.syncStatus.display;
	if(syncItem.syncStatus.className)
		syncItem.rowElement.className = syncItem.syncStatus.className;
};

config.macros.sync.doSync = function(e)
{
	var me = config.macros.sync;
	var getTiddlerCallback = function(context,syncItem) {
		if(syncItem) {
			var tiddler = context.tiddler;
			store.saveTiddler(tiddler.title,tiddler.title,tiddler.text,tiddler.modifier,tiddler.modified,tiddler.tags,tiddler.fields,true,tiddler.created);
			syncItem.syncStatus = me.syncStatusList.gotFromServer;
			me.updateSyncStatus(syncItem);
		}
	};
	var putTiddlerCallback = function(context,syncItem) {
		if(syncItem) {
			store.resetTiddler(context.title);
			syncItem.syncStatus = me.syncStatusList.putToServer;
			me.updateSyncStatus(syncItem);
		}
	};

	var rowNames = ListView.getSelectedRows(currSync.listView);
	var sl = me.syncStatusList;
	for(var i=0; i<currSync.syncList.length; i++) {
		var si = currSync.syncList[i];
		if(rowNames.indexOf(si.title) != -1) {
			var errorMsg = "Error in doSync: ";
			try {
				var r = true;
				switch(si.syncStatus) {
				case sl.changedServer:
					r = si.adaptor.getTiddler(si.title,null,si,getTiddlerCallback);
					break;
				case sl.notFound:
				case sl.changedLocally:
				case sl.changedBoth:
					r = si.adaptor.putTiddler(si.tiddler,null,si,putTiddlerCallback);
					break;
				default:
					break;
				}
				if(!r)
					displayMessage(errorMsg + r);
			} catch(ex) {
				if(ex.name == "TypeError")
					displayMessage("sync operation unsupported: " + ex.message);
				else
					displayMessage(errorMsg + ex.message);
			}
		}
	}
	return false;
};

//--
//-- Manager UI for groups of tiddlers
//--

config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString)
{
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	listWrapper.setAttribute("refresh","macro");
	listWrapper.setAttribute("macroName","plugins");
	listWrapper.setAttribute("params",paramString);
	this.refresh(listWrapper,paramString);
};

config.macros.plugins.refresh = function(listWrapper,params)
{
	var me = config.macros.plugins;
	var wizard = new Wizard(listWrapper);
	var selectedRows = [];
	ListView.forEachSelector(listWrapper,function(e,rowName) {
			if(e.checked)
				selectedRows.push(e.getAttribute("rowName"));
		});
	removeChildren(listWrapper);
	params = params.parseParams("anon");
	var plugins = installedPlugins.slice(0);
	var t,tiddler,p;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(t=0; t<configTiddlers.length; t++) {
		tiddler = configTiddlers[t];
		if(plugins.findByField("title",tiddler.title) == null) {
			p = getPluginInfo(tiddler);
			p.executed = false;
			p.log.splice(0,0,this.skippedText);
			plugins.push(p);
		}
	}
	for(t=0; t<plugins.length; t++) {
		p = plugins[t];
		p.size = p.tiddler.text ? p.tiddler.text.length : 0;
		p.forced = p.tiddler.isTagged("systemConfigForce");
		p.disabled = p.tiddler.isTagged("systemConfigDisable");
		p.Selected = selectedRows.indexOf(plugins[t].title) != -1;
	}
	if(plugins.length == 0) {
		createTiddlyElement(listWrapper,"em",null,null,this.noPluginText);
		wizard.setButtons([]);
	} else {
		var listView = ListView.create(listWrapper,plugins,this.listViewTemplate,this.onSelectCommand);
		wizard.setValue("listView",listView);
		wizard.setButtons([
				{caption: me.removeLabel, tooltip: me.removePrompt, onClick: me.doRemoveTag},
				{caption: me.deleteLabel, tooltip: me.deletePrompt, onClick: me.doDelete}
			]);
	}
};

config.macros.plugins.doRemoveTag = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		for(var t=0; t<rowNames.length; t++)
			store.setTiddlerTag(rowNames[t],false,"systemConfig");
	}
};

config.macros.plugins.doDelete = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		if(confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")]))) {
			for(var t=0; t<rowNames.length; t++) {
				store.removeTiddler(rowNames[t]);
				story.closeTiddler(rowNames[t],true);
			}
		}
	}
};

//--
//-- Message area
//--

function getMessageDiv()
{
	var msgArea = document.getElementById("messageArea");
	if(!msgArea)
		return null;
	if(!msgArea.hasChildNodes())
		createTiddlyButton(createTiddlyElement(msgArea,"div",null,"messageToolbar"),
			config.messages.messageClose.text,
			config.messages.messageClose.tooltip,
			clearMessage);
	msgArea.style.display = "block";
	return createTiddlyElement(msgArea,"div");
}

function displayMessage(text,linkText)
{
	var e = getMessageDiv();
	if(!e) {
		alert(text);
		return;
	}
	if(linkText) {
		var link = createTiddlyElement(e,"a",null,null,text);
		link.href = linkText;
		link.target = "_blank";
	} else {
		e.appendChild(document.createTextNode(text));
	}
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	if(msgArea) {
		removeChildren(msgArea);
		msgArea.style.display = "none";
	}
	return false;
}

//--
//-- Refresh mechanism
//--

config.notifyTiddlers = [
	{name: "StyleSheetLayout", notify: refreshStyles},
	{name: "StyleSheetColors", notify: refreshStyles},
	{name: "StyleSheet", notify: refreshStyles},
	{name: "StyleSheetPrint", notify: refreshStyles},
	{name: "PageTemplate", notify: refreshPageTemplate},
	{name: "SiteTitle", notify: refreshPageTitle},
	{name: "SiteSubtitle", notify: refreshPageTitle},
	{name: "WindowTitle", notify: refreshPageTitle},
	{name: "ColorPalette", notify: refreshColorPalette},
	{name: null, notify: refreshDisplay}
];

config.refreshers = {
	link: function(e,changeList)
		{
		var title = e.getAttribute("tiddlyLink");
		refreshTiddlyLink(e,title);
		return true;
		},

	tiddler: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var template = e.getAttribute("template");
		if(changeList && changeList.indexOf(title) != -1 && !story.isDirty(title))
			story.refreshTiddler(title,template,true);
		else
			refreshElements(e,changeList);
		return true;
		},

	content: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var force = e.getAttribute("force");
		var args = e.getAttribute("args");
		if(force != null || changeList == null || changeList.indexOf(title) != -1) {
			removeChildren(e);
			config.macros.tiddler.transclude(e,title,args);
			return true;
		} else
			return false;
		},

	macro: function(e,changeList)
		{
		var macro = e.getAttribute("macroName");
		var params = e.getAttribute("params");
		if(macro)
			macro = config.macros[macro];
		if(macro && macro.refresh)
			macro.refresh(e,params);
		return true;
		}
};

config.refresherData = {
	styleSheet: "StyleSheet",
	defaultStyleSheet: "StyleSheet",
	pageTemplate: "PageTemplate",
	defaultPageTemplate: "PageTemplate",
	colorPalette: "ColorPalette",
	defaultColorPalette: "ColorPalette"
};

function refreshElements(root,changeList)
{
	var nodes = root.childNodes;
	for(var c=0; c<nodes.length; c++) {
		var e = nodes[c], type = null;
		if(e.getAttribute && (e.tagName ? e.tagName != "IFRAME" : true))
			type = e.getAttribute("refresh");
		var refresher = config.refreshers[type];
		var refreshed = false;
		if(refresher != undefined)
			refreshed = refresher(e,changeList);
		if(e.hasChildNodes() && !refreshed)
			refreshElements(e,changeList);
	}
}

function applyHtmlMacros(root,tiddler)
{
	var e = root.firstChild;
	while(e) {
		var nextChild = e.nextSibling;
		if(e.getAttribute) {
			var macro = e.getAttribute("macro");
			if(macro) {
				e.removeAttribute("macro");
				var params = "";
				var p = macro.indexOf(" ");
				if(p != -1) {
					params = macro.substr(p+1);
					macro = macro.substr(0,p);
				}
				invokeMacro(e,macro,params,null,tiddler);
			}
		}
		if(e.hasChildNodes())
			applyHtmlMacros(e,tiddler);
		e = nextChild;
	}
}

function refreshPageTemplate(title)
{
	var stash = jQuery("<div/>").appendTo("body").hide()[0];
	var display = story.getContainer();
	var nodes,t;
	if(display) {
		nodes = display.childNodes;
		for(t=nodes.length-1; t>=0; t--)
			stash.appendChild(nodes[t]);
	}
	var wrapper = document.getElementById("contentWrapper");

	var isAvailable = function(title) {
		var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
		if(s!=-1)
			title = title.substr(0,s);
		return store.tiddlerExists(title) || store.isShadowTiddler(title);
	};
	if(!title || !isAvailable(title))
		title = config.refresherData.pageTemplate;
	if(!isAvailable(title))
		title = config.refresherData.defaultPageTemplate; //# this one is always avaialable
	wrapper.innerHTML = store.getRecursiveTiddlerText(title,null,10);
	applyHtmlMacros(wrapper);
	refreshElements(wrapper);
	display = story.getContainer();
	removeChildren(display);
	if(!display)
		display = createTiddlyElement(wrapper,"div",story.containerId());
	nodes = stash.childNodes;
	for(t=nodes.length-1; t>=0; t--)
		display.appendChild(nodes[t]);
	removeNode(stash);
}

function refreshDisplay(hint)
{
	if(typeof hint == "string")
		hint = [hint];
	var e = document.getElementById("contentWrapper");
	refreshElements(e,hint);
	if(backstage.isPanelVisible()) {
		e = document.getElementById("backstage");
		refreshElements(e,hint);
	}
}

function refreshPageTitle()
{
	document.title = getPageTitle();
}

function getPageTitle()
{
	return wikifyPlain("WindowTitle");
}

function refreshStyles(title,doc)
{
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title,doc || document);
}

function refreshColorPalette(title)
{
	if(!startingUp)
		refreshAll();
}

function refreshAll()
{
	refreshPageTemplate();
	refreshDisplay();
	refreshStyles("StyleSheetLayout");
	refreshStyles("StyleSheetColors");
	refreshStyles(config.refresherData.styleSheet);
	refreshStyles("StyleSheetPrint");
}

//--
//-- Options stuff
//--

config.optionHandlers = {
	'txt': {
		get: function(name) {return encodeCookie(config.options[name].toString());},
		set: function(name,value) {config.options[name] = decodeCookie(value);}
	},
	'chk': {
		get: function(name) {return config.options[name] ? "true" : "false";},
		set: function(name,value) {config.options[name] = value == "true";}
	}
};

function loadOptionsCookie()
{
	if(safeMode)
		return;
	var cookies = document.cookie.split(";");
	for(var c=0; c<cookies.length; c++) {
		var p = cookies[c].indexOf("=");
		if(p != -1) {
			var name = cookies[c].substr(0,p).trim();
			var value = cookies[c].substr(p+1).trim();
			var optType = name.substr(0,3);
			var handlers = config.optionHandlers;
			if(handlers[optType] && handlers[optType].set)
				handlers[optType].set(name,value);
		}
	}
}

function saveOptionCookie(name)
{
	if(safeMode)
		return;
	if(name.match(/[()\s]/g, "_")) {
		alert(config.messages.invalidCookie.format([name]));
		return;
	}
	var c = name + "=";
	var optType = name.substr(0,3);
	var handlers = config.optionHandlers;
	if(handlers[optType] && handlers[optType].get)
		c += handlers[optType].get(name);
	c += "; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
	document.cookie = c;
}

function removeCookie(name)
{
	document.cookie = name + "=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;";
}

function encodeCookie(s)
{
	return escape(convertUnicodeToHtmlEntities(s));
}

function decodeCookie(s)
{
	s = unescape(s);
	var re = /&#[0-9]{1,5};/g;
	return s.replace(re,function($0) {return String.fromCharCode(eval($0.replace(/[&#;]/g,"")));});
}


config.macros.option.genericCreate = function(place,type,opt,className,desc)
{
	var typeInfo = config.macros.option.types[type];
	var c = document.createElement(typeInfo.elementType);
	if(typeInfo.typeValue)
		c.setAttribute("type",typeInfo.typeValue);
	c[typeInfo.eventName] = typeInfo.onChange;
	c.setAttribute("option",opt);
	c.className = className || typeInfo.className;
	if(config.optionsDesc[opt])
		c.setAttribute("title",config.optionsDesc[opt]);
	place.appendChild(c);
	if(desc != "no")
		createTiddlyText(place,config.optionsDesc[opt] || opt);
	c[typeInfo.valueField] = config.options[opt];
	return c;
};

config.macros.option.genericOnChange = function(e)
{
	var opt = this.getAttribute("option");
	if(opt) {
		var optType = opt.substr(0,3);
		var handler = config.macros.option.types[optType];
		if(handler.elementType && handler.valueField)
			config.macros.option.propagateOption(opt,handler.valueField,this[handler.valueField],handler.elementType,this);
	}
	return true;
};

config.macros.option.types = {
	'txt': {
		elementType: "input",
		valueField: "value",
		eventName: "onchange",
		className: "txtOptionInput",
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	},
	'chk': {
		elementType: "input",
		valueField: "checked",
		eventName: "onclick",
		className: "chkOptionInput",
		typeValue: "checkbox",
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	}
};

config.macros.option.propagateOption = function(opt,valueField,value,elementType,elem)
{
	config.options[opt] = value;
	saveOptionCookie(opt);
	var nodes = document.getElementsByTagName(elementType);
	for(var t=0; t<nodes.length; t++) {
		var optNode = nodes[t].getAttribute("option");
		if(opt == optNode && nodes[t]!=elem)
			nodes[t][valueField] = value;
	}
};

config.macros.option.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var opt = (params[1] && params[1].name == "anon") ? params[1].value : getParam(params,"name",null);
	var className = (params[2] && params[2].name == "anon") ? params[2].value : getParam(params,"class",null);
	var desc = getParam(params,"desc","no");
	var type = opt.substr(0,3);
	var h = config.macros.option.types[type];
	if(h && h.create)
		h.create(place,type,opt,className,desc);
};

config.macros.options.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var showUnknown = getParam(params,"showUnknown","no");
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var chkUnknown = wizard.getElement("chkUnknown");
	chkUnknown.checked = showUnknown == "yes";
	chkUnknown.onchange = this.onChangeUnknown;
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	wizard.setValue("listWrapper",listWrapper);
	this.refreshOptions(listWrapper,showUnknown == "yes");
};

config.macros.options.refreshOptions = function(listWrapper,showUnknown)
{
	var opts = [];
	for(var n in config.options) {
		var opt = {};
		opt.option = "";
		opt.name = n;
		opt.lowlight = !config.optionsDesc[n];
		opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
		if(!opt.lowlight || showUnknown)
			opts.push(opt);
	}
	opts.sort(function(a,b) {return a.name.substr(3) < b.name.substr(3) ? -1 : (a.name.substr(3) == b.name.substr(3) ? 0 : +1);});
	var listview = ListView.create(listWrapper,opts,this.listViewTemplate);
	for(n=0; n<opts.length; n++) {
		var type = opts[n].name.substr(0,3);
		var h = config.macros.option.types[type];
		if(h && h.create) {
			h.create(opts[n].colElements['option'],type,opts[n].name,null,"no");
		}
	}
};

config.macros.options.onChangeUnknown = function(e)
{
	var wizard = new Wizard(this);
	var listWrapper = wizard.getValue("listWrapper");
	removeChildren(listWrapper);
	config.macros.options.refreshOptions(listWrapper,this.checked);
	return false;
};

//--
//-- Saving
//--

var saveUsingSafari = false;

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var endSaveArea = '</d' + 'iv>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
	hadConfirmExit = true;
	if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
		return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
	if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false) {
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
	}
}

function updateLanguageAttribute(s)
{
	if(config.locale) {
		var mRE = /(<html(?:.*?)?)(?: xml:lang\="([a-z]+)")?(?: lang\="([a-z]+)")?>/;
		var m = mRE.exec(s);
		if(m) {
			var t = m[1];
			if(m[2])
				t += ' xml:lang="' + config.locale + '"';
			if(m[3])
				t += ' lang="' + config.locale + '"';
			t += ">";
			s = s.substr(0,m.index) + t + s.substr(m.index+m[0].length);
		}
	}
	return s;
}

function updateMarkupBlock(s,blockName,tiddlerName)
{
	return s.replaceChunk(
			"<!--%0-START-->".format([blockName]),
			"<!--%0-END-->".format([blockName]),
			"\n" + convertUnicodeToFileFormat(store.getRecursiveTiddlerText(tiddlerName,"")) + "\n");
}

function updateOriginal(original,posDiv,localPath)
{
	if(!posDiv)
		posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return null;
	}
	var revised = original.substr(0,posDiv[0] + startSaveArea.length) + "\n" +
				convertUnicodeToFileFormat(store.allTiddlersAsHtml()) + "\n" +
				original.substr(posDiv[1]);
	var newSiteTitle = convertUnicodeToFileFormat(getPageTitle()).htmlEncode();
	revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
	revised = updateLanguageAttribute(revised);
	revised = updateMarkupBlock(revised,"PRE-HEAD","MarkupPreHead");
	revised = updateMarkupBlock(revised,"POST-HEAD","MarkupPostHead");
	revised = updateMarkupBlock(revised,"PRE-BODY","MarkupPreBody");
	revised = updateMarkupBlock(revised,"POST-SCRIPT","MarkupPostBody");
	return revised;
}

function locateStoreArea(original)
{
	// Locate the storeArea div's
	var posOpeningDiv = original.indexOf(startSaveArea);
	var limitClosingDiv = original.indexOf("<"+"!--POST-STOREAREA--"+">");
	if(limitClosingDiv == -1)
		limitClosingDiv = original.indexOf("<"+"!--POST-BODY-START--"+">");
	var posClosingDiv = original.lastIndexOf(endSaveArea,limitClosingDiv == -1 ? original.length : limitClosingDiv);
	return (posOpeningDiv != -1 && posClosingDiv != -1) ? [posOpeningDiv,posClosingDiv] : null;
}

function autoSaveChanges(onlyIfDirty,tiddlers)
{
	if(config.options.chkAutoSave)
		saveChanges(onlyIfDirty,tiddlers);
}

function loadOriginal(localPath)
{
	return loadFile(localPath);
}

// Save this tiddlywiki with the pending changes
function saveChanges(onlyIfDirty,tiddlers)
{
	if(onlyIfDirty && !store.isDirty())
		return;
	clearMessage();
	var t0 = new Date();
	var msg = config.messages;
	var originalPath = document.location.toString();
	if(originalPath.substr(0,5) != "file:") {
		alert(msg.notFileUrlError);
		if(store.tiddlerExists(msg.saveInstructions))
			story.displayTiddler(null,msg.saveInstructions);
		return;
	}
	var localPath = getLocalPath(originalPath);
	var original = loadOriginal(localPath);
	if(original == null) {
		alert(msg.cantSaveError);
		if(store.tiddlerExists(msg.saveInstructions))
			story.displayTiddler(null,msg.saveInstructions);
		return;
	}
	var posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(msg.invalidFileError.format([localPath]));
		return;
	}
	saveMain(localPath,original,posDiv);
	if(config.options.chkSaveBackups)
		saveBackup(localPath,original);
	if(config.options.chkSaveEmptyTemplate)
		saveEmpty(localPath,original,posDiv);
	if(config.options.chkGenerateAnRssFeed && saveRss instanceof Function)
		saveRss(localPath);
	if(config.options.chkDisplayInstrumentation)
		displayMessage("saveChanges " + (new Date()-t0) + " ms");
}

function saveMain(localPath,original,posDiv)
{
	var save;
	try {
		var revised = updateOriginal(original,posDiv,localPath);
		save = saveFile(localPath,revised);
	} catch (ex) {
		showException(ex);
	}
	if(save) {
		displayMessage(config.messages.mainSaved,"file://" + localPath);
		store.setDirty(false);
	} else {
		alert(config.messages.mainFailed);
	}
}

function saveBackup(localPath,original)
{
	var backupPath = getBackupPath(localPath);
	var backup = copyFile(backupPath,localPath);
	if(!backup)
		backup = saveFile(backupPath,original);
	if(backup)
		displayMessage(config.messages.backupSaved,"file://" + backupPath);
	else
		alert(config.messages.backupFailed);
}

function saveEmpty(localPath,original,posDiv)
{
	var emptyPath,p;
	if((p = localPath.lastIndexOf("/")) != -1)
		emptyPath = localPath.substr(0,p) + "/";
	else if((p = localPath.lastIndexOf("\\")) != -1)
		emptyPath = localPath.substr(0,p) + "\\";
	else
		emptyPath = localPath + ".";
	emptyPath += "empty.html";
	var empty = original.substr(0,posDiv[0] + startSaveArea.length) + original.substr(posDiv[1]);
	var emptySave = saveFile(emptyPath,empty);
	if(emptySave)
		displayMessage(config.messages.emptySaved,"file://" + emptyPath);
	else
		alert(config.messages.emptyFailed);
}

function getLocalPath(origPath)
{
	var originalPath = convertUriToUTF8(origPath,config.options.txtFileSystemCharSet);
	// Remove any location or query part of the URL
	var argPos = originalPath.indexOf("?");
	if(argPos != -1)
		originalPath = originalPath.substr(0,argPos);
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert file://localhost/ to file:///
	if(originalPath.indexOf("file://localhost/") == 0)
		originalPath = "file://" + originalPath.substr(16);
	// Convert to a native file format
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	return localPath;
}

function getBackupPath(localPath,title,extension)
{
	var slash = "\\";
	var dirPathPos = localPath.lastIndexOf("\\");
	if(dirPathPos == -1) {
		dirPathPos = localPath.lastIndexOf("/");
		slash = "/";
	}
	var backupFolder = config.options.txtBackupFolder;
	if(!backupFolder || backupFolder == "")
		backupFolder = ".";
	var backupPath = localPath.substr(0,dirPathPos) + slash + backupFolder + localPath.substr(dirPathPos);
	backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + ".";
	if(title)
		backupPath += title.replace(/[\\\/\*\?\":<> ]/g,"_") + ".";
	backupPath += (new Date()).convertToYYYYMMDDHHMMSSMMM() + "." + (extension || "html");
	return backupPath;
}

//--
//-- RSS Saving
//--

function saveRss(localPath)
{
	var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
	if(saveFile(rssPath,convertUnicodeToFileFormat(generateRss())))
		displayMessage(config.messages.rssSaved,"file://" + rssPath);
	else
		alert(config.messages.rssFailed);
}

tiddlerToRssItem = function(tiddler,uri)
{
	var s = "<title" + ">" + tiddler.title.htmlEncode() + "</title" + ">\n";
	s += "<description>" + wikifyStatic(tiddler.text,null,tiddler).htmlEncode() + "</description>\n";
	for(var i=0; i<tiddler.tags.length; i++)
		s += "<category>" + tiddler.tags[i] + "</category>\n";
	s += "<link>" + uri + "#" + encodeURIComponent(String.encodeTiddlyLink(tiddler.title)) + "</link>\n";
	s +="<pubDate>" + tiddler.modified.toGMTString() + "</pubDate>\n";
	return s;
};

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl");
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title" + ">" + wikifyPlain("SiteTitle").htmlEncode() + "</title" + ">");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + wikifyPlain("SiteSubtitle").htmlEncode() + "</description>");
	s.push("<language>" + config.locale + "</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + formatVersion() + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified","excludeLists");
	var n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
	for(var i=tiddlers.length-1; i>=n; i--) {
		s.push("<item>\n" + tiddlerToRssItem(tiddlers[i],u) + "\n</item>");
	}
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}

//--
//-- Filesystem code
//--

function convertUTF8ToUnicode(u)
{
	return config.browser.isOpera || !window.netscape ? manualConvertUTF8ToUnicode(u) : mozConvertUTF8ToUnicode(u);
}

function manualConvertUTF8ToUnicode(utf)
{
	var uni = utf;
	var src = 0;
	var dst = 0;
	var b1, b2, b3;
	var c;
	while(src < utf.length) {
		b1 = utf.charCodeAt(src++);
		if(b1 < 0x80) {
			dst++;
		} else if(b1 < 0xE0) {
			b2 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		} else {
			b2 = utf.charCodeAt(src++);
			b3 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		}
	}
	return uni;
}

function mozConvertUTF8ToUnicode(u)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUTF8ToUnicode(u);
	} // fallback
	var s = converter.ConvertToUnicode(u);
	var fin = converter.Finish();
	return fin.length > 0 ? s+fin : s;
}

function convertUnicodeToFileFormat(s)
{
	return config.browser.isOpera || !window.netscape ? (config.browser.isIE ? convertUnicodeToHtmlEntities(s) : s) : mozConvertUnicodeToUTF8(s);
}

function convertUnicodeToHtmlEntities(s)
{
	var re = /[^\u0000-\u007F]/g;
	return s.replace(re,function($0) {return "&#" + $0.charCodeAt(0).toString() + ";";});
}

function convertUnicodeToUTF8(s)
{
// return convertUnicodeToFileFormat to allow plugin migration
	return convertUnicodeToFileFormat(s);
}

function manualConvertUnicodeToUTF8(s)
{
	return unescape(encodeURIComponent(s));
}

function mozConvertUnicodeToUTF8(s)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUnicodeToUTF8(s);
	} // fallback
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	return fin.length > 0 ? u + fin : u;
}

function convertUriToUTF8(uri,charSet)
{
	if(window.netscape == undefined || charSet == undefined || charSet == "")
		return uri;
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/utf8converterservice;1"].getService(Components.interfaces.nsIUTF8ConverterService);
	} catch(ex) {
		return uri;
	}
	return converter.convertURISpecToUTF8(uri,charSet);
}

function copyFile(dest,source)
{
	return config.browser.isIE ? ieCopyFile(dest,source) : false;
}

function saveFile(fileUrl,content)
{
	var r = mozillaSaveFile(fileUrl,content);
	if(!r)
		r = ieSaveFile(fileUrl,content);
	if(!r)
		r = javaSaveFile(fileUrl,content);
	return r;
}

function loadFile(fileUrl)
{
	var r = mozillaLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = ieLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = javaLoadFile(fileUrl);
	return r;
}

function ieCreatePath(path)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}

	var pos = path.lastIndexOf("\\");
	if(pos==-1)
		pos = path.lastIndexOf("/");
	if(pos!=-1)
		path = path.substring(0,pos+1);

	var scan = [path];
	var parent = fso.GetParentFolderName(path);
	while(parent && !fso.FolderExists(parent)) {
		scan.push(parent);
		parent = fso.GetParentFolderName(parent);
	}

	for(i=scan.length-1;i>=0;i--) {
		if(!fso.FolderExists(scan[i])) {
			fso.CreateFolder(scan[i]);
		}
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath,content)
{
	ieCreatePath(filePath);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(content);
	file.Close();
	return true;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var file = fso.OpenTextFile(filePath,1);
		var content = file.ReadAll();
		file.Close();
	} catch(ex) {
		return null;
	}
	return content;
}

function ieCopyFile(dest,source)
{
	ieCreatePath(dest);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		fso.GetFile(source).Copy(dest);
	} catch(ex) {
		return false;
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath,content)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				file.create(0,0664);
			var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file,0x20|0x02,00004,null);
			out.write(content,content.length);
			out.flush();
			out.close();
			return true;
		} catch(ex) {
			return false;
		}
	}
	return null;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				return null;
			var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
			inputStream.init(file,0x01,00004,null);
			var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
			sInputStream.init(inputStream);
			var contents = sInputStream.read(sInputStream.available());
			sInputStream.close();
			inputStream.close();
			return contents;
		} catch(ex) {
			return false;
		}
	}
	return null;
}

function javaUrlToFilename(url)
{
	var f = "//localhost";
	if(url.indexOf(f) == 0)
		return url.substring(f.length);
	var i = url.indexOf(":");
	return i > 0 ? url.substring(i-1) : url;
}

function javaSaveFile(filePath,content)
{
	try {
		if(document.applets["TiddlySaver"])
			return document.applets["TiddlySaver"].saveFile(javaUrlToFilename(filePath),"UTF-8",content);
	} catch(ex) {
	}
	try {
		var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));
		s.print(content);
		s.close();
	} catch(ex) {
		return null;
	}
	return true;
}

function javaLoadFile(filePath)
{
	try {
		if(document.applets["TiddlySaver"])
			return String(document.applets["TiddlySaver"].loadFile(javaUrlToFilename(filePath),"UTF-8"));
	} catch(ex) {
	}
	var content = [];
	try {
		var r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));
		var line;
		while((line = r.readLine()) != null)
			content.push(new String(line));
		r.close();
	} catch(ex) {
		return null;
	}
	return content.join("\n");
}

//--
//-- Server adaptor base class
//--

function AdaptorBase()
{
	this.host = null;
	this.store = null;
	return this;
}

AdaptorBase.prototype.close = function()
{
	return true;
};

AdaptorBase.prototype.fullHostName = function(host)
{
	if(!host)
		return '';
	host = host.trim();
	if(!host.match(/:\/\//))
		host = 'http://' + host;
	if(host.substr(host.length-1) == '/')
		host = host.substr(0,host.length-1);
	return host;
};

AdaptorBase.minHostName = function(host)
{
	return host ? host.replace(/^http:\/\//,'').replace(/\/$/,'') : '';
};

AdaptorBase.prototype.setContext = function(context,userParams,callback)
{
	if(!context) context = {};
	context.userParams = userParams;
	if(callback) context.callback = callback;
	context.adaptor = this;
	if(!context.host)
		context.host = this.host;
	context.host = this.fullHostName(context.host);
	if(!context.workspace)
		context.workspace = this.workspace;
	return context;
};

// Open the specified host
AdaptorBase.prototype.openHost = function(host,context,userParams,callback)
{
	this.host = host;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {context.callback(context,userParams);},10);
	return true;
};

// Open the specified workspace
AdaptorBase.prototype.openWorkspace = function(workspace,context,userParams,callback)
{
	this.workspace = workspace;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

//--
//-- Server adaptor for talking to static TiddlyWiki files
//--

function FileAdaptor()
{
}

FileAdaptor.prototype = new AdaptorBase();

FileAdaptor.serverType = 'file';
FileAdaptor.serverLabel = 'TiddlyWiki';

FileAdaptor.loadTiddlyWikiCallback = function(status,context,responseText,url,xhr)
{
	context.status = status;
	if(!status) {
		context.statusText = "Error reading file";
	} else {
		context.adaptor.store = new TiddlyWiki();
		if(!context.adaptor.store.importTiddlyWiki(responseText)) {
			context.statusText = config.messages.invalidFileError.format([url]);
			context.status = false;
		}
	}
	context.complete(context,context.userParams);
};

// Get the list of workspaces on a given server
FileAdaptor.prototype.getWorkspaceList = function(context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.workspaces = [{title:"(default)"}];
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

// Gets the list of tiddlers within a given workspace
FileAdaptor.prototype.getTiddlerList = function(context,userParams,callback,filter)
{
	context = this.setContext(context,userParams,callback);
	if(!context.filter)
		context.filter = filter;
	context.complete = FileAdaptor.getTiddlerListComplete;
	if(this.store) {
		var ret = context.complete(context,context.userParams);
	} else {
		ret = loadRemoteFile(context.host,FileAdaptor.loadTiddlyWikiCallback,context);
		if(typeof ret != "string")
			ret = true;
	}
	return ret;
};

FileAdaptor.getTiddlerListComplete = function(context,userParams)
{
	if(context.status) {
		if(context.filter) {
			context.tiddlers = context.adaptor.store.filterTiddlers(context.filter);
		} else {
			context.tiddlers = [];
			context.adaptor.store.forEachTiddler(function(title,tiddler) {context.tiddlers.push(tiddler);});
		}
		for(var i=0; i<context.tiddlers.length; i++) {
			context.tiddlers[i].fields['server.type'] = FileAdaptor.serverType;
			context.tiddlers[i].fields['server.host'] = AdaptorBase.minHostName(context.host);
			context.tiddlers[i].fields['server.page.revision'] = context.tiddlers[i].modified.convertToYYYYMMDDHHMM();
		}
		context.status = true;
	}
	if(context.callback) {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.generateTiddlerInfo = function(tiddler)
{
	var info = {};
	info.uri = tiddler.fields['server.host'] + "#" + tiddler.title;
	return info;
};

// Retrieve a tiddler from a given workspace on a given server
FileAdaptor.prototype.getTiddler = function(title,context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.title = title;
	context.complete = FileAdaptor.getTiddlerComplete;
	return context.adaptor.store ?
		context.complete(context,context.userParams) :
		loadRemoteFile(context.host,FileAdaptor.loadTiddlyWikiCallback,context);
};

FileAdaptor.getTiddlerComplete = function(context,userParams)
{
	var t = context.adaptor.store.fetchTiddler(context.title);
	if(t) {
		t.fields['server.type'] = FileAdaptor.serverType;
		t.fields['server.host'] = AdaptorBase.minHostName(context.host);
		t.fields['server.page.revision'] = t.modified.convertToYYYYMMDDHHMM();
		context.tiddler = t;
		context.status = true;
	} else { //# tiddler does not exist in document
		context.status = false;
	}
	if(context.allowSynchronous) {
		context.isSynchronous = true;
		context.callback(context,userParams);
	} else {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.close = function()
{
	delete this.store;
	this.store = null;
};

config.adaptors[FileAdaptor.serverType] = FileAdaptor;

config.defaultAdaptor = FileAdaptor.serverType;

//--
//-- HTTP request code
//--

function ajaxReq(args)
{
	if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	return jQuery.ajax(args);
}

//--
//-- TiddlyWiki-specific utility functions
//--

// Returns TiddlyWiki version string
function formatVersion(v)
{
	v = v || version;
	return v.major + "." + v.minor + "." + v.revision +
		(v.alpha ? " (alpha " + v.alpha + ")" : "") +
		(v.beta ? " (beta " + v.beta + ")" : "");
}

function compareVersions(v1,v2)
{
	var a = ["major","minor","revision"];
	for(var i = 0; i<a.length; i++) {
		var x1 = v1[a[i]] || 0;
		var x2 = v2[a[i]] || 0;
		if(x1<x2)
			return 1;
		if(x1>x2)
			return -1;
	}
	x1 = v1.beta || 9999;
	x2 = v2.beta || 9999;
	if(x1<x2)
		return 1;
	return x1 > x2 ? -1 : 0;
}

function createTiddlyButton(parent,text,tooltip,action,className,id,accessKey,attribs)
{
	var btn = document.createElement("a");
	if(action) {
		btn.onclick = action;
		btn.setAttribute("href","javascript:;");
	}
	if(tooltip)
		btn.setAttribute("title",tooltip);
	if(text)
		btn.appendChild(document.createTextNode(text));
	btn.className = className || "button";
	if(id)
		btn.id = id;
	if(attribs) {
		for(var i in attribs) {
			btn.setAttribute(i,attribs[i]);
		}
	}
	if(parent)
		parent.appendChild(btn);
	if(accessKey)
		btn.setAttribute("accessKey",accessKey);
	return btn;
}

function createTiddlyLink(place,title,includeText,className,isStatic,linkedFromTiddler,noToggle)
{
	var text = includeText ? title : null;
	var i = getTiddlyLinkInfo(title,className);
	var btn = isStatic ? createExternalLink(place,store.getTiddlerText("SiteUrl",null) + "#" + title) : createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);
	if(isStatic)
		btn.className += ' ' + className;
	btn.setAttribute("refresh","link");
	btn.setAttribute("tiddlyLink",title);
	if(noToggle)
		btn.setAttribute("noToggle","true");
	if(linkedFromTiddler) {
		var fields = linkedFromTiddler.getInheritedFields();
		if(fields)
			btn.setAttribute("tiddlyFields",fields);
	}
	return btn;
}

function refreshTiddlyLink(e,title)
{
	var i = getTiddlyLinkInfo(title,e.className);
	e.className = i.classes;
	e.title = i.subTitle;
}

function getTiddlyLinkInfo(title,currClasses)
{
	var classes = currClasses ? currClasses.split(" ") : [];
	classes.pushUnique("tiddlyLink");
	var tiddler = store.fetchTiddler(title);
	var subTitle;
	if(tiddler) {
		subTitle = tiddler.getSubtitle();
		classes.pushUnique("tiddlyLinkExisting");
		classes.remove("tiddlyLinkNonExisting");
		classes.remove("shadow");
	} else {
		classes.remove("tiddlyLinkExisting");
		classes.pushUnique("tiddlyLinkNonExisting");
		if(store.isShadowTiddler(title)) {
			subTitle = config.messages.shadowedTiddlerToolTip.format([title]);
			classes.pushUnique("shadow");
		} else {
			subTitle = config.messages.undefinedTiddlerToolTip.format([title]);
			classes.remove("shadow");
		}
	}
	if(typeof config.annotations[title]=="string")
		subTitle = config.annotations[title];
	return {classes: classes.join(" "),subTitle: subTitle};
}

function createExternalLink(place,url,label)
{
	var link = document.createElement("a");
	link.className = "externalLink";
	link.href = url;
	link.title = config.messages.externalLinkTooltip.format([url]);
	if(config.options.chkOpenInNewWindow)
		link.target = "_blank";
	place.appendChild(link);
	if(label)
		createTiddlyText(link, label);
	return link;
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	var link = target;
	var title = null;
	var fields = null;
	var noToggle = null;
	do {
		title = link.getAttribute("tiddlyLink");
		fields = link.getAttribute("tiddlyFields");
		noToggle = link.getAttribute("noToggle");
		link = link.parentNode;
	} while(title == null && link != null);
	if(!store.isShadowTiddler(title)) {
		var f = fields ? fields.decodeHashMap() : {};
		fields = String.encodeHashMap(merge(f,config.defaultCustomFields,true));
	}
	if(title) {
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		if(noToggle)
			toggling = false;
		if(store.getTiddler(title))
			fields = null;
		story.displayTiddler(target,title,null,true,null,fields,toggling);
	}
	clearMessage();
	return false;
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler,title,tooltip)
{
	var btn = createTiddlyButton(place,title||tag,(tooltip||config.views.wikified.tag.tooltip).format([tag]),onClickTag);
	btn.setAttribute("tag",tag);
	if(excludeTiddler)
		btn.setAttribute("tiddler",excludeTiddler);
	return btn;
}

// Event handler for clicking on a tiddler tag
function onClickTag(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	addClass(popup,"taggedTiddlerList");
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag) {
		var tagged = tag.indexOf("[")==-1 ? store.getTaggedTiddlers(tag) : store.filterTiddlers(tag);
		var sortby = this.getAttribute("sortby");
		if(sortby&&sortby.length) {
			store.sortTiddlers(tagged,sortby);
		}
		var titles = [];
		var li,r;
		for(r=0;r<tagged.length;r++) {
			if(tagged[r].title != title)
				titles.push(tagged[r].title);
		}
		var lingo = config.views.wikified.tag;
		if(titles.length > 0) {
			var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			openAll.setAttribute("sortby",sortby);
			createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
			for(r=0; r<titles.length; r++) {
				createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
			}
		} else {
			createTiddlyElement(popup,"li",null,"disabled",lingo.popupNone.format([tag]));
		}
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
		createTiddlyText(h,lingo.openTag.format([tag]));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(ev)
{
	var tiddlers = store.getTaggedTiddlers(this.getAttribute("tag"));
	var sortby = this.getAttribute("sortby");
	if(sortby&&sortby.length) {
		store.sortTiddlers(tiddlers,sortby);
	}
	story.displayTiddlers(this,tiddlers);
	return false;
}

function onClickError(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	var lines = this.getAttribute("errorText").split("\n");
	for(var t=0; t<lines.length; t++)
		createTiddlyElement(popup,"li",null,null,lines[t]);
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyDropDown(place,onchange,options,defaultValue)
{
	var sel = createTiddlyElement(place,"select");
	sel.onchange = onchange;
	for(var t=0; t<options.length; t++) {
		var e = createTiddlyElement(sel,"option",null,null,options[t].caption);
		e.value = options[t].name;
		if(options[t].name == defaultValue)
			e.selected = true;
	}
	return sel;
}

function createTiddlyPopup(place,caption,tooltip,tiddler)
{
	if(tiddler.text) {
		createTiddlyLink(place,caption,true);
		var btn = createTiddlyButton(place,glyph("downArrow"),tooltip,onClickTiddlyPopup,"tiddlerPopupButton");
		btn.tiddler = tiddler;
	} else {
		createTiddlyText(place,caption);
	}
}

function onClickTiddlyPopup(ev)
{
	var e = ev || window.event;
	var tiddler = this.tiddler;
	if(tiddler.text) {
		var popup = Popup.create(this,"div","popupTiddler");
		wikify(tiddler.text,popup,null,tiddler);
		Popup.show();
	}
	if(e) e.cancelBubble = true;
	if(e && e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyError(place,title,text)
{
	var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
	if(text) btn.setAttribute("errorText",text);
}

function merge(dst,src,preserveExisting)
{
	for(var i in src) {
		if(!preserveExisting || dst[i] === undefined)
			dst[i] = src[i];
	}
	return dst;
}

// Returns a string containing the description of an exception, optionally prepended by a message
function exceptionText(e,message)
{
	var s = e.description || e.toString();
	return message ? "%0:\n%1".format([message,s]) : s;
}

// Displays an alert of an exception description with optional message
function showException(e,message)
{
	alert(exceptionText(e,message));
}

function alertAndThrow(m)
{
	alert(m);
	throw(m);
}

function glyph(name)
{
	var g = config.glyphs;
	var b = g.currBrowser;
	if(b == null) {
		b = 0;
		while(!g.browsers[b]() && b < g.browsers.length-1)
			b++;
		g.currBrowser = b;
	}
	if(!g.codes[name])
		return "";
	return g.codes[name][b];
}

if(!window.console) {
	console = {tiddlywiki:true,log:function(message) {displayMessage(message);}};
}

//-
//- Animation engine
//-

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID = 0; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() //# Variable number of arguments
{
	for(var t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0) {
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},10);
	}
	this.running += arguments.length;
};

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a < me.animations.length) {
		var animation = me.animations[a];
		if(animation.tick()) {
			a++;
		} else {
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
		}
	}
};

Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
};

//--
//-- Morpher animation
//--

// Animate a set of properties of an element
function Morpher(element,duration,properties,callback)
{
	this.element = element;
	this.duration = duration;
	this.properties = properties;
	this.startTime = new Date();
	this.endTime = Number(this.startTime) + duration;
	this.callback = callback;
	this.tick();
	return this;
}

Morpher.prototype.assignStyle = function(element,style,value)
{
	switch(style) {
	case "-tw-vertScroll":
		window.scrollTo(findScrollX(),value);
		break;
	case "-tw-horizScroll":
		window.scrollTo(value,findScrollY());
		break;
	default:
		element.style[style] = value;
		break;
	}
};

Morpher.prototype.stop = function()
{
	for(var t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.atEnd !== undefined) {
			this.assignStyle(this.element,p.style,p.atEnd);
		}
	}
	if(this.callback)
		this.callback(this.element,this.properties);
};

Morpher.prototype.tick = function()
{
	var currTime = Number(new Date());
	var progress = Animator.slowInSlowOut(Math.min(1,(currTime-this.startTime)/this.duration));
	for(var t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.start !== undefined && p.end !== undefined) {
			var template = p.template || "%0";
			switch(p.format) {
			case undefined:
			case "style":
				var v = p.start + (p.end-p.start) * progress;
				this.assignStyle(this.element,p.style,template.format([v]));
				break;
			case "color":
				break;
			}
		}
	}
	if(currTime >= this.endTime) {
		this.stop();
		return false;
	}
	return true;
};

//--
//-- Zoomer animation
//--

function Zoomer(text,startElement,targetElement,unused)
{
	var e = createTiddlyElement(document.body,"div",null,"zoomer");
	createTiddlyElement(e,"div",null,null,text);
	var winWidth = findWindowWidth();
	var winHeight = findWindowHeight();
	var p = [
		{style: 'left', start: findPosX(startElement), end: findPosX(targetElement), template: '%0px'},
		{style: 'top', start: findPosY(startElement), end: findPosY(targetElement), template: '%0px'},
		{style: 'width', start: Math.min(startElement.scrollWidth,winWidth), end: Math.min(targetElement.scrollWidth,winWidth), template: '%0px', atEnd: 'auto'},
		{style: 'height', start: Math.min(startElement.scrollHeight,winHeight), end: Math.min(targetElement.scrollHeight,winHeight), template: '%0px', atEnd: 'auto'},
		{style: 'fontSize', start: 8, end: 24, template: '%0pt'}
	];
	var c = function(element,properties) {removeNode(element);};
	return new Morpher(e,config.animDuration,p,c);
}

//--
//-- Scroller animation
//--

function Scroller(targetElement)
{
	var p = [{style: '-tw-vertScroll', start: findScrollY(), end: ensureVisible(targetElement)}];
	return new Morpher(targetElement,config.animDuration,p);
}

//--
//-- Slider animation
//--

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,unused,deleteMode)
{
	element.style.overflow = 'hidden';
	if(opening)
		element.style.height = '0px'; // Resolves a Firefox flashing bug
	element.style.display = 'block';
	var left = findPosX(element);
	var width = element.scrollWidth;
	var height = element.scrollHeight;
	var winWidth = findWindowWidth();
	var p = [];
	var c = null;
	if(opening) {
		p.push({style: 'height', start: 0, end: height, template: '%0px', atEnd: 'auto'});
		p.push({style: 'opacity', start: 0, end: 1, template: '%0'});
		p.push({style: 'filter', start: 0, end: 100, template: 'alpha(opacity:%0)'});
	} else {
		p.push({style: 'height', start: height, end: 0, template: '%0px'});
		p.push({style: 'display', atEnd: 'none'});
		p.push({style: 'opacity', start: 1, end: 0, template: '%0'});
		p.push({style: 'filter', start: 100, end: 0, template: 'alpha(opacity:%0)'});
		switch(deleteMode) {
		case "all":
			c = function(element,properties) {removeNode(element);};
			break;
		case "children":
			c = function(element,properties) {removeChildren(element);};
			break;
		}
	}
	return new Morpher(element,config.animDuration,p,c);
}

//--
//-- Popup menu
//--

var Popup = {
	stack: [] // Array of objects with members root: and popup:
	};

Popup.create = function(root,elem,className)
{
	var stackPosition = this.find(root,"popup");
	Popup.remove(stackPosition+1);
	var popup = createTiddlyElement(document.body,elem || "ol","popup",className || "popup");
	popup.stackPosition = stackPosition;
	Popup.stack.push({root: root, popup: popup});
	return popup;
};

Popup.onDocumentClick = function(ev)
{
	var e = ev || window.event;
	if(e.eventPhase == undefined)
		Popup.remove();
	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
		Popup.remove();
	return true;
};

Popup.show = function(valign,halign,offset)
{
	var curr = Popup.stack[Popup.stack.length-1];
	this.place(curr.root,curr.popup,valign,halign,offset);
	addClass(curr.root,"highlight");
	if(config.options.chkAnimate && anim && typeof Scroller == "function")
		anim.startAnimating(new Scroller(curr.popup));
	else
		window.scrollTo(0,ensureVisible(curr.popup));
};

Popup.place = function(root,popup,valign,halign,offset)
{
	if(!offset)
		var offset = {x:0,y:0};
	if(popup.stackPosition >= 0 && !valign && !halign) {
		offset.x = offset.x + root.offsetWidth;
	} else {
		offset.x = (halign == "right") ? offset.x + root.offsetWidth : offset.x;
		offset.y = (valign == "top") ? offset.y : offset.y + root.offsetHeight;
	}
	var rootLeft = findPosX(root);
	var rootTop = findPosY(root);
	var popupLeft = rootLeft + offset.x;
	var popupTop = rootTop + offset.y;
	var winWidth = findWindowWidth();
	if(popup.offsetWidth > winWidth*0.75)
		popup.style.width = winWidth*0.75 + "px";
	var popupWidth = popup.offsetWidth;
	var scrollWidth = winWidth - document.body.offsetWidth;
	if(popupLeft + popupWidth > winWidth - scrollWidth - 1) {
		if(halign == "right")
			popupLeft = popupLeft - root.offsetWidth - popupWidth;
		else
			popupLeft = winWidth - popupWidth - scrollWidth - 1;
	}
	popup.style.left = popupLeft + "px";
	popup.style.top = popupTop + "px";
	popup.style.display = "block";
};

Popup.find = function(e)
{
	var pos = -1;
	for (var t=this.stack.length-1; t>=0; t--) {
		if(isDescendant(e,this.stack[t].popup))
			pos = t;
	}
	return pos;
};

Popup.remove = function(pos)
{
	if(!pos) var pos = 0;
	if(Popup.stack.length > pos) {
		Popup.removeFrom(pos);
	}
};

Popup.removeFrom = function(from)
{
	for(var t=Popup.stack.length-1; t>=from; t--) {
		var p = Popup.stack[t];
		removeClass(p.root,"highlight");
		removeNode(p.popup);
	}
	Popup.stack = Popup.stack.slice(0,from);
};

//--
//-- Wizard support
//--

function Wizard(elem)
{
	if(elem) {
		this.formElem = findRelated(elem,"wizard","className");
		this.bodyElem = findRelated(this.formElem.firstChild,"wizardBody","className","nextSibling");
		this.footElem = findRelated(this.formElem.firstChild,"wizardFooter","className","nextSibling");
	} else {
		this.formElem = null;
		this.bodyElem = null;
		this.footElem = null;
	}
}

Wizard.prototype.setValue = function(name,value)
{
	if(this.formElem)
		this.formElem[name] = value;
};

Wizard.prototype.getValue = function(name)
{
	return this.formElem ? this.formElem[name] : null;
};

Wizard.prototype.createWizard = function(place,title)
{
	this.formElem = createTiddlyElement(place,"form",null,"wizard");
	createTiddlyElement(this.formElem,"h1",null,null,title);
	this.bodyElem = createTiddlyElement(this.formElem,"div",null,"wizardBody");
	this.footElem = createTiddlyElement(this.formElem,"div",null,"wizardFooter");
};

Wizard.prototype.clear = function()
{
	removeChildren(this.bodyElem);
};

Wizard.prototype.setButtons = function(buttonInfo,status)
{
	removeChildren(this.footElem);
	for(var t=0; t<buttonInfo.length; t++) {
		createTiddlyButton(this.footElem,buttonInfo[t].caption,buttonInfo[t].tooltip,buttonInfo[t].onClick);
		insertSpacer(this.footElem);
		}
	if(typeof status == "string") {
		createTiddlyElement(this.footElem,"span",null,"status",status);
	}
};

Wizard.prototype.addStep = function(stepTitle,html)
{
	removeChildren(this.bodyElem);
	var w = createTiddlyElement(this.bodyElem,"div");
	createTiddlyElement(w,"h2",null,null,stepTitle);
	var step = createTiddlyElement(w,"div",null,"wizardStep");
	step.innerHTML = html;
	applyHtmlMacros(step,tiddler);
};

Wizard.prototype.getElement = function(name)
{
	return this.formElem.elements[name];
};

//--
//-- ListView gadget
//--

var ListView = {};

// Create a listview
ListView.create = function(place,listObject,listTemplate,callback,className)
{
	var table = createTiddlyElement(place,"table",null,className || "listView twtable");
	var thead = createTiddlyElement(table,"thead");
	var r = createTiddlyElement(thead,"tr");
	for(var t=0; t<listTemplate.columns.length; t++) {
		var columnTemplate = listTemplate.columns[t];
		var c = createTiddlyElement(r,"th");
		var colType = ListView.columnTypes[columnTemplate.type];
		if(colType && colType.createHeader) {
			colType.createHeader(c,columnTemplate,t);
			if(columnTemplate.className)
				addClass(c,columnTemplate.className);
		}
	}
	var tbody = createTiddlyElement(table,"tbody");
	for(var rc=0; rc<listObject.length; rc++) {
		var rowObject = listObject[rc];
		r = createTiddlyElement(tbody,"tr");
		for(c=0; c<listTemplate.rowClasses.length; c++) {
			if(rowObject[listTemplate.rowClasses[c].field])
				addClass(r,listTemplate.rowClasses[c].className);
		}
		rowObject.rowElement = r;
		rowObject.colElements = {};
		for(var cc=0; cc<listTemplate.columns.length; cc++) {
			c = createTiddlyElement(r,"td");
			columnTemplate = listTemplate.columns[cc];
			var field = columnTemplate.field;
			colType = ListView.columnTypes[columnTemplate.type];
			if(colType && colType.createItem) {
				colType.createItem(c,rowObject,field,columnTemplate,cc,rc);
				if(columnTemplate.className)
					addClass(c,columnTemplate.className);
			}
			rowObject.colElements[field] = c;
		}
	}
	if(callback && listTemplate.actions)
		createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);
	if(callback && listTemplate.buttons) {
		for(t=0; t<listTemplate.buttons.length; t++) {
			var a = listTemplate.buttons[t];
			if(a && a.name != "")
				createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));
		}
	}
	return table;
};

ListView.getCommandHandler = function(callback,name,allowEmptySelection)
{
	return function(e) {
		var view = findRelated(this,"TABLE",null,"previousSibling");
		var tiddlers = [];
		ListView.forEachSelector(view,function(e,rowName) {
					if(e.checked)
						tiddlers.push(rowName);
					});
		if(tiddlers.length == 0 && !allowEmptySelection) {
			alert(config.messages.nothingSelected);
		} else {
			if(this.nodeName.toLowerCase() == "select") {
				callback(view,this.value,tiddlers);
				this.selectedIndex = 0;
			} else {
				callback(view,name,tiddlers);
			}
		}
	};
};

// Invoke a callback for each selector checkbox in the listview
ListView.forEachSelector = function(view,callback)
{
	var checkboxes = view.getElementsByTagName("input");
	var hadOne = false;
	for(var t=0; t<checkboxes.length; t++) {
		var cb = checkboxes[t];
		if(cb.getAttribute("type") == "checkbox") {
			var rn = cb.getAttribute("rowName");
			if(rn) {
				callback(cb,rn);
				hadOne = true;
			}
		}
	}
	return hadOne;
};

ListView.getSelectedRows = function(view)
{
	var rowNames = [];
	ListView.forEachSelector(view,function(e,rowName) {
				if(e.checked)
					rowNames.push(rowName);
				});
	return rowNames;
};

ListView.columnTypes = {};

ListView.columnTypes.String = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyText(place,columnTemplate.title);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v);
		}
};

ListView.columnTypes.WikiText = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				wikify(v,place,null,null);
		}
};

ListView.columnTypes.Tiddler = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined && v.title)
				createTiddlyPopup(place,v.title,config.messages.listView.tiddlerTooltip,v);
		}
};

ListView.columnTypes.Size = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var msg = config.messages.sizeTemplates;
			var v = listObject[field];
			if(v != undefined) {
				var t = 0;
				while(t<msg.length-1 && v<msg[t].unit)
					t++;
				createTiddlyText(place,msg[t].template.format([Math.round(v/msg[t].unit)]));
			}
		}
};

ListView.columnTypes.Link = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			var c = columnTemplate.text;
			if(v != undefined)
				createExternalLink(place,v,c || v);
		}
};

ListView.columnTypes.Date = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v.formatString(columnTemplate.dateFormat));
		}
};

ListView.columnTypes.StringList = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				for(var t=0; t<v.length; t++) {
					createTiddlyText(place,v[t]);
					createTiddlyElement(place,"br");
				}
			}
		}
};

ListView.columnTypes.Selector = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyCheckbox(place,null,false,this.onHeaderChange);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],null);
			e.setAttribute("rowName",listObject[columnTemplate.rowName]);
		},
	onHeaderChange: function(e)
		{
			var state = this.checked;
			var view = findRelated(this,"TABLE");
			if(!view)
				return;
			ListView.forEachSelector(view,function(e,rowName) {
								e.checked = state;
							});
		}
};

ListView.columnTypes.Tags = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var tags = listObject[field];
			createTiddlyText(place,String.encodeTiddlyLinkList(tags));
		}
};

ListView.columnTypes.Boolean = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			if(listObject[field] == true)
				createTiddlyText(place,columnTemplate.trueText);
			if(listObject[field] == false)
				createTiddlyText(place,columnTemplate.falseText);
		}
};

ListView.columnTypes.TagCheckbox = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);
			e.setAttribute("tiddler",listObject.title);
			e.setAttribute("tag",columnTemplate.tag);
		},
	onChange : function(e)
		{
			var tag = this.getAttribute("tag");
			var tiddler = this.getAttribute("tiddler");
			store.setTiddlerTag(tiddler,this.checked,tag);
		}
};

ListView.columnTypes.TiddlerLink = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);
				createTiddlyText(link,listObject[field]);
			}
		}
};

//--
//-- Augmented methods for the JavaScript Number(), Array(), String() and Date() objects
//--

// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	var c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return Number(c);
};

// Add indexOf function if browser does not support it
if(!Array.indexOf) {
Array.prototype.indexOf = function(item,from)
{
	if(!from)
		from = 0;
	for(var i=from; i<this.length; i++) {
		if(this[i] === item)
			return i;
	}
	return -1;
};}

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field,value)
{
	for(var t=0; t<this.length; t++) {
		if(this[t][field] === value)
			return t;
	}
	return null;
};

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
Array.prototype.setItem = function(value,mode)
{
	var p = this.indexOf(value);
	if(mode == 0)
		mode = (p == -1) ? +1 : -1;
	if(mode == +1) {
		if(p == -1)
			this.push(value);
	} else if(mode == -1) {
		if(p != -1)
			this.splice(p,1);
	}
};

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
	for(var i=0; i<items.length; i++) {
		if(this.indexOf(items[i]) != -1)
			return true;
	}
	return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
	for(var i = 0; i<items.length; i++) {
		if(this.indexOf(items[i]) == -1)
			return false;
	}
	return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique === false) {
		this.push(item);
	} else {
		if(this.indexOf(item) == -1)
			this.push(item);
	}
};

Array.prototype.remove = function(item)
{
	var p = this.indexOf(item);
	if(p != -1)
		this.splice(p,1);
};

if(!Array.prototype.map) {
Array.prototype.map = function(fn,thisObj)
{
	var scope = thisObj || window;
	var a = [];
	for(var i=0, j=this.length; i < j; ++i) {
		a.push(fn.call(scope,this[i],i,this));
	}
	return a;
};}

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	return n < this.length ? this.slice(this.length-n) : this;
};

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	return this.replace(/^\s*|\s*$/g,"");
};

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
	var s = this.split("-");
	if(s.length > 1) {
		for(var t=1; t<s.length; t++)
			s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
	}
	return s.join("");
};

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(s)
{
	var substrings = s && s.constructor == Array ? s : arguments;
	var subRegExp = /(?:%(\d+))/mg;
	var currPos = 0;
	var r = [];
	do {
		var match = subRegExp.exec(this);
		if(match && match[1]) {
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1])]);
			currPos = subRegExp.lastIndex;
		}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
};

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	var s = "\\^$*+?()=!|,{}[].";
	var c = this;
	for(var t=0; t<s.length; t++)
		c = c.replace(new RegExp("\\" + s.substr(t,1),"g"),"\\" + s.substr(t,1));
	return c;
};

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
	return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
};

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
	return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
};

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	return this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;");
};

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
	return this.replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\"").replace(/&amp;/mg,"&");
};

// Parse a space-separated string of name:value parameters
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)
{
	var parseToken = function(match,p) {
		var n;
		if(match[p]) // Double quoted
			n = match[p];
		else if(match[p+1]) // Single quoted
			n = match[p+1];
		else if(match[p+2]) // Double-square-bracket quoted
			n = match[p+2];
		else if(match[p+3]) // Double-brace quoted
			try {
				n = match[p+3];
				if(allowEval)
					n = window.eval(n);
			} catch(ex) {
				throw "Unable to evaluate {{" + match[p+3] + "}}: " + exceptionText(ex);
			}
		else if(match[p+4]) // Unquoted
			n = match[p+4];
		else if(match[p+5]) // empty quote
			n = "";
		return n;
	};
	var r = [{}];
	var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
	var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
	var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
	var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
	var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
	var emptyQuote = "((?:\"\")|(?:''))";
	var skipSpace = "(?:\\s*)";
	var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
	var re = noNames ? new RegExp(token,"mg") : new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?","mg");
	var params = [];
	do {
		var match = re.exec(this);
		if(match) {
			var n = parseToken(match,1);
			if(noNames) {
				r.push({name:"",value:n});
			} else {
				var v = parseToken(match,8);
				if(v == null && defaultName) {
					v = n;
					n = defaultName;
				} else if(v == null && defaultValue) {
					v = defaultValue;
				}
				r.push({name:n,value:v});
				if(cascadeDefaults) {
					defaultName = n;
					defaultValue = v;
				}
			}
		}
	} while(match);
	// Summarise parameters into first element
	for(var t=1; t<r.length; t++) {
		if(r[0][r[t].name])
			r[0][r[t].name].push(r[t].value);
		else
			r[0][r[t].name] = [r[t].value];
	}
	return r;
};

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function()
{
	var p = this.parseParams("list",null,true,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.push(p[t].value);
	return n;
};

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var p = this.parseParams("list",null,false,true);
	var n = [];
	for(var t=1; t<p.length; t++) {
		if(p[t].value)
			n.pushUnique(p[t].value,unique);
	}
	return n;
};

// Returns array with start and end index of chunk between given start and end marker, or undefined.
String.prototype.getChunkRange = function(start,end)
{
	var s = this.indexOf(start);
	if(s != -1) {
		s += start.length;
		var e = this.indexOf(end,s);
		if(e != -1)
			return [s,e];
	}
};

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
	var r = this.getChunkRange(start,end);
	return r ? this.substring(0,r[0]) + sub + this.substring(r[1]) : this;
};

// Returns a chunk of a string between start and end markers, or undefined
String.prototype.getChunk = function(start,end)
{
	var r = this.getChunkRange(start,end);
	if(r)
		return this.substring(r[0],r[1]);
};


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	return title.indexOf(" ") == -1 ? title : "[[" + title + "]]";
};

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
	if(list) {
		var results = [];
		for(var t=0; t<list.length; t++)
			results.push(String.encodeTiddlyLink(list[t]));
		return results.join(" ");
	} else {
		return "";
	}
};

// Convert a string as a sequence of name:"value" pairs into a hashmap
String.prototype.decodeHashMap = function()
{
	var fields = this.parseParams("anon","",false);
	var r = {};
	for(var t=1; t<fields.length; t++)
		r[fields[t].name] = fields[t].value;
	return r;
};

// Static method to encode a hashmap into a name:"value"... string
String.encodeHashMap = function(hashmap)
{
	var r = [];
	for(var t in hashmap)
		r.push(t + ':"' + hashmap[t] + '"');
	return r.join(" ");
};

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return s;
};

String.prototype.startsWith = function(prefix)
{
	return !prefix || this.substring(0,prefix.length) == prefix;
};

// Returns the first value of the given named parameter.
function getParam(params,name,defaultValue)
{
	if(!params)
		return defaultValue;
	var p = params[0][name];
	return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
function getFlag(params,name,defaultValue)
{
	return !!getParam(params,name,defaultValue);
}

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
	t = t.replace(/hh12/g,this.getHours12());
	t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
	t = t.replace(/hh/g,this.getHours());
	t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
	t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
	t = t.replace(/mm/g,this.getMinutes());
	t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
	t = t.replace(/ss/g,this.getSeconds());
	t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
	t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
	t = t.replace(/wYYYY/g,this.getYearForWeekNo());
	t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
	t = t.replace(/YYYY/g,this.getFullYear());
	t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
	t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
	t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
	t = t.replace(/MM/g,this.getMonth()+1);
	t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
	t = t.replace(/WW/g,this.getWeek());
	t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
	t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
	t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
	t = t.replace(/DDth/g,this.getDate()+this.daySuffix());
	t = t.replace(/DD/g,this.getDate());
	var tz = this.getTimezoneOffset();
	var atz = Math.abs(tz);
	t = t.replace(/TZD/g,(tz < 0 ? '+' : '-') + String.zeroPad(Math.floor(atz / 60),2) + ':' + String.zeroPad(atz % 60,2));
	t = t.replace(/\\/g,"");
	return t;
};

Date.prototype.getWeek = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo
	var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000);
	return Math.floor(n/7)+1;
};

Date.prototype.getYearForWeekNo = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week
	return dt.getFullYear();
};

Date.prototype.getHours12 = function()
{
	var h = this.getHours();
	return h > 12 ? h-12 : ( h > 0 ? h : 12 );
};

Date.prototype.getAmPm = function()
{
	return this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;
};

Date.prototype.daySuffix = function()
{
	return config.messages.dates.daySuffixes[this.getDate()-1];
};

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
	return this.getFullYear() + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2);
};

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2);
};

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),3) +"0";
};

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	d = d?d.replace(/[^0-9]/g, ""):""; 
	return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,12));
};

// Static method to create a date from a UTC YYYYMMDDHHMMSS format string
Date.convertFromYYYYMMDDHHMMSS = function(d)
{
	d = d?d.replace(/[^0-9]/g, ""):""; 
	return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,14));
};

// Static method to create a date from a UTC YYYYMMDDHHMMSSMMM format string
Date.convertFromYYYYMMDDHHMMSSMMM = function(d)
{
	d = d ? d.replace(/[^0-9]/g, "") : "";
	return new Date(Date.UTC(parseInt(d.substr(0,4),10),
			parseInt(d.substr(4,2),10)-1,
			parseInt(d.substr(6,2),10),
			parseInt(d.substr(8,2)||"00",10),
			parseInt(d.substr(10,2)||"00",10),
			parseInt(d.substr(12,2)||"00",10),
			parseInt(d.substr(14,3)||"000",10)));
};

//--
//-- RGB colour object
//--

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string") {
		if(r.substr(0,1) == "#") {
			if(r.length == 7) {
				this.r = parseInt(r.substr(1,2),16)/255;
				this.g = parseInt(r.substr(3,2),16)/255;
				this.b = parseInt(r.substr(5,2),16)/255;
			} else {
				this.r = parseInt(r.substr(1,1),16)/15;
				this.g = parseInt(r.substr(2,1),16)/15;
				this.b = parseInt(r.substr(3,1),16)/15;
			}
		} else {
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/;
			var c = r.match(rgbPattern);
			if(c) {
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
			}
		}
	} else {
		this.r = r;
		this.g = g;
		this.b = b;
	}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
};

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	return "#" + ("0" + Math.floor(this.r.clamp(0,1) * 255).toString(16)).right(2) +
				 ("0" + Math.floor(this.g.clamp(0,1) * 255).toString(16)).right(2) +
				 ("0" + Math.floor(this.b.clamp(0,1) * 255).toString(16)).right(2);
};

//--
//-- DOM utilities - many derived from www.quirksmode.org
//--

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if(e.target)
		obj = e.target;
	else if(e.srcElement)
		obj = e.srcElement;
	if(obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return obj;
}

function drawGradient(place,horiz,locolors,hicolors)
{
	if(!hicolors)
		hicolors = locolors;
	for(var t=0; t<= 100; t+=2) {
		var bar = document.createElement("div");
		place.appendChild(bar);
		bar.style.position = "absolute";
		bar.style.left = horiz ? t + "%" : 0;
		bar.style.top = horiz ? 0 : t + "%";
		bar.style.width = horiz ? (101-t) + "%" : "100%";
		bar.style.height = horiz ? "100%" : (101-t) + "%";
		bar.style.zIndex = -1;
		var p = t/100*(locolors.length-1);
		var hc = hicolors[Math.floor(p)];
		if(typeof hc == "string")
			hc = new RGB(hc);
		var lc = locolors[Math.ceil(p)];
		if(typeof lc == "string")
			lc = new RGB(lc);
		bar.style.backgroundColor = hc.mix(lc,p-Math.floor(p)).toString();
	}
}

function createTiddlyText(parent,text)
{
	return parent.appendChild(document.createTextNode(text));
}

function createTiddlyCheckbox(parent,caption,checked,onChange)
{
	var cb = document.createElement("input");
	cb.setAttribute("type","checkbox");
	cb.onclick = onChange;
	parent.appendChild(cb);
	cb.checked = checked;
	cb.className = "chkOptionInput";
	if(caption)
		wikify(caption,parent);
	return cb;
}

function createTiddlyElement(parent,element,id,className,text,attribs)
{
	var e = document.createElement(element);
	if(className != null)
		e.className = className;
	if(id != null)
		e.setAttribute("id",id);
	if(text != null)
		e.appendChild(document.createTextNode(text));
	if(attribs) {
		for(var n in attribs) {
			e.setAttribute(n,attribs[n]);
		}
	}
	if(parent != null)
		parent.appendChild(e);
	return e;
}

function addEvent(obj,type,fn)
{
	if(obj.attachEvent) {
		obj["e"+type+fn] = fn;
		obj[type+fn] = function(){obj["e"+type+fn](window.event);};
		obj.attachEvent("on"+type,obj[type+fn]);
	} else {
		obj.addEventListener(type,fn,false);
	}
}

function removeEvent(obj,type,fn)
{
	if(obj.detachEvent) {
		obj.detachEvent("on"+type,obj[type+fn]);
		obj[type+fn] = null;
	} else {
		obj.removeEventListener(type,fn,false);
	}
}


// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e,value,name,relative)
{
	name = name || "tagName";
	relative = relative || "parentNode";
	if(name == "className") {
		while(e && !hasClass(e,value)) {
			e = e[relative];
		}
	} else {
		while(e && e[name] != value) {
			e = e[relative];
		}
	}
	return e;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop) {
		return posTop;
	} else if(posBot > winBot) {
		if(e.offsetHeight < winHeight)
			return posTop - (winHeight - e.offsetHeight);
		else
			return posTop;
	} else {
		return winTop;
	}
}

// Get the current width of the display window
function findWindowWidth()
{
	return window.innerWidth || document.documentElement.clientWidth;
}

// Get the current height of the display window
function findWindowHeight()
{
	return window.innerHeight || document.documentElement.clientHeight;
}

// Get the current horizontal page scroll position
function findScrollX()
{
	return window.scrollX || document.documentElement.scrollLeft;
}

// Get the current vertical page scroll position
function findScrollY()
{
	return window.scrollY || document.documentElement.scrollTop;
}

function findPosX(obj)
{
	var curleft = 0;
	while(obj.offsetParent) {
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
	}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while(obj.offsetParent) {
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
	}
	return curtop;
}

// Blur a particular element
function blurElement(e)
{
	if(e && e.focus && e.blur) {
		e.focus();
		e.blur();
	}
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Force the browser to do a document reflow when needed to workaround browser bugs
function forceReflow()
{
	if(config.browser.isGecko) {
		setStylesheet("body {top:0px;margin-top:0px;}","forceReflow");
		setTimeout(function() {setStylesheet("","forceReflow");},1);
	}
}

// Replace the current selection of a textarea or text input and scroll it into view
function replaceSelection(e,text)
{
	if(e.setSelectionRange) {
		var oldpos = e.selectionStart;
		var isRange = e.selectionEnd > e.selectionStart;
		e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionEnd);
		e.setSelectionRange(isRange ? oldpos : oldpos + text.length,oldpos + text.length);
		var linecount = e.value.split("\n").length;
		var thisline = e.value.substr(0,e.selectionStart).split("\n").length-1;
		e.scrollTop = Math.floor((thisline - e.rows / 2) * e.scrollHeight / linecount);
	} else if(document.selection) {
		var range = document.selection.createRange();
		if(range.parentElement() == e) {
			var isCollapsed = range.text == "";
			range.text = text;
			if(!isCollapsed) {
				range.moveStart("character", -text.length);
				range.select();
			}
		}
	}
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
	var t = "";
	while(e && e.nodeName == "#text") {
		t += e.nodeValue;
		e = e.nextSibling;
	}
	return t;
}

// Returns true if the element e has a given ancestor element
function isDescendant(e,ancestor)
{
	while(e) {
		if(e === ancestor)
			return true;
		e = e.parentNode;
	}
	return false;
}


// deprecate the following...

// Prevent an event from bubbling
function stopEvent(e)
{
	var ev = e || window.event;
	ev.cancelBubble = true;
	if(ev.stopPropagation) ev.stopPropagation();
	return false;
}

// Remove any event handlers or non-primitve custom attributes
function scrubNode(e)
{
	if(!config.browser.isIE)
		return;
	var att = e.attributes;
	if(att) {
		for(var t=0; t<att.length; t++) {
			var n = att[t].name;
			if(n !== "style" && (typeof e[n] === "function" || (typeof e[n] === "object" && e[n] != null))) {
				try {
					e[n] = null;
				} catch(ex) {
				}
			}
		}
	}
	var c = e.firstChild;
	while(c) {
		scrubNode(c);
		c = c.nextSibling;
	}
}

function addClass(e,className)
{
	jQuery(e).addClass(className);
}

function removeClass(e,className)
{
	jQuery(e).removeClass(className);
}

function hasClass(e,className)
{
	return jQuery(e).hasClass(className);
}

// Remove all children of a node
function removeChildren(e)
{
	jQuery(e).empty();
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
	return jQuery(e).text();
}

// Remove a node and all it's children
function removeNode(e)
{
	jQuery(e).remove();
}

//--
//-- LoaderBase and SaverBase
//--

function LoaderBase() {}

LoaderBase.prototype.loadTiddler = function(store,node,tiddlers)
{
	var title = this.getTitle(store,node);
	if(safeMode && store.isShadowTiddler(title))
		return;
	if(title) {
		var tiddler = store.createTiddler(title);
		this.internalizeTiddler(store,tiddler,title,node);
		tiddlers.push(tiddler);
	}
};

LoaderBase.prototype.loadTiddlers = function(store,nodes)
{
	var tiddlers = [];
	for(var t = 0; t < nodes.length; t++) {
		try {
			this.loadTiddler(store,nodes[t],tiddlers);
		} catch(ex) {
			showException(ex,config.messages.tiddlerLoadError.format([this.getTitle(store,nodes[t])]));
		}
	}
	return tiddlers;
};

function SaverBase() {}

SaverBase.prototype.externalize = function(store)
{
	var results = [];
	var tiddlers = store.getTiddlers("title");
	for(var t = 0; t < tiddlers.length; t++) {
		if(!tiddlers[t].doNotSave())
			results.push(this.externalizeTiddler(store, tiddlers[t]));
	}
	return results.join("\n");
};

//--
//-- TW21Loader (inherits from LoaderBase)
//--

function TW21Loader() {}

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store,node)
{
	var title = null;
	if(node.getAttribute) {
		title = node.getAttribute("title");
		if(!title)
			title = node.getAttribute("tiddler");
	}
	if(!title && node.id) {
		var lenPrefix = store.idPrefix.length;
		if(node.id.substr(0,lenPrefix) == store.idPrefix)
			title = node.id.substr(lenPrefix);
	}
	return title;
};

TW21Loader.prototype.internalizeTiddler = function(store,tiddler,title,node)
{
	var e = node.firstChild;
	var text = null;
	if(node.getAttribute("tiddler")) {
		text = getNodeText(e).unescapeLineBreaks();
	} else {
		while(e.nodeName!="PRE" && e.nodeName!="pre") {
			e = e.nextSibling;
		}
		text = e.innerHTML.replace(/\r/mg,"").htmlDecode();
	}
	var creator = node.getAttribute("creator");
	var modifier = node.getAttribute("modifier");
	var c = node.getAttribute("created");
	var m = node.getAttribute("modified");
	var created = c ? Date.convertFromYYYYMMDDHHMMSS(c) : version.date;
	var modified = m ? Date.convertFromYYYYMMDDHHMMSS(m) : created;
	var tags = node.getAttribute("tags");
	var fields = {};
	var attrs = node.attributes;
	for(var i = attrs.length-1; i >= 0; i--) {
		var name = attrs[i].name;
		if(attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
			fields[name] = attrs[i].value.unescapeLineBreaks();
		}
	}
	tiddler.assign(title,text,modifier,modified,tags,created,fields,creator);
	return tiddler;
};

//--
//-- TW21Saver (inherits from SaverBase)
//--

function TW21Saver() {}

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store,tiddler)
{
	try {
		var extendedAttributes = "";
		var usePre = config.options.chkUsePreForStorage;
		store.forEachField(tiddler,
			function(tiddler,fieldName,value) {
				// don't store stuff from the temp namespace
				if(typeof value != "string")
					value = "";
				if(!fieldName.match(/^temp\./))
					extendedAttributes += ' %0="%1"'.format([fieldName,value.escapeLineBreaks().htmlEncode()]);
			},true);
		var created = tiddler.created;
		var modified = tiddler.modified;
		var attributes = tiddler.creator ? ' creator="' + tiddler.creator.htmlEncode() + '"' : "";
		attributes += tiddler.modifier ? ' modifier="' + tiddler.modifier.htmlEncode() + '"' : "";
		attributes += (usePre && created == version.date) ? "" :' created="' + created.convertToYYYYMMDDHHMM() + '"';
		attributes += (usePre && modified == created) ? "" : ' modified="' + modified.convertToYYYYMMDDHHMM() +'"';
		var tags = tiddler.getTags();
		if(!usePre || tags)
			attributes += ' tags="' + tags.htmlEncode() + '"';
		return ('<div %0="%1"%2%3>%4</'+'div>').format([
				usePre ? "title" : "tiddler",
				tiddler.title.htmlEncode(),
				attributes,
				extendedAttributes,
				usePre ? "\n<pre>" + tiddler.text.htmlEncode() + "</pre>\n" : tiddler.text.escapeLineBreaks().htmlEncode()
			]);
	} catch (ex) {
		throw exceptionText(ex,config.messages.tiddlerSaveError.format([tiddler.title]));
	}
};

//]]>
</script>
<script id="jsdeprecatedArea" type="text/javascript">
//<![CDATA[
//--
//-- Deprecated Crypto functions and associated conversion routines.
//-- Use the jQuery.encoding functions directly instead.
//--

// Crypto 'namespace'
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
	return jQuery.encoding.strToBe32s(str);
};

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
	return jQuery.encoding.be32sToStr(be);
};

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
	return jQuery.encoding.be32sToHex(be);
};

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
	return jQuery.encoding.digests.hexSha1Str(str);
};

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
	return jQuery.encoding.digests.sha1Str(str);
};

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
	return jQuery.encoding.digests.sha1(x,blen);
};

//--
//-- Deprecated DOM utilities
//--

// @Deprecated: Use jQuery.stylesheet instead
function setStylesheet(s,id,doc)
{
	jQuery.twStylesheet(s,{ id: id, doc: doc });
}

// @Deprecated: Use jQuery.stylesheet.remove instead
function removeStyleSheet(id)
{
	jQuery.twStylesheet.remove({ id: id });
}
//--
//-- Deprecated HTTP request code
//-- Use the jQuery ajax functions directly instead
//--

function loadRemoteFile(url,callback,params)
{
	return httpReq("GET",url,callback,params);
}

function doHttp(type,url,data,contentType,username,password,callback,params,headers,allowCache)
{
	return httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache);
}

function httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache)
{
	var options = {
		type:type,
		url:url,
		processData:false,
		data:data,
		cache:!!allowCache,
		beforeSend: function(xhr) {
			for(var i in headers)
				xhr.setRequestHeader(i,headers[i]);
			xhr.setRequestHeader("X-Requested-With", "TiddlyWiki " + formatVersion());
		}
	};

	if(callback) {
		options.complete = function(xhr,textStatus) {
			if(jQuery.httpSuccess(xhr))
				callback(true,params,xhr.responseText,url,xhr);
			else
				callback(false,params,null,url,xhr);
		};
	}
	if(contentType)
		options.contentType = contentType;
	if(username)
		options.username = username;
	if(password)
		options.password = password;
	if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	return jQuery.ajax(options);
}

//--
//-- Deprecated String functions
//--

// @Deprecated: no direct replacement, since not used in core code
String.prototype.toJSONString = function()
{
	// Convert a string to it's JSON representation by encoding control characters, double quotes and backslash. See json.org
	var m = {
		'\b': '\\b',
		'\f': '\\f',
		'\n': '\\n',
		'\r': '\\r',
		'\t': '\\t',
		'"' : '\\"',
		'\\': '\\\\'
		};
	var replaceFn = function(a,b) {
		var c = m[b];
		if(c)
			return c;
		c = b.charCodeAt();
		return '\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
		};
	if(/["\\\x00-\x1f]/.test(this))
		return '"' + this.replace(/([\x00-\x1f\\"])/g,replaceFn) + '"';
	return '"' + this + '"';
};

//--
//-- Deprecated Tiddler code
//--

// @Deprecated: Use tiddlerToRssItem(tiddler,uri) instead
Tiddler.prototype.toRssItem = function(uri)
{
	return tiddlerToRssItem(this,uri);
};

// @Deprecated: Use "<item>\n" + tiddlerToRssItem(tiddler,uri)  + "\n</item>" instead
Tiddler.prototype.saveToRss = function(uri)
{
	return "<item>\n" + tiddlerToRssItem(this,uri) + "\n</item>";
};

// @Deprecated: Use jQuery.encoding.digests.hexSha1Str instead
Tiddler.prototype.generateFingerprint = function()
{
	return "0x" + Crypto.hexSha1Str(this.text);
};

//]]>
</script>
<script id="jslibArea" type="text/javascript">
//<![CDATA[
/*!
 * jQuery JavaScript Library v1.4.2
 * http://jquery.com/
 *
 * Copyright 2010, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 * Copyright 2010, The Dojo Foundation
 * Released under the MIT, BSD, and GPL Licenses.
 *
 * Date: Sat Feb 13 22:33:48 2010 -0500
 */
(function(A,w){function ma(){if(!c.isReady){try{s.documentElement.doScroll("left")}catch(a){setTimeout(ma,1);return}c.ready()}}function Qa(a,b){b.src?c.ajax({url:b.src,async:false,dataType:"script"}):c.globalEval(b.text||b.textContent||b.innerHTML||"");b.parentNode&&b.parentNode.removeChild(b)}function X(a,b,d,f,e,j){var i=a.length;if(typeof b==="object"){for(var o in b)X(a,o,b[o],f,e,d);return a}if(d!==w){f=!j&&f&&c.isFunction(d);for(o=0;o<i;o++)e(a[o],b,f?d.call(a[o],o,e(a[o],b)):d,j);return a}return i?
e(a[0],b):w}function J(){return(new Date).getTime()}function Y(){return false}function Z(){return true}function na(a,b,d){d[0].type=a;return c.event.handle.apply(b,d)}function oa(a){var b,d=[],f=[],e=arguments,j,i,o,k,n,r;i=c.data(this,"events");if(!(a.liveFired===this||!i||!i.live||a.button&&a.type==="click")){a.liveFired=this;var u=i.live.slice(0);for(k=0;k<u.length;k++){i=u[k];i.origType.replace(O,"")===a.type?f.push(i.selector):u.splice(k--,1)}j=c(a.target).closest(f,a.currentTarget);n=0;for(r=
j.length;n<r;n++)for(k=0;k<u.length;k++){i=u[k];if(j[n].selector===i.selector){o=j[n].elem;f=null;if(i.preType==="mouseenter"||i.preType==="mouseleave")f=c(a.relatedTarget).closest(i.selector)[0];if(!f||f!==o)d.push({elem:o,handleObj:i})}}n=0;for(r=d.length;n<r;n++){j=d[n];a.currentTarget=j.elem;a.data=j.handleObj.data;a.handleObj=j.handleObj;if(j.handleObj.origHandler.apply(j.elem,e)===false){b=false;break}}return b}}function pa(a,b){return"live."+(a&&a!=="*"?a+".":"")+b.replace(/\./g,"`").replace(/ /g,
"&")}function qa(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function ra(a,b){var d=0;b.each(function(){if(this.nodeName===(a[d]&&a[d].nodeName)){var f=c.data(a[d++]),e=c.data(this,f);if(f=f&&f.events){delete e.handle;e.events={};for(var j in f)for(var i in f[j])c.event.add(this,j,f[j][i],f[j][i].data)}}})}function sa(a,b,d){var f,e,j;b=b&&b[0]?b[0].ownerDocument||b[0]:s;if(a.length===1&&typeof a[0]==="string"&&a[0].length<512&&b===s&&!ta.test(a[0])&&(c.support.checkClone||!ua.test(a[0]))){e=
true;if(j=c.fragments[a[0]])if(j!==1)f=j}if(!f){f=b.createDocumentFragment();c.clean(a,b,f,d)}if(e)c.fragments[a[0]]=j?f:1;return{fragment:f,cacheable:e}}function K(a,b){var d={};c.each(va.concat.apply([],va.slice(0,b)),function(){d[this]=a});return d}function wa(a){return"scrollTo"in a&&a.document?a:a.nodeType===9?a.defaultView||a.parentWindow:false}var c=function(a,b){return new c.fn.init(a,b)},Ra=A.jQuery,Sa=A.$,s=A.document,T,Ta=/^[^<]*(<[\w\W]+>)[^>]*$|^#([\w-]+)$/,Ua=/^.[^:#\[\.,]*$/,Va=/\S/,
Wa=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,Xa=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,P=navigator.userAgent,xa=false,Q=[],L,$=Object.prototype.toString,aa=Object.prototype.hasOwnProperty,ba=Array.prototype.push,R=Array.prototype.slice,ya=Array.prototype.indexOf;c.fn=c.prototype={init:function(a,b){var d,f;if(!a)return this;if(a.nodeType){this.context=this[0]=a;this.length=1;return this}if(a==="body"&&!b){this.context=s;this[0]=s.body;this.selector="body";this.length=1;return this}if(typeof a==="string")if((d=Ta.exec(a))&&
(d[1]||!b))if(d[1]){f=b?b.ownerDocument||b:s;if(a=Xa.exec(a))if(c.isPlainObject(b)){a=[s.createElement(a[1])];c.fn.attr.call(a,b,true)}else a=[f.createElement(a[1])];else{a=sa([d[1]],[f]);a=(a.cacheable?a.fragment.cloneNode(true):a.fragment).childNodes}return c.merge(this,a)}else{if(b=s.getElementById(d[2])){if(b.id!==d[2])return T.find(a);this.length=1;this[0]=b}this.context=s;this.selector=a;return this}else if(!b&&/^\w+$/.test(a)){this.selector=a;this.context=s;a=s.getElementsByTagName(a);return c.merge(this,
a)}else return!b||b.jquery?(b||T).find(a):c(b).find(a);else if(c.isFunction(a))return T.ready(a);if(a.selector!==w){this.selector=a.selector;this.context=a.context}return c.makeArray(a,this)},selector:"",jquery:"1.4.2",length:0,size:function(){return this.length},toArray:function(){return R.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this.slice(a)[0]:this[a]},pushStack:function(a,b,d){var f=c();c.isArray(a)?ba.apply(f,a):c.merge(f,a);f.prevObject=this;f.context=this.context;if(b===
"find")f.selector=this.selector+(this.selector?" ":"")+d;else if(b)f.selector=this.selector+"."+b+"("+d+")";return f},each:function(a,b){return c.each(this,a,b)},ready:function(a){c.bindReady();if(c.isReady)a.call(s,c);else Q&&Q.push(a);return this},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(R.apply(this,arguments),"slice",R.call(arguments).join(","))},map:function(a){return this.pushStack(c.map(this,
function(b,d){return a.call(b,d,b)}))},end:function(){return this.prevObject||c(null)},push:ba,sort:[].sort,splice:[].splice};c.fn.init.prototype=c.fn;c.extend=c.fn.extend=function(){var a=arguments[0]||{},b=1,d=arguments.length,f=false,e,j,i,o;if(typeof a==="boolean"){f=a;a=arguments[1]||{};b=2}if(typeof a!=="object"&&!c.isFunction(a))a={};if(d===b){a=this;--b}for(;b<d;b++)if((e=arguments[b])!=null)for(j in e){i=a[j];o=e[j];if(a!==o)if(f&&o&&(c.isPlainObject(o)||c.isArray(o))){i=i&&(c.isPlainObject(i)||
c.isArray(i))?i:c.isArray(o)?[]:{};a[j]=c.extend(f,i,o)}else if(o!==w)a[j]=o}return a};c.extend({noConflict:function(a){A.$=Sa;if(a)A.jQuery=Ra;return c},isReady:false,ready:function(){if(!c.isReady){if(!s.body)return setTimeout(c.ready,13);c.isReady=true;if(Q){for(var a,b=0;a=Q[b++];)a.call(s,c);Q=null}c.fn.triggerHandler&&c(s).triggerHandler("ready")}},bindReady:function(){if(!xa){xa=true;if(s.readyState==="complete")return c.ready();if(s.addEventListener){s.addEventListener("DOMContentLoaded",
L,false);A.addEventListener("load",c.ready,false)}else if(s.attachEvent){s.attachEvent("onreadystatechange",L);A.attachEvent("onload",c.ready);var a=false;try{a=A.frameElement==null}catch(b){}s.documentElement.doScroll&&a&&ma()}}},isFunction:function(a){return $.call(a)==="[object Function]"},isArray:function(a){return $.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||$.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!aa.call(a,"constructor")&&!aa.call(a.constructor.prototype,
"isPrototypeOf"))return false;var b;for(b in a);return b===w||aa.call(a,b)},isEmptyObject:function(a){for(var b in a)return false;return true},error:function(a){throw a;},parseJSON:function(a){if(typeof a!=="string"||!a)return null;a=c.trim(a);if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return A.JSON&&A.JSON.parse?A.JSON.parse(a):(new Function("return "+
a))();else c.error("Invalid JSON: "+a)},noop:function(){},globalEval:function(a){if(a&&Va.test(a)){var b=s.getElementsByTagName("head")[0]||s.documentElement,d=s.createElement("script");d.type="text/javascript";if(c.support.scriptEval)d.appendChild(s.createTextNode(a));else d.text=a;b.insertBefore(d,b.firstChild);b.removeChild(d)}},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,b,d){var f,e=0,j=a.length,i=j===w||c.isFunction(a);if(d)if(i)for(f in a){if(b.apply(a[f],
d)===false)break}else for(;e<j;){if(b.apply(a[e++],d)===false)break}else if(i)for(f in a){if(b.call(a[f],f,a[f])===false)break}else for(d=a[0];e<j&&b.call(d,e,d)!==false;d=a[++e]);return a},trim:function(a){return(a||"").replace(Wa,"")},makeArray:function(a,b){b=b||[];if(a!=null)a.length==null||typeof a==="string"||c.isFunction(a)||typeof a!=="function"&&a.setInterval?ba.call(b,a):c.merge(b,a);return b},inArray:function(a,b){if(b.indexOf)return b.indexOf(a);for(var d=0,f=b.length;d<f;d++)if(b[d]===
a)return d;return-1},merge:function(a,b){var d=a.length,f=0;if(typeof b.length==="number")for(var e=b.length;f<e;f++)a[d++]=b[f];else for(;b[f]!==w;)a[d++]=b[f++];a.length=d;return a},grep:function(a,b,d){for(var f=[],e=0,j=a.length;e<j;e++)!d!==!b(a[e],e)&&f.push(a[e]);return f},map:function(a,b,d){for(var f=[],e,j=0,i=a.length;j<i;j++){e=b(a[j],j,d);if(e!=null)f[f.length]=e}return f.concat.apply([],f)},guid:1,proxy:function(a,b,d){if(arguments.length===2)if(typeof b==="string"){d=a;a=d[b];b=w}else if(b&&
!c.isFunction(b)){d=b;b=w}if(!b&&a)b=function(){return a.apply(d||this,arguments)};if(a)b.guid=a.guid=a.guid||b.guid||c.guid++;return b},uaMatch:function(a){a=a.toLowerCase();a=/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||!/compatible/.test(a)&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(a)||[];return{browser:a[1]||"",version:a[2]||"0"}},browser:{}});P=c.uaMatch(P);if(P.browser){c.browser[P.browser]=true;c.browser.version=P.version}if(c.browser.webkit)c.browser.safari=
true;if(ya)c.inArray=function(a,b){return ya.call(b,a)};T=c(s);if(s.addEventListener)L=function(){s.removeEventListener("DOMContentLoaded",L,false);c.ready()};else if(s.attachEvent)L=function(){if(s.readyState==="complete"){s.detachEvent("onreadystatechange",L);c.ready()}};(function(){c.support={};var a=s.documentElement,b=s.createElement("script"),d=s.createElement("div"),f="script"+J();d.style.display="none";d.innerHTML="   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>";
var e=d.getElementsByTagName("*"),j=d.getElementsByTagName("a")[0];if(!(!e||!e.length||!j)){c.support={leadingWhitespace:d.firstChild.nodeType===3,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/red/.test(j.getAttribute("style")),hrefNormalized:j.getAttribute("href")==="/a",opacity:/^0.55$/.test(j.style.opacity),cssFloat:!!j.style.cssFloat,checkOn:d.getElementsByTagName("input")[0].value==="on",optSelected:s.createElement("select").appendChild(s.createElement("option")).selected,
parentNode:d.removeChild(d.appendChild(s.createElement("div"))).parentNode===null,deleteExpando:true,checkClone:false,scriptEval:false,noCloneEvent:true,boxModel:null};b.type="text/javascript";try{b.appendChild(s.createTextNode("window."+f+"=1;"))}catch(i){}a.insertBefore(b,a.firstChild);if(A[f]){c.support.scriptEval=true;delete A[f]}try{delete b.test}catch(o){c.support.deleteExpando=false}a.removeChild(b);if(d.attachEvent&&d.fireEvent){d.attachEvent("onclick",function k(){c.support.noCloneEvent=
false;d.detachEvent("onclick",k)});d.cloneNode(true).fireEvent("onclick")}d=s.createElement("div");d.innerHTML="<input type='radio' name='radiotest' checked='checked'/>";a=s.createDocumentFragment();a.appendChild(d.firstChild);c.support.checkClone=a.cloneNode(true).cloneNode(true).lastChild.checked;c(function(){var k=s.createElement("div");k.style.width=k.style.paddingLeft="1px";s.body.appendChild(k);c.boxModel=c.support.boxModel=k.offsetWidth===2;s.body.removeChild(k).style.display="none"});a=function(k){var n=
s.createElement("div");k="on"+k;var r=k in n;if(!r){n.setAttribute(k,"return;");r=typeof n[k]==="function"}return r};c.support.submitBubbles=a("submit");c.support.changeBubbles=a("change");a=b=d=e=j=null}})();c.props={"for":"htmlFor","class":"className",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",colspan:"colSpan",tabindex:"tabIndex",usemap:"useMap",frameborder:"frameBorder"};var G="jQuery"+J(),Ya=0,za={};c.extend({cache:{},expando:G,noData:{embed:true,object:true,
applet:true},data:function(a,b,d){if(!(a.nodeName&&c.noData[a.nodeName.toLowerCase()])){a=a==A?za:a;var f=a[G],e=c.cache;if(!f&&typeof b==="string"&&d===w)return null;f||(f=++Ya);if(typeof b==="object"){a[G]=f;e[f]=c.extend(true,{},b)}else if(!e[f]){a[G]=f;e[f]={}}a=e[f];if(d!==w)a[b]=d;return typeof b==="string"?a[b]:a}},removeData:function(a,b){if(!(a.nodeName&&c.noData[a.nodeName.toLowerCase()])){a=a==A?za:a;var d=a[G],f=c.cache,e=f[d];if(b){if(e){delete e[b];c.isEmptyObject(e)&&c.removeData(a)}}else{if(c.support.deleteExpando)delete a[c.expando];
else a.removeAttribute&&a.removeAttribute(c.expando);delete f[d]}}}});c.fn.extend({data:function(a,b){if(typeof a==="undefined"&&this.length)return c.data(this[0]);else if(typeof a==="object")return this.each(function(){c.data(this,a)});var d=a.split(".");d[1]=d[1]?"."+d[1]:"";if(b===w){var f=this.triggerHandler("getData"+d[1]+"!",[d[0]]);if(f===w&&this.length)f=c.data(this[0],a);return f===w&&d[1]?this.data(d[0]):f}else return this.trigger("setData"+d[1]+"!",[d[0],b]).each(function(){c.data(this,
a,b)})},removeData:function(a){return this.each(function(){c.removeData(this,a)})}});c.extend({queue:function(a,b,d){if(a){b=(b||"fx")+"queue";var f=c.data(a,b);if(!d)return f||[];if(!f||c.isArray(d))f=c.data(a,b,c.makeArray(d));else f.push(d);return f}},dequeue:function(a,b){b=b||"fx";var d=c.queue(a,b),f=d.shift();if(f==="inprogress")f=d.shift();if(f){b==="fx"&&d.unshift("inprogress");f.call(a,function(){c.dequeue(a,b)})}}});c.fn.extend({queue:function(a,b){if(typeof a!=="string"){b=a;a="fx"}if(b===
w)return c.queue(this[0],a);return this.each(function(){var d=c.queue(this,a,b);a==="fx"&&d[0]!=="inprogress"&&c.dequeue(this,a)})},dequeue:function(a){return this.each(function(){c.dequeue(this,a)})},delay:function(a,b){a=c.fx?c.fx.speeds[a]||a:a;b=b||"fx";return this.queue(b,function(){var d=this;setTimeout(function(){c.dequeue(d,b)},a)})},clearQueue:function(a){return this.queue(a||"fx",[])}});var Aa=/[\n\t]/g,ca=/\s+/,Za=/\r/g,$a=/href|src|style/,ab=/(button|input)/i,bb=/(button|input|object|select|textarea)/i,
cb=/^(a|area)$/i,Ba=/radio|checkbox/;c.fn.extend({attr:function(a,b){return X(this,a,b,true,c.attr)},removeAttr:function(a){return this.each(function(){c.attr(this,a,"");this.nodeType===1&&this.removeAttribute(a)})},addClass:function(a){if(c.isFunction(a))return this.each(function(n){var r=c(this);r.addClass(a.call(this,n,r.attr("class")))});if(a&&typeof a==="string")for(var b=(a||"").split(ca),d=0,f=this.length;d<f;d++){var e=this[d];if(e.nodeType===1)if(e.className){for(var j=" "+e.className+" ",
i=e.className,o=0,k=b.length;o<k;o++)if(j.indexOf(" "+b[o]+" ")<0)i+=" "+b[o];e.className=c.trim(i)}else e.className=a}return this},removeClass:function(a){if(c.isFunction(a))return this.each(function(k){var n=c(this);n.removeClass(a.call(this,k,n.attr("class")))});if(a&&typeof a==="string"||a===w)for(var b=(a||"").split(ca),d=0,f=this.length;d<f;d++){var e=this[d];if(e.nodeType===1&&e.className)if(a){for(var j=(" "+e.className+" ").replace(Aa," "),i=0,o=b.length;i<o;i++)j=j.replace(" "+b[i]+" ",
" ");e.className=c.trim(j)}else e.className=""}return this},toggleClass:function(a,b){var d=typeof a,f=typeof b==="boolean";if(c.isFunction(a))return this.each(function(e){var j=c(this);j.toggleClass(a.call(this,e,j.attr("class"),b),b)});return this.each(function(){if(d==="string")for(var e,j=0,i=c(this),o=b,k=a.split(ca);e=k[j++];){o=f?o:!i.hasClass(e);i[o?"addClass":"removeClass"](e)}else if(d==="undefined"||d==="boolean"){this.className&&c.data(this,"__className__",this.className);this.className=
this.className||a===false?"":c.data(this,"__className__")||""}})},hasClass:function(a){a=" "+a+" ";for(var b=0,d=this.length;b<d;b++)if((" "+this[b].className+" ").replace(Aa," ").indexOf(a)>-1)return true;return false},val:function(a){if(a===w){var b=this[0];if(b){if(c.nodeName(b,"option"))return(b.attributes.value||{}).specified?b.value:b.text;if(c.nodeName(b,"select")){var d=b.selectedIndex,f=[],e=b.options;b=b.type==="select-one";if(d<0)return null;var j=b?d:0;for(d=b?d+1:e.length;j<d;j++){var i=
e[j];if(i.selected){a=c(i).val();if(b)return a;f.push(a)}}return f}if(Ba.test(b.type)&&!c.support.checkOn)return b.getAttribute("value")===null?"on":b.value;return(b.value||"").replace(Za,"")}return w}var o=c.isFunction(a);return this.each(function(k){var n=c(this),r=a;if(this.nodeType===1){if(o)r=a.call(this,k,n.val());if(typeof r==="number")r+="";if(c.isArray(r)&&Ba.test(this.type))this.checked=c.inArray(n.val(),r)>=0;else if(c.nodeName(this,"select")){var u=c.makeArray(r);c("option",this).each(function(){this.selected=
c.inArray(c(this).val(),u)>=0});if(!u.length)this.selectedIndex=-1}else this.value=r}})}});c.extend({attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attr:function(a,b,d,f){if(!a||a.nodeType===3||a.nodeType===8)return w;if(f&&b in c.attrFn)return c(a)[b](d);f=a.nodeType!==1||!c.isXMLDoc(a);var e=d!==w;b=f&&c.props[b]||b;if(a.nodeType===1){var j=$a.test(b);if(b in a&&f&&!j){if(e){b==="type"&&ab.test(a.nodeName)&&a.parentNode&&c.error("type property can't be changed");
a[b]=d}if(c.nodeName(a,"form")&&a.getAttributeNode(b))return a.getAttributeNode(b).nodeValue;if(b==="tabIndex")return(b=a.getAttributeNode("tabIndex"))&&b.specified?b.value:bb.test(a.nodeName)||cb.test(a.nodeName)&&a.href?0:w;return a[b]}if(!c.support.style&&f&&b==="style"){if(e)a.style.cssText=""+d;return a.style.cssText}e&&a.setAttribute(b,""+d);a=!c.support.hrefNormalized&&f&&j?a.getAttribute(b,2):a.getAttribute(b);return a===null?w:a}return c.style(a,b,d)}});var O=/\.(.*)$/,db=function(a){return a.replace(/[^\w\s\.\|`]/g,
function(b){return"\\"+b})};c.event={add:function(a,b,d,f){if(!(a.nodeType===3||a.nodeType===8)){if(a.setInterval&&a!==A&&!a.frameElement)a=A;var e,j;if(d.handler){e=d;d=e.handler}if(!d.guid)d.guid=c.guid++;if(j=c.data(a)){var i=j.events=j.events||{},o=j.handle;if(!o)j.handle=o=function(){return typeof c!=="undefined"&&!c.event.triggered?c.event.handle.apply(o.elem,arguments):w};o.elem=a;b=b.split(" ");for(var k,n=0,r;k=b[n++];){j=e?c.extend({},e):{handler:d,data:f};if(k.indexOf(".")>-1){r=k.split(".");
k=r.shift();j.namespace=r.slice(0).sort().join(".")}else{r=[];j.namespace=""}j.type=k;j.guid=d.guid;var u=i[k],z=c.event.special[k]||{};if(!u){u=i[k]=[];if(!z.setup||z.setup.call(a,f,r,o)===false)if(a.addEventListener)a.addEventListener(k,o,false);else a.attachEvent&&a.attachEvent("on"+k,o)}if(z.add){z.add.call(a,j);if(!j.handler.guid)j.handler.guid=d.guid}u.push(j);c.event.global[k]=true}a=null}}},global:{},remove:function(a,b,d,f){if(!(a.nodeType===3||a.nodeType===8)){var e,j=0,i,o,k,n,r,u,z=c.data(a),
C=z&&z.events;if(z&&C){if(b&&b.type){d=b.handler;b=b.type}if(!b||typeof b==="string"&&b.charAt(0)==="."){b=b||"";for(e in C)c.event.remove(a,e+b)}else{for(b=b.split(" ");e=b[j++];){n=e;i=e.indexOf(".")<0;o=[];if(!i){o=e.split(".");e=o.shift();k=new RegExp("(^|\\.)"+c.map(o.slice(0).sort(),db).join("\\.(?:.*\\.)?")+"(\\.|$)")}if(r=C[e])if(d){n=c.event.special[e]||{};for(B=f||0;B<r.length;B++){u=r[B];if(d.guid===u.guid){if(i||k.test(u.namespace)){f==null&&r.splice(B--,1);n.remove&&n.remove.call(a,u)}if(f!=
null)break}}if(r.length===0||f!=null&&r.length===1){if(!n.teardown||n.teardown.call(a,o)===false)Ca(a,e,z.handle);delete C[e]}}else for(var B=0;B<r.length;B++){u=r[B];if(i||k.test(u.namespace)){c.event.remove(a,n,u.handler,B);r.splice(B--,1)}}}if(c.isEmptyObject(C)){if(b=z.handle)b.elem=null;delete z.events;delete z.handle;c.isEmptyObject(z)&&c.removeData(a)}}}}},trigger:function(a,b,d,f){var e=a.type||a;if(!f){a=typeof a==="object"?a[G]?a:c.extend(c.Event(e),a):c.Event(e);if(e.indexOf("!")>=0){a.type=
e=e.slice(0,-1);a.exclusive=true}if(!d){a.stopPropagation();c.event.global[e]&&c.each(c.cache,function(){this.events&&this.events[e]&&c.event.trigger(a,b,this.handle.elem)})}if(!d||d.nodeType===3||d.nodeType===8)return w;a.result=w;a.target=d;b=c.makeArray(b);b.unshift(a)}a.currentTarget=d;(f=c.data(d,"handle"))&&f.apply(d,b);f=d.parentNode||d.ownerDocument;try{if(!(d&&d.nodeName&&c.noData[d.nodeName.toLowerCase()]))if(d["on"+e]&&d["on"+e].apply(d,b)===false)a.result=false}catch(j){}if(!a.isPropagationStopped()&&
f)c.event.trigger(a,b,f,true);else if(!a.isDefaultPrevented()){f=a.target;var i,o=c.nodeName(f,"a")&&e==="click",k=c.event.special[e]||{};if((!k._default||k._default.call(d,a)===false)&&!o&&!(f&&f.nodeName&&c.noData[f.nodeName.toLowerCase()])){try{if(f[e]){if(i=f["on"+e])f["on"+e]=null;c.event.triggered=true;f[e]()}}catch(n){}if(i)f["on"+e]=i;c.event.triggered=false}}},handle:function(a){var b,d,f,e;a=arguments[0]=c.event.fix(a||A.event);a.currentTarget=this;b=a.type.indexOf(".")<0&&!a.exclusive;
if(!b){d=a.type.split(".");a.type=d.shift();f=new RegExp("(^|\\.)"+d.slice(0).sort().join("\\.(?:.*\\.)?")+"(\\.|$)")}e=c.data(this,"events");d=e[a.type];if(e&&d){d=d.slice(0);e=0;for(var j=d.length;e<j;e++){var i=d[e];if(b||f.test(i.namespace)){a.handler=i.handler;a.data=i.data;a.handleObj=i;i=i.handler.apply(this,arguments);if(i!==w){a.result=i;if(i===false){a.preventDefault();a.stopPropagation()}}if(a.isImmediatePropagationStopped())break}}}return a.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),
fix:function(a){if(a[G])return a;var b=a;a=c.Event(b);for(var d=this.props.length,f;d;){f=this.props[--d];a[f]=b[f]}if(!a.target)a.target=a.srcElement||s;if(a.target.nodeType===3)a.target=a.target.parentNode;if(!a.relatedTarget&&a.fromElement)a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement;if(a.pageX==null&&a.clientX!=null){b=s.documentElement;d=s.body;a.pageX=a.clientX+(b&&b.scrollLeft||d&&d.scrollLeft||0)-(b&&b.clientLeft||d&&d.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||
d&&d.scrollTop||0)-(b&&b.clientTop||d&&d.clientTop||0)}if(!a.which&&(a.charCode||a.charCode===0?a.charCode:a.keyCode))a.which=a.charCode||a.keyCode;if(!a.metaKey&&a.ctrlKey)a.metaKey=a.ctrlKey;if(!a.which&&a.button!==w)a.which=a.button&1?1:a.button&2?3:a.button&4?2:0;return a},guid:1E8,proxy:c.proxy,special:{ready:{setup:c.bindReady,teardown:c.noop},live:{add:function(a){c.event.add(this,a.origType,c.extend({},a,{handler:oa}))},remove:function(a){var b=true,d=a.origType.replace(O,"");c.each(c.data(this,
"events").live||[],function(){if(d===this.origType.replace(O,""))return b=false});b&&c.event.remove(this,a.origType,oa)}},beforeunload:{setup:function(a,b,d){if(this.setInterval)this.onbeforeunload=d;return false},teardown:function(a,b){if(this.onbeforeunload===b)this.onbeforeunload=null}}}};var Ca=s.removeEventListener?function(a,b,d){a.removeEventListener(b,d,false)}:function(a,b,d){a.detachEvent("on"+b,d)};c.Event=function(a){if(!this.preventDefault)return new c.Event(a);if(a&&a.type){this.originalEvent=
a;this.type=a.type}else this.type=a;this.timeStamp=J();this[G]=true};c.Event.prototype={preventDefault:function(){this.isDefaultPrevented=Z;var a=this.originalEvent;if(a){a.preventDefault&&a.preventDefault();a.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=Z;var a=this.originalEvent;if(a){a.stopPropagation&&a.stopPropagation();a.cancelBubble=true}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=Z;this.stopPropagation()},isDefaultPrevented:Y,isPropagationStopped:Y,
isImmediatePropagationStopped:Y};var Da=function(a){var b=a.relatedTarget;try{for(;b&&b!==this;)b=b.parentNode;if(b!==this){a.type=a.data;c.event.handle.apply(this,arguments)}}catch(d){}},Ea=function(a){a.type=a.data;c.event.handle.apply(this,arguments)};c.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){c.event.special[a]={setup:function(d){c.event.add(this,b,d&&d.selector?Ea:Da,a)},teardown:function(d){c.event.remove(this,b,d&&d.selector?Ea:Da)}}});if(!c.support.submitBubbles)c.event.special.submit=
{setup:function(){if(this.nodeName.toLowerCase()!=="form"){c.event.add(this,"click.specialSubmit",function(a){var b=a.target,d=b.type;if((d==="submit"||d==="image")&&c(b).closest("form").length)return na("submit",this,arguments)});c.event.add(this,"keypress.specialSubmit",function(a){var b=a.target,d=b.type;if((d==="text"||d==="password")&&c(b).closest("form").length&&a.keyCode===13)return na("submit",this,arguments)})}else return false},teardown:function(){c.event.remove(this,".specialSubmit")}};
if(!c.support.changeBubbles){var da=/textarea|input|select/i,ea,Fa=function(a){var b=a.type,d=a.value;if(b==="radio"||b==="checkbox")d=a.checked;else if(b==="select-multiple")d=a.selectedIndex>-1?c.map(a.options,function(f){return f.selected}).join("-"):"";else if(a.nodeName.toLowerCase()==="select")d=a.selectedIndex;return d},fa=function(a,b){var d=a.target,f,e;if(!(!da.test(d.nodeName)||d.readOnly)){f=c.data(d,"_change_data");e=Fa(d);if(a.type!=="focusout"||d.type!=="radio")c.data(d,"_change_data",
e);if(!(f===w||e===f))if(f!=null||e){a.type="change";return c.event.trigger(a,b,d)}}};c.event.special.change={filters:{focusout:fa,click:function(a){var b=a.target,d=b.type;if(d==="radio"||d==="checkbox"||b.nodeName.toLowerCase()==="select")return fa.call(this,a)},keydown:function(a){var b=a.target,d=b.type;if(a.keyCode===13&&b.nodeName.toLowerCase()!=="textarea"||a.keyCode===32&&(d==="checkbox"||d==="radio")||d==="select-multiple")return fa.call(this,a)},beforeactivate:function(a){a=a.target;c.data(a,
"_change_data",Fa(a))}},setup:function(){if(this.type==="file")return false;for(var a in ea)c.event.add(this,a+".specialChange",ea[a]);return da.test(this.nodeName)},teardown:function(){c.event.remove(this,".specialChange");return da.test(this.nodeName)}};ea=c.event.special.change.filters}s.addEventListener&&c.each({focus:"focusin",blur:"focusout"},function(a,b){function d(f){f=c.event.fix(f);f.type=b;return c.event.handle.call(this,f)}c.event.special[b]={setup:function(){this.addEventListener(a,
d,true)},teardown:function(){this.removeEventListener(a,d,true)}}});c.each(["bind","one"],function(a,b){c.fn[b]=function(d,f,e){if(typeof d==="object"){for(var j in d)this[b](j,f,d[j],e);return this}if(c.isFunction(f)){e=f;f=w}var i=b==="one"?c.proxy(e,function(k){c(this).unbind(k,i);return e.apply(this,arguments)}):e;if(d==="unload"&&b!=="one")this.one(d,f,e);else{j=0;for(var o=this.length;j<o;j++)c.event.add(this[j],d,i,f)}return this}});c.fn.extend({unbind:function(a,b){if(typeof a==="object"&&
!a.preventDefault)for(var d in a)this.unbind(d,a[d]);else{d=0;for(var f=this.length;d<f;d++)c.event.remove(this[d],a,b)}return this},delegate:function(a,b,d,f){return this.live(b,d,f,a)},undelegate:function(a,b,d){return arguments.length===0?this.unbind("live"):this.die(b,null,d,a)},trigger:function(a,b){return this.each(function(){c.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0]){a=c.Event(a);a.preventDefault();a.stopPropagation();c.event.trigger(a,b,this[0]);return a.result}},
toggle:function(a){for(var b=arguments,d=1;d<b.length;)c.proxy(a,b[d++]);return this.click(c.proxy(a,function(f){var e=(c.data(this,"lastToggle"+a.guid)||0)%d;c.data(this,"lastToggle"+a.guid,e+1);f.preventDefault();return b[e].apply(this,arguments)||false}))},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var Ga={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};c.each(["live","die"],function(a,b){c.fn[b]=function(d,f,e,j){var i,o=0,k,n,r=j||this.selector,
u=j?this:c(this.context);if(c.isFunction(f)){e=f;f=w}for(d=(d||"").split(" ");(i=d[o++])!=null;){j=O.exec(i);k="";if(j){k=j[0];i=i.replace(O,"")}if(i==="hover")d.push("mouseenter"+k,"mouseleave"+k);else{n=i;if(i==="focus"||i==="blur"){d.push(Ga[i]+k);i+=k}else i=(Ga[i]||i)+k;b==="live"?u.each(function(){c.event.add(this,pa(i,r),{data:f,selector:r,handler:e,origType:i,origHandler:e,preType:n})}):u.unbind(pa(i,r),e)}}return this}});c.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),
function(a,b){c.fn[b]=function(d){return d?this.bind(b,d):this.trigger(b)};if(c.attrFn)c.attrFn[b]=true});A.attachEvent&&!A.addEventListener&&A.attachEvent("onunload",function(){for(var a in c.cache)if(c.cache[a].handle)try{c.event.remove(c.cache[a].handle.elem)}catch(b){}});(function(){function a(g){for(var h="",l,m=0;g[m];m++){l=g[m];if(l.nodeType===3||l.nodeType===4)h+=l.nodeValue;else if(l.nodeType!==8)h+=a(l.childNodes)}return h}function b(g,h,l,m,q,p){q=0;for(var v=m.length;q<v;q++){var t=m[q];
if(t){t=t[g];for(var y=false;t;){if(t.sizcache===l){y=m[t.sizset];break}if(t.nodeType===1&&!p){t.sizcache=l;t.sizset=q}if(t.nodeName.toLowerCase()===h){y=t;break}t=t[g]}m[q]=y}}}function d(g,h,l,m,q,p){q=0;for(var v=m.length;q<v;q++){var t=m[q];if(t){t=t[g];for(var y=false;t;){if(t.sizcache===l){y=m[t.sizset];break}if(t.nodeType===1){if(!p){t.sizcache=l;t.sizset=q}if(typeof h!=="string"){if(t===h){y=true;break}}else if(k.filter(h,[t]).length>0){y=t;break}}t=t[g]}m[q]=y}}}var f=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,
e=0,j=Object.prototype.toString,i=false,o=true;[0,0].sort(function(){o=false;return 0});var k=function(g,h,l,m){l=l||[];var q=h=h||s;if(h.nodeType!==1&&h.nodeType!==9)return[];if(!g||typeof g!=="string")return l;for(var p=[],v,t,y,S,H=true,M=x(h),I=g;(f.exec(""),v=f.exec(I))!==null;){I=v[3];p.push(v[1]);if(v[2]){S=v[3];break}}if(p.length>1&&r.exec(g))if(p.length===2&&n.relative[p[0]])t=ga(p[0]+p[1],h);else for(t=n.relative[p[0]]?[h]:k(p.shift(),h);p.length;){g=p.shift();if(n.relative[g])g+=p.shift();
t=ga(g,t)}else{if(!m&&p.length>1&&h.nodeType===9&&!M&&n.match.ID.test(p[0])&&!n.match.ID.test(p[p.length-1])){v=k.find(p.shift(),h,M);h=v.expr?k.filter(v.expr,v.set)[0]:v.set[0]}if(h){v=m?{expr:p.pop(),set:z(m)}:k.find(p.pop(),p.length===1&&(p[0]==="~"||p[0]==="+")&&h.parentNode?h.parentNode:h,M);t=v.expr?k.filter(v.expr,v.set):v.set;if(p.length>0)y=z(t);else H=false;for(;p.length;){var D=p.pop();v=D;if(n.relative[D])v=p.pop();else D="";if(v==null)v=h;n.relative[D](y,v,M)}}else y=[]}y||(y=t);y||k.error(D||
g);if(j.call(y)==="[object Array]")if(H)if(h&&h.nodeType===1)for(g=0;y[g]!=null;g++){if(y[g]&&(y[g]===true||y[g].nodeType===1&&E(h,y[g])))l.push(t[g])}else for(g=0;y[g]!=null;g++)y[g]&&y[g].nodeType===1&&l.push(t[g]);else l.push.apply(l,y);else z(y,l);if(S){k(S,q,l,m);k.uniqueSort(l)}return l};k.uniqueSort=function(g){if(B){i=o;g.sort(B);if(i)for(var h=1;h<g.length;h++)g[h]===g[h-1]&&g.splice(h--,1)}return g};k.matches=function(g,h){return k(g,null,null,h)};k.find=function(g,h,l){var m,q;if(!g)return[];
for(var p=0,v=n.order.length;p<v;p++){var t=n.order[p];if(q=n.leftMatch[t].exec(g)){var y=q[1];q.splice(1,1);if(y.substr(y.length-1)!=="\\"){q[1]=(q[1]||"").replace(/\\/g,"");m=n.find[t](q,h,l);if(m!=null){g=g.replace(n.match[t],"");break}}}}m||(m=h.getElementsByTagName("*"));return{set:m,expr:g}};k.filter=function(g,h,l,m){for(var q=g,p=[],v=h,t,y,S=h&&h[0]&&x(h[0]);g&&h.length;){for(var H in n.filter)if((t=n.leftMatch[H].exec(g))!=null&&t[2]){var M=n.filter[H],I,D;D=t[1];y=false;t.splice(1,1);if(D.substr(D.length-
1)!=="\\"){if(v===p)p=[];if(n.preFilter[H])if(t=n.preFilter[H](t,v,l,p,m,S)){if(t===true)continue}else y=I=true;if(t)for(var U=0;(D=v[U])!=null;U++)if(D){I=M(D,t,U,v);var Ha=m^!!I;if(l&&I!=null)if(Ha)y=true;else v[U]=false;else if(Ha){p.push(D);y=true}}if(I!==w){l||(v=p);g=g.replace(n.match[H],"");if(!y)return[];break}}}if(g===q)if(y==null)k.error(g);else break;q=g}return v};k.error=function(g){throw"Syntax error, unrecognized expression: "+g;};var n=k.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,
CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(g){return g.getAttribute("href")}},
relative:{"+":function(g,h){var l=typeof h==="string",m=l&&!/\W/.test(h);l=l&&!m;if(m)h=h.toLowerCase();m=0;for(var q=g.length,p;m<q;m++)if(p=g[m]){for(;(p=p.previousSibling)&&p.nodeType!==1;);g[m]=l||p&&p.nodeName.toLowerCase()===h?p||false:p===h}l&&k.filter(h,g,true)},">":function(g,h){var l=typeof h==="string";if(l&&!/\W/.test(h)){h=h.toLowerCase();for(var m=0,q=g.length;m<q;m++){var p=g[m];if(p){l=p.parentNode;g[m]=l.nodeName.toLowerCase()===h?l:false}}}else{m=0;for(q=g.length;m<q;m++)if(p=g[m])g[m]=
l?p.parentNode:p.parentNode===h;l&&k.filter(h,g,true)}},"":function(g,h,l){var m=e++,q=d;if(typeof h==="string"&&!/\W/.test(h)){var p=h=h.toLowerCase();q=b}q("parentNode",h,m,g,p,l)},"~":function(g,h,l){var m=e++,q=d;if(typeof h==="string"&&!/\W/.test(h)){var p=h=h.toLowerCase();q=b}q("previousSibling",h,m,g,p,l)}},find:{ID:function(g,h,l){if(typeof h.getElementById!=="undefined"&&!l)return(g=h.getElementById(g[1]))?[g]:[]},NAME:function(g,h){if(typeof h.getElementsByName!=="undefined"){var l=[];
h=h.getElementsByName(g[1]);for(var m=0,q=h.length;m<q;m++)h[m].getAttribute("name")===g[1]&&l.push(h[m]);return l.length===0?null:l}},TAG:function(g,h){return h.getElementsByTagName(g[1])}},preFilter:{CLASS:function(g,h,l,m,q,p){g=" "+g[1].replace(/\\/g,"")+" ";if(p)return g;p=0;for(var v;(v=h[p])!=null;p++)if(v)if(q^(v.className&&(" "+v.className+" ").replace(/[\t\n]/g," ").indexOf(g)>=0))l||m.push(v);else if(l)h[p]=false;return false},ID:function(g){return g[1].replace(/\\/g,"")},TAG:function(g){return g[1].toLowerCase()},
CHILD:function(g){if(g[1]==="nth"){var h=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(g[2]==="even"&&"2n"||g[2]==="odd"&&"2n+1"||!/\D/.test(g[2])&&"0n+"+g[2]||g[2]);g[2]=h[1]+(h[2]||1)-0;g[3]=h[3]-0}g[0]=e++;return g},ATTR:function(g,h,l,m,q,p){h=g[1].replace(/\\/g,"");if(!p&&n.attrMap[h])g[1]=n.attrMap[h];if(g[2]==="~=")g[4]=" "+g[4]+" ";return g},PSEUDO:function(g,h,l,m,q){if(g[1]==="not")if((f.exec(g[3])||"").length>1||/^\w/.test(g[3]))g[3]=k(g[3],null,null,h);else{g=k.filter(g[3],h,l,true^q);l||m.push.apply(m,
g);return false}else if(n.match.POS.test(g[0])||n.match.CHILD.test(g[0]))return true;return g},POS:function(g){g.unshift(true);return g}},filters:{enabled:function(g){return g.disabled===false&&g.type!=="hidden"},disabled:function(g){return g.disabled===true},checked:function(g){return g.checked===true},selected:function(g){return g.selected===true},parent:function(g){return!!g.firstChild},empty:function(g){return!g.firstChild},has:function(g,h,l){return!!k(l[3],g).length},header:function(g){return/h\d/i.test(g.nodeName)},
text:function(g){return"text"===g.type},radio:function(g){return"radio"===g.type},checkbox:function(g){return"checkbox"===g.type},file:function(g){return"file"===g.type},password:function(g){return"password"===g.type},submit:function(g){return"submit"===g.type},image:function(g){return"image"===g.type},reset:function(g){return"reset"===g.type},button:function(g){return"button"===g.type||g.nodeName.toLowerCase()==="button"},input:function(g){return/input|select|textarea|button/i.test(g.nodeName)}},
setFilters:{first:function(g,h){return h===0},last:function(g,h,l,m){return h===m.length-1},even:function(g,h){return h%2===0},odd:function(g,h){return h%2===1},lt:function(g,h,l){return h<l[3]-0},gt:function(g,h,l){return h>l[3]-0},nth:function(g,h,l){return l[3]-0===h},eq:function(g,h,l){return l[3]-0===h}},filter:{PSEUDO:function(g,h,l,m){var q=h[1],p=n.filters[q];if(p)return p(g,l,h,m);else if(q==="contains")return(g.textContent||g.innerText||a([g])||"").indexOf(h[3])>=0;else if(q==="not"){h=
h[3];l=0;for(m=h.length;l<m;l++)if(h[l]===g)return false;return true}else k.error("Syntax error, unrecognized expression: "+q)},CHILD:function(g,h){var l=h[1],m=g;switch(l){case "only":case "first":for(;m=m.previousSibling;)if(m.nodeType===1)return false;if(l==="first")return true;m=g;case "last":for(;m=m.nextSibling;)if(m.nodeType===1)return false;return true;case "nth":l=h[2];var q=h[3];if(l===1&&q===0)return true;h=h[0];var p=g.parentNode;if(p&&(p.sizcache!==h||!g.nodeIndex)){var v=0;for(m=p.firstChild;m;m=
m.nextSibling)if(m.nodeType===1)m.nodeIndex=++v;p.sizcache=h}g=g.nodeIndex-q;return l===0?g===0:g%l===0&&g/l>=0}},ID:function(g,h){return g.nodeType===1&&g.getAttribute("id")===h},TAG:function(g,h){return h==="*"&&g.nodeType===1||g.nodeName.toLowerCase()===h},CLASS:function(g,h){return(" "+(g.className||g.getAttribute("class"))+" ").indexOf(h)>-1},ATTR:function(g,h){var l=h[1];g=n.attrHandle[l]?n.attrHandle[l](g):g[l]!=null?g[l]:g.getAttribute(l);l=g+"";var m=h[2];h=h[4];return g==null?m==="!=":m===
"="?l===h:m==="*="?l.indexOf(h)>=0:m==="~="?(" "+l+" ").indexOf(h)>=0:!h?l&&g!==false:m==="!="?l!==h:m==="^="?l.indexOf(h)===0:m==="$="?l.substr(l.length-h.length)===h:m==="|="?l===h||l.substr(0,h.length+1)===h+"-":false},POS:function(g,h,l,m){var q=n.setFilters[h[2]];if(q)return q(g,l,h,m)}}},r=n.match.POS;for(var u in n.match){n.match[u]=new RegExp(n.match[u].source+/(?![^\[]*\])(?![^\(]*\))/.source);n.leftMatch[u]=new RegExp(/(^(?:.|\r|\n)*?)/.source+n.match[u].source.replace(/\\(\d+)/g,function(g,
h){return"\\"+(h-0+1)}))}var z=function(g,h){g=Array.prototype.slice.call(g,0);if(h){h.push.apply(h,g);return h}return g};try{Array.prototype.slice.call(s.documentElement.childNodes,0)}catch(C){z=function(g,h){h=h||[];if(j.call(g)==="[object Array]")Array.prototype.push.apply(h,g);else if(typeof g.length==="number")for(var l=0,m=g.length;l<m;l++)h.push(g[l]);else for(l=0;g[l];l++)h.push(g[l]);return h}}var B;if(s.documentElement.compareDocumentPosition)B=function(g,h){if(!g.compareDocumentPosition||
!h.compareDocumentPosition){if(g==h)i=true;return g.compareDocumentPosition?-1:1}g=g.compareDocumentPosition(h)&4?-1:g===h?0:1;if(g===0)i=true;return g};else if("sourceIndex"in s.documentElement)B=function(g,h){if(!g.sourceIndex||!h.sourceIndex){if(g==h)i=true;return g.sourceIndex?-1:1}g=g.sourceIndex-h.sourceIndex;if(g===0)i=true;return g};else if(s.createRange)B=function(g,h){if(!g.ownerDocument||!h.ownerDocument){if(g==h)i=true;return g.ownerDocument?-1:1}var l=g.ownerDocument.createRange(),m=
h.ownerDocument.createRange();l.setStart(g,0);l.setEnd(g,0);m.setStart(h,0);m.setEnd(h,0);g=l.compareBoundaryPoints(Range.START_TO_END,m);if(g===0)i=true;return g};(function(){var g=s.createElement("div"),h="script"+(new Date).getTime();g.innerHTML="<a name='"+h+"'/>";var l=s.documentElement;l.insertBefore(g,l.firstChild);if(s.getElementById(h)){n.find.ID=function(m,q,p){if(typeof q.getElementById!=="undefined"&&!p)return(q=q.getElementById(m[1]))?q.id===m[1]||typeof q.getAttributeNode!=="undefined"&&
q.getAttributeNode("id").nodeValue===m[1]?[q]:w:[]};n.filter.ID=function(m,q){var p=typeof m.getAttributeNode!=="undefined"&&m.getAttributeNode("id");return m.nodeType===1&&p&&p.nodeValue===q}}l.removeChild(g);l=g=null})();(function(){var g=s.createElement("div");g.appendChild(s.createComment(""));if(g.getElementsByTagName("*").length>0)n.find.TAG=function(h,l){l=l.getElementsByTagName(h[1]);if(h[1]==="*"){h=[];for(var m=0;l[m];m++)l[m].nodeType===1&&h.push(l[m]);l=h}return l};g.innerHTML="<a href='#'></a>";
if(g.firstChild&&typeof g.firstChild.getAttribute!=="undefined"&&g.firstChild.getAttribute("href")!=="#")n.attrHandle.href=function(h){return h.getAttribute("href",2)};g=null})();s.querySelectorAll&&function(){var g=k,h=s.createElement("div");h.innerHTML="<p class='TEST'></p>";if(!(h.querySelectorAll&&h.querySelectorAll(".TEST").length===0)){k=function(m,q,p,v){q=q||s;if(!v&&q.nodeType===9&&!x(q))try{return z(q.querySelectorAll(m),p)}catch(t){}return g(m,q,p,v)};for(var l in g)k[l]=g[l];h=null}}();
(function(){var g=s.createElement("div");g.innerHTML="<div class='test e'></div><div class='test'></div>";if(!(!g.getElementsByClassName||g.getElementsByClassName("e").length===0)){g.lastChild.className="e";if(g.getElementsByClassName("e").length!==1){n.order.splice(1,0,"CLASS");n.find.CLASS=function(h,l,m){if(typeof l.getElementsByClassName!=="undefined"&&!m)return l.getElementsByClassName(h[1])};g=null}}})();var E=s.compareDocumentPosition?function(g,h){return!!(g.compareDocumentPosition(h)&16)}:
function(g,h){return g!==h&&(g.contains?g.contains(h):true)},x=function(g){return(g=(g?g.ownerDocument||g:0).documentElement)?g.nodeName!=="HTML":false},ga=function(g,h){var l=[],m="",q;for(h=h.nodeType?[h]:h;q=n.match.PSEUDO.exec(g);){m+=q[0];g=g.replace(n.match.PSEUDO,"")}g=n.relative[g]?g+"*":g;q=0;for(var p=h.length;q<p;q++)k(g,h[q],l);return k.filter(m,l)};c.find=k;c.expr=k.selectors;c.expr[":"]=c.expr.filters;c.unique=k.uniqueSort;c.text=a;c.isXMLDoc=x;c.contains=E})();var eb=/Until$/,fb=/^(?:parents|prevUntil|prevAll)/,
gb=/,/;R=Array.prototype.slice;var Ia=function(a,b,d){if(c.isFunction(b))return c.grep(a,function(e,j){return!!b.call(e,j,e)===d});else if(b.nodeType)return c.grep(a,function(e){return e===b===d});else if(typeof b==="string"){var f=c.grep(a,function(e){return e.nodeType===1});if(Ua.test(b))return c.filter(b,f,!d);else b=c.filter(b,f)}return c.grep(a,function(e){return c.inArray(e,b)>=0===d})};c.fn.extend({find:function(a){for(var b=this.pushStack("","find",a),d=0,f=0,e=this.length;f<e;f++){d=b.length;
c.find(a,this[f],b);if(f>0)for(var j=d;j<b.length;j++)for(var i=0;i<d;i++)if(b[i]===b[j]){b.splice(j--,1);break}}return b},has:function(a){var b=c(a);return this.filter(function(){for(var d=0,f=b.length;d<f;d++)if(c.contains(this,b[d]))return true})},not:function(a){return this.pushStack(Ia(this,a,false),"not",a)},filter:function(a){return this.pushStack(Ia(this,a,true),"filter",a)},is:function(a){return!!a&&c.filter(a,this).length>0},closest:function(a,b){if(c.isArray(a)){var d=[],f=this[0],e,j=
{},i;if(f&&a.length){e=0;for(var o=a.length;e<o;e++){i=a[e];j[i]||(j[i]=c.expr.match.POS.test(i)?c(i,b||this.context):i)}for(;f&&f.ownerDocument&&f!==b;){for(i in j){e=j[i];if(e.jquery?e.index(f)>-1:c(f).is(e)){d.push({selector:i,elem:f});delete j[i]}}f=f.parentNode}}return d}var k=c.expr.match.POS.test(a)?c(a,b||this.context):null;return this.map(function(n,r){for(;r&&r.ownerDocument&&r!==b;){if(k?k.index(r)>-1:c(r).is(a))return r;r=r.parentNode}return null})},index:function(a){if(!a||typeof a===
"string")return c.inArray(this[0],a?c(a):this.parent().children());return c.inArray(a.jquery?a[0]:a,this)},add:function(a,b){a=typeof a==="string"?c(a,b||this.context):c.makeArray(a);b=c.merge(this.get(),a);return this.pushStack(qa(a[0])||qa(b[0])?b:c.unique(b))},andSelf:function(){return this.add(this.prevObject)}});c.each({parent:function(a){return(a=a.parentNode)&&a.nodeType!==11?a:null},parents:function(a){return c.dir(a,"parentNode")},parentsUntil:function(a,b,d){return c.dir(a,"parentNode",
d)},next:function(a){return c.nth(a,2,"nextSibling")},prev:function(a){return c.nth(a,2,"previousSibling")},nextAll:function(a){return c.dir(a,"nextSibling")},prevAll:function(a){return c.dir(a,"previousSibling")},nextUntil:function(a,b,d){return c.dir(a,"nextSibling",d)},prevUntil:function(a,b,d){return c.dir(a,"previousSibling",d)},siblings:function(a){return c.sibling(a.parentNode.firstChild,a)},children:function(a){return c.sibling(a.firstChild)},contents:function(a){return c.nodeName(a,"iframe")?
a.contentDocument||a.contentWindow.document:c.makeArray(a.childNodes)}},function(a,b){c.fn[a]=function(d,f){var e=c.map(this,b,d);eb.test(a)||(f=d);if(f&&typeof f==="string")e=c.filter(f,e);e=this.length>1?c.unique(e):e;if((this.length>1||gb.test(f))&&fb.test(a))e=e.reverse();return this.pushStack(e,a,R.call(arguments).join(","))}});c.extend({filter:function(a,b,d){if(d)a=":not("+a+")";return c.find.matches(a,b)},dir:function(a,b,d){var f=[];for(a=a[b];a&&a.nodeType!==9&&(d===w||a.nodeType!==1||!c(a).is(d));){a.nodeType===
1&&f.push(a);a=a[b]}return f},nth:function(a,b,d){b=b||1;for(var f=0;a;a=a[d])if(a.nodeType===1&&++f===b)break;return a},sibling:function(a,b){for(var d=[];a;a=a.nextSibling)a.nodeType===1&&a!==b&&d.push(a);return d}});var Ja=/ jQuery\d+="(?:\d+|null)"/g,V=/^\s+/,Ka=/(<([\w:]+)[^>]*?)\/>/g,hb=/^(?:area|br|col|embed|hr|img|input|link|meta|param)$/i,La=/<([\w:]+)/,ib=/<tbody/i,jb=/<|&#?\w+;/,ta=/<script|<object|<embed|<option|<style/i,ua=/checked\s*(?:[^=]|=\s*.checked.)/i,Ma=function(a,b,d){return hb.test(d)?
a:b+"></"+d+">"},F={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};F.optgroup=F.option;F.tbody=F.tfoot=F.colgroup=F.caption=F.thead;F.th=F.td;if(!c.support.htmlSerialize)F._default=[1,"div<div>","</div>"];c.fn.extend({text:function(a){if(c.isFunction(a))return this.each(function(b){var d=
c(this);d.text(a.call(this,b,d.text()))});if(typeof a!=="object"&&a!==w)return this.empty().append((this[0]&&this[0].ownerDocument||s).createTextNode(a));return c.text(this)},wrapAll:function(a){if(c.isFunction(a))return this.each(function(d){c(this).wrapAll(a.call(this,d))});if(this[0]){var b=c(a,this[0].ownerDocument).eq(0).clone(true);this[0].parentNode&&b.insertBefore(this[0]);b.map(function(){for(var d=this;d.firstChild&&d.firstChild.nodeType===1;)d=d.firstChild;return d}).append(this)}return this},
wrapInner:function(a){if(c.isFunction(a))return this.each(function(b){c(this).wrapInner(a.call(this,b))});return this.each(function(){var b=c(this),d=b.contents();d.length?d.wrapAll(a):b.append(a)})},wrap:function(a){return this.each(function(){c(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){c.nodeName(this,"body")||c(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.appendChild(a)})},
prepend:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(b){this.parentNode.insertBefore(b,this)});else if(arguments.length){var a=c(arguments[0]);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(b){this.parentNode.insertBefore(b,
this.nextSibling)});else if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,c(arguments[0]).toArray());return a}},remove:function(a,b){for(var d=0,f;(f=this[d])!=null;d++)if(!a||c.filter(a,[f]).length){if(!b&&f.nodeType===1){c.cleanData(f.getElementsByTagName("*"));c.cleanData([f])}f.parentNode&&f.parentNode.removeChild(f)}return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++)for(b.nodeType===1&&c.cleanData(b.getElementsByTagName("*"));b.firstChild;)b.removeChild(b.firstChild);
return this},clone:function(a){var b=this.map(function(){if(!c.support.noCloneEvent&&!c.isXMLDoc(this)){var d=this.outerHTML,f=this.ownerDocument;if(!d){d=f.createElement("div");d.appendChild(this.cloneNode(true));d=d.innerHTML}return c.clean([d.replace(Ja,"").replace(/=([^="'>\s]+\/)>/g,'="$1">').replace(V,"")],f)[0]}else return this.cloneNode(true)});if(a===true){ra(this,b);ra(this.find("*"),b.find("*"))}return b},html:function(a){if(a===w)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(Ja,
""):null;else if(typeof a==="string"&&!ta.test(a)&&(c.support.leadingWhitespace||!V.test(a))&&!F[(La.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Ka,Ma);try{for(var b=0,d=this.length;b<d;b++)if(this[b].nodeType===1){c.cleanData(this[b].getElementsByTagName("*"));this[b].innerHTML=a}}catch(f){this.empty().append(a)}}else c.isFunction(a)?this.each(function(e){var j=c(this),i=j.html();j.empty().append(function(){return a.call(this,e,i)})}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&
this[0].parentNode){if(c.isFunction(a))return this.each(function(b){var d=c(this),f=d.html();d.replaceWith(a.call(this,b,f))});if(typeof a!=="string")a=c(a).detach();return this.each(function(){var b=this.nextSibling,d=this.parentNode;c(this).remove();b?c(b).before(a):c(d).append(a)})}else return this.pushStack(c(c.isFunction(a)?a():a),"replaceWith",a)},detach:function(a){return this.remove(a,true)},domManip:function(a,b,d){function f(u){return c.nodeName(u,"table")?u.getElementsByTagName("tbody")[0]||
u.appendChild(u.ownerDocument.createElement("tbody")):u}var e,j,i=a[0],o=[],k;if(!c.support.checkClone&&arguments.length===3&&typeof i==="string"&&ua.test(i))return this.each(function(){c(this).domManip(a,b,d,true)});if(c.isFunction(i))return this.each(function(u){var z=c(this);a[0]=i.call(this,u,b?z.html():w);z.domManip(a,b,d)});if(this[0]){e=i&&i.parentNode;e=c.support.parentNode&&e&&e.nodeType===11&&e.childNodes.length===this.length?{fragment:e}:sa(a,this,o);k=e.fragment;if(j=k.childNodes.length===
1?(k=k.firstChild):k.firstChild){b=b&&c.nodeName(j,"tr");for(var n=0,r=this.length;n<r;n++)d.call(b?f(this[n],j):this[n],n>0||e.cacheable||this.length>1?k.cloneNode(true):k)}o.length&&c.each(o,Qa)}return this}});c.fragments={};c.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){c.fn[a]=function(d){var f=[];d=c(d);var e=this.length===1&&this[0].parentNode;if(e&&e.nodeType===11&&e.childNodes.length===1&&d.length===1){d[b](this[0]);
return this}else{e=0;for(var j=d.length;e<j;e++){var i=(e>0?this.clone(true):this).get();c.fn[b].apply(c(d[e]),i);f=f.concat(i)}return this.pushStack(f,a,d.selector)}}});c.extend({clean:function(a,b,d,f){b=b||s;if(typeof b.createElement==="undefined")b=b.ownerDocument||b[0]&&b[0].ownerDocument||s;for(var e=[],j=0,i;(i=a[j])!=null;j++){if(typeof i==="number")i+="";if(i){if(typeof i==="string"&&!jb.test(i))i=b.createTextNode(i);else if(typeof i==="string"){i=i.replace(Ka,Ma);var o=(La.exec(i)||["",
""])[1].toLowerCase(),k=F[o]||F._default,n=k[0],r=b.createElement("div");for(r.innerHTML=k[1]+i+k[2];n--;)r=r.lastChild;if(!c.support.tbody){n=ib.test(i);o=o==="table"&&!n?r.firstChild&&r.firstChild.childNodes:k[1]==="<table>"&&!n?r.childNodes:[];for(k=o.length-1;k>=0;--k)c.nodeName(o[k],"tbody")&&!o[k].childNodes.length&&o[k].parentNode.removeChild(o[k])}!c.support.leadingWhitespace&&V.test(i)&&r.insertBefore(b.createTextNode(V.exec(i)[0]),r.firstChild);i=r.childNodes}if(i.nodeType)e.push(i);else e=
c.merge(e,i)}}if(d)for(j=0;e[j];j++)if(f&&c.nodeName(e[j],"script")&&(!e[j].type||e[j].type.toLowerCase()==="text/javascript"))f.push(e[j].parentNode?e[j].parentNode.removeChild(e[j]):e[j]);else{e[j].nodeType===1&&e.splice.apply(e,[j+1,0].concat(c.makeArray(e[j].getElementsByTagName("script"))));d.appendChild(e[j])}return e},cleanData:function(a){for(var b,d,f=c.cache,e=c.event.special,j=c.support.deleteExpando,i=0,o;(o=a[i])!=null;i++)if(d=o[c.expando]){b=f[d];if(b.events)for(var k in b.events)e[k]?
c.event.remove(o,k):Ca(o,k,b.handle);if(j)delete o[c.expando];else o.removeAttribute&&o.removeAttribute(c.expando);delete f[d]}}});var kb=/z-?index|font-?weight|opacity|zoom|line-?height/i,Na=/alpha\([^)]*\)/,Oa=/opacity=([^)]*)/,ha=/float/i,ia=/-([a-z])/ig,lb=/([A-Z])/g,mb=/^-?\d+(?:px)?$/i,nb=/^-?\d/,ob={position:"absolute",visibility:"hidden",display:"block"},pb=["Left","Right"],qb=["Top","Bottom"],rb=s.defaultView&&s.defaultView.getComputedStyle,Pa=c.support.cssFloat?"cssFloat":"styleFloat",ja=
function(a,b){return b.toUpperCase()};c.fn.css=function(a,b){return X(this,a,b,true,function(d,f,e){if(e===w)return c.curCSS(d,f);if(typeof e==="number"&&!kb.test(f))e+="px";c.style(d,f,e)})};c.extend({style:function(a,b,d){if(!a||a.nodeType===3||a.nodeType===8)return w;if((b==="width"||b==="height")&&parseFloat(d)<0)d=w;var f=a.style||a,e=d!==w;if(!c.support.opacity&&b==="opacity"){if(e){f.zoom=1;b=parseInt(d,10)+""==="NaN"?"":"alpha(opacity="+d*100+")";a=f.filter||c.curCSS(a,"filter")||"";f.filter=
Na.test(a)?a.replace(Na,b):b}return f.filter&&f.filter.indexOf("opacity=")>=0?parseFloat(Oa.exec(f.filter)[1])/100+"":""}if(ha.test(b))b=Pa;b=b.replace(ia,ja);if(e)f[b]=d;return f[b]},css:function(a,b,d,f){if(b==="width"||b==="height"){var e,j=b==="width"?pb:qb;function i(){e=b==="width"?a.offsetWidth:a.offsetHeight;f!=="border"&&c.each(j,function(){f||(e-=parseFloat(c.curCSS(a,"padding"+this,true))||0);if(f==="margin")e+=parseFloat(c.curCSS(a,"margin"+this,true))||0;else e-=parseFloat(c.curCSS(a,
"border"+this+"Width",true))||0})}a.offsetWidth!==0?i():c.swap(a,ob,i);return Math.max(0,Math.round(e))}return c.curCSS(a,b,d)},curCSS:function(a,b,d){var f,e=a.style;if(!c.support.opacity&&b==="opacity"&&a.currentStyle){f=Oa.test(a.currentStyle.filter||"")?parseFloat(RegExp.$1)/100+"":"";return f===""?"1":f}if(ha.test(b))b=Pa;if(!d&&e&&e[b])f=e[b];else if(rb){if(ha.test(b))b="float";b=b.replace(lb,"-$1").toLowerCase();e=a.ownerDocument.defaultView;if(!e)return null;if(a=e.getComputedStyle(a,null))f=
a.getPropertyValue(b);if(b==="opacity"&&f==="")f="1"}else if(a.currentStyle){d=b.replace(ia,ja);f=a.currentStyle[b]||a.currentStyle[d];if(!mb.test(f)&&nb.test(f)){b=e.left;var j=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;e.left=d==="fontSize"?"1em":f||0;f=e.pixelLeft+"px";e.left=b;a.runtimeStyle.left=j}}return f},swap:function(a,b,d){var f={};for(var e in b){f[e]=a.style[e];a.style[e]=b[e]}d.call(a);for(e in b)a.style[e]=f[e]}});if(c.expr&&c.expr.filters){c.expr.filters.hidden=function(a){var b=
a.offsetWidth,d=a.offsetHeight,f=a.nodeName.toLowerCase()==="tr";return b===0&&d===0&&!f?true:b>0&&d>0&&!f?false:c.curCSS(a,"display")==="none"};c.expr.filters.visible=function(a){return!c.expr.filters.hidden(a)}}var sb=J(),tb=/<script(.|\s)*?\/script>/gi,ub=/select|textarea/i,vb=/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i,N=/=\?(&|$)/,ka=/\?/,wb=/(\?|&)_=.*?(&|$)/,xb=/^(\w+:)?\/\/([^\/?#]+)/,yb=/%20/g,zb=c.fn.load;c.fn.extend({load:function(a,b,d){if(typeof a!==
"string")return zb.call(this,a);else if(!this.length)return this;var f=a.indexOf(" ");if(f>=0){var e=a.slice(f,a.length);a=a.slice(0,f)}f="GET";if(b)if(c.isFunction(b)){d=b;b=null}else if(typeof b==="object"){b=c.param(b,c.ajaxSettings.traditional);f="POST"}var j=this;c.ajax({url:a,type:f,dataType:"html",data:b,complete:function(i,o){if(o==="success"||o==="notmodified")j.html(e?c("<div />").append(i.responseText.replace(tb,"")).find(e):i.responseText);d&&j.each(d,[i.responseText,o,i])}});return this},
serialize:function(){return c.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?c.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||ub.test(this.nodeName)||vb.test(this.type))}).map(function(a,b){a=c(this).val();return a==null?null:c.isArray(a)?c.map(a,function(d){return{name:b.name,value:d}}):{name:b.name,value:a}}).get()}});c.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),
function(a,b){c.fn[b]=function(d){return this.bind(b,d)}});c.extend({get:function(a,b,d,f){if(c.isFunction(b)){f=f||d;d=b;b=null}return c.ajax({type:"GET",url:a,data:b,success:d,dataType:f})},getScript:function(a,b){return c.get(a,null,b,"script")},getJSON:function(a,b,d){return c.get(a,b,d,"json")},post:function(a,b,d,f){if(c.isFunction(b)){f=f||d;d=b;b={}}return c.ajax({type:"POST",url:a,data:b,success:d,dataType:f})},ajaxSetup:function(a){c.extend(c.ajaxSettings,a)},ajaxSettings:{url:location.href,
global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:A.XMLHttpRequest&&(A.location.protocol!=="file:"||!A.ActiveXObject)?function(){return new A.XMLHttpRequest}:function(){try{return new A.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},etag:{},ajax:function(a){function b(){e.success&&
e.success.call(k,o,i,x);e.global&&f("ajaxSuccess",[x,e])}function d(){e.complete&&e.complete.call(k,x,i);e.global&&f("ajaxComplete",[x,e]);e.global&&!--c.active&&c.event.trigger("ajaxStop")}function f(q,p){(e.context?c(e.context):c.event).trigger(q,p)}var e=c.extend(true,{},c.ajaxSettings,a),j,i,o,k=a&&a.context||e,n=e.type.toUpperCase();if(e.data&&e.processData&&typeof e.data!=="string")e.data=c.param(e.data,e.traditional);if(e.dataType==="jsonp"){if(n==="GET")N.test(e.url)||(e.url+=(ka.test(e.url)?
"&":"?")+(e.jsonp||"callback")+"=?");else if(!e.data||!N.test(e.data))e.data=(e.data?e.data+"&":"")+(e.jsonp||"callback")+"=?";e.dataType="json"}if(e.dataType==="json"&&(e.data&&N.test(e.data)||N.test(e.url))){j=e.jsonpCallback||"jsonp"+sb++;if(e.data)e.data=(e.data+"").replace(N,"="+j+"$1");e.url=e.url.replace(N,"="+j+"$1");e.dataType="script";A[j]=A[j]||function(q){o=q;b();d();A[j]=w;try{delete A[j]}catch(p){}z&&z.removeChild(C)}}if(e.dataType==="script"&&e.cache===null)e.cache=false;if(e.cache===
false&&n==="GET"){var r=J(),u=e.url.replace(wb,"$1_="+r+"$2");e.url=u+(u===e.url?(ka.test(e.url)?"&":"?")+"_="+r:"")}if(e.data&&n==="GET")e.url+=(ka.test(e.url)?"&":"?")+e.data;e.global&&!c.active++&&c.event.trigger("ajaxStart");r=(r=xb.exec(e.url))&&(r[1]&&r[1]!==location.protocol||r[2]!==location.host);if(e.dataType==="script"&&n==="GET"&&r){var z=s.getElementsByTagName("head")[0]||s.documentElement,C=s.createElement("script");C.src=e.url;if(e.scriptCharset)C.charset=e.scriptCharset;if(!j){var B=
false;C.onload=C.onreadystatechange=function(){if(!B&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){B=true;b();d();C.onload=C.onreadystatechange=null;z&&C.parentNode&&z.removeChild(C)}}}z.insertBefore(C,z.firstChild);return w}var E=false,x=e.xhr();if(x){e.username?x.open(n,e.url,e.async,e.username,e.password):x.open(n,e.url,e.async);try{if(e.data||a&&a.contentType)x.setRequestHeader("Content-Type",e.contentType);if(e.ifModified){c.lastModified[e.url]&&x.setRequestHeader("If-Modified-Since",
c.lastModified[e.url]);c.etag[e.url]&&x.setRequestHeader("If-None-Match",c.etag[e.url])}r||x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Accept",e.dataType&&e.accepts[e.dataType]?e.accepts[e.dataType]+", */*":e.accepts._default)}catch(ga){}if(e.beforeSend&&e.beforeSend.call(k,x,e)===false){e.global&&!--c.active&&c.event.trigger("ajaxStop");x.abort();return false}e.global&&f("ajaxSend",[x,e]);var g=x.onreadystatechange=function(q){if(!x||x.readyState===0||q==="abort"){E||
d();E=true;if(x)x.onreadystatechange=c.noop}else if(!E&&x&&(x.readyState===4||q==="timeout")){E=true;x.onreadystatechange=c.noop;i=q==="timeout"?"timeout":!c.httpSuccess(x)?"error":e.ifModified&&c.httpNotModified(x,e.url)?"notmodified":"success";var p;if(i==="success")try{o=c.httpData(x,e.dataType,e)}catch(v){i="parsererror";p=v}if(i==="success"||i==="notmodified")j||b();else c.handleError(e,x,i,p);d();q==="timeout"&&x.abort();if(e.async)x=null}};try{var h=x.abort;x.abort=function(){x&&h.call(x);
g("abort")}}catch(l){}e.async&&e.timeout>0&&setTimeout(function(){x&&!E&&g("timeout")},e.timeout);try{x.send(n==="POST"||n==="PUT"||n==="DELETE"?e.data:null)}catch(m){c.handleError(e,x,null,m);d()}e.async||g();return x}},handleError:function(a,b,d,f){if(a.error)a.error.call(a.context||a,b,d,f);if(a.global)(a.context?c(a.context):c.event).trigger("ajaxError",[b,a,f])},active:0,httpSuccess:function(a){try{return!a.status&&location.protocol==="file:"||a.status>=200&&a.status<300||a.status===304||a.status===
1223||a.status===0}catch(b){}return false},httpNotModified:function(a,b){var d=a.getResponseHeader("Last-Modified"),f=a.getResponseHeader("Etag");if(d)c.lastModified[b]=d;if(f)c.etag[b]=f;return a.status===304||a.status===0},httpData:function(a,b,d){var f=a.getResponseHeader("content-type")||"",e=b==="xml"||!b&&f.indexOf("xml")>=0;a=e?a.responseXML:a.responseText;e&&a.documentElement.nodeName==="parsererror"&&c.error("parsererror");if(d&&d.dataFilter)a=d.dataFilter(a,b);if(typeof a==="string")if(b===
"json"||!b&&f.indexOf("json")>=0)a=c.parseJSON(a);else if(b==="script"||!b&&f.indexOf("javascript")>=0)c.globalEval(a);return a},param:function(a,b){function d(i,o){if(c.isArray(o))c.each(o,function(k,n){b||/\[\]$/.test(i)?f(i,n):d(i+"["+(typeof n==="object"||c.isArray(n)?k:"")+"]",n)});else!b&&o!=null&&typeof o==="object"?c.each(o,function(k,n){d(i+"["+k+"]",n)}):f(i,o)}function f(i,o){o=c.isFunction(o)?o():o;e[e.length]=encodeURIComponent(i)+"="+encodeURIComponent(o)}var e=[];if(b===w)b=c.ajaxSettings.traditional;
if(c.isArray(a)||a.jquery)c.each(a,function(){f(this.name,this.value)});else for(var j in a)d(j,a[j]);return e.join("&").replace(yb,"+")}});var la={},Ab=/toggle|show|hide/,Bb=/^([+-]=)?([\d+-.]+)(.*)$/,W,va=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];c.fn.extend({show:function(a,b){if(a||a===0)return this.animate(K("show",3),a,b);else{a=0;for(b=this.length;a<b;a++){var d=c.data(this[a],"olddisplay");
this[a].style.display=d||"";if(c.css(this[a],"display")==="none"){d=this[a].nodeName;var f;if(la[d])f=la[d];else{var e=c("<"+d+" />").appendTo("body");f=e.css("display");if(f==="none")f="block";e.remove();la[d]=f}c.data(this[a],"olddisplay",f)}}a=0;for(b=this.length;a<b;a++)this[a].style.display=c.data(this[a],"olddisplay")||"";return this}},hide:function(a,b){if(a||a===0)return this.animate(K("hide",3),a,b);else{a=0;for(b=this.length;a<b;a++){var d=c.data(this[a],"olddisplay");!d&&d!=="none"&&c.data(this[a],
"olddisplay",c.css(this[a],"display"))}a=0;for(b=this.length;a<b;a++)this[a].style.display="none";return this}},_toggle:c.fn.toggle,toggle:function(a,b){var d=typeof a==="boolean";if(c.isFunction(a)&&c.isFunction(b))this._toggle.apply(this,arguments);else a==null||d?this.each(function(){var f=d?a:c(this).is(":hidden");c(this)[f?"show":"hide"]()}):this.animate(K("toggle",3),a,b);return this},fadeTo:function(a,b,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,d)},
animate:function(a,b,d,f){var e=c.speed(b,d,f);if(c.isEmptyObject(a))return this.each(e.complete);return this[e.queue===false?"each":"queue"](function(){var j=c.extend({},e),i,o=this.nodeType===1&&c(this).is(":hidden"),k=this;for(i in a){var n=i.replace(ia,ja);if(i!==n){a[n]=a[i];delete a[i];i=n}if(a[i]==="hide"&&o||a[i]==="show"&&!o)return j.complete.call(this);if((i==="height"||i==="width")&&this.style){j.display=c.css(this,"display");j.overflow=this.style.overflow}if(c.isArray(a[i])){(j.specialEasing=
j.specialEasing||{})[i]=a[i][1];a[i]=a[i][0]}}if(j.overflow!=null)this.style.overflow="hidden";j.curAnim=c.extend({},a);c.each(a,function(r,u){var z=new c.fx(k,j,r);if(Ab.test(u))z[u==="toggle"?o?"show":"hide":u](a);else{var C=Bb.exec(u),B=z.cur(true)||0;if(C){u=parseFloat(C[2]);var E=C[3]||"px";if(E!=="px"){k.style[r]=(u||1)+E;B=(u||1)/z.cur(true)*B;k.style[r]=B+E}if(C[1])u=(C[1]==="-="?-1:1)*u+B;z.custom(B,u,E)}else z.custom(B,u,"")}});return true})},stop:function(a,b){var d=c.timers;a&&this.queue([]);
this.each(function(){for(var f=d.length-1;f>=0;f--)if(d[f].elem===this){b&&d[f](true);d.splice(f,1)}});b||this.dequeue();return this}});c.each({slideDown:K("show",1),slideUp:K("hide",1),slideToggle:K("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(a,b){c.fn[a]=function(d,f){return this.animate(b,d,f)}});c.extend({speed:function(a,b,d){var f=a&&typeof a==="object"?a:{complete:d||!d&&b||c.isFunction(a)&&a,duration:a,easing:d&&b||b&&!c.isFunction(b)&&b};f.duration=c.fx.off?0:typeof f.duration===
"number"?f.duration:c.fx.speeds[f.duration]||c.fx.speeds._default;f.old=f.complete;f.complete=function(){f.queue!==false&&c(this).dequeue();c.isFunction(f.old)&&f.old.call(this)};return f},easing:{linear:function(a,b,d,f){return d+f*a},swing:function(a,b,d,f){return(-Math.cos(a*Math.PI)/2+0.5)*f+d}},timers:[],fx:function(a,b,d){this.options=b;this.elem=a;this.prop=d;if(!b.orig)b.orig={}}});c.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this);(c.fx.step[this.prop]||
c.fx.step._default)(this);if((this.prop==="height"||this.prop==="width")&&this.elem.style)this.elem.style.display="block"},cur:function(a){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];return(a=parseFloat(c.css(this.elem,this.prop,a)))&&a>-10000?a:parseFloat(c.curCSS(this.elem,this.prop))||0},custom:function(a,b,d){function f(j){return e.step(j)}this.startTime=J();this.start=a;this.end=b;this.unit=d||this.unit||"px";this.now=this.start;
this.pos=this.state=0;var e=this;f.elem=this.elem;if(f()&&c.timers.push(f)&&!W)W=setInterval(c.fx.tick,13)},show:function(){this.options.orig[this.prop]=c.style(this.elem,this.prop);this.options.show=true;this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur());c(this.elem).show()},hide:function(){this.options.orig[this.prop]=c.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(a){var b=J(),d=true;if(a||b>=this.options.duration+this.startTime){this.now=
this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;for(var f in this.options.curAnim)if(this.options.curAnim[f]!==true)d=false;if(d){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;a=c.data(this.elem,"olddisplay");this.elem.style.display=a?a:this.options.display;if(c.css(this.elem,"display")==="none")this.elem.style.display="block"}this.options.hide&&c(this.elem).hide();if(this.options.hide||this.options.show)for(var e in this.options.curAnim)c.style(this.elem,
e,this.options.orig[e]);this.options.complete.call(this.elem)}return false}else{e=b-this.startTime;this.state=e/this.options.duration;a=this.options.easing||(c.easing.swing?"swing":"linear");this.pos=c.easing[this.options.specialEasing&&this.options.specialEasing[this.prop]||a](this.state,e,0,1,this.options.duration);this.now=this.start+(this.end-this.start)*this.pos;this.update()}return true}};c.extend(c.fx,{tick:function(){for(var a=c.timers,b=0;b<a.length;b++)a[b]()||a.splice(b--,1);a.length||
c.fx.stop()},stop:function(){clearInterval(W);W=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){c.style(a.elem,"opacity",a.now)},_default:function(a){if(a.elem.style&&a.elem.style[a.prop]!=null)a.elem.style[a.prop]=(a.prop==="width"||a.prop==="height"?Math.max(0,a.now):a.now)+a.unit;else a.elem[a.prop]=a.now}}});if(c.expr&&c.expr.filters)c.expr.filters.animated=function(a){return c.grep(c.timers,function(b){return a===b.elem}).length};c.fn.offset="getBoundingClientRect"in s.documentElement?
function(a){var b=this[0];if(a)return this.each(function(e){c.offset.setOffset(this,a,e)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return c.offset.bodyOffset(b);var d=b.getBoundingClientRect(),f=b.ownerDocument;b=f.body;f=f.documentElement;return{top:d.top+(self.pageYOffset||c.support.boxModel&&f.scrollTop||b.scrollTop)-(f.clientTop||b.clientTop||0),left:d.left+(self.pageXOffset||c.support.boxModel&&f.scrollLeft||b.scrollLeft)-(f.clientLeft||b.clientLeft||0)}}:function(a){var b=
this[0];if(a)return this.each(function(r){c.offset.setOffset(this,a,r)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return c.offset.bodyOffset(b);c.offset.initialize();var d=b.offsetParent,f=b,e=b.ownerDocument,j,i=e.documentElement,o=e.body;f=(e=e.defaultView)?e.getComputedStyle(b,null):b.currentStyle;for(var k=b.offsetTop,n=b.offsetLeft;(b=b.parentNode)&&b!==o&&b!==i;){if(c.offset.supportsFixedPosition&&f.position==="fixed")break;j=e?e.getComputedStyle(b,null):b.currentStyle;
k-=b.scrollTop;n-=b.scrollLeft;if(b===d){k+=b.offsetTop;n+=b.offsetLeft;if(c.offset.doesNotAddBorder&&!(c.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(b.nodeName))){k+=parseFloat(j.borderTopWidth)||0;n+=parseFloat(j.borderLeftWidth)||0}f=d;d=b.offsetParent}if(c.offset.subtractsBorderForOverflowNotVisible&&j.overflow!=="visible"){k+=parseFloat(j.borderTopWidth)||0;n+=parseFloat(j.borderLeftWidth)||0}f=j}if(f.position==="relative"||f.position==="static"){k+=o.offsetTop;n+=o.offsetLeft}if(c.offset.supportsFixedPosition&&
f.position==="fixed"){k+=Math.max(i.scrollTop,o.scrollTop);n+=Math.max(i.scrollLeft,o.scrollLeft)}return{top:k,left:n}};c.offset={initialize:function(){var a=s.body,b=s.createElement("div"),d,f,e,j=parseFloat(c.curCSS(a,"marginTop",true))||0;c.extend(b.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"});b.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";
a.insertBefore(b,a.firstChild);d=b.firstChild;f=d.firstChild;e=d.nextSibling.firstChild.firstChild;this.doesNotAddBorder=f.offsetTop!==5;this.doesAddBorderForTableAndCells=e.offsetTop===5;f.style.position="fixed";f.style.top="20px";this.supportsFixedPosition=f.offsetTop===20||f.offsetTop===15;f.style.position=f.style.top="";d.style.overflow="hidden";d.style.position="relative";this.subtractsBorderForOverflowNotVisible=f.offsetTop===-5;this.doesNotIncludeMarginInBodyOffset=a.offsetTop!==j;a.removeChild(b);
c.offset.initialize=c.noop},bodyOffset:function(a){var b=a.offsetTop,d=a.offsetLeft;c.offset.initialize();if(c.offset.doesNotIncludeMarginInBodyOffset){b+=parseFloat(c.curCSS(a,"marginTop",true))||0;d+=parseFloat(c.curCSS(a,"marginLeft",true))||0}return{top:b,left:d}},setOffset:function(a,b,d){if(/static/.test(c.curCSS(a,"position")))a.style.position="relative";var f=c(a),e=f.offset(),j=parseInt(c.curCSS(a,"top",true),10)||0,i=parseInt(c.curCSS(a,"left",true),10)||0;if(c.isFunction(b))b=b.call(a,
d,e);d={top:b.top-e.top+j,left:b.left-e.left+i};"using"in b?b.using.call(a,d):f.css(d)}};c.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),d=this.offset(),f=/^body|html$/i.test(b[0].nodeName)?{top:0,left:0}:b.offset();d.top-=parseFloat(c.curCSS(a,"marginTop",true))||0;d.left-=parseFloat(c.curCSS(a,"marginLeft",true))||0;f.top+=parseFloat(c.curCSS(b[0],"borderTopWidth",true))||0;f.left+=parseFloat(c.curCSS(b[0],"borderLeftWidth",true))||0;return{top:d.top-
f.top,left:d.left-f.left}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||s.body;a&&!/^body|html$/i.test(a.nodeName)&&c.css(a,"position")==="static";)a=a.offsetParent;return a})}});c.each(["Left","Top"],function(a,b){var d="scroll"+b;c.fn[d]=function(f){var e=this[0],j;if(!e)return null;if(f!==w)return this.each(function(){if(j=wa(this))j.scrollTo(!a?f:c(j).scrollLeft(),a?f:c(j).scrollTop());else this[d]=f});else return(j=wa(e))?"pageXOffset"in j?j[a?"pageYOffset":
"pageXOffset"]:c.support.boxModel&&j.document.documentElement[d]||j.document.body[d]:e[d]}});c.each(["Height","Width"],function(a,b){var d=b.toLowerCase();c.fn["inner"+b]=function(){return this[0]?c.css(this[0],d,false,"padding"):null};c.fn["outer"+b]=function(f){return this[0]?c.css(this[0],d,false,f?"margin":"border"):null};c.fn[d]=function(f){var e=this[0];if(!e)return f==null?null:this;if(c.isFunction(f))return this.each(function(j){var i=c(this);i[d](f.call(this,j,i[d]()))});return"scrollTo"in
e&&e.document?e.document.compatMode==="CSS1Compat"&&e.document.documentElement["client"+b]||e.document.body["client"+b]:e.nodeType===9?Math.max(e.documentElement["client"+b],e.body["scroll"+b],e.documentElement["scroll"+b],e.body["offset"+b],e.documentElement["offset"+b]):f===w?c.css(e,d):this.css(d,typeof f==="string"?f:f+"px")}});A.jQuery=A.$=c})(window);

//]]>
</script>
<script id="jqueryArea" type="text/javascript">
//<![CDATA[
/*
jQuery.encoding.digests.sha1.js

SHA-1 digest and associated utility functions

Copyright (c) UnaMesa Association 2009

Dual licensed under the MIT and GPL licenses:
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

if(!$.encoding)
	$.encoding = {};
	$.extend($.encoding,{
		strToBe32s: function(str) {
			// Convert a string to an array of big-endian 32-bit words
			var be=[];
			var len=Math.floor(str.length/4);
			var i, j;
			for(i=0, j=0; i<len; i++, j+=4) {
				be[i]=((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
			}
			while(j<str.length) {
				be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
				j++;
			}
			return be;
		},
		be32sToStr: function(be) {
			// Convert an array of big-endian 32-bit words to a string
			var str='';
			for(var i=0;i<be.length*32;i+=8) {
				str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
			}
			return str;
		},
		be32sToHex: function(be) {
			// Convert an array of big-endian 32-bit words to a hex string
			var hex='0123456789ABCDEF';
			var str='';
			for(var i=0;i<be.length*4;i++) {
				str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
			}
			return str;
		}
	});
})(jQuery);


(function($) {

if(!$.encoding.digests)
	$.encoding.digests = {};
	$.extend($.encoding.digests,{
		hexSha1Str: function(str) {
			// Return, in hex, the SHA-1 hash of a string
			return $.encoding.be32sToHex($.encoding.digests.sha1Str(str));
		},
		sha1Str: function(str) {
			// Return the SHA-1 hash of a string
			return sha1($.encoding.strToBe32s(str),str.length);
		},
		sha1: function(x,blen) {
			// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
			return sha1($.encoding.strToBe32s(str),str.length);
		}
	});

	// Private functions.
	function sha1(x,blen) {
		// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
		function add32(a,b) {
			// Add 32-bit integers, wrapping at 32 bits
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			var lsw=(a&0xFFFF)+(b&0xFFFF);
			var msw=(a>>16)+(b>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function AA(a,b,c,d,e) {
			// Cryptographic round helper function. Add five 32-bit integers, wrapping at 32 bits, second parameter is rotated left 5 bits before the addition
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			b=(b>>>27)|(b<<5);
			var lsw=(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
			var msw=(a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function RR(w,j) {
			// Cryptographic round helper function.
			var n=w[j-3]^w[j-8]^w[j-14]^w[j-16];
			return (n>>>31)|(n<<1);
		}

		var len=blen*8;
		x[len>>5] |= 0x80 << (24-len%32);
		x[((len+64>>9)<<4)+15]=len;
		var w=new Array(80);

		var k1=0x5A827999;
		var k2=0x6ED9EBA1;
		var k3=0x8F1BBCDC;
		var k4=0xCA62C1D6;

		var h0=0x67452301;
		var h1=0xEFCDAB89;
		var h2=0x98BADCFE;
		var h3=0x10325476;
		var h4=0xC3D2E1F0;

		for(var i=0;i<x.length;i+=16) {
			var j=0;
			var t;
			var a=h0;
			var b=h1;
			var c=h2;
			var d=h3;
			var e=h4;
			while(j<16) {
				w[j]=x[i+j];
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<20) {
				w[j]=RR(w,j);
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<40) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k2);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<60) {
				w[j]=RR(w,j);
				t=AA(e,a,(b&c)|(d&(b|c)),w[j],k3);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<80) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k4);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			h0=add32(h0,a);
			h1=add32(h1,b);
			h2=add32(h2,c);
			h3=add32(h3,d);
			h4=add32(h4,e);
		}
		return [h0,h1,h2,h3,h4];
	}
})(jQuery);
/*
jQuery.twStylesheet.js

jQuery plugin to dynamically insert CSS rules into a document

Usage:
  jQuery.twStylesheet applies style definitions
  jQuery.twStylesheet.remove neutralizes style definitions

Copyright (c) UnaMesa Association 2009

Triple licensed under the BSD, MIT and GPL licenses:
  http://www.opensource.org/licenses/bsd-license.php
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

var defaultId = "customStyleSheet"; // XXX: rename to dynamicStyleSheet?

// Add or replace a style sheet
// css argument is a string of CSS rule sets
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
// N.B.: Uses DOM methods instead of jQuery to ensure cross-browser comaptibility.
$.twStylesheet = function(css, options) {
	options = options || {};
	var id = options.id || defaultId;
	var doc = options.doc || document;
	var el = doc.getElementById(id);
	if(doc.createStyleSheet) { // IE-specific handling
		if(el) {
			el.cssText = css;
		} else {
			doc.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd",
				'&nbsp;<style id="' + id + '" type="text/css">' + css + '</style>'); // fails without &nbsp;
		}
	} else { // modern browsers
		if(el) {
			el.replaceChild(doc.createTextNode(css), el.firstChild);
		} else {
			el = doc.createElement("style");
			el.type = "text/css";
			el.id = id;
			el.appendChild(doc.createTextNode(css));
			doc.getElementsByTagName("head")[0].appendChild(el);
		}
	}
};

// Remove existing style sheet
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
$.twStylesheet.remove = function(options) {
	options = options || {};
	var id = options.id || defaultId;
	var doc = options.doc || document;
	var el = doc.getElementById(id);
	if(el) {
		el.parentNode.removeChild(el);
	}
};

})(jQuery);
//]]>
</script>
<script type="text/javascript">
//<![CDATA[
if(useJavaSaver)
	document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
</script>
<!--POST-SCRIPT-START-->

<!--POST-SCRIPT-END-->
</body>
</html>
