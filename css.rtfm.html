<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script id="versionArea" type="text/javascript">
//<![CDATA[
var version = {title: "TiddlyWiki", major: 2, minor: 4, revision: 1, date: new Date("Aug 4, 2008"), extensions: {}};
//]]>
</script>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="copyright" content="
TiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) UnaMesa Association 2004-2008

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the UnaMesa Association nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS' AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
" />
<!--PRE-HEAD-START-->
<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' />
<!--}}}-->
<!--PRE-HEAD-END-->
<title> CSS &amp; HTML Notes - robs ramblings </title>
<style id="styleArea" type="text/css">
#saveTest {display:none;}
#messageArea {display:none;}
#copyright {display:none;}
#storeArea {display:none;}
#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}
#shadowArea {display:none;}
#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}
</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.checkUnsavedChanges) checkUnsavedChanges(); if(window.scrubNodes) scrubNodes(document.body);">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
<div id="copyright">
Welcome to TiddlyWiki created by Jeremy Ruston, Copyright &copy; 2007 UnaMesa Association
</div>
<noscript>
	<div id="javascriptWarning">This page requires JavaScript to function properly.<br /><br />If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.</div>
</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstageButton"></div>
<div id="backstageArea"><div id="backstageToolbar"></div></div>
<div id="backstage">
	<div id="backstagePanel"></div>
</div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="shadowArea">
<div title="MarkupPreHead">
<pre>&lt;!--{{{--&gt;
&lt;link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' /&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="ColorPalette">
<pre>Background: #fff
Foreground: #000
PrimaryPale: #8cf
PrimaryLight: #18f
PrimaryMid: #04b
PrimaryDark: #014
SecondaryPale: #ffc
SecondaryLight: #fe8
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #eee
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88</pre>
</div>
<div title="StyleSheetColors">
<pre>/*{{{*/
body {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}

a {color:[[ColorPalette::PrimaryMid]];}
a:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}
a img {border:0;}

h1,h2,h3,h4,h5,h6 {color:[[ColorPalette::SecondaryDark]]; background:transparent;}
h1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}
h2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}

.button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}
.button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}
.button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}

.header {background:[[ColorPalette::PrimaryMid]];}
.headerShadow {color:[[ColorPalette::Foreground]];}
.headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}
.headerForeground {color:[[ColorPalette::Background]];}
.headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}

.tabSelected{color:[[ColorPalette::PrimaryDark]];
	background:[[ColorPalette::TertiaryPale]];
	border-left:1px solid [[ColorPalette::TertiaryLight]];
	border-top:1px solid [[ColorPalette::TertiaryLight]];
	border-right:1px solid [[ColorPalette::TertiaryLight]];
}
.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}
.tabContents {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::TertiaryPale]]; border:1px solid [[ColorPalette::TertiaryLight]];}
.tabContents .button {border:0;}

#sidebar {}
#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}
#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}

.wizard {background:[[ColorPalette::PrimaryPale]]; border:1px solid [[ColorPalette::PrimaryMid]];}
.wizard h1 {color:[[ColorPalette::PrimaryDark]]; border:none;}
.wizard h2 {color:[[ColorPalette::Foreground]]; border:none;}
.wizardStep {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];
	border:1px solid [[ColorPalette::PrimaryMid]];}
.wizardStep.wizardStepDone {background:[[ColorPalette::TertiaryLight]];}
.wizardFooter {background:[[ColorPalette::PrimaryPale]];}
.wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}
.wizard .button {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;
	border-color:[[ColorPalette::SecondaryPale]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryPale]];}
.wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}
.wizard .button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;
	border-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];}
	
.wizard .notChanged {background:transparent;}
.wizard .changedLocally {background:#80ff80;}
.wizard .changedServer {background:#8080ff;}
.wizard .changedBoth {background:#ff8080;}
.wizard .notFound {background:#ffff80;}
.wizard .putToServer {background:#ff80ff;}
.wizard .gotFromServer {background:#80ffff;}

#messageArea {border:1px solid [[ColorPalette::SecondaryMid]]; background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]];}
#messageArea .button {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none;}

.popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}

.popup {background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]]; border-left:1px solid [[ColorPalette::TertiaryMid]]; border-top:1px solid [[ColorPalette::TertiaryMid]]; border-right:2px solid [[ColorPalette::TertiaryDark]]; border-bottom:2px solid [[ColorPalette::TertiaryDark]];}
.popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}
.popup li.disabled {color:[[ColorPalette::TertiaryMid]];}
.popup li a, .popup li a:visited {color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:active {background:[[ColorPalette::SecondaryPale]]; color:[[ColorPalette::Foreground]]; border: none;}
.popupHighlight {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
.listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}

.tiddler .defaultCommand {font-weight:bold;}

.shadow .title {color:[[ColorPalette::TertiaryDark]];}

.title {color:[[ColorPalette::SecondaryDark]];}
.subtitle {color:[[ColorPalette::TertiaryDark]];}

.toolbar {color:[[ColorPalette::PrimaryMid]];}
.toolbar a {color:[[ColorPalette::TertiaryLight]];}
.selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}
.selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}

.tagging, .tagged {border:1px solid [[ColorPalette::TertiaryPale]]; background-color:[[ColorPalette::TertiaryPale]];}
.selected .tagging, .selected .tagged {background-color:[[ColorPalette::TertiaryLight]]; border:1px solid [[ColorPalette::TertiaryMid]];}
.tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}
.tagging .button, .tagged .button {border:none;}

.footer {color:[[ColorPalette::TertiaryLight]];}
.selected .footer {color:[[ColorPalette::TertiaryMid]];}

.sparkline {background:[[ColorPalette::PrimaryPale]]; border:0;}
.sparktick {background:[[ColorPalette::PrimaryDark]];}

.error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}
.warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}
.lowlight {background:[[ColorPalette::TertiaryLight]];}

.zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}

.imageLink, #displayArea .imageLink {background:transparent;}

.annotation {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border:2px solid [[ColorPalette::SecondaryMid]];}

.viewer .listTitle {list-style-type:none; margin-left:-2em;}
.viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}
.viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}

.viewer table, table.twtable {border:2px solid [[ColorPalette::TertiaryDark]];}
.viewer th, .viewer thead td, .twtable th, .twtable thead td {background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::Background]];}
.viewer td, .viewer tr, .twtable td, .twtable tr {border:1px solid [[ColorPalette::TertiaryDark]];}

.viewer pre {border:1px solid [[ColorPalette::SecondaryLight]]; background:[[ColorPalette::SecondaryPale]];}
.viewer code {color:[[ColorPalette::SecondaryDark]];}
.viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}

.highlight, .marked {background:[[ColorPalette::SecondaryLight]];}

.editor input {border:1px solid [[ColorPalette::PrimaryMid]];}
.editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%;}
.editorFooter {color:[[ColorPalette::TertiaryMid]];}

#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}
#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }
#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}
#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}
.backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}
.backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}
#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:'alpha(opacity:60)';}
/*}}}*/</pre>
</div>
<div title="StyleSheetLayout">
<pre>/*{{{*/
* html .tiddler {height:1%;}

body {font-size:.75em; font-family:arial,helvetica; margin:0; padding:0;}

h1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}
h1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}
h4,h5,h6 {margin-top:1em;}
h1 {font-size:1.35em;}
h2 {font-size:1.25em;}
h3 {font-size:1.1em;}
h4 {font-size:1em;}
h5 {font-size:.9em;}

hr {height:1px;}

a {text-decoration:none;}

dt {font-weight:bold;}

ol {list-style-type:decimal;}
ol ol {list-style-type:lower-alpha;}
ol ol ol {list-style-type:lower-roman;}
ol ol ol ol {list-style-type:decimal;}
ol ol ol ol ol {list-style-type:lower-alpha;}
ol ol ol ol ol ol {list-style-type:lower-roman;}
ol ol ol ol ol ol ol {list-style-type:decimal;}

.txtOptionInput {width:11em;}

#contentWrapper .chkOptionInput {border:0;}

.externalLink {text-decoration:underline;}

.indent {margin-left:3em;}
.outdent {margin-left:3em; text-indent:-3em;}
code.escaped {white-space:nowrap;}

.tiddlyLinkExisting {font-weight:bold;}
.tiddlyLinkNonExisting {font-style:italic;}

/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */
a.tiddlyLinkNonExisting.shadow {font-weight:bold;}

#mainMenu .tiddlyLinkExisting,
	#mainMenu .tiddlyLinkNonExisting,
	#sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}
#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}

.header {position:relative;}
.header a:hover {background:transparent;}
.headerShadow {position:relative; padding:4.5em 0em 1em 1em; left:-1px; top:-1px;}
.headerForeground {position:absolute; padding:4.5em 0em 1em 1em; left:0px; top:0px;}

.siteTitle {font-size:3em;}
.siteSubtitle {font-size:1.2em;}

#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}

#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}
#sidebarOptions {padding-top:0.3em;}
#sidebarOptions a {margin:0em 0.2em; padding:0.2em 0.3em; display:block;}
#sidebarOptions input {margin:0.4em 0.5em;}
#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}
#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}
#sidebarOptions .sliderPanel input {margin:0 0 .3em 0;}
#sidebarTabs .tabContents {width:15em; overflow:hidden;}

.wizard {padding:0.1em 1em 0em 2em;}
.wizard h1 {font-size:2em; font-weight:bold; background:none; padding:0em 0em 0em 0em; margin:0.4em 0em 0.2em 0em;}
.wizard h2 {font-size:1.2em; font-weight:bold; background:none; padding:0em 0em 0em 0em; margin:0.4em 0em 0.2em 0em;}
.wizardStep {padding:1em 1em 1em 1em;}
.wizard .button {margin:0.5em 0em 0em 0em; font-size:1.2em;}
.wizardFooter {padding:0.8em 0.4em 0.8em 0em;}
.wizardFooter .status {padding:0em 0.4em 0em 0.4em; margin-left:1em;}
.wizard .button {padding:0.1em 0.2em 0.1em 0.2em;}

#messageArea {position:fixed; top:2em; right:0em; margin:0.5em; padding:0.5em; z-index:2000; _position:absolute;}
.messageToolbar {display:block; text-align:right; padding:0.2em 0.2em 0.2em 0.2em;}
#messageArea a {text-decoration:underline;}

.tiddlerPopupButton {padding:0.2em 0.2em 0.2em 0.2em;}
.popupTiddler {position: absolute; z-index:300; padding:1em 1em 1em 1em; margin:0;}

.popup {position:absolute; z-index:300; font-size:.9em; padding:0; list-style:none; margin:0;}
.popup .popupMessage {padding:0.4em;}
.popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0em;}
.popup li.disabled {padding:0.4em;}
.popup li a {display:block; padding:0.4em; font-weight:normal; cursor:pointer;}
.listBreak {font-size:1px; line-height:1px;}
.listBreak div {margin:2px 0;}

.tabset {padding:1em 0em 0em 0.5em;}
.tab {margin:0em 0em 0em 0.25em; padding:2px;}
.tabContents {padding:0.5em;}
.tabContents ul, .tabContents ol {margin:0; padding:0;}
.txtMainTab .tabContents li {list-style:none;}
.tabContents li.listLink { margin-left:.75em;}

#contentWrapper {display:block;}
#splashScreen {display:none;}

#displayArea {margin:1em 17em 0em 14em;}

.toolbar {text-align:right; font-size:.9em;}

.tiddler {padding:1em 1em 0em 1em;}

.missing .viewer,.missing .title {font-style:italic;}

.title {font-size:1.6em; font-weight:bold;}

.missing .subtitle {display:none;}
.subtitle {font-size:1.1em;}

.tiddler .button {padding:0.2em 0.4em;}

.tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}
.isTag .tagging {display:block;}
.tagged {margin:0.5em; float:right;}
.tagging, .tagged {font-size:0.9em; padding:0.25em;}
.tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}
.tagClear {clear:both;}

.footer {font-size:.9em;}
.footer li {display:inline;}

.annotation {padding:0.5em; margin:0.5em;}

* html .viewer pre {width:99%; padding:0 0 1em 0;}
.viewer {line-height:1.4em; padding-top:0.5em;}
.viewer .button {margin:0em 0.25em; padding:0em 0.25em;}
.viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}
.viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}

.viewer table, table.twtable {border-collapse:collapse; margin:0.8em 1.0em;}
.viewer th, .viewer td, .viewer tr,.viewer caption,.twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}
table.listView {font-size:0.85em; margin:0.8em 1.0em;}
table.listView th, table.listView td, table.listView tr {padding:0px 3px 0px 3px;}

.viewer pre {padding:0.5em; margin-left:0.5em; font-size:1.2em; line-height:1.4em; overflow:auto;}
.viewer code {font-size:1.2em; line-height:1.4em;}

.editor {font-size:1.1em;}
.editor input, .editor textarea {display:block; width:100%; font:inherit;}
.editorFooter {padding:0.25em 0em; font-size:.9em;}
.editorFooter .button {padding-top:0px; padding-bottom:0px;}

.fieldsetFix {border:0; padding:0; margin:1px 0px 1px 0px;}

.sparkline {line-height:1em;}
.sparktick {outline:0;}

.zoomer {font-size:1.1em; position:absolute; overflow:hidden;}
.zoomer div {padding:1em;}

* html #backstage {width:99%;}
* html #backstageArea {width:99%;}
#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em 0.3em 0.5em;}
#backstageToolbar {position:relative;}
#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em 0.3em 0.5em;}
#backstageButton {display:none; position:absolute; z-index:175; top:0em; right:0em;}
#backstageButton a {padding:0.1em 0.4em 0.1em 0.4em; margin:0.1em 0.1em 0.1em 0.1em;}
#backstage {position:relative; width:100%; z-index:50;}
#backstagePanel {display:none; z-index:100; position:absolute; width:90%; margin:0em 3em 0em 3em; padding:1em 1em 1em 1em;}
.backstagePanelFooter {padding-top:0.2em; float:right;}
.backstagePanelFooter a {padding:0.2em 0.4em 0.2em 0.4em;}
#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}

.whenBackstage {display:none;}
.backstageVisible .whenBackstage {display:block;}
/*}}}*/</pre>
</div>
<div title="StyleSheetLocale">
<pre>/***
StyleSheet for use when a translation requires any css style changes.
This StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which need larger font sizes.
***/
/*{{{*/
body {font-size:0.8em;}
#sidebarOptions {font-size:1.05em;}
#sidebarOptions a {font-style:normal;}
#sidebarOptions .sliderPanel {font-size:0.95em;}
.subtitle {font-size:0.8em;}
.viewer table.listView {font-size:0.95em;}
/*}}}*/</pre>
</div>
<div title="StyleSheetPrint">
<pre>/*{{{*/
@media print {
#mainMenu, #sidebar, #messageArea, .toolbar, #backstageButton, #backstageArea {display: none ! important;}
#displayArea {margin: 1em 1em 0em 1em;}
/* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */
noscript {display:none;}
}
/*}}}*/</pre>
</div>
<div title="PageTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;
&lt;div class='headerShadow'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class='headerForeground'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea'&gt;
&lt;div id='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="ViewTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="EditTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::EditToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div macro='annotations'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="GettingStarted">
<pre>To get started with this blank TiddlyWiki, you'll need to modify the following tiddlers:
* SiteTitle &amp; SiteSubtitle: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* MainMenu: The menu (usually on the left)
* DefaultTiddlers: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;</pre>
</div>
<div title="OptionsPanel">
<pre>These InterfaceOptions for customising TiddlyWiki are saved in your browser

Your username for signing your edits. Write it as a WikiWord (eg JoeBloggs)

&lt;&lt;option txtUserName&gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; SaveBackups
&lt;&lt;option chkAutoSave&gt;&gt; AutoSave
&lt;&lt;option chkRegExpSearch&gt;&gt; RegExpSearch
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; CaseSensitiveSearch
&lt;&lt;option chkAnimate&gt;&gt; EnableAnimations

----
Also see AdvancedOptions</pre>
</div>
<div title="ImportTiddlers">
<pre>&lt;&lt;importTiddlers&gt;&gt;</pre>
</div>
</div>
<!--POST-SHADOWAREA-->

<!--TIDDLYSPOT_INJECT-->
<div style="display:none"><img src="http://tiddlyspot.com/_ts/stats/css.rtfm"/></div>
<!--TCEJNI_TOPSYLDDIT-->

<!--TIDDLYSPOT_INJECT-->
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">_uacct="UA-96965-3";urchinTracker();</script>

<!--TCEJNI_TOPSYLDDIT-->
<div id="storeArea">
<div title="! important" modifier="rvr" created="201509122121" modified="201509122122" changecount="21">
<pre>To make sure that our CSS is not overridden, even by [[inline]], we can use ''! important''.
&lt;html&gt;&lt;pre&gt;
  .warning {
    color: red !important;
  }
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="A-E" modifier="rvr" created="201101062108" modified="202210091016" changecount="69">
<pre>[[absolute]]
[[after and before]]
[[anchor]]
[[animation]]
[[attribute]]
[[background]]
[[basic HTML]]
[[block]]
[[body]]
[[Bootstrap]]
[[Bootstrap buttons]]
[[Bootstrap classes]]
[[Bootstrap container]]
[[Bootstrap dropdown]]
[[Bootstrap form inputs]]
[[Bootstrap forms]]
[[Bootstrap images]]
[[Bootstrap input]]
[[Bootstrap table]]
[[border]]
[[box example]]
[[Box Model]]
[[box shadow]]
[[box-sizing]]
[[child selector]]
[[circle]]
[[class]]
[[class and id]]
[[class selector]]
[[classes - context dependant]]
[[clear]]
[[colors]]
[[comments]]
[[context dependant]]
[[CSS]]
[[CSS best practices]]
[[CSS Grids]]
[[CSS guidelines]]
[[CSS Performance]]
[[CSS Rules]]
[[CSS Styles]]
[[Custom Properties|variables]] - variables
[[display]]
[[div]]
[[document]]
[[element]]
[[element space]]
[[element type selector]]
[[em]] 
[[emmet]]
[[example stylesheet]]
[[examples]]
[[external stylesheet]]
</pre>
</div>
<div title="Bootstrap" modifier="rvr" created="201507131607" modified="201712170305" changecount="64">
<pre>''Bootstrap'' is a commonly used ''framework'' created by Twitter. It helps keeps things consistent across platforms.
Bootstrap will figure out how wide your screen is and resize your HTML elements. This means the design will look good on mobile as well as web, regardless of screen width.
It can be added to a Rails app via a gem, or it can be added by using the [[link]] tag:
&lt;html&gt;&lt;pre&gt;
&amp;lt;link rel=&quot;stylesheet&quot; href=&quot;http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css&quot; /&amp;gt;
or
&amp;lt;link rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css&quot;&gt;
&lt;/pre&gt;&lt;/html&gt;
Using the text editor ''Sublime Text 3'' - there are some great linters to use. See [[ST3 Linter]].
Important concepts:
*[[Bootstrap container]]
*Bootstrap [[grid]]
*In container there are rows,which will contain 1-12 columns (ie [[grid]])
*Columns contain padding. More then 12 columns, then it will wrap.
*[[typography]]
*[[Bootstrap table]]
*[[Bootstrap forms]]
*[[Bootstrap input]]
*[[Bootstrap buttons]]
*[[Bootstrap images]]
*[[Bootstrap dropdown]]
*[[collapse]] - to hide content.
*[[breadcrumb]]
*[[Navs]] - used more for in page navigation
*[[Navbars]] - used more for site wide navigation
*[[tooltip]]
Bootstrap has a 12 column [[grid]] system for layout.
See [[Bootstrap forms]] and then [[Bootstrap form inputs]].
Bootstrap has many classes predefined, see [[Bootstrap classes]].
Cheat sheet - https://bootstrapcreative.com/resources/bootstrap-4-css-classes-index/
</pre>
</div>
<div title="Bootstrap buttons" modifier="rvr" created="201509131431" modified="201703200603" changecount="58">
<pre>The ''button'' element creates a clickable button. This example uses the [[Bootstrap]] framework (by calling class=&quot;btn&quot;).
&lt;html&gt;&lt;pre&gt;
  &amp;lt;button class=&quot;btn&quot;&amp;gt;Click Me!&amp;lt;/button&amp;gt;
  &lt;button &gt;Click Me!&lt;/button&gt;
&lt;/pre&gt;&lt;/html&gt;
A button will not perform a [[submit]], so when used in a form it is anticipated that some javascript will perform the submit. You have more freedom to modify the text (even use an image) of the button than a submit. You can use buttons with the ''anchor'' element (ie &lt;a...&gt;) and with the ''input'' element, (ie &lt;input...&gt;)
!!Example
A log in button that once clicked will show an italicized &quot;Logging in...&quot; and a spinning wait icon.
&lt;html&gt;&lt;pre&gt;
&lt;a class=&quot;btn btn-primary&quot; href=&quot;#&quot; role=&quot;button&quot;&gt;Anchor&lt;/a&gt;
&amp;lt;a class=&quot;btn btn-primary&quot; href=&quot;#&quot; role=&quot;button&quot;&gt;Anchor&amp;lt;/a&gt;
&lt;button class=&quot;btn btn-primary&quot; type=&quot;submit&quot;&gt;Button&lt;/button&gt;
&amp;lt;button class=&quot;btn btn-primary&quot; type=&quot;submit&quot;&gt;Button&amp;lt;/button&gt;
&lt;input class=&quot;btn btn-primary&quot; type=&quot;button&quot; value=&quot;Input&quot;&gt;
&amp;lt;input class=&quot;btn btn-primary&quot; type=&quot;button&quot; value=&quot;Input&quot;&gt;
&lt;input class=&quot;btn btn-primary&quot; type=&quot;submit&quot; value=&quot;Submit This&quot;&gt;
&amp;lt;input class=&quot;btn btn-primary&quot; type=&quot;submit&quot; value=&quot;Submit This&quot;&gt;
&lt;/pre&gt;&lt;/html&gt;
See [[toggle]] example.
!!Bootstrap classes
There are a number of [[Bootstrap]] classes to enhance buttons:
*''btn'' - is the basic [[inline]] class, meaning that it is only large enough to hold the text it contains.
*''btn-group'' - group buttons/checkbox/radio as one group. Use ''div'' element to wrap all concerned widgets.
**''btn-group-sm'' - small buttons
**''btn-group-lg'' - large buttons
*''btn-group-vertical'' - to group vertically.
*''btn-block'' - is the [[block]]-level class for the element, meaning the button covers the whole width of the screen.
*''btn-lg'' - large button size.
*''btn-sm'' - not large.
*''disabled'' - disable


|!Class|!Outline|!Description|
|btn-primary|btn-outline-primary|Typically blue, text white.|
|btn-secondary|btn-outline-secondary|Clear with black text.|
|btn-info|btn-outline-info|Light blue.|
|btn-success|btn-outline-success|Green button.|
|btn-warning|btn-outline-warning|Yellow.|
|btn-danger|btn-outline-danger|Typically styled red.|
|btn-link|none|Almost looks like one, no outside &quot;button&quot; border&quot;.|
The ''btn-outline-*'' class applies color to outline only.

</pre>
</div>
<div title="Bootstrap classes" modifier="rvr" created="201509141734" modified="201703172207" changecount="10">
<pre>Bootstrap has many classes to use.
Here are some

|!Class|!Description|
|''text-center''|to center text.|
|''btn''|Does [[button|Bootstrap buttons]] elements styling.|
|''btn-default''|Does...|
|''well''|Provides visual depth for columns.|
|''target''|Provides a target for jQuery.|</pre>
</div>
<div title="Bootstrap container" modifier="rvr" created="201703160425" modified="202209071759" changecount="22">
<pre>A Bootstrap container is for holding HTML elements and implementing a grid system.
A container is fluid or fixed, inside a container you can use the [[grid]] system.
!!Fixed Container
A fixed container is HTML responsive. Resizing a browser the width remains constant, until it passes a certain breakpoint when it will jump to a new width.
&lt;html&gt;&lt;pre&gt;
&amp;lt;div class=&quot;container&quot;&gt;
  ...
&amp;lt/div&gt;
&lt;/pre&gt;&lt;/html&gt;
!!Fluid Container
A fluid container spans the full width of the [[viewport]]. It will expand and contract fluidly as you resize the browser.
&lt;html&gt;&lt;pre&gt;
&amp;lt;div class=&quot;container-fluid&quot;&amp;gt;
  ...
&amp;lt;/div&amp;gt;
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="Bootstrap dropdown" modifier="rvr" created="201703200226" modified="201703201759" changecount="43">
<pre>Bootstrap dropdown requires javascript, but it comes packaged so you don't have to add anything. Make sure 
*to wrap everything in the dropdown class (first ''div'' statement.)
*add the ''dropdown-toggle'' Bootstrap class and add ''data-toggle=&quot;dropdown&quot;'' to the trigger element (in below it is the ''button'' element.)
* Wrap all items within a ''div'' element and add the Bootstrap class ''dropdown-menu'' .
*All items use the class ''dropdown-item''.
&lt;html&gt;&lt;pre&gt;
&amp;lt;div class=&quot;dropdown&quot;&gt;
  &amp;lt;button class=&quot;btn btn-primary dropdown-toggle&quot; type=&quot;button&quot; id=&quot;about-us&quot; data-toggle=&quot;dropdown&quot;&gt;
  Fruit Backet
  &amp;lt;/button&gt;
    &amp;lt;div class=&quot;dropdown-menu&quot; &gt;
    &amp;lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;Avacado&amp;lt;/a&gt;
    &amp;lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;Mango&amp;lt;/a&gt;
    &amp;lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;Watermelon&amp;lt;/a&gt;
  &amp;lt;/div&gt;
&amp;lt;/div&gt;
&lt;/pre&gt;&lt;/html&gt;Can substitute ''dropup'' for ''dropdown''.
You can have dropdown headers in the item list: ''dropdown-header''
You can also have dividers: ''dropdown-divider''
To disable use ''disabled'' (see potato)
&lt;html&gt;&lt;pre&gt;
&amp;lt;div class=&quot;dropdown&quot;&gt;
  &amp;lt;button class=&quot;btn btn-primary dropdown-toggle&quot; type=&quot;button&quot; id=&quot;about-us&quot; data-toggle=&quot;dropdown&quot; &gt;
  Food
  &amp;lt;/button&gt;
  &amp;lt;div class=&quot;dropdown-menu&quot;&gt;
    &amp;lt;h3 class=&quot;dropdown-header&quot;&gt;Fruit&amp;lt;/h3&gt;
    &amp;lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;Mango&amp;lt;/a&gt;
    &amp;lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;Peach&amp;lt;/a&gt;
   &amp;lt;div class=&quot;dropdown-divider&quot;&gt;&lt;/div&gt;
    &amp;lt;h3 class=&quot;dropdown-header&quot;&gt;Veggies&amp;lt;/h3&gt;
    &amp;lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;Carrrot&amp;lt;/a&gt;
    &amp;lt;a class=&quot;dropdown-item disabled&quot; href=&quot;#&quot;&gt;Potato&amp;lt;/a&gt;
  &amp;lt;/div&gt;
&amp;lt;/div&gt;
&lt;/pre&gt;&lt;/html&gt;
There is an example of dropdown mixed in with [[Nav bars]], see [[nav dropdown example]].</pre>
</div>
<div title="Bootstrap form inputs" modifier="rvr" created="201604010927" modified="201703180011" changecount="25">
<pre>Bootstrap supports these form inputs: input, textarea, checkbox, radio, and select.
Bootstrap 4 provides these classes for displaying checkboxes and radio buttons.
*''form-check''
*''form-check-label''
*''form-check-input''
*''form-check-inline''
To display the checkboxes or radio buttons stacked, nest each one inside a &lt;div&gt; with the ''form-check'' class.
&lt;html&gt;&lt;pre&gt;
&amp;lt;div class=&quot;form-check&quot;&gt;
  &amp;lt;label class=&quot;form-check-label&quot;&gt;
    &amp;lt;input class=&quot;form-check-input&quot; type=&quot;checkbox&quot; id=&quot;checkbox1&quot; value=&quot;1&quot;&gt;Apple
  &amp;lt;/label&gt;
&amp;lt;/div&gt;
&amp;lt;div class=&quot;form-check&quot;&gt;
  &amp;lt;label class=&quot;form-check-label&quot;&gt;
    &amp;lt;input class=&quot;form-check-input&quot; type=&quot;checkbox&quot; id=&quot;checkbox2&quot; value=&quot;2&quot;&gt;Coconut
  &amp;lt;/label&gt;
&amp;lt;/div&gt;
&lt;/pre&gt;&lt;/html&gt;
And just for fun...
&lt;html&gt;&lt;pre&gt;
&lt;input class=&quot;form-check-input&quot; type=&quot;checkbox&quot; id=&quot;checkbox1&quot; value=&quot;1&quot;&gt;Apple
&lt;input class=&quot;form-check-input&quot; type=&quot;checkbox&quot; id=&quot;checkbox2&quot; value=&quot;2&quot;&gt;Coconut
&lt;/pre&gt;&lt;/html&gt;
To disable a control, use class: ''disabled''
&gt;&lt;div class=&quot;form-check disabled&quot;&gt;
!Inline
Display controls inline by removing the  ''div'' element and adding the ''form-check-inline'' class to the element ''label''.
&lt;html&gt;&lt;pre&gt;
&amp;lt;label class=&quot;form-check-inline&quot;&gt;
  &amp;lt;input class=&quot;form-check-input&quot; type=&quot;checkbox&quot; id=&quot;cb1&quot; value=&quot;1&quot;&gt; 1
&amp;lt;/label&gt;
&amp;lt;label class=&quot;form-check-inline&quot;&gt;
  &amp;lt;input class=&quot;form-check-input&quot; type=&quot;checkbox&quot; id=&quot;cb2&quot; value=&quot;2&quot;&gt; 2
&amp;lt;/label&gt;
&amp;lt;label class=&quot;form-check-inline&quot;&gt;
  &amp;lt;input class=&quot;form-check-input&quot; type=&quot;checkbox&quot; id=&quot;cb3&quot; value=&quot;3&quot;&gt; 3
&amp;lt;/label&gt;
&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="Bootstrap forms" modifier="rvr" created="201603291109" modified="201705151829" changecount="42">
<pre>Bootstrap comes with lots of for styling for ''forms''. See also [[Bootstrap input]]. There are three styles:
*vertical styling (default)
*horizontal styling
*inline
Bootstrap applies display: block and width: 100% to most form controls.
Here are a couple of good basics to follow:
*Wrap labels and form controls using HTML element ''fieldset'' and class ''.form-group'', example: @@&lt;fieldset class=&quot;form-group&quot;&gt;@@
**Alternatively, wrap all labels and form controls in a ''div'': @@&lt;div class=&quot;form-group&quot;&gt;@@  
*Add class ''.form-control'' to all &lt;input&gt;, &lt;textarea&gt;, and &lt;select&gt; elements.
*Hide labels, use @@class=&quot;sr-only&quot;@@
**This is useful if you don't want a label, you are using a ''placeholder'' as the label.
**This is useful for dropdown where you want just the down arrow, no label.
*Have labels in text input, use: @@placeholder=&quot;First Name&quot;@@
More fancy form styling see [[more styling forms]].
!!Vertical Styling
Using the above basics, an example of the default vertical styling:
&lt;html&gt;&lt;pre&gt;
&amp;lt;form ... &gt;
  &amp;lt;fieldset class=&quot;form-group&quot;&gt;
    &amp;lt;label for=&quot;first_name&quot; class=&quot;sr-only&quot;&gt;First Name:&amp;lt;/label&gt;
    &amp;lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;first_name&quot; placeholder=&quot;First Name&quot;&gt;
  &amp;lt;fieldset&gt;
  &amp;lt;button type=&quot;submit&quot; class=&quot;btn btn-default&quot;&gt;Submit&amp;lt;/button&gt;
&amp;lt;/form&gt;
&lt;/pre&gt;&lt;/html&gt;
!!To make it inline:
&lt;html&gt;&lt;pre&gt;&amp;lt;form class=&quot;form-inline&quot;&gt; ...&lt;/pre&gt;&lt;/html&gt;
See also [[vertical-align]]
!!For horizontal
Some things...
*Add a ''row'' class to the ''form-group''
*v3: Add @@class=&quot;form-horizontal&quot; @@ to the &lt;form&gt; element. (Not needed for Bootstrap4)
*v3: Add @@class=&quot;control-label&quot;@@ to all &lt;label&gt; elements. 
*v4: Add @@class=&quot;col-form-label&quot;@@ to all &lt;label&gt; elements.  
*Add the grid class: ''.col-*-*'' for each column. Below we used: @@col-sm-2@@
&lt;html&gt;&lt;pre&gt;
&amp;lt;form class=&quot;form-horizontal&quot;&gt;
  &amp;lt;div class=&quot;form-group row&quot;&gt;
    &amp;lt;label class=&quot;col-form-label col-sm-2&quot; for=&quot;email&quot;&gt;Email:&amp;lt;/label&gt;
    &amp;lt;div class=&quot;col-sm-10&quot;&gt;
      &amp;lt;input type=&quot;email&quot; class=&quot;form-control&quot; name=&quot;email&quot; placeholder=&quot;Enter email&quot;&gt;
    &amp;lt;/div&gt;
  &amp;lt;/div&gt;
&lt;/pre&gt;&lt;/html&gt;
Next - [[Bootstrap form inputs]].
</pre>
</div>
<div title="Bootstrap images" modifier="rvr" created="201703180035" modified="201703210027" changecount="23">
<pre>Bootstrap images make them responsive.

|!Class|!Description|
|img-fluid|To make an image scale appropriately across devices.|
|img-responsive|v3 - to make an image scale appropriately across devices.|
|img-rounded|To round edges of image.|
|img-circle|Image in a circle.|
|img-thumbnail|A thumbnail.|
|pull-*-left|Pull to left. * is xs, sm, md, lg, or xl.|
|pull-*-right|Pull to right. * is xs, sm, md, lg, or xl.|
Caution: ''pull-*'' for navbar was changed to ''float-*''.

Centering [[block] level Images - Use Bootstrap's ''m-x-auto'' to center an image with d-block applied.
&lt;html&gt;&lt;pre&gt;
&amp;lt;img src=&quot;/pix/something.jpg&quot; class=&quot;img-circle m-x-auto d-block&quot; alt=&quot;Photo of something&quot;&gt;
&lt;/pre&gt;&lt;/html&gt;
Centering non-block level Images - Use Bootstrap's ''text-*-center'' (*= is xs, sm, md, lg, or xl.) classes on the image's parent to center a non-block-level image.
&lt;html&gt;&lt;pre&gt;
&amp;lt;div class=&quot;text-xs-center&quot;&gt;
  &amp;lt;img src=&quot;/pix/something.jpg&quot; class=&quot;img-circle&quot; alt=&quot;Photo of something&quot;&gt;
&amp;lt;/div&gt;
&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="Bootstrap input" modifier="rvr" created="201703200603" modified="201703200612" changecount="43">
<pre>To have a bit more styling only on the  ''input'' element.
This example will have a &quot;$&quot; followed by an input field followed by a &quot;.00&quot;. To do so wrap it all in ''input-group'' and use ''input-group-addon'' to add on the element that you want to add to the form control.
&lt;html&gt;&lt;pre&gt;
&amp;lt;div class=&quot;input-group&quot;&gt;
  &amp;lt;span class=&quot;input-group-addon&quot;&gt;$&amp;lt;/span&gt;
  &amp;lt;input type=&quot;text&quot; class=&quot;form-control&quot; &gt;
  &amp;lt;span class=&quot;input-group-addon&quot;&gt;.00&amp;lt;/span&gt;
&amp;lt;/div&gt;
&lt;/pre&gt;&lt;/html&gt;
Change size by using: ''input-group-sm'' or ''input-group-lg''
You can also add on checkboxes or radio buttons.</pre>
</div>
<div title="Bootstrap table" modifier="rvr" created="201703160527" modified="201703160534" changecount="21">
<pre>You can add more styling by adding the bootstrap class.
Example: @@ &lt;table class=&quot;table&quot;&gt;...@@
More:
*Make smaller table: @@&lt;table class=&quot;table table-sm&quot;&gt;...@@@
*Horiz scrollbars: @@&lt;table class=&quot;table table-responsive&quot;&gt;...@@
*Inverse color: @@&lt;table class=&quot;table table-inverse&quot;&gt;...@@
*Striped rows: @@&lt;table class=&quot;table table-striped&quot;&gt;...@@
*Borders: @@&lt;table class=&quot;table table-bordered&quot;&gt;...@@
*Hover: @@&lt;table class=&quot;table table-hover&quot;&gt;...@@
*Table Head style: @@&lt;thead class=&quot;thead-default&quot;&gt;...@@
*Table Head inverse: @@&lt;thead class=&quot;thead-inverse&quot;&gt;@@
*Table Head on LHS: @@&lt;table class=&quot;table table-reflow&quot;&gt;...@@

</pre>
</div>
<div title="Box Model" modifier="rvr" created="201004042221" modified="202209041814" changecount="73">
<pre>The ''Box Model'' concerns design and layout. Consider everything in CSS to be in boxes. It places a margin &amp; border around elements and spaces elements in relation to other elements. It is layered from the outer most edge to the inside, like nested boxes:
*[[margin]] - Controls space. Clears an area around the border to other elements/boxes. Has no background color, and is always transparent. It affects other content in relation to it!
*[[border]] - Appearance of a boundary or not. Lies around the padding and content. Is affected by the background color of the box
*[[padding]] - Controls space. Clears an area around the content and provides empty space before the border. Is affected by the background color of the box
*''content'' - Text &amp; images - this is the inside portion of the box model.
Box total width is calculated: @@content-width + padding-left + padding-right + border-left + border-right + left and right margin@@
Box total height is calculated: @@content-height + padding-top + padding-bottom + border-top + border-bottom + top and bottom margin@@
There is a @@color:red;tricky css property@@ called [[box-sizing]] that changes the above rules - it ignores all padding/margin being added and fits it all inside ''content-width''.
If padding or borders are undeclared then a value of zero is used.
Use [[margin]] to separate the block or box from things outside it
Use [[padding]] to move the contents away from the edges of the block or box.
This model acts differently depending if we are using [[inline]] vs [[block]].
Note: The box model is important to understand when it comes to [[positioning]]. 
See also a [[box example]] and [[Flexbox]].</pre>
</div>
<div title="CDelements" modifier="rvr" created="201406280650" changecount="10">
<pre>The ''element'' tab of the Chrome Developer Tools, shows you what the source of the page is, and formatted as it sees it.
You see what HTML elements are styled by which css.
The top listed css attributes are the precedence they are applied.
The &quot;Computed Style&quot; shows what is computed based on a % or a value applied in some other element.</pre>
</div>
<div title="CDnetwork" modifier="rvr" created="201406280705" changecount="10">
<pre>The network tab shows various loading times of each part of the web page.</pre>
</div>
<div title="CSS" modifier="rvr" created="201407060620" modified="202208311619" changecount="21">
<pre>Cascading Style Sheets (CSS) is to be used to format content. The size &amp; color of fonts. It allows us to describe the layouts. The size and position of elements. The whole webpage is styled by css.

Cascading is used because the order of stylesheets cascades. 

# User-agent stylesheets are browser defaults. Like size of H1 tag
# User stylesheets, override the above and are user preferences. Like a Red H1
# Author stylesheets - this is where we will be working.

CSS is simply a series of declarations, following the [[CSS Rules]]. CSS is built with [[selector]]s, properties, and values.
Format: ''property: value;'' and then apply this rule to what element by using a [[selector]]. 
An example would be: @@ ''h1 { color: red; margin: 13px; }'' @@

Check out [[CSS Rules]] and [[CSS guidelines]].

CSS has to be linked to a web page. Can be done in three ways:
*inline - right in the HTML code. Don't use this.
*[[internal stylesheet]] 
*[[external stylesheet]] - this is what I prefer, best for any real project

There are [[frameworks]] such as [[Bootstrap]] to help with things.
See [[grid of images example]].

In the Developer screen in Chrome, in the &quot;styles&quot; tab, it will list the order or priority, but reversing it, so the most important css rules are first! 
As you go further down the page, there will be more overridden css rules, with --strikethrough--. </pre>
</div>
<div title="CSS Grids" modifier="rvr" created="202209051939" modified="202210102100" changecount="41">
<pre>CSS Grids is a two-dimensional grid that defines multiple areas of layout with just a few CSS rules
[[Flexbox]] is great for single rows and columns and is responsive, but we get better control where elements end up by using CSS Grids. And, grid items can be other grid containers. Flexbox and CSS grids work together well.
CSS Grids are similar to Bootstrap grids, but Bootstrap has predefined breakpoints based on the min-width media queries. I think I will prefer CSS grids over bootstrap.
Let's start: 
* [[grid terminology]]
* [[grid start]]
* [[grid properties]]
** [[grid rows &amp; columns]]
** [[grid positioning]] - where in the grid to position.
** [[grid alignment]] - where to align in the cell.
** [[grid spanning]] - multiple rows or columns.
* [[grid naming]] - instead of numbers, names
* [[grid area]] - define areas by name

</pre>
</div>
<div title="CSS Performance" modifier="rvr" created="202209101000" modified="202209161158" changecount="13">
<pre>Time for  ''CSS Performance'' info.  Here we go:
* Browsers read right to left.
** ''#specific &gt; p '' - this will get all paragraphs first!
*Expensive properties
** These are: [[box-shadow]], text-shadow, transform, position:fixed, nth-child etc
*Don't use unused style. Get rif of them.
*Minify CSS files
</pre>
</div>
<div title="CSS Rules" modifier="rvr" created="201004022310" modified="202209151458" changecount="77">
<pre>CSS rules require a [[selector]] and the [[property]] to change:
&lt;html&gt;&lt;pre&gt;   selector {declaration;}      // basic format
   selector {property:value;}   // more detail format
&lt;/pre&gt;&lt;/html&gt;
Some examples: &lt;html&gt;&lt;pre&gt;
   p{color:pink;}               // an example of an element type selector - all &quot;p&quot; tags
   p{font-family:verdana;}      // again, all p tags.
   footer p{color:red;}         // only p tags in footer 
   .make-blue { color: blue; }  // an example of a class selector
   #do-it { color: green; }     // an example of an ID selector.
&lt;/pre&gt;&lt;/html&gt;The [[selector]] is the [[element]] that you want to define. The declaration is style [[attribute]] that you want to define &amp; a value. code inside the squiggly brackets is called: &quot;Declaration Block&quot;.
We can also group rules with common declarations:
&lt;html&gt;&lt;pre&gt;
  h1, h2, h3 { color:red; }   
&lt;/pre&gt;&lt;/html&gt;
CSS reads from the top of the file down, so if there are conflicting CSS rules, the latest one wins!
CSS also gives precedence to more specific rules. The [[chain]] example shows this. Example: @@#some-id.alert@@ is more specific than @@.alert@@.
An [[example stylesheet]].</pre>
</div>
<div title="CSS Styles" modifier="rvr" created="201004022344" modified="201004051557" changecount="52">
<pre>CSS can modify styles that are inherit in HTML tags, they can also add styling characteristics, like:
*[[background]]
*[[display]]
*[[text]]
*[[font]]
*[[list]]
*[[table]]
*[[height]] and width
*[[float]]
Note that I cover some detail with background, but not with all styles.</pre>
</div>
<div title="CSS best practices" modifier="rvr" created="202209100938" modified="202209100952" changecount="11">
<pre>There are many different CSS best practices. I won't go further than a quick intro:
*Object Oriented CSS
*Atomic CSS.
*Inverted Triangle CSS (ITCSS)
*Scalable And Module Architecture for CSS (SMACSS)
*and finally BEM, described below, as an example

Block Element Modifier (BEM) is organizing your CSS into three parts:
* ''Block'' - stand-alone entity with independent meaning
** If we are styling a menu area, its a &quot;block&quot;. Have class name for all CSS like ''class=&quot;menu&quot; ''
* ''Element'' - part of block with no standalone use.
** This would be styled as ''class=&quot;menu_item&quot; ''
* ''Modifier''  - Small falgs on elements, to change stylesm variants.
** This would be styled as ''class=&quot;menu menu_disabled&quot; ''
This is easy to read but does get bulky.

See [[Good CSS]].
</pre>
</div>
<div title="CSS guidelines" modifier="rvr" created="201511221220" modified="202208311629" changecount="7">
<pre>Some basic ''CSS guidelines''.
The document should have the following format:
&lt;html&gt;&lt;pre&gt;
&amp;lt;!DOCTYPE html&gt;
&amp;lt;html&gt;
  &amp;lt;head&gt;
    &amp;lt;title&gt;Some title&amp;lt;/title&gt;
  &amp;lt;/head&gt;
  &amp;lt;body&gt;
    &amp;lt;header&gt;
      # Code such as nav bars, logo
    &amp;lt;/header&gt;
    &amp;lt;main&gt;
      # Main code.
    &amp;lt;/main&gt;
    &amp;lt;section&gt;
      # Can also use sections
    &amp;lt;/section&gt;
    &amp;lt;footer&gt;
      # Footer code!
    &amp;lt;/footer&gt;
  &amp;lt;/body&gt;
&amp;lt;/html&gt;
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="Chrome Developer Tools" modifier="rvr" created="201406280639" modified="201406280711" changecount="10">
<pre>The ''Chrome Developer Tools'' are very useful. To access quickly in Win8:
*right-click element on web page and choose ''inspect element''. 
*cntrl-shift-i
The tools are:
*[[Elements|CDelements]] -  You can see the web page as the browser sees it: raw HTML, CSS styles, and the DOM aka Document Object Model.
*[[Network|CDnetwork]] - You can see the various loading times of each part of the web page.
*[[Scripts|CDscripts]]
*[[Timeline|CDtimeline]]
*[[Profiles|CDprofile]]
*[[Storage|CDstorage]]
*[[Audit|CDaudit]]
*[[Console|CDconsole]]
To move around use cntl-] and cntl-[</pre>
</div>
<div title="DefaultTiddlers" modifier="rvr" created="200906011623" modified="201004022303" changecount="3">
<pre>[[Introduction]]</pre>
</div>
<div title="F-L" modifier="rvr" created="201004051706" modified="202210061541" changecount="96">
<pre>[[fieldset]]
[[first-child and last-child]]
[[first-line]]
[[Flex Item Shortcuts]] 
[[Flexbox]]
[[Flexbox layout options]]
[[flexbox page example]]
[[float]]
[[font]]
[[Font Awesome]]
[[form]] aka ''input form''
[[framework]]
[[Good CSS]]
[[Grid|CSS Grids]] - CSS Grids
[[grid properties]] - CSS Grids
[[grid]]
[[grid of images example]]
[[head]]
[[header]] 
[[height]]
[[hover]]
[[HTML]]
[[HTML element]]
[[ID]]
[[inherit]]
[[image darker]]
[[Image Sprites]]
[[images]]
[[! important]]
[[inline]]
[[input]]
[[input form|form]]
[[input types]]
[[internal stylesheet]]
[[legend|fieldset]]
[[link]]
[[list]]</pre>
</div>
<div title="Flex Item Shortcuts" modifier="rvr" created="201705222332" modified="201705230131" changecount="34">
<pre>You can use shortcuts in defining [[flexbox properties]] 
An example: @@ flex: 1 1 0;@@  = equals =  @@flex: &lt;flex-grow&gt; &lt;flex-shrink&gt; &lt;flex-basis&gt; @@
The default values for these properties can be shown in shorthand: @@: flex: 0 1 auto;@@ which equals: 
&lt;html&gt;&lt;pre&gt;
flex-grow: 0;
flex-shrink: 1;
flex-basis: auto;
&lt;/pre&gt;&lt;/html&gt;
There is an even more shorthand, @@ flex: 1 1 0;@@ is the same as @@ flex: 1; @@ &amp;larr; I don't like that.
*flex-grow : 1; - expand in proportion relative to the rest of the flexible items (ie if all 1s then all expand the same.)
*flex-shrink : 1; - how much to shrink relative to the rest of the flexible items (ie 2 will shrink 2x as fast as a 1)
*flex-basis : 0; - does not have a starting value. Takes up space available evenly.
</pre>
</div>
<div title="Flexbox" modifier="rvr" created="201705190453" modified="202209051159" changecount="52">
<pre>Flexbox is a layout system  that is for building responsive websites. Regardless of screen size, it will adjust to look good based on window size.
It is like a flexible [[Box Model]].
There are a few things to know
*A flexbox is set in css via: @@ [[display]]: flex @@
** Typically we set a flexbox using a div or section [[tags]]. That element is then a ''flex container''.
*A ''flex container'' contains, surprise: ''flex items''
** These &quot;flex items&quot; are tags like div, section, etc - all children of the initial tag we call a ''flex container''.
*When you set the parent container as a ''flexbox'' container, then all its immediate children are automatically ''flex items''.
**Even if they do not specifically set a ''flex item'' (see [[flexbox properties]]), the default kicks in: @@ flex: 0 1 auto;@@
*''flex items'' -  can be aligned, stretched, shrunk, ... and they fit the entire ''flex container'' space.
*You can nest a Flex container in a Flex item!
A good place to set the flex container is on the [[body]] tag - for setting up an entire page. 
Let's now check out the [[Flexbox layout options]].
A good example for setting a page with flexbox: [[flexbox page example]].
</pre>
</div>
<div title="Flexbox layout options" modifier="rvr" created="202209051203" modified="202209051311" changecount="12">
<pre>There are default options when creating a Flexbox via the css: ''display: flex;''.  See [[flexbox properties]]. This covers flexbox containers. See also [[flexbox items]].

There is a direction component:
* &quot;main-axis&quot; - the direction flex items are laid out
** ''flex-direction: row;'' means flex-items are placed L to R horizontally
** ''flex-direction: column;'' flex-items are stacked vertically from top to bottom
* &quot;cross-axis&quot; - opposite of above. If above is horizontal, then this is vertical.

Direction. The css default is: ''flex-direction: row;''  
* This means main-axis is horizontal.
* ''row'' means that the flexbox items follow each other left to right in a row from LHS.
* ''row-reverse'' means that the flexbox items follow each other right to left in a row - from RHS.

Direction. If we set the css as: ''flex-direction: column;''  
* This means main-axis is vertical.
* ''column'' means the items are stacked vertically from top to bottom.
* ''column-reverse '' means the items are stacked vertically from bottom to top
If we have a row direction we can use ''justify-content'':
*with a value of ''flex-start'' to line them up on the left hand side.
*with a value of ''flex-end''  to line them up on the right hand side.
*with a ''space-around'' to evenly space them.
If we have a column direction we can use both:
* ''align-items:flex-end;'' or ''align-items: center;''
* ''gap: 13px;''

If we overflow our container, use ''flex-wrap:wrap''</pre>
</div>
<div title="Font Awesome" modifier="rvr" created="201509141609" modified="201608300316" changecount="12">
<pre>This is a library of icons, stored as vectors (.svg) so they are treated as if a font. Therefore you can change their size easily!
It is treated as a font so you can use: @@&lt;i class=&quot;fa fa-trash&quot;&gt;&lt;/i&gt;@@ to get a garbage can icon.
Anyways, you can access it via [[link]] :
&lt;html&gt;&lt;pre&gt;&amp;lt;link rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css&quot;&amp;gt;
...
&amp;lt--  Add a garbage can icon --&amp;gt;
&amp;lt;button class=&quot;btn btn-block btn-danger&quot;&amp;gt;&amp;lt;i class=&quot;fa fa-trash&quot;&amp;gt;&amp;lt;/i&amp;gt; Delete&amp;lt;/button&amp;gt;
&lt;/pre&gt;&lt;/html&gt;
To get a thumbs-up icon on the &quot;Like&quot; button, it's just...
&lt;html&gt;&lt;pre&gt;
&amp;lt;button class=&quot;btn btn-block btn-primary&quot;&amp;gt;&amp;lt;i class=&quot;fa fa-thumbs-up&quot;&amp;gt;&amp;lt;/i&amp;gt; Like&amp;lt;/button&amp;gt;
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="Good CSS" modifier="rvr" created="202209100929" modified="202209100954" changecount="11">
<pre>There are some good practices here.
* Keep consistent. Get a design plan before coding.
* Don't place CSS in HTML
* Do use responsive design.
* Understand and use cascading.  Understand [[Selector Specificity]].
* Try and keep it DRY (Rubies: Don't repeat yourself)
* Group similar things.

Check out [[CSS best practices]] and [[CSS Performance]].
</pre>
</div>
<div title="HTML" modifier="rvr" created="201005252128" modified="202209071753" changecount="30">
<pre>HTML is a language for display content that uses [[element]]s, which are comprised of [[tags]]. 
You should always choose the ~UTF-8 character encoding, Like: @@&lt;meta charset=&quot;utf-8&quot;/&gt;@@
It is also an [[element]]! Albeit, a special one, see [[HTML element]].
The [[form]] element has [[input]] tags that allow server side processing to occur.
An HTML [[document]] has 2 main sections, a [[head]] and a [[body]]:
&lt;html&gt;&lt;pre&gt;
&amp;lt;!DOCTYPE html&gt;
&amp;lt;html lang=&quot;en&quot;&gt;
  &amp;lt;head&gt; 
     &amp;lt;title&gt;Some Title&amp;lt;/title&gt;
     &amp;lt;meta charset=&quot;utf-8&quot;/&gt;
     ... 
  &amp;lt;/head&gt;
  &amp;lt;body&gt;
   ... 
  &amp;lt;/body&gt;
&amp;lt;/html&gt;
&lt;/pre&gt;&lt;/html&gt;
There are two types of HTML [[element]]s : &lt;- &quot;inline&quot; and &quot;block-level&quot;.
</pre>
</div>
<div title="HTML element" modifier="rvr" created="201509122043" modified="201601101315" changecount="22">
<pre>The [[element]] HTML is a special one, it is the base element. It has it's height automatically assigned by the width &amp; height of the browser. 
This has the curious effect that the [[body]] element can actually be larger then the HTML element! 
What?
There is the [[overflow]] property, so if it is set to ''visible'' on the HTML element, then we will see all the body, otherwise overflowed test is hidden., </pre>
</div>
<div title="ID" modifier="rvr" created="201406271650" modified="201705100704" changecount="21">
<pre>The ''ID'' is a fragment identifier. Also known as an ''id selector''.  You know its an ID when it starts with a hash (''@@#@@'').  A [[class]] starts with a ''dot''! (''@@.@@''). 
It should identify a unique element, and only occur once in a document (or page for javascript). 
It overrides any ''class''. And [[inline]] trumps all, except if you use [[! important]].
 It is meant for single elements, not a whole class (see [[class selector]]) of elements. We declare it using the ''hash'' symbol like: @@#id-selector-name {declaration;}@@:
To identify an ID use the hash: ''#''. Classes will use a period: ''.''

The CSS (these are poor examples):&lt;html&gt;&lt;pre&gt;
p#blue { color: blue; } 
p#bold { font-weight:bold; } 
#red  { background-color: red; } 
&lt;/pre&gt;&lt;/html&gt;
The HTML&lt;html&gt;&lt;pre&gt;
&amp;lt;p id=&quot;bold&quot;&amp;gt; This will be BOLD&amp;lt;/p&amp;gt;
&amp;lt;p id=&quot;blue&quot;&amp;gt; This will be Blue&amp;lt;/p&amp;gt;
&amp;lt;p id=&quot;red&quot;&amp;gt;This paragraph has a red background. &amp;lt;/p&amp;gt;
&lt;/pre&gt;&lt;/html&gt;
You can also omit the element so that it can be applied anywhere:
&lt;html&gt;&lt;pre&gt;
#bold
&lt;/pre&gt;&lt;/html&gt;
You can [[chain]] [[class]] selector with ID selector.</pre>
</div>
<div title="Image Sprites" modifier="rvr" created="202209062024" modified="202209062050" changecount="13">
<pre>Image Sprites is a collection of images put into a single image. This is useful to save bandwidth.
Example: Image is: width x height : 50x500 pixels - there are 10 images stacked, first at 0,0, second at 0,-50, last one at 0,-450
&lt;html&gt;&lt;pre&gt;
/* CSS */
.sprite {
    background: url(&quot;qwerty.png&quot;) no-repeat;
}
.one {
    width: 50px; 
    height: 50px; 
    display: inline-block;  
    background-position: 0 0px;  
}
.ten {
    width: 50px; 
    height: 50px; 
    display: inline-block;  
    background-position: 0 -450px; 
}  

/*  HTML  */
    &amp;lt;span class=&quot;sprite one&quot;&gt;&amp;lt;/span&gt;
    &amp;lt;span class=&quot;sprite ten&quot;&gt;&amp;lt;/span&gt;
&lt;/pre&gt;&lt;/html&gt;
Ya, you'll see both images.</pre>
</div>
<div title="Introduction" modifier="rvr" created="200905302331" modified="202210061036" changecount="113">
<pre>[[HTML]] is best for defining content. Understand the definitions in [[HTML]].
[[CSS]] is to be used to format or style content. Understand the definitions in [[CSS]].

There will probably be many changes as I'm looking at this again like 5 years later. Get right of cruft.

What is [[Good CSS]]?
See some [[examples]] of css in actual code.
There is also a whole bunch of [[Bootstrap]] in this wiki. But I now prefer [[CSS Grids]] over bootstrap.
The heart of HTML is [[tags]] - which is an [[element]] surrounded by angle brackets, ie an anchor tag: ''&lt;a&gt;''. 
The heart of [[CSS]] is [[CSS Rules]] used to select elements to format. Syntax is:&lt;html&gt;&lt;pre&gt;   selector { declaration; }        // Can have many declarations
   selector { property:value; }     // a declaration is made of of 2 parts: property:value; &lt;/pre&gt;&lt;/html&gt;
CSS Rules specify a [[selector]] and a property and [[attribute]]s to style.
Examples: &lt;html&gt;&lt;pre&gt;
h1, h2, h3, h4 { color: #009900;} // Combine the selectors. }
p#bold { font-weight:bold; }      // This is used by an ID
p.rvr { background-color: red;}   // This is used by a class
div { border: 3px solid green; }  // All divs will have this styling.
&lt;/pre&gt;&lt;/html&gt;
Key definitions - understand them...
*The [[ID]] styles a unique element, and only occur once in a document. These use the hash ''#''.
*The [[class]] styles all elements with the specified class. These use the period ''.''.

Other introduction topics, in a good order would be:
*CSS [[selector]]
*[[class and id]]
*[[CSS]]
*[[CSS Rules]]
*[[CSS Styles]]
*[[pseudo-class]]
*[[Font Awesome]]
*[[SASS]]
*[[context dependant]]
*[[Box Model]]
*[[Flexbox]]
*[[positioning]]
*[[animation]]
*Ways to to make an HTML document use css:
**[[internal stylesheet]] 
**[[external stylesheet]] - this is what I prefer
**inline - right in the HTML code. Don't use this.
*[[Chrome Developer Tools]]
*CSS [[tricks]]
</pre>
</div>
<div title="LoadRemoteFileThroughProxy" modifier="YourName" created="200703202229" modified="200905302326" tags="systemConfig">
<pre>/***
|''Name:''|LoadRemoteFileThroughProxy (previous LoadRemoteFileHijack)|
|''Description:''|When the TiddlyWiki file is located on the web (view over http) the content of [[SiteProxy]] tiddler is added in front of the file url. If [[SiteProxy]] does not exist &quot;/proxy/&quot; is added. |
|''Version:''|1.1.0|
|''Date:''|mar 17, 2007|
|''Source:''|http://tiddlywiki.bidix.info/#LoadRemoteFileHijack|
|''Author:''|BidiX (BidiX (at) bidix (dot) info)|
|''License:''|[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D ]]|
|''~CoreVersion:''|2.2.0|
***/
//{{{
version.extensions.LoadRemoteFileThroughProxy = {
 major: 1, minor: 1, revision: 0, 
 date: new Date(&quot;mar 17, 2007&quot;), 
 source: &quot;http://tiddlywiki.bidix.info/#LoadRemoteFileThroughProxy&quot;};

if (!window.bidix) window.bidix = {}; // bidix namespace
if (!bidix.core) bidix.core = {};

bidix.core.loadRemoteFile = loadRemoteFile;
loadRemoteFile = function(url,callback,params)
{
 if ((document.location.toString().substr(0,4) == &quot;http&quot;) &amp;&amp; (url.substr(0,4) == &quot;http&quot;)){ 
 url = store.getTiddlerText(&quot;SiteProxy&quot;, &quot;/proxy/&quot;) + url;
 }
 return bidix.core.loadRemoteFile(url,callback,params);
}
//}}}
</pre>
</div>
<div title="M-R" modifier="rvr" created="202209081300" modified="202209100908" changecount="9">
<pre>[[margin]] 
[[margin examples]]
[[media queries]]
[[meta tags]]
[[more styling forms]]
[[Nav bars]]
[[nav dropdown example]]
[[nav tab dropdown example]]
[[negative margins]]
[[overflow]] 
[[padding]]
[[positioning]]
[[preprocessor]]
[[property]]
[[pseudo-class]]
[[pseudo-elements]]
[[radio button]]
[[relative]]
[[rem|units]] - units
[[responsive web design]]
[[rgba]]
[[root element]]</pre>
</div>
<div title="MainMenu" modifier="rvr" created="200905302328" modified="202209081301" changecount="31">
<pre>[[Introduction]]
[[Bootstrap]]

!!Index
[[A-E]]
[[F-L]]
[[M-R]]
[[S-Z]]
[[special chars]]

!!Other Sites
[[Jekyll &amp; Templates|http://template.rtfm.tiddlyspot.com/]]
[[jQuery Notes|http://jquery.rtfm.tiddlyspot.com]]
[[Ajax Notes|http://ajax.rtfm.tiddlyspot.com]]
[[Angular Notes|http://angular.rtfm.tiddlyspot.com]]
[[Javascript Notes|http://javascript.rtfm.tiddlyspot.com]]
[[Nodes Notes|http://node.rtfm.tiddlyspot.com]]

[[Ruby|http://ruby.rtfm.tiddlyspot.com]]
[[Rails|http://rails.rtfm.tiddlyspot.com]]
[[Linux|http://linux.rtfm.tiddlyspot.com]]
[[Gems|http://gems.rtfm.tiddlyspot.com]]</pre>
</div>
<div title="Navbars" modifier="rvr" created="201703201944" modified="201703210026" changecount="43">
<pre>Bootstrap uses ''navbars'' for site wide navigation. Just [[Navs]] is used for in page navigation. The semantics are very similar.
Basic navbar details:
*Wrap it all in a ''navbar'' class, plus any styling/coloring classes.
**To fix: ''navbar-fixed-top'' or ''navbar-fixed-bottom''. (Note fixed if the webpage scrolls.)
***So a fixed nav bar does not hide content you'll need: ''body { padding-top: 77px; }''
**Like ''navbar-light'', ''navbar-dark''
**Like ''bg-faded'', ''bg-primary'', ''bg-inverse''. 
**For other colors, omit any ''bg-'' class and have in css: ''nav {background-color: yerColor;}''
*The whole list is an ''&lt;ul&gt;'' element, add class ''nav navbar-nav''
**To float components left or right use: ''float-*-left'', ''float-*-right'' (*=xs, sm, md, lg, xl)
**Each item is an ''&lt;li&gt;'' element, add class ''nav-item''
**Each link is an ''&lt;a&gt;'' element , ad class ''nav-link''
&lt;html&gt;&lt;pre&gt;
&amp;lt;nav class=&quot;navbar navbar-light bg-faded&quot;&gt;
  &amp;lt;a class=&quot;navbar-brand&quot; href=&quot;#&quot;&gt;Da Logo&amp;lt;/a&gt;

  &amp;lt;ul class=&quot;nav navbar-nav float-md-right&quot;&gt;
    &amp;lt;li class=&quot;nav-item&quot;&gt;
      &amp;lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;Home&amp;lt;/a&gt;
    &amp;lt;/li&gt;
    &amp;lt;li class=&quot;nav-item&quot;&gt;
      &amp;lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;About&amp;lt;/a&gt;
    &amp;lt;/li&gt;
    &amp;lt;li class=&quot;nav-item&quot;&gt;
      &amp;lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;Contact&amp;lt;/a&gt;
    &amp;lt;/li&gt;
  &amp;lt;/ul&gt;
&amp;lt;/nav&gt;
&lt;/pre&gt;&lt;/html&gt;In this above example the logo will be on the LHS and the 3 list items will be on the RHS
</pre>
</div>
<div title="Navs" modifier="rvr" created="201703200625" modified="201705160221" changecount="46">
<pre>Navigation Bars. The ''nav'' classes allow you to turn lists into navigation bars.
The outer &quot;&lt;ul&gt;&quot; or &quot;&lt;nav&gt;&quot; elements must have the class ''nav'':
*&lt;ul class=&quot;nav&quot;&gt;
**Each &quot;&lt;li&gt;&quot; must have a: ''nav-item''
**Also, there will be an &quot;&lt;a&gt;&quot; - like below.
**This will give a vertical list of nav links.
**A nice thing about ''nav-item'' is that an item can be a [[Bootstrap dropdown]] See [[nav dropdown example]].
*&lt;nav class=&quot;nav&quot;&gt;
**Each &quot;&lt;a&gt;&quot; must have a: ''nav-link''
**Eg: &lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;Dog&lt;/a&gt;
**This will give a horizontal list of links.
One element must have an ''active'' Bootstrap class.
The below can also be a&quot;&lt;ul&gt;&quot; type, just wrap each &quot;&lt;a&gt;&quot; in @@&lt;li class=&quot;nav-item&quot;&gt; ... &lt;/li&gt;@@
&lt;html&gt;&lt;pre&gt;
&amp;lt;nav class=&quot;nav&quot;&gt;
  &amp;lt;a class=&quot;nav-link active&quot; href=&quot;#&quot;&gt;Aardvark&amp;lt;/a&gt;
  &amp;lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;Bonobo&amp;lt;/a&gt;
  &amp;lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;Chicken&amp;lt;/a&gt;
  &amp;lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;Dog&amp;lt;/a&gt;
&amp;lt;/nav&gt;
&lt;/pre&gt;&lt;/html&gt;Produces&lt;html&gt;&lt;pre&gt;
&lt;a class=&quot;nav-link active&quot; href=&quot;#&quot;&gt;Aardvark&lt;/a&gt; &lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;Bonobo&lt;/a&gt; &lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;Chicken&lt;/a&gt; &lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;Dog&lt;/a&gt;
&lt;/pre&gt;&lt;/html&gt;
More customization
*Add Bootstrap class ''nav-inline'' to both &quot;&lt;ul&gt;&quot; and &quot;nav&gt;&quot; to give a horizontal nav bar with spaces.
*Add Bootstrap class ''nav-tabs'' to make tabs, be sure to pick one item as ''active''.
*Add Bootstrap class ''nav-pills'' to make pills (button-like), be sure to pick one item as ''active''.
**Use Bootstrap class ''nav-stacked'' to stack pills vertically.

See [[nav dropdown example]].
See [[nav tab dropdown example]] with bonus class ''tab-pane''.
</pre>
</div>
<div title="PasswordOptionsPlugin" modifier="YourName" created="200704220851" modified="200905302326" tags="systemConfig">
<pre>/***
|''Name:''|PasswordOptionPlugin|
|''Description:''|Extends TiddlyWiki options with non encrypted password option.|
|''Version:''|1.0.2|
|''Date:''|Apr 19, 2007|
|''Source:''|http://tiddlywiki.bidix.info/#PasswordOptionPlugin|
|''Author:''|BidiX (BidiX (at) bidix (dot) info)|
|''License:''|[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D ]]|
|''~CoreVersion:''|2.2.0 (Beta 5)|
***/
//{{{
version.extensions.PasswordOptionPlugin = {
	major: 1, minor: 0, revision: 2, 
	date: new Date(&quot;Apr 19, 2007&quot;),
	source: 'http://tiddlywiki.bidix.info/#PasswordOptionPlugin',
	author: 'BidiX (BidiX (at) bidix (dot) info',
	license: '[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D]]',
	coreVersion: '2.2.0 (Beta 5)'
};

config.macros.option.passwordCheckboxLabel = &quot;Save this password on this computer&quot;;
config.macros.option.passwordInputType = &quot;password&quot;; // password | text
setStylesheet(&quot;.pasOptionInput {width: 11em;}\n&quot;,&quot;passwordInputTypeStyle&quot;);

merge(config.macros.option.types, {
	'pas': {
		elementType: &quot;input&quot;,
		valueField: &quot;value&quot;,
		eventName: &quot;onkeyup&quot;,
		className: &quot;pasOptionInput&quot;,
		typeValue: config.macros.option.passwordInputType,
		create: function(place,type,opt,className,desc) {
			// password field
			config.macros.option.genericCreate(place,'pas',opt,className,desc);
			// checkbox linked with this password &quot;save this password on this computer&quot;
			config.macros.option.genericCreate(place,'chk','chk'+opt,className,desc);			
			// text savePasswordCheckboxLabel
			place.appendChild(document.createTextNode(config.macros.option.passwordCheckboxLabel));
		},
		onChange: config.macros.option.genericOnChange
	}
});

merge(config.optionHandlers['chk'], {
	get: function(name) {
		// is there an option linked with this chk ?
		var opt = name.substr(3);
		if (config.options[opt]) 
			saveOptionCookie(opt);
		return config.options[name] ? &quot;true&quot; : &quot;false&quot;;
	}
});

merge(config.optionHandlers, {
	'pas': {
 		get: function(name) {
			if (config.options[&quot;chk&quot;+name]) {
				return encodeCookie(config.options[name].toString());
			} else {
				return &quot;&quot;;
			}
		},
		set: function(name,value) {config.options[name] = decodeCookie(value);}
	}
});

// need to reload options to load passwordOptions
loadOptionsCookie();

/*
if (!config.options['pasPassword'])
	config.options['pasPassword'] = '';

merge(config.optionsDesc,{
		pasPassword: &quot;Test password&quot;
	});
*/
//}}}</pre>
</div>
<div title="S-Z" modifier="rvr" created="200905302335" modified="202210061222" changecount="88">
<pre>[[SASS]]
[[SCSS]]
[[selector]]  
[[selector examples]]
[[sibling selector]]
[[span]]
[[style]]
[[syntax|CSS Rules]]
[[table]]
[[tags]]
[[text]]
[[tooltip]]
[[transform]]
[[transition]]
[[tricks]]
[[universal selector]]
[[units]]
[[user agent stylesheet]]
[[variables]]
[[vertical-align]]
[[vw]] - also ''vh''
[[width|height]]
[[z-index]]</pre>
</div>
<div title="SASS" modifier="rvr" created="201507131728" modified="202210061230" changecount="28">
<pre>Sass is a language for writing stylesheets that improves on CSS. Is is called a ''preprocessor'':
*[[nesting]]
*[[variables]]
*[[mixins]]
You can install and run ''sass'' using a ruby gem.
Create a project, here is the hierarchy:
&lt;html&gt;&lt;pre&gt;
[root] - index.html
  &amp;#8614;  [css] - app.css       # This file is used to style our code, it is overwritten every time we change app.sass.
  &amp;#8614;  [css] - app.sass      # This file is watched by sass - changes to it get written to the @@app.css@@ file.
&lt;/pre&gt;&lt;/html&gt;
In directory root/css, we'll launch css: @@sass -&amp;dash;watch app.sass:app.css@@
*Identify ''sass'' file first: ''app.sass''
*Identify output file by using a colon ('':'') and filename: ''app.css''
&lt;html&gt;&lt;pre&gt;
$ sass -watch app.sass:app.css
&gt;&amp;gt;&gt; Sass is watching for changes. Press Ctrl-C to stop.
      write app.css
      write app.css.map
&lt;/pre&gt;&lt;/html&gt;
Whenever we make a change to the @@app.sass@@ file by our coding, it gets written to @@app.css@@.

See also [[SCSS]].</pre>
</div>
<div title="SCSS" modifier="rvr" created="202210061229" modified="202210061240" changecount="28">
<pre>Like [[SASS]], ''SCSS'' is a CSS preprocessor. Also called ''Syntactically Awesome Style Sheet''. It is a superset of CSS and has added syntax to simplify coding.

For example, let's say we have some classes labelled as seen below. We can style all ''item'' classes in the same style, but we can tailor the individual elements in another style:
&lt;html&gt;&lt;pre&gt;
&amp;lt;div class=&quot;item item-1&quot;&gt;I want to be Orange&amp;lt;/div&gt;
&amp;lt;div class=&quot;item item-2&quot;&gt;I want to be Green&amp;lt;/div&gt;

.item {
  font-size: 30px;
  font-family: sans-serif;

  &amp;-1 { background-color: orange;}
  &amp;-2 { background-color: green;}
}&lt;/pre&gt;&lt;/html&gt;The ''&amp;'' picks up the class name of ''item'' and prepends it. ''&amp;-1'' becomes ''item-1''.</pre>
</div>
<div title="ST3 Linter" modifier="rvr" created="201703260359" modified="201703260403" changecount="2">
<pre>There is a great shortcut to use in ''Sublime Text 3''. 
*Type in: @@nav.navbar-default@@ and follow up with a ''TAB''.
*Get: @@&lt;nav class=&quot;navbar-default&quot;&gt;&lt;/nav&gt;@@
Another example:
*Type: @@ul.nav.navbar-nav.navbar-right@@
*Get: @@ul.nav.navbar-&lt;nav class=&quot;navbar-right&quot;&gt;&lt;/nav&gt;@@</pre>
</div>
<div title="Selector Specificity" modifier="rvr" created="202209031011" modified="202209100932" changecount="7">
<pre>If a selector has a conflict - let's say one selector specifies red and the other blue. How to pick which one?
In the case of this conflict, the most &quot;specific&quot; selector is used, if the same, it defaults to the last rule in the stylesheet.  
&quot;Specificity&quot; is done by weighted calculation. 
* Inline styles - 1000 pts
* ~IDs - 100 pts
* Classes - 10 pts
* Pseudo classes - 10 pts
* Attributes - 10 pts
* Elements - 1 pt
* Pseudo elements - 1 pt

Example:
* section.links a { ...} - this is 1 + 10 + 1 = 12 pts
* a[href=&quot;...&quot;] { ... } - this is 1 + 10 = 11
In this example the first styling will be picked.
We can override this by using @@''!important''@@ - this is best avoided. Like: ''color: red !important;''</pre>
</div>
<div title="SiteSubtitle" modifier="rvr" created="200905302329" changecount="13">
<pre>robs ramblings</pre>
</div>
<div title="SiteTitle" modifier="rvr" created="200905302327" modified="200905302328" changecount="13">
<pre>CSS &amp; HTML Notes
</pre>
</div>
<div title="TspotSetupPlugin" modifier="YourName" created="200808081041" modified="200808081041" tags="systemConfig">
<pre>/***
Description: Contains the stuff you need to use Tiddlyspot
Note, you also need UploadPlugin, PasswordOptionPlugin and LoadRemoteFileThroughProxy
from http://tiddlywiki.bidix.info for a complete working Tiddlyspot site.
***/
//{{{

// edit this if you are migrating sites or retrofitting an existing TW
config.tiddlyspotSiteId = 'css.rtfm';

// make it so you can by default see edit controls via http
config.options.chkHttpReadOnly = false;
window.readOnly = false; // make sure of it (for tw 2.2)
window.showBackstage = true; // show backstage too

// disable autosave in d3
if (window.location.protocol != &quot;file:&quot;)
	config.options.chkGTDLazyAutoSave = false;

// tweak shadow tiddlers to add upload button, password entry box etc
with (config.shadowTiddlers) {
	SiteUrl = 'http://'+config.tiddlyspotSiteId+'.tiddlyspot.com';
	SideBarOptions = SideBarOptions.replace(/(&lt;&lt;saveChanges&gt;&gt;)/,&quot;$1&lt;&lt;tiddler TspotSidebar&gt;&gt;&quot;);
	OptionsPanel = OptionsPanel.replace(/^/,&quot;&lt;&lt;tiddler TspotOptions&gt;&gt;&quot;);
	DefaultTiddlers = DefaultTiddlers.replace(/^/,&quot;[[WelcomeToTiddlyspot]] &quot;);
	MainMenu = MainMenu.replace(/^/,&quot;[[WelcomeToTiddlyspot]] &quot;);
}

// create some shadow tiddler content
merge(config.shadowTiddlers,{

'WelcomeToTiddlyspot':[
 &quot;This document is a ~TiddlyWiki from tiddlyspot.com.  A ~TiddlyWiki is an electronic notebook that is great for managing todo lists, personal information, and all sorts of things.&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //What now?// &amp;nbsp;&amp;nbsp;@@ Before you can save any changes, you need to enter your password in the form below.  Then configure privacy and other site settings at your [[control panel|http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/controlpanel]] (your control panel username is //&quot; + config.tiddlyspotSiteId + &quot;//).&quot;,
 &quot;&lt;&lt;tiddler TspotControls&gt;&gt;&quot;,
 &quot;See also GettingStarted.&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //Working online// &amp;nbsp;&amp;nbsp;@@ You can edit this ~TiddlyWiki right now, and save your changes using the \&quot;save to web\&quot; button in the column on the right.&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //Working offline// &amp;nbsp;&amp;nbsp;@@ A fully functioning copy of this ~TiddlyWiki can be saved onto your hard drive or USB stick.  You can make changes and save them locally without being connected to the Internet.  When you're ready to sync up again, just click \&quot;upload\&quot; and your ~TiddlyWiki will be saved back to tiddlyspot.com.&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //Help!// &amp;nbsp;&amp;nbsp;@@ Find out more about ~TiddlyWiki at [[TiddlyWiki.com|http://tiddlywiki.com]].  Also visit [[TiddlyWiki.org|http://tiddlywiki.org]] for documentation on learning and using ~TiddlyWiki. New users are especially welcome on the [[TiddlyWiki mailing list|http://groups.google.com/group/TiddlyWiki]], which is an excellent place to ask questions and get help.  If you have a tiddlyspot related problem email [[tiddlyspot support|mailto:support@tiddlyspot.com]].&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //Enjoy :)// &amp;nbsp;&amp;nbsp;@@ We hope you like using your tiddlyspot.com site.  Please email [[feedback@tiddlyspot.com|mailto:feedback@tiddlyspot.com]] with any comments or suggestions.&quot;
].join(&quot;\n&quot;),

'TspotControls':[
 &quot;| tiddlyspot password:|&lt;&lt;option pasUploadPassword&gt;&gt;|&quot;,
 &quot;| site management:|&lt;&lt;upload http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/store.cgi index.html . .  &quot; + config.tiddlyspotSiteId + &quot;&gt;&gt;//(requires tiddlyspot password)//&lt;br&gt;[[control panel|http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/controlpanel]], [[download (go offline)|http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/download]]|&quot;,
 &quot;| links:|[[tiddlyspot.com|http://tiddlyspot.com/]], [[FAQs|http://faq.tiddlyspot.com/]], [[blog|http://tiddlyspot.blogspot.com/]], email [[support|mailto:support@tiddlyspot.com]] &amp; [[feedback|mailto:feedback@tiddlyspot.com]], [[donate|http://tiddlyspot.com/?page=donate]]|&quot;
].join(&quot;\n&quot;),

'TspotSidebar':[
 &quot;&lt;&lt;upload http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/store.cgi index.html . .  &quot; + config.tiddlyspotSiteId + &quot;&gt;&gt;&lt;html&gt;&lt;a href='http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/download' class='button'&gt;download&lt;/a&gt;&lt;/html&gt;&quot;
].join(&quot;\n&quot;),

'TspotOptions':[
 &quot;tiddlyspot password:&quot;,
 &quot;&lt;&lt;option pasUploadPassword&gt;&gt;&quot;,
 &quot;&quot;
].join(&quot;\n&quot;)

});
//}}}
</pre>
</div>
<div title="UploadLog" modifier="rvr" created="200905310007" modified="202210102202">
<pre>| !date | !user | !location | !storeUrl | !uploadDir | !toFilename | !backupdir | !origin |
| 15/09/2022 20:50:15 | rvr | [[/|http://css.rtfm.tiddlyspot.com/]] | [[store.cgi|http://css.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://css.rtfm.tiddlyspot.com/index.html]] | . | ok |
| 15/09/2022 22:26:47 | rvr | [[/|http://css.rtfm.tiddlyspot.com/]] | [[store.cgi|http://css.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://css.rtfm.tiddlyspot.com/index.html]] | . |
| 16/09/2022 12:28:16 | rvr | [[/|http://css.rtfm.tiddlyspot.com/]] | [[store.cgi|http://css.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://css.rtfm.tiddlyspot.com/index.html]] | . |
| 16/09/2022 17:14:49 | rvr | [[/|http://css.rtfm.tiddlyspot.com/]] | [[store.cgi|http://css.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://css.rtfm.tiddlyspot.com/index.html]] | . |
| 06/10/2022 15:56:58 | rvr | [[/|http://css.rtfm.tiddlyspot.com/]] | [[store.cgi|http://css.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://css.rtfm.tiddlyspot.com/index.html]] | . | ok |
| 06/10/2022 16:37:24 | rvr | [[/|http://css.rtfm.tiddlyspot.com/]] | [[store.cgi|http://css.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://css.rtfm.tiddlyspot.com/index.html]] | . | ok |
| 06/10/2022 17:42:04 | rvr | [[/|http://css.rtfm.tiddlyspot.com/]] | [[store.cgi|http://css.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://css.rtfm.tiddlyspot.com/index.html]] | . |
| 08/10/2022 20:40:38 | rvr | [[/|http://css.rtfm.tiddlyspot.com/]] | [[store.cgi|http://css.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://css.rtfm.tiddlyspot.com/index.html]] | . | ok |
| 09/10/2022 12:58:39 | rvr | [[/|http://css.rtfm.tiddlyspot.com/]] | [[store.cgi|http://css.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://css.rtfm.tiddlyspot.com/index.html]] | . |
| 11/10/2022 00:02:13 | rvr | [[/|http://css.rtfm.tiddlyspot.com/]] | [[store.cgi|http://css.rtfm.tiddlyspot.com/store.cgi]] | . | [[index.html | http://css.rtfm.tiddlyspot.com/index.html]] | . |</pre>
</div>
<div title="UploadPlugin" modifier="YourName" created="200808080918" modified="200905302326" tags="systemConfig">
<pre>/***
|''Name:''|UploadPlugin|
|''Description:''|Save to web a TiddlyWiki|
|''Version:''|4.1.3|
|''Date:''|Feb 24, 2008|
|''Source:''|http://tiddlywiki.bidix.info/#UploadPlugin|
|''Documentation:''|http://tiddlywiki.bidix.info/#UploadPluginDoc|
|''Author:''|BidiX (BidiX (at) bidix (dot) info)|
|''License:''|[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D ]]|
|''~CoreVersion:''|2.2.0|
|''Requires:''|PasswordOptionPlugin|
***/
//{{{
version.extensions.UploadPlugin = {
	major: 4, minor: 1, revision: 3,
	date: new Date(&quot;Feb 24, 2008&quot;),
	source: 'http://tiddlywiki.bidix.info/#UploadPlugin',
	author: 'BidiX (BidiX (at) bidix (dot) info',
	coreVersion: '2.2.0'
};

//
// Environment
//

if (!window.bidix) window.bidix = {}; // bidix namespace
bidix.debugMode = false;	// true to activate both in Plugin and UploadService
	
//
// Upload Macro
//

config.macros.upload = {
// default values
	defaultBackupDir: '',	//no backup
	defaultStoreScript: &quot;store.php&quot;,
	defaultToFilename: &quot;index.html&quot;,
	defaultUploadDir: &quot;.&quot;,
	authenticateUser: true	// UploadService Authenticate User
};
	
config.macros.upload.label = {
	promptOption: &quot;Save and Upload this TiddlyWiki with UploadOptions&quot;,
	promptParamMacro: &quot;Save and Upload this TiddlyWiki in %0&quot;,
	saveLabel: &quot;save to web&quot;, 
	saveToDisk: &quot;save to disk&quot;,
	uploadLabel: &quot;upload&quot;	
};

config.macros.upload.messages = {
	noStoreUrl: &quot;No store URL in parmeters or options&quot;,
	usernameOrPasswordMissing: &quot;Username or password missing&quot;
};

config.macros.upload.handler = function(place,macroName,params) {
	if (readOnly)
		return;
	var label;
	if (document.location.toString().substr(0,4) == &quot;http&quot;) 
		label = this.label.saveLabel;
	else
		label = this.label.uploadLabel;
	var prompt;
	if (params[0]) {
		prompt = this.label.promptParamMacro.toString().format([this.destFile(params[0], 
			(params[1] ? params[1]:bidix.basename(window.location.toString())), params[3])]);
	} else {
		prompt = this.label.promptOption;
	}
	createTiddlyButton(place, label, prompt, function() {config.macros.upload.action(params);}, null, null, this.accessKey);
};

config.macros.upload.action = function(params)
{
		// for missing macro parameter set value from options
		if (!params) params = {};
		var storeUrl = params[0] ? params[0] : config.options.txtUploadStoreUrl;
		var toFilename = params[1] ? params[1] : config.options.txtUploadFilename;
		var backupDir = params[2] ? params[2] : config.options.txtUploadBackupDir;
		var uploadDir = params[3] ? params[3] : config.options.txtUploadDir;
		var username = params[4] ? params[4] : config.options.txtUploadUserName;
		var password = config.options.pasUploadPassword; // for security reason no password as macro parameter	
		// for still missing parameter set default value
		if ((!storeUrl) &amp;&amp; (document.location.toString().substr(0,4) == &quot;http&quot;)) 
			storeUrl = bidix.dirname(document.location.toString())+'/'+config.macros.upload.defaultStoreScript;
		if (storeUrl.substr(0,4) != &quot;http&quot;)
			storeUrl = bidix.dirname(document.location.toString()) +'/'+ storeUrl;
		if (!toFilename)
			toFilename = bidix.basename(window.location.toString());
		if (!toFilename)
			toFilename = config.macros.upload.defaultToFilename;
		if (!uploadDir)
			uploadDir = config.macros.upload.defaultUploadDir;
		if (!backupDir)
			backupDir = config.macros.upload.defaultBackupDir;
		// report error if still missing
		if (!storeUrl) {
			alert(config.macros.upload.messages.noStoreUrl);
			clearMessage();
			return false;
		}
		if (config.macros.upload.authenticateUser &amp;&amp; (!username || !password)) {
			alert(config.macros.upload.messages.usernameOrPasswordMissing);
			clearMessage();
			return false;
		}
		bidix.upload.uploadChanges(false,null,storeUrl, toFilename, uploadDir, backupDir, username, password); 
		return false; 
};

config.macros.upload.destFile = function(storeUrl, toFilename, uploadDir) 
{
	if (!storeUrl)
		return null;
		var dest = bidix.dirname(storeUrl);
		if (uploadDir &amp;&amp; uploadDir != '.')
			dest = dest + '/' + uploadDir;
		dest = dest + '/' + toFilename;
	return dest;
};

//
// uploadOptions Macro
//

config.macros.uploadOptions = {
	handler: function(place,macroName,params) {
		var wizard = new Wizard();
		wizard.createWizard(place,this.wizardTitle);
		wizard.addStep(this.step1Title,this.step1Html);
		var markList = wizard.getElement(&quot;markList&quot;);
		var listWrapper = document.createElement(&quot;div&quot;);
		markList.parentNode.insertBefore(listWrapper,markList);
		wizard.setValue(&quot;listWrapper&quot;,listWrapper);
		this.refreshOptions(listWrapper,false);
		var uploadCaption;
		if (document.location.toString().substr(0,4) == &quot;http&quot;) 
			uploadCaption = config.macros.upload.label.saveLabel;
		else
			uploadCaption = config.macros.upload.label.uploadLabel;
		
		wizard.setButtons([
				{caption: uploadCaption, tooltip: config.macros.upload.label.promptOption, 
					onClick: config.macros.upload.action},
				{caption: this.cancelButton, tooltip: this.cancelButtonPrompt, onClick: this.onCancel}
				
			]);
	},
	options: [
		&quot;txtUploadUserName&quot;,
		&quot;pasUploadPassword&quot;,
		&quot;txtUploadStoreUrl&quot;,
		&quot;txtUploadDir&quot;,
		&quot;txtUploadFilename&quot;,
		&quot;txtUploadBackupDir&quot;,
		&quot;chkUploadLog&quot;,
		&quot;txtUploadLogMaxLine&quot;		
	],
	refreshOptions: function(listWrapper) {
		var opts = [];
		for(i=0; i&lt;this.options.length; i++) {
			var opt = {};
			opts.push();
			opt.option = &quot;&quot;;
			n = this.options[i];
			opt.name = n;
			opt.lowlight = !config.optionsDesc[n];
			opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
			opts.push(opt);
		}
		var listview = ListView.create(listWrapper,opts,this.listViewTemplate);
		for(n=0; n&lt;opts.length; n++) {
			var type = opts[n].name.substr(0,3);
			var h = config.macros.option.types[type];
			if (h &amp;&amp; h.create) {
				h.create(opts[n].colElements['option'],type,opts[n].name,opts[n].name,&quot;no&quot;);
			}
		}
		
	},
	onCancel: function(e)
	{
		backstage.switchTab(null);
		return false;
	},
	
	wizardTitle: &quot;Upload with options&quot;,
	step1Title: &quot;These options are saved in cookies in your browser&quot;,
	step1Html: &quot;&lt;input type='hidden' name='markList'&gt;&lt;/input&gt;&lt;br&gt;&quot;,
	cancelButton: &quot;Cancel&quot;,
	cancelButtonPrompt: &quot;Cancel prompt&quot;,
	listViewTemplate: {
		columns: [
			{name: 'Description', field: 'description', title: &quot;Description&quot;, type: 'WikiText'},
			{name: 'Option', field: 'option', title: &quot;Option&quot;, type: 'String'},
			{name: 'Name', field: 'name', title: &quot;Name&quot;, type: 'String'}
			],
		rowClasses: [
			{className: 'lowlight', field: 'lowlight'} 
			]}
};

//
// upload functions
//

if (!bidix.upload) bidix.upload = {};

if (!bidix.upload.messages) bidix.upload.messages = {
	//from saving
	invalidFileError: &quot;The original file '%0' does not appear to be a valid TiddlyWiki&quot;,
	backupSaved: &quot;Backup saved&quot;,
	backupFailed: &quot;Failed to upload backup file&quot;,
	rssSaved: &quot;RSS feed uploaded&quot;,
	rssFailed: &quot;Failed to upload RSS feed file&quot;,
	emptySaved: &quot;Empty template uploaded&quot;,
	emptyFailed: &quot;Failed to upload empty template file&quot;,
	mainSaved: &quot;Main TiddlyWiki file uploaded&quot;,
	mainFailed: &quot;Failed to upload main TiddlyWiki file. Your changes have not been saved&quot;,
	//specific upload
	loadOriginalHttpPostError: &quot;Can't get original file&quot;,
	aboutToSaveOnHttpPost: 'About to upload on %0 ...',
	storePhpNotFound: &quot;The store script '%0' was not found.&quot;
};

bidix.upload.uploadChanges = function(onlyIfDirty,tiddlers,storeUrl,toFilename,uploadDir,backupDir,username,password)
{
	var callback = function(status,uploadParams,original,url,xhr) {
		if (!status) {
			displayMessage(bidix.upload.messages.loadOriginalHttpPostError);
			return;
		}
		if (bidix.debugMode) 
			alert(original.substr(0,500)+&quot;\n...&quot;);
		// Locate the storeArea div's 
		var posDiv = locateStoreArea(original);
		if((posDiv[0] == -1) || (posDiv[1] == -1)) {
			alert(config.messages.invalidFileError.format([localPath]));
			return;
		}
		bidix.upload.uploadRss(uploadParams,original,posDiv);
	};
	
	if(onlyIfDirty &amp;&amp; !store.isDirty())
		return;
	clearMessage();
	// save on localdisk ?
	if (document.location.toString().substr(0,4) == &quot;file&quot;) {
		var path = document.location.toString();
		var localPath = getLocalPath(path);
		saveChanges();
	}
	// get original
	var uploadParams = new Array(storeUrl,toFilename,uploadDir,backupDir,username,password);
	var originalPath = document.location.toString();
	// If url is a directory : add index.html
	if (originalPath.charAt(originalPath.length-1) == &quot;/&quot;)
		originalPath = originalPath + &quot;index.html&quot;;
	var dest = config.macros.upload.destFile(storeUrl,toFilename,uploadDir);
	var log = new bidix.UploadLog();
	log.startUpload(storeUrl, dest, uploadDir,  backupDir);
	displayMessage(bidix.upload.messages.aboutToSaveOnHttpPost.format([dest]));
	if (bidix.debugMode) 
		alert(&quot;about to execute Http - GET on &quot;+originalPath);
	var r = doHttp(&quot;GET&quot;,originalPath,null,null,username,password,callback,uploadParams,null);
	if (typeof r == &quot;string&quot;)
		displayMessage(r);
	return r;
};

bidix.upload.uploadRss = function(uploadParams,original,posDiv) 
{
	var callback = function(status,params,responseText,url,xhr) {
		if(status) {
			var destfile = responseText.substring(responseText.indexOf(&quot;destfile:&quot;)+9,responseText.indexOf(&quot;\n&quot;, responseText.indexOf(&quot;destfile:&quot;)));
			displayMessage(bidix.upload.messages.rssSaved,bidix.dirname(url)+'/'+destfile);
			bidix.upload.uploadMain(params[0],params[1],params[2]);
		} else {
			displayMessage(bidix.upload.messages.rssFailed);			
		}
	};
	// do uploadRss
	if(config.options.chkGenerateAnRssFeed) {
		var rssPath = uploadParams[1].substr(0,uploadParams[1].lastIndexOf(&quot;.&quot;)) + &quot;.xml&quot;;
		var rssUploadParams = new Array(uploadParams[0],rssPath,uploadParams[2],'',uploadParams[4],uploadParams[5]);
		var rssString = generateRss();
		// no UnicodeToUTF8 conversion needed when location is &quot;file&quot; !!!
		if (document.location.toString().substr(0,4) != &quot;file&quot;)
			rssString = convertUnicodeToUTF8(rssString);	
		bidix.upload.httpUpload(rssUploadParams,rssString,callback,Array(uploadParams,original,posDiv));
	} else {
		bidix.upload.uploadMain(uploadParams,original,posDiv);
	}
};

bidix.upload.uploadMain = function(uploadParams,original,posDiv) 
{
	var callback = function(status,params,responseText,url,xhr) {
		var log = new bidix.UploadLog();
		if(status) {
			// if backupDir specified
			if ((params[3]) &amp;&amp; (responseText.indexOf(&quot;backupfile:&quot;) &gt; -1))  {
				var backupfile = responseText.substring(responseText.indexOf(&quot;backupfile:&quot;)+11,responseText.indexOf(&quot;\n&quot;, responseText.indexOf(&quot;backupfile:&quot;)));
				displayMessage(bidix.upload.messages.backupSaved,bidix.dirname(url)+'/'+backupfile);
			}
			var destfile = responseText.substring(responseText.indexOf(&quot;destfile:&quot;)+9,responseText.indexOf(&quot;\n&quot;, responseText.indexOf(&quot;destfile:&quot;)));
			displayMessage(bidix.upload.messages.mainSaved,bidix.dirname(url)+'/'+destfile);
			store.setDirty(false);
			log.endUpload(&quot;ok&quot;);
		} else {
			alert(bidix.upload.messages.mainFailed);
			displayMessage(bidix.upload.messages.mainFailed);
			log.endUpload(&quot;failed&quot;);			
		}
	};
	// do uploadMain
	var revised = bidix.upload.updateOriginal(original,posDiv);
	bidix.upload.httpUpload(uploadParams,revised,callback,uploadParams);
};

bidix.upload.httpUpload = function(uploadParams,data,callback,params)
{
	var localCallback = function(status,params,responseText,url,xhr) {
		url = (url.indexOf(&quot;nocache=&quot;) &lt; 0 ? url : url.substring(0,url.indexOf(&quot;nocache=&quot;)-1));
		if (xhr.status == 404)
			alert(bidix.upload.messages.storePhpNotFound.format([url]));
		if ((bidix.debugMode) || (responseText.indexOf(&quot;Debug mode&quot;) &gt;= 0 )) {
			alert(responseText);
			if (responseText.indexOf(&quot;Debug mode&quot;) &gt;= 0 )
				responseText = responseText.substring(responseText.indexOf(&quot;\n\n&quot;)+2);
		} else if (responseText.charAt(0) != '0') 
			alert(responseText);
		if (responseText.charAt(0) != '0')
			status = null;
		callback(status,params,responseText,url,xhr);
	};
	// do httpUpload
	var boundary = &quot;---------------------------&quot;+&quot;AaB03x&quot;;	
	var uploadFormName = &quot;UploadPlugin&quot;;
	// compose headers data
	var sheader = &quot;&quot;;
	sheader += &quot;--&quot; + boundary + &quot;\r\nContent-disposition: form-data; name=\&quot;&quot;;
	sheader += uploadFormName +&quot;\&quot;\r\n\r\n&quot;;
	sheader += &quot;backupDir=&quot;+uploadParams[3] +
				&quot;;user=&quot; + uploadParams[4] +
				&quot;;password=&quot; + uploadParams[5] +
				&quot;;uploaddir=&quot; + uploadParams[2];
	if (bidix.debugMode)
		sheader += &quot;;debug=1&quot;;
	sheader += &quot;;;\r\n&quot;; 
	sheader += &quot;\r\n&quot; + &quot;--&quot; + boundary + &quot;\r\n&quot;;
	sheader += &quot;Content-disposition: form-data; name=\&quot;userfile\&quot;; filename=\&quot;&quot;+uploadParams[1]+&quot;\&quot;\r\n&quot;;
	sheader += &quot;Content-Type: text/html;charset=UTF-8&quot; + &quot;\r\n&quot;;
	sheader += &quot;Content-Length: &quot; + data.length + &quot;\r\n\r\n&quot;;
	// compose trailer data
	var strailer = new String();
	strailer = &quot;\r\n--&quot; + boundary + &quot;--\r\n&quot;;
	data = sheader + data + strailer;
	if (bidix.debugMode) alert(&quot;about to execute Http - POST on &quot;+uploadParams[0]+&quot;\n with \n&quot;+data.substr(0,500)+ &quot; ... &quot;);
	var r = doHttp(&quot;POST&quot;,uploadParams[0],data,&quot;multipart/form-data; ;charset=UTF-8; boundary=&quot;+boundary,uploadParams[4],uploadParams[5],localCallback,params,null);
	if (typeof r == &quot;string&quot;)
		displayMessage(r);
	return r;
};

// same as Saving's updateOriginal but without convertUnicodeToUTF8 calls
bidix.upload.updateOriginal = function(original, posDiv)
{
	if (!posDiv)
		posDiv = locateStoreArea(original);
	if((posDiv[0] == -1) || (posDiv[1] == -1)) {
		alert(config.messages.invalidFileError.format([localPath]));
		return;
	}
	var revised = original.substr(0,posDiv[0] + startSaveArea.length) + &quot;\n&quot; +
				store.allTiddlersAsHtml() + &quot;\n&quot; +
				original.substr(posDiv[1]);
	var newSiteTitle = getPageTitle().htmlEncode();
	revised = revised.replaceChunk(&quot;&lt;title&quot;+&quot;&gt;&quot;,&quot;&lt;/title&quot;+&quot;&gt;&quot;,&quot; &quot; + newSiteTitle + &quot; &quot;);
	revised = updateMarkupBlock(revised,&quot;PRE-HEAD&quot;,&quot;MarkupPreHead&quot;);
	revised = updateMarkupBlock(revised,&quot;POST-HEAD&quot;,&quot;MarkupPostHead&quot;);
	revised = updateMarkupBlock(revised,&quot;PRE-BODY&quot;,&quot;MarkupPreBody&quot;);
	revised = updateMarkupBlock(revised,&quot;POST-SCRIPT&quot;,&quot;MarkupPostBody&quot;);
	return revised;
};

//
// UploadLog
// 
// config.options.chkUploadLog :
//		false : no logging
//		true : logging
// config.options.txtUploadLogMaxLine :
//		-1 : no limit
//      0 :  no Log lines but UploadLog is still in place
//		n :  the last n lines are only kept
//		NaN : no limit (-1)

bidix.UploadLog = function() {
	if (!config.options.chkUploadLog) 
		return; // this.tiddler = null
	this.tiddler = store.getTiddler(&quot;UploadLog&quot;);
	if (!this.tiddler) {
		this.tiddler = new Tiddler();
		this.tiddler.title = &quot;UploadLog&quot;;
		this.tiddler.text = &quot;| !date | !user | !location | !storeUrl | !uploadDir | !toFilename | !backupdir | !origin |&quot;;
		this.tiddler.created = new Date();
		this.tiddler.modifier = config.options.txtUserName;
		this.tiddler.modified = new Date();
		store.addTiddler(this.tiddler);
	}
	return this;
};

bidix.UploadLog.prototype.addText = function(text) {
	if (!this.tiddler)
		return;
	// retrieve maxLine when we need it
	var maxLine = parseInt(config.options.txtUploadLogMaxLine,10);
	if (isNaN(maxLine))
		maxLine = -1;
	// add text
	if (maxLine != 0) 
		this.tiddler.text = this.tiddler.text + text;
	// Trunck to maxLine
	if (maxLine &gt;= 0) {
		var textArray = this.tiddler.text.split('\n');
		if (textArray.length &gt; maxLine + 1)
			textArray.splice(1,textArray.length-1-maxLine);
			this.tiddler.text = textArray.join('\n');		
	}
	// update tiddler fields
	this.tiddler.modifier = config.options.txtUserName;
	this.tiddler.modified = new Date();
	store.addTiddler(this.tiddler);
	// refresh and notifiy for immediate update
	story.refreshTiddler(this.tiddler.title);
	store.notify(this.tiddler.title, true);
};

bidix.UploadLog.prototype.startUpload = function(storeUrl, toFilename, uploadDir,  backupDir) {
	if (!this.tiddler)
		return;
	var now = new Date();
	var text = &quot;\n| &quot;;
	var filename = bidix.basename(document.location.toString());
	if (!filename) filename = '/';
	text += now.formatString(&quot;0DD/0MM/YYYY 0hh:0mm:0ss&quot;) +&quot; | &quot;;
	text += config.options.txtUserName + &quot; | &quot;;
	text += &quot;[[&quot;+filename+&quot;|&quot;+location + &quot;]] |&quot;;
	text += &quot; [[&quot; + bidix.basename(storeUrl) + &quot;|&quot; + storeUrl + &quot;]] | &quot;;
	text += uploadDir + &quot; | &quot;;
	text += &quot;[[&quot; + bidix.basename(toFilename) + &quot; | &quot; +toFilename + &quot;]] | &quot;;
	text += backupDir + &quot; |&quot;;
	this.addText(text);
};

bidix.UploadLog.prototype.endUpload = function(status) {
	if (!this.tiddler)
		return;
	this.addText(&quot; &quot;+status+&quot; |&quot;);
};

//
// Utilities
// 

bidix.checkPlugin = function(plugin, major, minor, revision) {
	var ext = version.extensions[plugin];
	if (!
		(ext  &amp;&amp; 
			((ext.major &gt; major) || 
			((ext.major == major) &amp;&amp; (ext.minor &gt; minor))  ||
			((ext.major == major) &amp;&amp; (ext.minor == minor) &amp;&amp; (ext.revision &gt;= revision))))) {
			// write error in PluginManager
			if (pluginInfo)
				pluginInfo.log.push(&quot;Requires &quot; + plugin + &quot; &quot; + major + &quot;.&quot; + minor + &quot;.&quot; + revision);
			eval(plugin); // generate an error : &quot;Error: ReferenceError: xxxx is not defined&quot;
	}
};

bidix.dirname = function(filePath) {
	if (!filePath) 
		return;
	var lastpos;
	if ((lastpos = filePath.lastIndexOf(&quot;/&quot;)) != -1) {
		return filePath.substring(0, lastpos);
	} else {
		return filePath.substring(0, filePath.lastIndexOf(&quot;\\&quot;));
	}
};

bidix.basename = function(filePath) {
	if (!filePath) 
		return;
	var lastpos;
	if ((lastpos = filePath.lastIndexOf(&quot;#&quot;)) != -1) 
		filePath = filePath.substring(0, lastpos);
	if ((lastpos = filePath.lastIndexOf(&quot;/&quot;)) != -1) {
		return filePath.substring(lastpos + 1);
	} else
		return filePath.substring(filePath.lastIndexOf(&quot;\\&quot;)+1);
};

bidix.initOption = function(name,value) {
	if (!config.options[name])
		config.options[name] = value;
};

//
// Initializations
//

// require PasswordOptionPlugin 1.0.1 or better
bidix.checkPlugin(&quot;PasswordOptionPlugin&quot;, 1, 0, 1);

// styleSheet
setStylesheet('.txtUploadStoreUrl, .txtUploadBackupDir, .txtUploadDir {width: 22em;}',&quot;uploadPluginStyles&quot;);

//optionsDesc
merge(config.optionsDesc,{
	txtUploadStoreUrl: &quot;Url of the UploadService script (default: store.php)&quot;,
	txtUploadFilename: &quot;Filename of the uploaded file (default: in index.html)&quot;,
	txtUploadDir: &quot;Relative Directory where to store the file (default: . (downloadService directory))&quot;,
	txtUploadBackupDir: &quot;Relative Directory where to backup the file. If empty no backup. (default: ''(empty))&quot;,
	txtUploadUserName: &quot;Upload Username&quot;,
	pasUploadPassword: &quot;Upload Password&quot;,
	chkUploadLog: &quot;do Logging in UploadLog (default: true)&quot;,
	txtUploadLogMaxLine: &quot;Maximum of lines in UploadLog (default: 10)&quot;
});

// Options Initializations
bidix.initOption('txtUploadStoreUrl','');
bidix.initOption('txtUploadFilename','');
bidix.initOption('txtUploadDir','');
bidix.initOption('txtUploadBackupDir','');
bidix.initOption('txtUploadUserName','');
bidix.initOption('pasUploadPassword','');
bidix.initOption('chkUploadLog',true);
bidix.initOption('txtUploadLogMaxLine','10');


// Backstage
merge(config.tasks,{
	uploadOptions: {text: &quot;upload&quot;, tooltip: &quot;Change UploadOptions and Upload&quot;, content: '&lt;&lt;uploadOptions&gt;&gt;'}
});
config.backstageTasks.push(&quot;uploadOptions&quot;);


//}}}

</pre>
</div>
<div title="absolute" modifier="rvr" created="201004050224" modified="201705190052" changecount="69">
<pre>Absolute [[positioning]] is specified as:  @@ position: absolute; @@
*Is positioned relative to the nearest positioned ancestor, if none, then to document body.
*Positions the element at a specific place by removing it from document flow - it completely ignores it.
**Therefore, it does not enter into other content space calculation.
*Can be within a parent wrapper with a ''position'' value that is ''not'' static.
**if there is no parent then a specific place in the browser window. (first point above)
*It is still a part of the page content, which means it scrolls with content.
*Lets you define a z-index property.
*The width and height is determined by the content inside, or by setting dimensions in CSS.
*If a [[float]] is set, it is ignored.

The following will place text 75 pixels from the top and left of the screen.
&lt;html&gt;&lt;pre&gt;
   .logo { position:absolute; top:75px; left:75px; } 
&lt;/pre&gt;&lt;/html&gt;@@Important!@@ 
*The above will place the content at 75px from top and 75px from the right of the entire document body if the parent element has no ''position'' set.
*If a ''position'' is set ( ''position:relative; '' ) in a parent element then it will be 75px from top and 75px in that element.
Setting a value to negative, will move it out of the boundaries of the parent. Example: @@ top:-10px @@
Absolute [[positioning]] can overlap elements. To specify an order we use [[z-index]], like:
&lt;html&gt;&lt;pre&gt;
   img { position:absolute; left:9px; z-index:-1 }
&lt;/pre&gt;&lt;/html&gt;
So the higher the z-index will be placed on top.</pre>
</div>
<div title="after and before" modifier="rvr" created="201601211817" modified="202209021835" changecount="21">
<pre>''after'' and ''before'' are [[pseudo-elements]] that are available to all HTML elements.
It creates an pseudo element, (doesn't really exist, fake) and places if before or after that element.  It actually changes ''nothing'' (hence pseudo) in the document. Simple case, in front of each paragraph we want to place an arrow:
&lt;html&gt;&lt;pre&gt;
p::before {
    height: 2em;
    content: &quot; -&gt; &quot;;      /* a pseudo-element has to have some content */
} 
&lt;/pre&gt;&lt;/html&gt; 

In the following, after the ''h2'' element has rendered, the ''&quot;after&quot;'' pseudo-element is displayed.
&lt;html&gt;&lt;pre&gt;
h2::after {
    display: block;     /* To force a line break */
    height: 2px;
    background-color: #cf6d17;
    content: &quot; &quot;;      /* a pseudo-element has to have some content */
    width: 100px;
    margin: 0 auto;
} 
&lt;/pre&gt;&lt;/html&gt; 
Another example, to clear out a [[float]] we'll use the @@ ::after @@ method.
&lt;html&gt;&lt;pre&gt;
.something{ ... float: left; ... }
.something::after { ...  clear: both; ... }
&lt;/pre&gt;&lt;/html&gt;
Here you can add an @@color(red):A@@ after the ''h1'' element:
&lt;html&gt;&lt;pre&gt;
.apres-text h1::after {
  color: red;
  content: &quot;A&quot;;
}
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="anchor" modifier="rvr" created="201407220605" modified="202209081050" changecount="13">
<pre>The anchor link has many [[pseudo-class]] values:
*a:link - this is for unvisited links
*a:visited - this is for visited links
*a:active - this is what happens when you click
*a:hover - when you [[hover]] over it.
</pre>
</div>
<div title="animation" modifier="rvr" created="201705240014" modified="202209081218" changecount="12">
<pre>There are some CSS animation properties to do ''fun''ky things in CSS
See also [[transition]] and its companion [[transform]].
Example
&lt;html&gt;&lt;pre&gt;
&amp;lt;property&gt;: duration timing-function delay iteration-count direction fill-mode play-state name
animation:  3s       ease-in         1s    2               reverse   both      paused     slidein;
 
&amp;lt;property&gt;: duration timing-function delay name  
animation:  3s       linear          1s    lidein;
&lt;/pre&gt;&lt;/html&gt;

The animation CSS property is a shorthand property for 
|!Property|!Default Value|
|animation-name|none|
|animation-duration|0s|
|animation-timing-function|ease|
|animation-delay|0s|
|animation-iteration-count|1|
|animation-direction|normal|
|animation-fill-mode|none|
|animation-play-state|running|


See [[animation example]].</pre>
</div>
<div title="animation example" modifier="rvr" created="202209081222" modified="202209081246" changecount="8">
<pre>We have a div that is a box. To animate, we are going to:
*move it
** in 50% of time alloted to the right 222px
** by 100% of time, down 333px.
*take 3 seconds to do that
*keep box at ending position (''animation-fill-mode'')
All these can be in a shortcut - see [[animation]]. Here is the css to do such a thing:&lt;html&gt;&lt;pre&gt;
div#animate {
    background-color: darkblue;
    color: white;
    border-radius: 42px;
    animation-name: moveitmoveit88;
    animation-duration: 3s;
    animation-fill-mode: forwards;
} 

@keyframes moveitmoveit88 {
    50% {
        transform: translate(222px, 0px);
    }
    100% {
         transform: translate(222px, 333px);
    }
&lt;/pre&gt;&lt;/html&gt;
If we use:
* ''animation-direction: reverse;'' - it starts at ending position and goes to start.
* ''animation-iteration-count: 3;'' - repeats 3x. Want more? try ''infinite''. 
* '' animation-play-state: paused;'' - change to ''running'' by javascript. Or vice versa.
* ''animation-timing-function: ease-out;'' - velocity style of animation. Very cusomizable.
See also [[transition example]].</pre>
</div>
<div title="attribute" modifier="rvr" created="200912130228" modified="201602220951" changecount="8">
<pre>In HTML an ''attribute'' is a property of an [[element]], providing more information, they look like a key/value pair. For the following paragraph element, there is one attribute:
&lt;html&gt;&lt;pre&gt;
 &amp;lt;p class=&quot;woot&quot;&amp;gt;  // this is a paragraph tag with one attribute named class with value of woot.
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="attribute selector" modifier="rvr" created="202208311643" modified="202208311643" changecount="2">
<pre>This is rarely used, but does have its purposes.
Select an element with some specific attribute or attribute value

[attribute] Selector: This type of attribute selector is used to select all the elements that have the specified attribute and applies the CSS

Example: The following example selects all ''&lt;a&gt;'' elements with a target=&quot;_blank&quot; attribute:

&lt;html&gt;&lt;pre&gt;
a[target=&quot;_blank&quot;] {
  background-color: yellow;
}
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="background" modifier="rvr" created="201004022352" modified="202209061946" changecount="69">
<pre>The CSS Background properties are:
*''background-image ''- id the image to use
**Example: @@ background-image: url(/images/donut.jpg); @@
**With nothing else styled, the image will probably overflow and will be cropped to fit width and height.
**So we can use the below setting
*[[background-size]] - size of image - because height and width properties dont work for background styles.
**Example: @@ background-size: 100px 100px; @@ - this might repeat images (if image is small)
**Example: @@ background-size: contain; @@ - will stretch until one edge it hit, then repeat image
**Example: @@ background-size: cover; @@ - will stretch until all covered, but will crop
*''background-clip''
*''background-color''
*''background-repeat'' - set if there will be one image or many
*''background-attachment'' - so it doesn't move or it does (scroll)
*''background-position'' - so we can place it where we want - ie set an anchor point so when resizing the pix will be resized on that anchor.
**Format is: @@ background-position: x-axis y-axis; @@ - can use top/left/right/center/%/px
** Example: @@ background-position: center top; @@
Examples:
&lt;html&gt;&lt;pre&gt;
   p { background-color:#aabbcc; }
   h1 { background-color:#red; }
   body { background-image:url('coolpix.gif');   
          background-repeat:repeat-x;         // Can also use no-repeat, repeat-y, ...
          background-position:right top; }    // Can also use center, bottom, left, %x, %y
&lt;/pre&gt;&lt;/html&gt;You can also use a shorthand, following the above order:
&lt;html&gt;&lt;pre&gt;
   body { background: red url('coolpix.gif') no-repeat top right; }
&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="background-size" modifier="rvr" created="202209061944" modified="202209062013" changecount="13">
<pre>The ''background-size'' property handles the width and height of an image. Here is our css:
&lt;html&gt;&lt;pre&gt;
#rrimg {
    width: 300px;
    height: 200px;
    border: 10px dashed black;
    padding: 10px;
    background-image: url('qwerty.jpg');
}
&lt;/pre&gt;&lt;/html&gt;
Our image will be set in a space of 300x200 px.
It will probably overflow, but we can change the size of the image, so let's try 100x100px:
''background-size: 100px 100px;''
This will probably show many repeating images.

So let's try:
''background-size: cover;''
This will keep aspect ration until the image fills the space, will crop. Next...

''background-size: contain;''
This will keep the aspect ration for one side and then repeat image (aka tile) - kinda like 1x1.2 images. We could also add:
''background-size: contain;''
''background-repeat: no-repeat;''
And this will only give 1 image but the rest is white space. You can play around with this more by adding the property ''background-origin'' with the following ''attributes'':
* ''border-box;'' - background is positioned relative to the border box. Default is inside border.
* ''padding-box'' - background is positioned relative to the padding box.
* ''content-box'' - background is positioned relative to the content box.

See [[background]] image.</pre>
</div>
<div title="basic HTML" modifier="rvr" created="202209141028" modified="202209141029" changecount="3">
<pre>Here is a basic HTML example, a template.

&lt;html&gt;&lt;pre&gt;
&amp;lt;html lang=&quot;en&quot;&amp;gt;
&amp;lt;head&amp;gt;
    &amp;lt;meta charset=&quot;UTF-8&quot;&amp;gt;
    &amp;lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&amp;gt;
    &amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&amp;gt;
    &amp;lt;title&amp;gt;Document&amp;lt;/title&amp;gt;
    &amp;lt;link rel=&quot;stylesheet&quot; href=&quot;styles.css&quot; /&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
    
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="block" modifier="rvr" created="201407220615" modified="202209141016" changecount="18">
<pre>An element is either ''block'' or [[inline]]. A block element is the width of the web page and has line breaks enforced at the edges. 
An ''H1'' or a ''p'' element is a block element.  A ''block'' level container - is a large block of content that can be handled by specific css. It should be some logical division. Blocks can contain blocks too. A [[div]] is a block
&lt;html&gt;&lt;pre&gt;
&amp;lt;div id=fancy&amp;gt;
  Lots of stuff in here that is styled with id of fancy. Even other blocks:
    &amp;lt;div id=detail&amp;gt;
      More stuff styled by id of detail!
    &amp;lt;/div&amp;gt;
  Can put stuff here too.
&amp;lt;/div&amp;gt;
&lt;/pre&gt;&lt;/html&gt;Block elements with margins will collapse when next to each other (ie overlap). The opposite for [[inline]].
You can change block &amp;larr;-&amp;rarr; inline using [[display]]. Like this:
&lt;html&gt;&lt;pre&gt;
h1 {
  display: inline;
}
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="body" modifier="rvr" created="201509122015" modified="201705180150" changecount="30">
<pre>The ''body'' element is automatically included in every HTML page. So CSS styling it will have every other element inheriting from it.
The first line tells the browser that we are an HTML 5 doc. See also [[head]].
&lt;html&gt;&lt;pre&gt;
&amp;lt;!DOCTYPE html&gt;
&amp;lt;html lang=&quot;en&quot;&gt;
  &amp;lt;head&gt;...  &amp;lt;/head&gt;
  &amp;lt;body&gt;
  ...  all kinds of html goodness here
  &amp;lt;/body&gt;
&amp;lt;/html&gt;
&lt;/pre&gt;&lt;/html&gt;
The h3 element will inherit from the body element. 
If we use a class in the h3 element, then that will override that.

Note: body element has styling of ''position:static'' by default. See [[positioning]]. 
You may want it: ''position:relative'' so child elements (with ''height:100%'') follow this and not HTML element styling.</pre>
</div>
<div title="border" modifier="rvr" created="201004050115" modified="201705151806" changecount="66">
<pre>A border surrounds a content [[element]]. There are many border properties you can manipulate. A few are used by the [[Box Model]]. 
If you specify the width of a [[block]] element (like a ''p'' or a [[div]], then the border is outside that and adds to the width.
Here are the some border properties:
|!Property|!Values|
|border-width|in px or as thin, medium, or thick.|
|border-style|none, hidden, dashed, dotted, double, groove, inset, ridge, outset and solid.|
|border-color|name, RGB or hex.|
|border-radius|A numeric value, like 13px. Used to make round corners.|
|border-radius|A % value, like 50%. Used to make a round image.|
Can also vary it all with (zzz=width|style|color) with ''border-xxx-zzz'' where ''xxx'' is top, bottom, left or right. Finally you can combine all three into one statement:
&lt;html&gt;&lt;pre&gt;
   border-bottom-width:5px;   // Pick the border to assign width to
   border:5px groove red;     // All in one
   border-color: green;
   border-width: 10px;
   border-style: solid;
   border-radius: 10px;
&lt;/pre&gt;&lt;/html&gt;Note: there is also a ''outline'' property which works just like ''border'', same properties. This goes on the outside of the border.
The ''border'' property has many variations. For example:
&lt;html&gt;&lt;pre&gt;
border: 11px solid green;
&lt;/pre&gt;&lt;/html&gt;Is actually
&lt;html&gt;&lt;pre&gt;
border-width: 11px;
border-style: solid;
border-color: green;
&lt;/pre&gt;&lt;/html&gt;And each of these are actually shorthands too! For example, the above is actually&lt;html&gt;&lt;pre&gt;
border-width: 11px 11px 11px 11px;
border-style: solid solid solid solid;
border-color: green green green green;
&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="box example" modifier="rvr" created="201101061933" modified="201705181756" changecount="21">
<pre>This [[Box Model]] example will outline a box, with rounded corners.
&lt;html&gt;&lt;pre&gt;/* The html */
&amp;lt;div id=&quot;rounded&quot; class=&quot;box&quot;&amp;gt;
	&amp;lt;p&amp;gt;This text will be surrounded by a rounded box.&amp;lt;/p&amp;gt; 
&amp;lt;/div&amp;gt;
/* The css */
.box {width: 500px; margin: 50px; padding: 20px;}
#rounded { border:1px solid #000;  -moz-border-radius:15px;  border-radius:15px;  }
&lt;/pre&gt;&lt;/html&gt;@@Note:@@ The ''width'' is the width without a border. Adding a border increases the overall width.
For example, the following will be ... 30px+10px+300px+10px+30px = 380px
&lt;html&gt;&lt;pre&gt;
.something {
  width: 300px;
  padding: 30px;
  border: 10px solid #0f0;
}
&lt;/pre&gt;&lt;/html&gt;@@Note:@@ You can tweak the content width using: [[box-sizing]].</pre>
</div>
<div title="box-shadow" modifier="rvr" created="201705180324" modified="202209161158" changecount="33">
<pre>This will place a shadow behind an elements frame. Use ''box-shadow''. There is also ''text-shadow'':
&lt;html&gt;&lt;pre&gt;
html {
  box-shadow: 0 0 0 10px #000 inset;
  padding: 0 30px;
}
&lt;/pre&gt;&lt;/html&gt;Format is:  @@ box-shadow: x-axis y-axis blur size color inset @@
Note that we are tweaking this property a bit. It is typically meant for show a shadow of a dialog box on a background. See: http://www.cssmatic.com/box-shadow</pre>
</div>
<div title="box-sizing" modifier="rvr" created="201705181753" modified="202209041818" changecount="31">
<pre>When you specify the width of a block element ( ie ''div'' or ''p'') and then apply a border or padding to it, the additional border or padding will go outside of the content.
The ''box-sizing'' property helps fix that. There are 4 values for this property:
|!Value|!Meaning|
|content-box|Default. The width and height properties (and min/max properties) includes only the content. Border, padding, or margin are not included.|
|border-box|The width and height properties (and min/max properties) includes content, padding and border, but not the margin.|
|initial|Sets this property to its default value.|
|inherit|Inherits this property from its parent element.|
The CSS @@ box-sizing: border-box; @@ causes the browser to draw the content and borders and padding ''within'' of the defined width. The margin is outside this region, and is not a factor, however, it will add to total width.
In the [[Box Model]] the width of a content element is a formula that takes into account margin+border+padding+content.
If we sent content width to 200, with the extra elements will push that further. Check out this table below.
|!CSS|!Width|!~Content-Width|
|.box1 {  width: 200px;   }|200|200|
|.box2 {  border: 10px   solid #000;  padding: 40px;  }|10+40+200+40+10=300 |300|
|.box3 {  margin: 30px;  }|30+10+40+200+40+10-30=360 |300|
|.box4 {  ''box-sizing: border-box;''  }|30+10+40+100+40+10+30=260 |200|
''Note:'' Assume that CSS is cumulative, ie box2=box1+box2, box3=box1+box2+box3...
''Note:'' So with box-sizing - margins are ignored and the inner portion includes padding &amp; border = original width.

Finally, often one might set the whole stylesheet to use a particular model:
&lt;html&gt;&lt;pre&gt;
* {
  box-sizing: border-boc;
}
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="breadcrumb" modifier="rvr" created="201703202014" modified="201703202016" changecount="43">
<pre>Breadcrumbs. Three things to do
#Have Bootstrap class of ''breadcrumb''
#Each item to have class ''breadcrumb-item''
#The current item has to have class ''active''
&lt;html&gt;&lt;pre&gt;
&amp;lt;ul class=&quot;breadcrumb&quot;&gt;
  &amp;lt;li class=&quot;breadcrumb-item&quot;&gt;&amp;lt;a href=&quot;#&quot;&gt;Sun&amp;lt;/a&gt;&amp;lt;/li&gt;
  &amp;lt;li class=&quot;breadcrumb-item&quot;&gt;&amp;lt;a href=&quot;#&quot;&gt;Mercury&amp;lt;/a&gt;&amp;lt;/li&gt;
  &amp;lt;li class=&quot;breadcrumb-item&quot;&gt;&amp;lt;a href=&quot;#&quot;&gt;Venus&amp;lt;/a&gt;&amp;lt;/li&gt;
  &amp;lt;li class=&quot;breadcrumb-item active&quot;&gt;Earth&amp;lt;/li&gt;
&amp;lt;/ul&gt;
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="chain" modifier="rvr" created="201705100709" modified="201705101752" changecount="6">
<pre>You can ''chain'' [[class]] [[selector]] with [[ID]] selector.
In this example, the ID overrides the class, therefore we chain them to make sure that if want to use the ''alert'' class in the element with the id=&quot;return-address&quot;. That it is red background not pink.
&lt;html&gt;&lt;pre&gt;
  #return-address {
    background: pink;
  }
  .alert {
    background: red;
  }
  #return-address.alert {
    background: red;
  }
&lt;/pre&gt;&lt;/html&gt;
Also highlighted by this, CSS will give precedence to more specific rules over general rules. So @@#return-address.alert @@ is more specific than @@.alert@@.
We'd use something like: @@&lt;div id=&quot;return-address&quot; class=&quot;alert &quot;&gt;@@</pre>
</div>
<div title="checkbox" modifier="rvr" created="201005251921" modified="201509121502" changecount="12">
<pre>This element of the [[input]] tag is used when you want the user to select one or more options. Code:
&lt;html&gt;&lt;pre&gt;
I like:  
   Mangos &amp;lt;input type=&quot;checkbox&quot; name=&quot;food&quot; value=&quot;mangos&quot; /&amp;gt;
   Almonds &amp;lt;input type=&quot;checkbox&quot; name=&quot;food&quot; value=&quot;almonds&quot; checked/&amp;gt;
   Chocolate &amp;lt;input type=&quot;checkbox&quot; name=&quot;food&quot; value=&quot;chocolate&quot; /&amp;gt;
&lt;/pre&gt;&lt;/html&gt;The above looks like the following, (notice that we can have items pre checked):
&lt;html&gt;&lt;pre&gt;
I like:  
   Mangos &lt;input type=&quot;checkbox&quot; name=&quot;food&quot; value=&quot;mangos&quot; /&gt;
   Almonds &lt;input type=&quot;checkbox&quot; name=&quot;food&quot; value=&quot;almonds&quot; checked/&gt;
   Chocolate &lt;input type=&quot;checkbox&quot; name=&quot;food&quot; value=&quot;chocolate&quot; /&gt;
&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="child selector" modifier="rvr" created="201705181807" modified="202209151656" changecount="34">
<pre>An advanced [[selector]] is ''child combinator selector''.
&lt;html&gt;&lt;pre&gt;
  .my-nav &gt; li {
    display: inline-block;
  }

body &gt; * { ... } ;
&lt;/pre&gt;&lt;/html&gt;
This says to: @@select only ''li'''s that are direct children of the .my-nav parent, and make them [[inline-block]].@@
The second one reads: @@Select all direct children elements of the body element.@@
This allows targeted/selective css styling.
See [[inline-block]].
</pre>
</div>
<div title="circle" modifier="rvr" created="202207141351" modified="202207141433" changecount="7">
<pre>How to make a circle? Here is the CSS:
&lt;html&gt;&lt;pre&gt;
.color-circle {
    width: 33px;
    height: 33px;
    border: 2px solid #4e4e4e;
    border-radius: 50%;
  }
}
&lt;/pre&gt;&lt;/html&gt;
Some points:
* We have a circle of 33x33 pixels, no [[margin]]s. 
* The ''border-radius'' of 50% makes a circle.
* The ''border-radius'' of 10% makes a box with barely rounded couners.</pre>
</div>
<div title="class" modifier="rvr" created="201406271725" modified="201601181342" changecount="24">
<pre>Class. You know its a class when it starts with a ''dot''! (''@@.@@''). An [[ID]] uses a hash (@@#@@)
When you want a consistent style throughout the document, use a class. An element can have multiple classes.

CSS:&lt;html&gt;&lt;pre&gt;.title .paragraph { font-family: Georgia}       // Both classes can have similar settings
.title {font-size: 18px;}                       // But then you can further change them
.paragraph {font-size: 12px;}
p.rvr { color:purple;background-color: yellow;} // This style not often used&lt;/pre&gt;&lt;/html&gt;

HTML:&lt;html&gt;&lt;pre&gt;&amp;lt;p class='title'&amp;gt;This is cool&amp;lt;/p&amp;gt;
&amp;lt;p class='rvr'&amp;gt;This is another line&amp;lt;/p&amp;gt;&lt;/pre&gt;&lt;/html&gt;
See also [[ID]], as well as [[classes - context dependant]].</pre>
</div>
<div title="class and id" modifier="rvr" created="201206080537" modified="201701241733" changecount="5">
<pre>The [[class]] attribute on an [[element]] is used to group one or more elements into a related collection. This is used to style a ''class'' of elements, such as certain paragraphs. In the following we may want to bold or highlight paragraphs that are of class &quot;warning&quot; but leave other paragraphs normal.
The ''id'' is used to uniquely identify one specific element. If you need to id more than one, use [[class]]. Here is an example with both ''class'' and ''id''.
&lt;html&gt;&lt;pre&gt;
  &amp;lt;p id=&quot;caution&quot; class=&quot;warning&quot;&amp;gt;When adding potassium to ... &amp;lt;/p&amp;gt;
  &amp;lt;p&amp;gt; Now we are ready to ...&amp;lt;/p&amp;gt;
  &amp;lt;p class=&quot;warning&quot;&amp;gt;At this point safety goggles are...&amp;lt;/p&amp;gt;
&lt;/pre&gt;&lt;/html&gt;
To style these using css:&lt;html&gt;&lt;pre&gt;
  #caution { color: red }     # This is an id.
  .warning { font : 24 }      # This is a class.
&lt;/pre&gt;&lt;/html&gt;
See also [[ID]] and [[class]].</pre>
</div>
<div title="class selector" modifier="rvr" created="200905302348" modified="201705100704" changecount="29">
<pre>The ''[[class|class and id]] selector'' is used to give a group of HTML elements a different style. It is not meant for an individual element (see [[id|class and id]] and  [[id selector]]). The format is simply to start with a period &quot;.&quot;.
&lt;html&gt;&lt;pre&gt;
   .red{ color: red; }
   .center {text-align:center}
&lt;/pre&gt;&lt;/html&gt;And we use them like this:&lt;html&gt;&lt;pre&gt;
   &amp;lt;p class=&quot;red&quot;&amp;gt;This paragraph will be red.&amp;lt;/p&amp;gt;
   &amp;lt;p class=&quot;center&quot;&amp;gt;This paragraph will be center-aligned.&amp;lt;/p&amp;gt;
   &amp;lt;p class=&quot;center red&quot;&amp;gt;This paragraph will be red and center-aligned.&amp;lt;/p&amp;gt;
&lt;/pre&gt;&lt;/html&gt;
We can also use multiple classes, like:&lt;html&gt;&lt;pre&gt;
   &amp;lt;p class=&quot;center red&quot;&amp;gt;This is a paragraph the we be centered and read, I mean red.&amp;lt;/p&amp;gt;
&lt;/pre&gt;&lt;/html&gt;Finally, if we add an element to the front of the selector, then only that element will be effected, so only paragraph elements that use class ''center'' will be center-aligned:
&lt;html&gt;&lt;pre&gt;
  p.center {text-align:center}
&lt;/pre&gt;&lt;/html&gt;
You can [[chain]] class selector with [[ID]] selector.</pre>
</div>
<div title="classes - context dependant" modifier="rvr" created="201407180607" modified="201407180626" changecount="14">
<pre>You may want elements styled, but under certain contexts. For example,
&lt;html&gt;&lt;pre&gt;
&amp;lt;a href=&quot;#&quot;&amp;gt;link&amp;lt;/a&amp;gt;            // This will only inherit a font-weight:bold
&amp;lt;li&amp;gt;&amp;lt;a href=&quot;#&quot;&amp;gt;link&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;   // This gets it all
&lt;/pre&gt;&lt;/html&gt;
So you would use this CSS:&lt;html&gt;&lt;pre&gt;li a {font-size:16px; color:fuschia}
a {font-weight:bold;}
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="clear" modifier="rvr" created="201101072058" modified="202209041850" changecount="16">
<pre>To avoid &quot;floated&quot; sections, we can use ''clear''. By that I mean a section that has clear set will be &quot;clear&quot; (or below) of that floated element.
To stop the [[float]] property from earlier html/css code use ''clear''. Its four values are: ''left'', ''right'', ''both'' and ''none''. The following css snippet will have a dashed line across the bottom.
&lt;html&gt;&lt;pre&gt;
 #pagefooter {  float:left; border-top: 2px green dashed; clear:both; width:100%; }
&lt;/pre&gt;&lt;/html&gt;Note that we have it floating too! If not then it would be plain html and follow (probably incorrectly) after other objects
Another example to end float:
&lt;html&gt;&lt;pre&gt;
&amp;lt;p style=&quot;float: left;&quot;&gt;
...
&amp;lt;p style=&quot;clear: left;&quot;&gt;
&lt;/pre&gt;&lt;/html&gt;Just to reset - you could also have used: @@ clear: both; @@

Another way is to wrap the whole thing in a [[div]] and style using [[overflow]], for example: @@ overflow: hidden; @@
However, if you set a height or width on that element, the content inside can get cut off. 
If you *have* to set a height or width, then you'll have to use the: @@:after@@ method. See example of this in [[after and before]].</pre>
</div>
<div title="collapse" modifier="rvr" created="201703200615" modified="201703200620" changecount="43">
<pre>To hide content use ''collapse''. Here we have a title of &quot;Fruit&quot;, when you click on the link (toggle) the text will appear/hide.
''data-toggle'' - toggles on/off, hide/display. Make sure you have the ''id''. The following uses the ''anchor'' element.
&lt;html&gt;&lt;pre&gt;
&amp;lt;div class=&quot;container-fluid&quot;&gt;
  &amp;lt;p&gt;&amp;lt;a data-toggle=&quot;collapse&quot; href=&quot;#Fruit&quot; &gt;Fruit&amp;lt;/a&gt;&amp;lt;/p&gt;
  &amp;lt;div class=&quot;collapse&quot; id=&quot;fruit&quot;&gt;
    &amp;lt;p&gt;Mangos are beautiful things, and things are beautiful mangos.&amp;lt;/p&gt;
  &amp;lt;/div&gt;
&amp;lt;/div&gt;
&lt;/pre&gt;&lt;/html&gt;You could use the ''button'' element:
&gt;&lt;button class=&quot;btn btn-info&quot; type=&quot;button&quot; data-toggle=&quot;collapse&quot; data-target=&quot;#fruit&quot; &gt;</pre>
</div>
<div title="colors" modifier="rvr" created="201407110709" modified="202209031400" changecount="29">
<pre>You have background and foreground colors. See [[rgba]]. There are a few color standards:
*Keywords: ''red'' - use the actual name, so that red really is red!
*RGB: ''rgb(255,0,0)'' - for more fine grained control
**''rgb(100%,0%,0%)'' - similar to above
**''rgba(100%,0%,0%, .5)'' - similar to above but adding an &quot;opacity&quot; value 0.0-1.0, with 1.0=default 0=see just white
*Hex: ''#ff0000'' - hex code (0-f), follows RGB format.
**''#ff0000'' - red  - ''#f00'' - can also be used
**''#00ff00'' - green - ''#0f0'' - as above
**''#0000ff'' - blue - ''#00f'' - ditto  
**''#000000'' - black - ''#000''  
**''#ffffff'' - white - aka ''fff''
**''#xyxyxy'' - grey, any 2 repeating hex numbers
*HSL: Hue, saturation, lightness, opacity
** ''hsla(200, 42%, 22%, 0.5)''  &lt;- can also just use ''hsl'' 

Whatever you use, be consistent.
Some more examples:
&lt;html&gt;&lt;pre&gt;
.hot{color:red; background-color:firebrick;}
&lt;/pre&gt;&lt;/html&gt;
See also [[units]].</pre>
</div>
<div title="comments" modifier="rvr" created="200905310000" changecount="13">
<pre>/* css comments look like this! */</pre>
</div>
<div title="context dependant" modifier="rvr" created="201407220651" modified="201407220659" changecount="5">
<pre>''context dependant'' - used to make selectors work only in certain contexts. For example,
&lt;html&gt;&lt;pre&gt;
CSS: i b {font-size:20px; color:red;}
HTML
  &amp;lt;b&gt;This will be bold and&amp;lt;/b&amp;gt; 
  &amp;lt;i&amp;gt;this will be italic&amp;lt;/&amp;gt; But.
  &amp;lt;i&amp;gt;&amp;lt;b&amp;gt;This will have both and is red&amp;lt;/b&amp;gt;&amp;lt;/i&amp;gt; 
&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="display" modifier="rvr" created="201004051608" modified="202209031435" changecount="68">
<pre>The ''display'' element allows us control over line breaks. By default many HTML elements have automatic breaks (like &quot;p&quot;), that in CSS would look like:
&lt;html&gt;&lt;pre&gt;
   p { display:block }    // This is how HTML does paragraphs - automatic breaks
   a { display:inline }   // This is how HTML does anchors - no line breaks
&lt;/pre&gt;&lt;/html&gt;Here are the ''values'' for the ''display'' property.
|!Value|!Description|
|none|Don't display anything. Used to hide data on interactive pages.|
|[[block]]|Sets element as a block.|
|[[inline]]|Sets an element as inline.|
|[[inline-block]]|A hybrid of inline &amp; box. Often used for site nav, icons, and images.|
|[[flex]]|Forces all child elements to fill the entire parent element. See [[Flexbox]].|
|inherit|Inherit the parent elements display property.|
|list-item|Will create a box and an inline box for items.|
There are also a whole list of table-like properties not covered here.</pre>
</div>
<div title="div" modifier="rvr" created="200907030153" modified="201705190023" changecount="30">
<pre>The ''div'' element is one of the most used elements. 
Picture the ''div'' tags as a division or a container (see [[block]]). 
The ''div'' and [[span]] elements are similar. ''div'' will produce a paragraph break (because it's a [[block]]) whereas a ''span'' (which in [[inline]]) will not. They are both useful for layout control, somewhat like the HTML table, but with finer control. 
Think ''logical division'' for ''div'', so all elements inside the ''div'' tag are applied when we use class:
&lt;html&gt;&lt;pre&gt;
// The css code:
    div#notice {font-size:14pt; color:#008000;	}
    .cool {color: blue; font-size: large; font-weight: bold }

// The HTML code.
    &amp;lt;div id=&quot;notice&quot;&amp;gt;...some notice information...&amp;lt;/div&amp;gt;
    &amp;lt;div class=&quot;cool&quot;&amp;gt;...all kinds of stuff in here...&amp;lt;/div&amp;gt;

// Or use it to center things:
   &amp;lt;div style=&quot;text-align: center;&quot;&amp;gt;...&amp;lt;/div&amp;gt;
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="document" modifier="rvr" created="201509121434" modified="201509121441" changecount="21">
<pre>When [[HTML]] is loaded into a web browser, it becomes a DOM (Document Object Model). It is organized that everything is a node.
A document is made up of [[element]]s.
The root node is the DOM, From here everything below is a node and there are commands and rules for accessing these nodes and displaying them on the screen.
The nodes are:
*[[element]] nodes - like paragraph tags
*[[attribute]] nodes - these are properties of elements
*text nodes - the text inside elements
*comment nodes - comments</pre>
</div>
<div title="element" modifier="rvr" created="200912130221" modified="202209071757" changecount="41">
<pre>In HTML the element describes the structure and content of a web page. There are two types of elements:
* [[block]] - always start on a new line (a line break before and after) &amp; takes full width of their container. 
** these elements may appear only within a &lt;body&gt; element.
** [[tags]] like h1, table, p, div
* [[inline]] - only takes the space it needs. No new line either. 
** [[tags]] like img, b, em, strong, button, input, [[span]]...
** usually contain only their own properties

An element would be: ''open-~HTML-tag + content + close-~HTML-tag''
&lt;html&gt;&lt;pre&gt;&amp;lt;h1 class=&quot;awesome&quot;&amp;gt;Some Heading&amp;lt;/h1&amp;gt;
&amp;lt;p&amp;gt;This is a paragraph.&amp;lt;/p&amp;gt;
&lt;/pre&gt;&lt;/html&gt;There are two paragraph tags, the opening tag @@&lt;p&gt;@@ and the closing tag  @@&lt;/p&gt;@@.  These tags can be modified by [[attribute]]s (like a [[class and id]]) on the opening tag, for example: @@&lt;h1 class=&quot;awesome&quot;&gt;@@
Think of it like this: An HTML paragraph element consists of two HTML tags.

Elements are organized like a tree. This means that there are siblings, parents and children. A parent element will have a child element and any element with out a child is a leaf. The ancestor of all elements is the [[root element]]. 

In conventional use tag &amp; element are often interchanged.

See also [[element space]].
</pre>
</div>
<div title="element space" modifier="rvr" created="202209031421" changecount="1">
<pre>!Space around an element
There is space around every element, this is important. They can be controlled:
*[[padding]] - this is the amount of space between (within) the element and its border.
*[[margin]] - a margin defines the white space around the element's border,
*[[border]] - this surrounds the element.</pre>
</div>
<div title="element type selector" modifier="rvr" created="201407060642" modified="202209141141" changecount="29">
<pre>The basic CSS [[selector]]s is a ''type selector''. This targets the [[basic HTML]] element, like the paragraph element.
To target all paragraph elements, you would use:
&lt;html&gt;&lt;pre&gt;
  p { ... }                               # The selector is &quot;p&quot;
ie...
  selector {property:value;} 
  p {                         # The selector is &quot;p&quot; - paragraph
     color: red;              # The property we change is color -&gt; red
     font-family:verdana;}    # The property we change is font-family -&gt; verdana
&lt;/pre&gt;&lt;/html&gt;
A global selector, selecting everything would be: @@* { ... } @@
!!Nested
Let's say that we want all the paragraph elements in a div to be styled different then not in a div. 
The more specific the selector takes precedence over the more general selector.
&lt;html&gt;&lt;pre&gt;
p { color: red; }           // All paragraphs are red. This is very general.
div p { color: green; }     // All paragraphs inside &quot;div&quot; are green - overrides above css because it placed later.
&lt;/pre&gt;&lt;/html&gt;Of course if we want different divs to have colours, we'd need to do either an [[ID]] or [[class]].</pre>
</div>
<div title="em" modifier="rvr" created="201705102251" modified="202209031416" changecount="7">
<pre>While em is relative to the font-size of its direct or nearest parent, rem is only relative to the html (root) font-size.
''Note'' - there is also an ''&lt;em&gt;'' element for &quot;emphasis&quot;.

These are absolute measurements.
''em'' - relative size based on nearest parent font-size. Twice the size would be written: 2em. It has a problem, it is cumulative when size is changed.
''rem'' - root em. Relative to font-size of the root element. This sets it document wide. It is a percentage of an absolute font size. 

If a font-size is not set on a child element, it will inherit the font-size from the parent. If there is not one there, it goes up the stack to the root element of the document.

&lt;html&gt;&lt;pre&gt;
.example {
    font-size: 16px;       /* This sets 1em = 16px for any child elements of this element. */
    border-radius: .5em;   /* This will translate to .5 * 16px = 8px */
}
&lt;/pre&gt;&lt;/html&gt;
This is applied to things other than font, like ''border'' or &quot;padding&quot;. This can be a gotcha.</pre>
</div>
<div title="emmet" modifier="rvr" created="202210091022" modified="202210091056" changecount="7">
<pre>Emmet is a plugin for text editors (many are builtin line codepen) that allow for high-speed coding and editing using structured code formats via content assist.
In an HTML/CSS editor typing in ''doc'' and hitting enter will give an HTML skeleton - ready to go.
The tips:
* ''doc'' - expand out to basic HTML document
* ''link'' - will give a link tag in header
* ''link:css'' - will give a link tag in header with an href to css property.
* &amp;lt;element&gt; - will expand to that element. aanchor tag,  h1header 1 tag, ...
* @@color:red;Child: ''&gt;''@@
** ''div&gt;ul&gt;li'' - will give a ''list'' element inside an ''unordered list'' element inside a ''div'' element
* @@color:red;Sibling: ''+''@@
** ''div+h1+ol'' - will give three element siblings
* @@color:red;ID and CLASS attributes@@
** ''.thing'' - gives a div with a thing class.
** ''#thing'' - gives a div with a thing id.
** ''#thing'' inside an ''ol'' will give a list element with a ''thing'' @@id@@.
** ''.thing'' inside an ''ol'' will give a list element with a ''thing'' @@class@@.
* @@color:red;Text: ''{}''@@
** ''.thing{Bite Me}'' - will have a div with a class thing with content &quot;Bite Me&quot;.
** ''h1.thing{Bite Me}'' - will have a h1 tag with a class thing with content &quot;Bite Me&quot;.
* @@color:red;Multiplication: ''*'' @@ 
** ''ul&gt;li*5'' - will give an ''unordered list'' containing 5 ''list'' elements 
** ''ul.xlist&gt;li.xyz*5'' - gives an ''ul'' with a class ''xlist'' and 5 list elements with a class ''xyz''
* @@color:red;Item numbering: ''$''@@
** ''ul&gt;li.item-$*5'' - will give an ''unordered list'' containing 5 ''list'' elements with a class ''item-1'' to ''item-5''.
** ''ul&gt;li{Item number $}*5'' - will give an ''unordered list'' containing 5 ''list'' elements with content: ''Item number 1''...
</pre>
</div>
<div title="example stylesheet" modifier="rvr" created="201101060757" modified="201101060758" changecount="14">
<pre>Here are some examples:
|!css|!what it says|
|p {font-size:14pt ; color: orange }|The whole paragraph will be 14pts and be orange in colour.|
|h1 { size: 16pt; color: red; font-family: Garamond }|The h1 tag will be 16pts, coloured red and be garamond.|
</pre>
</div>
<div title="examples" modifier="rvr" created="201507131532" modified="201507131605" changecount="21">
<pre>Here is what css looks like in some actual code.This uses [[Bootstrap]], a twitter framework in common use.
*The [[header]] tag indicates that there are three css [[class]]es: ''navbar navbar-fixed-top navbar-inverse''
*The [[div]] tag is used just to divide up content. In this division, there is a ''css'' class called ''container''.
*The ''link_to'' is a rails thing. We care about the css id tag ''logo''. Notice its slightly different.
*Next we have a ''nav'' tag, an HTML5 thing like ''div'', for navigation. 
*The unordered list (''ul'') has three css classes associated with it.
&lt;html&gt;&lt;pre&gt;
&amp;lt;header class=&quot;navbar navbar-fixed-top navbar-inverse&quot;&amp;gt;
  &amp;lt;div class=&quot;container&quot;&amp;gt;
    &amp;lt;%= link_to &quot;sample app&quot;, '#', id: &quot;logo&quot; %&amp;gt;
    &amp;lt;nav&gt;
      &amp;lt;ul class=&quot;nav navbar-nav navbar-right&quot;&gt;
        &amp;lt;li&gt;&amp;lt;%= link_to &quot;Home&quot;,   '#' %&gt;&amp;lt;/li&gt;
        &amp;lt;li&gt;&amp;lt;%= link_to &quot;Help&quot;,   '#' %&gt;&amp;lt;/li&gt;
        &amp;lt;li&gt;&amp;lt;%= link_to &quot;Log in&quot;, '#' %&gt;&amp;lt;/li&gt;
      &amp;lt;/ul&gt;
    &amp;lt;/nav&gt;
  &amp;lt;/div&amp;gt;
&lt;/pre&gt;&lt;/html&gt;
Note that the three ''link_to''s will turn from Rails ERB format into HTML. Then it will look like:
&lt;html&gt;&lt;pre&gt;
    &amp;lt;li&amp;gt;&amp;lt;a href=&quot;#&quot;&amp;gt;Home&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;
    &amp;lt;li&amp;gt;&amp;lt;a href=&quot;#&quot;&amp;gt;Help&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;
    &amp;lt;li&amp;gt;&amp;lt;a href=&quot;#&quot;&amp;gt;Log in&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;
&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="external stylesheet" modifier="rvr" created="200905310013" modified="202209141012" changecount="20">
<pre>Here is how we pick up an external style sheet (it should be in the head of the HTML). Be aware that the order of linking the stylesheets is important!
&lt;html&gt;&lt;pre&gt;
&amp;lt;!DOCTYPE htm&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
  &amp;lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;styles.css&quot; /&amp;gt;
&amp;lt;/head&amp;gt;
...
&lt;/pre&gt;&lt;/html&gt;Make sure that a styles.css file is there! Even better especially if there are many stylesheets, place it in its own subdirectory. See also [[internal stylesheet]].</pre>
</div>
<div title="fieldset" modifier="rvr" created="200906011625" modified="200906011626" changecount="2">
<pre>The ''fieldset'' HTML tag is used to group elements in a form. It will draw a box around these form elements. The ''&lt;legend&gt;'' element will place a title or caption in the box created by the ''&lt;fieldset&gt;'' tag.</pre>
</div>
<div title="first-child and last-child" modifier="rvr" created="201601221727" modified="201705160115" changecount="13">
<pre>Type [[pseudo-elements]], ''first-child'' and ''last-child'' are used to select the first of many of a particular class. 
For example, say we have four elements that are defined as ''some-class''.  
Then @@.some-class:first-child@@ will select the first of these 4 elements. 
And then @@.some-class:last-child@@ will select the last of these 4 elements.

An example, to make the first link (grouped using a ''li''st) a different color &amp; when clicked a different color from the other links, we'd:
&lt;html&gt;&lt;pre&gt;
.the-nav a {
  color: #aaa;
}
.the-nav &gt; li:first-child a {
  color: #111;
}
.the-nav &gt; li:first-child a:hover {
  color: #000;
}
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="first-line" modifier="rvr" created="201101060825" modified="201705160109" changecount="16">
<pre>You can apply a style on the first letter and the first line of an element:
&lt;html&gt;&lt;pre&gt;
  h1:first-letter { font-size: 24pt }    # First letter of h1 will be 24pt!
  p:first-line { font-weight: bold }     # First line of paragraph will be bold.
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="fixed" modifier="rvr" created="201705180210" modified="202209041836" changecount="36">
<pre>Not to be used a lot.
Fixed [[positioning]] is specified as: @@position: fixed; @@
*Positions the element at a specific spot in the browser window. Ignores all page content. 
**When you scroll the page, it will not move.
* If you set ''top: 10px;'' - it will always be 10px down from the top of the [[viewport]].
** Same with left, right, or bottom.
*You can set [[z-index]].
*The width and height is determined by the content inside, or by setting dimensions in CSS.
*If a [[float]] is set, it is ignored
This is often used to stick a header bar at the top of the screen that stays there. Here is some css:
&lt;html&gt;&lt;pre&gt;
.header {
  position: fixed;
  width: 100%;
  z-index: 20;  
}
&lt;/pre&gt;&lt;/html&gt;
The [[z-index]] makes sure that it is over top of the regular content.</pre>
</div>
<div title="flex" modifier="rvr" created="201705221938" modified="201705221939" changecount="34">
<pre>A flex container is declared by setting the [[display]] property of an element to either flex (rendered as a block) or inline-flex (rendered as inline).
Flex items are set inside this flex container.
The ''flex'' value - see [[Flexbox]].
</pre>
</div>
<div title="flex-grow" modifier="rvr" created="201705222004" modified="201705222006" changecount="34">
<pre>The ''flex-grow'' property works by proportions: 
*If there is one item and that item is set to 1, it takes up the whole container.
*If there are three items and each is set to 1, then each one takes up 1/3 of the container.
*If there are three items and one is set to 1 and the other 2 are set to 0, then the &quot;1&quot; item expands so that the container is full.
The default value for ''flex-grow'' is 0.</pre>
</div>
<div title="flexbox items" modifier="rvr" created="202209051314" modified="202209051318" changecount="12">
<pre>Most [[Flexbox layout options]] are for the containers, but we can also control the items.  See also:  [[flexbox properties]]. Here are some values &amp; etc:
*''order'' - default is in order found. Default value is zero.
** To move to front use -1 otherwise +1 to move to the end.
*''flex-grow'' - how much can we grow&quot; 0=nothing, 1=gets first free space
** Also ''flex-shrink''
</pre>
</div>
<div title="flexbox page example" modifier="rvr" created="201705221957" modified="201705222012" changecount="34">
<pre>Setting up [[Flexbox]] for a web page example follows, here are the key points:
*Setup [[body]] tag to be the flex container
*Setup flex items:
**A header that is fixed
**Content that expands as necessary
**A footer that is fixed.
!!Setup Body Tag
This is so that the whole document is in a flex container:
&lt;html&gt;&lt;pre&gt;
body {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}
&lt;/pre&gt;&lt;/html&gt;
!!Setup Flex Items
We want some to grow and other not. Only the ''content'' item should grow, the header/footer to be fixed.
The ''content'' should then be wrapped in a [[div]] and we need to set the declaration to@@ [[flex-grow]]: 1@@. 0=no grow &amp; 1=grow
&lt;html&gt;&lt;pre&gt;
.content-container {
  flex-grow: 1;
}
&lt;/pre&gt;&lt;/html&gt;We have no need to set [[flex-grow]] on the header/footer as the default value is 0 (no-grow).
That's all folks.

</pre>
</div>
<div title="flexbox properties" modifier="rvr" created="201705222042" modified="202209051308" changecount="42">
<pre>The following [[Flexbox]] tables focus on the ''container'' and ''item'' specific properties
!!Flex Container Properties
|!Property|!Values|!Description|
|display|flex or inline-flex|To identify a flexbox container.|
|flex-direction|row(default), row-reverse, column, column-reverse|The direction of flow. &quot;row&quot;: L&amp;rarr;R, &quot;column&quot;: Top&amp;rarr;Bottom.|
|flex-wrap|nowrap, wrap, wrap-reverse|How wrapping is done when the line limit is reached.|
|align-content|center, flex-start, flex-end, stretch, space-around|The alignment along the main axis.|
|justify-content|center, flex-start, flex-end, space-between, space-around|The alignment along the main axis.|
|align-items|flex-start, flex-end, center, baseline, stretch(default)|How items are aligned along the cross axis. ''flex-start'' starts at top of container.|
|flex-flow|row wrap|Comines flex-direction &amp; flex-wrap|
!!Flex Item Properties
|!Property|!Values|!Description|
|order|&lt;integer&gt;|The order of items, from -n to 0 to +n|
|flex|&lt;flex-grow&gt;&lt;flex-shrink&gt;&lt;flex-basis&gt;|Shortcut for following three.|
|flex-grow|&lt;integer&gt;,0=default|How items grow inside parent. 0=don't expand, 1=expand equally, 2=expand 2x as fast.|
|flex-shrink|&lt;integer&gt;,1=default|How items shrink inside parent. 0=no shrink, 1=shrink equally, 2=shrink 2x as fast.|
|flex-basis|number, auto(default), initial, inherit|How big to start off as. 0=no start size. Take up space allotted by flex-grow, auto=based on content, npx/n%=guarantee that space.|
|align-self|auto(default), flex-start, flex-end, center, baseline, stretch|Determines size of items before space is distributed and how content is treated. Overrides ''align-items'' on container.|
Notes:
*Even if you do not specifically set a flex item property, if it is in a flex container, the defaults kick in, which is: @@flex:0 1 auto@@.
*flex-basis: if set to 25em - it will start that width &amp; keep it.
See [[Flex Item Shortcuts]] Example: @@ flex: 1 1 0;@@  = equals =  @@flex: &lt;flex-grow&gt; &lt;flex-shrink&gt; &lt;flex-basis&gt; @@</pre>
</div>
<div title="float" modifier="rvr" created="201004050242" modified="202209151855" changecount="79">
<pre>Floats here are the details:
*are a hack before we had good layouts. 
* Used to flow text around images.
* using ''float'' removed it from normal flow of document.
*We had tables we used them.
*they have rows and cells. 
*if you float it may cover another element, to see that one you must ie ''clear: left''. 
*limited rearranging on the screen. 
*problem of equal row heights - many javascript code to fix

Float element is used to position elements around the web page. It has three properties, ''left'', ''right'' and ''none''. Images can be floated as is, but text will have to be [[div]]ided up into sections.
&lt;html&gt;&lt;pre&gt; img { float:right; }   // Floats an image to the right of the screen.&lt;/pre&gt;&lt;/html&gt;
To float text, place in a div:
&lt;html&gt;&lt;pre&gt;
...
&amp;lt;div id=&quot;rightcolumn&quot;&amp;gt;
   &amp;lt;h2&amp;gt;Some Title&amp;lt;/h2&amp;gt;
   &amp;lt;p&amp;gt;Here is the text that'll be floated.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;		
...
/* css */
#rightcolumn { float: left;width: 60% }
&lt;/pre&gt;&lt;/html&gt;
Float example where only the first letter is capitalized and makes the text float around it:
&lt;html&gt;&lt;pre&gt;
/*css */ 
capit { float:left; width:0.7em;  font-size:500%; font-family:courier; line-height:80%; }

/* html */  
&amp;lt;capit&amp;gt;T&amp;lt;/capit&amp;gt;his is some text that goes on and on...
&lt;/pre&gt;&lt;/html&gt;
Or float to the right, an image:
&lt;html&gt;&lt;pre&gt;
...
&amp;lt;p&amp;gt;This text goes all across the screen,&amp;lt;/p&amp;gt;
&amp;lt;div id=&quot;doit&quot;&amp;gt;
&amp;lt;img src=&quot;someimage.gif&quot;/&amp;gt;&amp;lt;br/&amp;gt;     # This text centered under image!
&amp;lt;/div&amp;gt;
&amp;lt;p&amp;gt;This text goes up to the image and then wraps under it.&amp;lt;/p&amp;gt;

/* css - also places a 1px border around image. */   
doit { float:right; margin:10px; padding:15px; border:1px solid black; text-align:center; }
&lt;/pre&gt;&lt;/html&gt;
To stop this floating business, just set the [[clear]] property.</pre>
</div>
<div title="font" modifier="rvr" created="201004030016" modified="202209151503" changecount="92">
<pre>We can define font family, size, boldness and style. There are two types here:
*font family - Specific font. Arial, courier, Palatino, Helvetica, ...
*generic family - Fonts that look similar. serif, sans-serif, fantasy,  cursive, and monospace
**When listing fonts, have the last one a generic one - for fallback ie browser picks one
In the following, we first list the font we want, a fallback in case the browser does not have that font and finally a generic font.
&lt;html&gt;&lt;pre&gt;
p{font-family:&quot;Times New Roman&quot;, Times, serif;} // specific, specific, generic (fallback)
&lt;/pre&gt;&lt;/html&gt;Here are some more properties:
|!Property|!Example|!Other options|
|font-style|p {font-style:oblique;}|oblique,italic,normal.|
|font-size|p {font-size:7px;}|px or em|
|font-weight|p {font-weight:bold;}|bold, normal, lighter, 100, 200, ... 900|
|font-variant|p {font-variant:small-caps;} |normal, small-caps|

We can also put everything into one line, if done in the right order:
&lt;html&gt;&lt;pre&gt;
  format: selector { font: style  weight variant    size font-family }
  example:     h1  { font: italic bold   small-caps 96pt &quot;Georgia&quot; }
&lt;/pre&gt;&lt;/html&gt;
Generic fonts with :
* serif, sans serif, cursive, fantasy, and monospace

See also [[text]]. Fini!</pre>
</div>
<div title="form" modifier="rvr" created="201005251906" modified="201603291314" changecount="41">
<pre>Form is an HTML element. It is like a container that defines the start and end of form for entering user information. 
There are many related [[form elements]]. 
It is used to gather user input using the [[input]] tags. It look like this:
&lt;html&gt;&lt;pre&gt;
&amp;lt;form action=&quot;step1.php&quot; method=&quot;post&quot;&amp;gt;
   Firstname: &amp;lt;input type=&quot;text&quot; name=&quot;firstname&quot; &amp;gt; 
   &amp;lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&amp;gt;
&amp;lt;/form&amp;gt;
&lt;/pre&gt;&lt;/html&gt;Notice that there is an ''action'' [[attribute]] to the ''form'' [[element]].
Here is another example, we have a text field &amp; we want to (via button) submit it.
code: @@&lt;input type=&quot;text&quot; placeholder=&quot;your username&quot;&gt;@@ Actual:&lt;html&gt;&lt;input type=&quot;text&quot; placeholder=&quot;your username&quot;&gt;&lt;/html&gt;
&lt;html&gt;&lt;pre&gt;
  &amp;lt;form action=&quot;/submit-something&quot;&amp;gt
    &amp;lt;input type=&quot;text&quot; required placeholder=&quot;your username&quot;&amp;gt
    &amp;lt;button type=&quot;submit&quot;&gt;Submit&amp;lt;/button&gt;
  &amp;lt;/form&amp;gt
&lt;/pre&gt;&lt;/html&gt;Note ''required'' attribute, if you leave it empty, it will complain.
The form tag has an ''action'' [[attribute]] to direct where to go after [[submit]] has been pressed.</pre>
</div>
<div title="form elements" modifier="rvr" created="201603291254" modified="201703172210" changecount="11">
<pre>An HTML [[form]] has a group of [[element]]s that it works with. Here is the list:
*[[form]] - defines a form that includes a range of inputs and controls
*[[input]] - the input control for a form
*''button'' - a button  (See [[Bootstrap buttons]])
*[[select]] - this gives us a ''drop down list'', where a user can select a choice.
*[[textarea]] - This defines a multiline text area.
*''isindex'' - indicates that the document has an associated keyword index that can be searched
*''label'' - specifies descriptive text for the associated form control
*''legend'' - caption text for form controls that are grouped by the fieldset element
*''optgroup'' - groups related option elements contained in a select list
*''option'' - defines an item in a select list</pre>
</div>
<div title="framework" modifier="rvr" created="201510182026" modified="202209100920" changecount="8">
<pre>There are CSS frameworks that are toolkits to help with provide a standardization. One such is [[Bootstrap]]. The aim is to provide:
*An easily customizable [[grid]]
*Some default typography
*A typographic baseline
*CSS reset for default browser styles
*A stylesheet for printing
*[[responsive web design]].

CSS frameworks are libraries are designed to help make a developers job easier. Instead of re-inventing the wheel, popular patterns like nav bars, hamburger menus, 3 grid layouts - are already done. This makes it easier to get it done quick and provides standards-compliant design. Simply put, they are libraries of code available for use right away.
These libraries often include:
* a default &quot;blank&quot; stylesheet.
* provide standardized/consistent color, fonts, icons
* compatibility with different browsers
* often used helper classes

Some popular ones:
* ''Tailwind'' - can create classes of colors that others can use.
**Easy to build consistent looking sites. May intimidate because of he use of classes in HTML
* ''Bootstrap'' - has many prebuilt components. Very popular, but many use it. Like grids.
**Means adding a large css style file to you website
*''Materialize'' - has own grid, and responsive components.
** From google. From designs that are to look familiar. Must follow their style on all pages,
*''Foundation'' - many prebuilt components and a grid system. 
**Very flexible.
* ''Bulma'' - CSS Only framework. No javascript like all others.
A ''framework'' is different from a [[preprocessor]].</pre>
</div>
<div title="grid" modifier="rvr" created="201509131759" modified="201703160446" changecount="44">
<pre>[[Bootstrap]] has a grid system for layout. It has a 12 column grid, you can choose any size up to 12 columns.
See also [[grid of images example]].

|!Class|!Description|!Device Size|!Container Width|!Width in em|
|.col-xs-*|extra small - for mobiles|&lt;576px|auto|&lt;34em|
|.col-sm-*|small - for tablets|&gt;576px|540px|&gt;34em|
|.col-md-*|medium - for laptops|&gt;768px|720px|&gt;48em|
|.col-lg-*|Large - for desktops|&gt;992px|960px|&gt;62em|
|.col-xl-*|Extra Large - for desktops|&gt;1200px|1140px|&gt;75em|

The above ''*'' is how many columns the element should be. You have: @@''col-md-1'', ''col-md-2'', ''col-md-3'', ... ''col-md-12''@@
For three equal columns: @@''col-md-4'', ''col-md-4'', ''col-md-4'' @@ (equals 12)
For three unequal columns: @@''col-md-5'', ''col-md-2'', ''col-md-5'' @@ (equals 12)

The following is code for 3 buttons taking the full width of the screen.
#Wrap in a ''container'' class.
#Organize by ''row'' classes.
#Break up into &quot;columns&quot; classes, ie ''.col-sm-*''.
&lt;html&gt;&lt;pre&gt;
&amp;lt;main class=&quot;container&quot;&amp;gt;
  &amp;lt;div class=&quot;row&quot;&amp;gt;
    &amp;lt;div class=&quot;col-md-4&quot;&amp;gt;
      &amp;lt;button class=&quot;btn btn-block btn-primary&quot;&amp;gt;Like&amp;lt;/button&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div class=&quot;col-md-4&quot;&amp;gt;
      &amp;lt;button class=&quot;btn btn-block btn-info&quot;&amp;gt;Info&amp;lt;/button&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div class=&quot;col-md-4&quot;&amp;gt;
      &amp;lt;button class=&quot;btn btn-block btn-danger&quot;&amp;gt;Delete&amp;lt;/button&amp;gt;
    &amp;lt;/div&amp;gt;
  &amp;lt;/div&amp;gt;
&amp;lt;/main&amp;gt;&lt;/pre&gt;&lt;/html&gt;The key is to:
#Wrap everything in a [[div]] with class ''row''. 
#Then wrap each element in a ''div'' and give a class of ''col-md-*''.  (or ''col-xs-*'')</pre>
</div>
<div title="grid alignment" modifier="rvr" created="202210061434" modified="202210061441" changecount="28">
<pre>This will show [[CSS Grid|CSS Grids]] alignment properties.

These properties are for defining cell alignment:.
* See [[grid-template-areas]] for alternative to ''grid-column*''.
* ''place-items: center;'' - element doesn't take full space of column and row..
** ''justify-items: center;'' - element doesn't take full space of column.
** ''align-items: center;'' - element doesn't take full space of row.
* ''gap: 10px'' - gaps between each grid item
See also [[grid positioning]].</pre>
</div>
<div title="grid area" modifier="rvr" created="202210102100" modified="202210102202" changecount="12">
<pre>Grid areas are like [[grid naming]] except we name whole areas, including [[grid spanning]]. Using the code from [[grid naming]] we set up a ''grid template''. This looks a little strange, but in a 4x4 grid, this is what we want in each cell. You'll see it's much cleaner.
&lt;html&gt;&lt;pre&gt;
  grid-template-areas: &quot;head head head head&quot;
                       &quot;box box box side&quot;
                       &quot;main main main side&quot;
                       &quot;foot foot foot foot&quot;;

.main {
  /* Formerly: grid-column: col-start 1 / col-end 3;   Formerly: 1/-2; */
  grid-area: main;
}

.sidebar {
  /* Formerly:  grid-row: box-start / main-end;    */
  /* Formerly:  grid-column: col-end 3 / grid-end   Formerly: -2/-1;  */
  grid-area: side;
}

/* .box naturally falls where it belongs. */
.footer { 
  grid-area: foot;
}

&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="grid naming" modifier="rvr" created="202210102049" modified="202210102102" changecount="12">
<pre>We can use [[grid positioning]] to position elements, using numbers. But we can also use names which helps because we only have to change the cells covered by a name and not each occurrence if we had used numbers. 
Here are some examples: Again, this is a 4x4 grid with a span &lt;html&gt;&lt;pre&gt;
.container {
  display: grid;
  grid-template-rows: [header-start] 33px [header-end box-start] 66px [box-end main-start] 111px [main-end footer-start] 33px [footer-end];
  grid-template-columns: repeat(3, [col-start] 1fr [col-end]) 99px [grid-end];
}

.header {
  grid-column: col-start 1 / grid-end 1;    /* With numbers, we'd use:  1/-1; */
  grid-row: header-start / header-end;      /* With numbers, we'd use:  1/2; */
}
.main {
  grid-column: col-start 1 / col-end 3;     /* With numbers, we'd use:  1/-2; */
}
.sidebar {
  grid-row: box-start / main-end;      /* Span 2 rows */
  grid-column: col-end 3 / grid-end;   /* With numbers, we'd use:  -2/-1;  */
}&lt;/pre&gt;&lt;/html&gt;
See also [[grid area]].</pre>
</div>
<div title="grid of images example" modifier="rvr" created="201601212025" modified="201601220834" changecount="22">
<pre>Here you'll see how to make a grid of images and also to have a zoom-in capability.
The images will fill the width of the web browser, no border. They are slightly dark, and when you hover over an image, it will lighten and transform in 1/2sec from 115% to 100%.

&lt;html&gt;&lt;pre&gt;
&amp;lt;section class=&quot;section-socks&quot;&gt;
    &amp;lt;ul class=&quot;sock-showcase&quot;&gt;
        &amp;lt;i&gt;
            &amp;lt;figure class=&quot;sock-photo&quot;&gt;
                &amp;lt;img src=&quot;resources/images/sock1.jpg&quot; alt=&quot;Wool socks&quot;&gt;
            &amp;lt;/figure&gt;
        &amp;lt;/li&gt;
        &amp;lt;i&gt;   
         .... next image
&lt;/pre&gt;&lt;/html&gt;
The CSS:
&lt;html&gt;&lt;pre&gt;
.sock-showcase {
    list-style: none;   // Using unordered lists, we don't want 1 image per line.
    width: 100%;
}

.sock-photo {       //  Container for an individual photo
    width: 100%;
    margin: 0;
    overflow: hidden;    // When the image is 115% - we don't want it leaking past browser edge.
    background: #000;    // Set backgournd black, when we set opacity, the image will appear darker.
}

.sock-photo img {    // Css for an image inside container sock-photo
    opacity: 0.7;    // This allows the background to show through a little
    width: 100%;
    height: auto;
    transform: scale(1.15);     // We set the image at 115% of its regular size
    transition: transform 0.5s, opacity 0.5s;
}

.sock-photo img:hover {
    opacity: 1;               // When we hover over image, opacity is gone.
    transform: scale(1.03);   // Picture &quot;zooms&quot; to 100%. The .03% to cover up a little white space.
}
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="grid positioning" modifier="rvr" created="202210061433" modified="202210102100" changecount="30">
<pre>This will show [[CSS Grid|CSS Grids]] positioning properties.

These properties are for defining where and how big the cells are. (Where the rows and columns are.)
* ''grid-column: 1/3;'' - what column to start  and end element being styled. Below 2 do same thing
** ''grid-column-start: 1;'' - what column to start element being styled.
** ''grid-column-end: 3;'' - what column to end element being styled.
* ''grid-row: 1;'' - what row we want that element in.
** ''grid-row: 1/2;'' - is the same as above.
* ''grid-area'' combines the above two, but I prefer to use ''grid-column&quot; and ''grid-row&quot;.
* ''place-self: center;'' - to center individual item in column and row
** ''justify-self: center;'' - to center individual item in column.
** ''align-self: center;'' - to center individual item in row

See also [[grid alignment]] and [[grid naming]].</pre>
</div>
<div title="grid properties" modifier="rvr" created="202210061204" modified="202210061540" changecount="28">
<pre>[[CSS Grids]] is very flexible with how we specify values.
* There is a ''fr'' for fractional, meaning fraction of page.
** ''fr'' is in whole numbers.
** ''1fr'' is for 1-fractional space. If is is the last one, then the whole space.
* There is a ''repeat'' to repeat things.
** ''repeat'' is in form: ''repeat(2, 100px);''

If we are not explicit with some property:values, then the browser will decide.
We have control over where things will go.
* column #1 = ''grid-column: 1/2''    
*col #1+2 = ''grid-column: 1/3''

Check out: 
* [[grid rows &amp; columns]] - the grid rows x columns.
* [[grid positioning]] - where in the grid to position.
* [[grid alignment]] - where to align in the cell.
* [[grid spanning]] - multiple rows or columns.</pre>
</div>
<div title="grid rows &amp; columns" modifier="rvr" created="202210061437" modified="202210061439" changecount="28">
<pre>This will show [[CSS Grid|CSS Grids]] row x columns format:

These properties are for defining the number pf rows and columns of our grid.
* ''grid-template-columns: minmax(200px, 1fr) 2fr 1fr;'' - gives us 3 columns of 3 different widths
** fr=fractional, better than px. covers entire width of page.
** optional ''minmax()'' - sets a min (200px) and a max (1fr)
* ''grid-template-rows: 1fr 3fr 1fr;'' - sets how wide each of the three rows are
** If all rows same can use: ''repeat(3, 1fr);'' - meaning three rows of ''1fr''.
* ''grid-template-rows: 1fr [left] 3fr [middle] 1fr [right];'' - as above - but with names
** therefore with above (and below) we could use: ''grid-column: left/right;''
See more [[grid properties]].</pre>
</div>
<div title="grid spanning" modifier="rvr" created="202210061509" modified="202210081827" changecount="41">
<pre>This will show [[CSS Grid|CSS Grids]] spanning properties. We want to occupy more than a single cell.
This is very similar to [[grid positioning]].

To occupy 2 adjacent grid cells (column 2 and 3), using the ''grid numbers'' in the second row, you'd need to specify:&lt;html&gt;&lt;pre&gt;
    grid-row: 2/3;
    grid-column: 2/4;
&lt;/pre&gt;&lt;/html&gt;
@@color(red):Important@@ - if we have two elements that we specify occupy the same cell - the later one will be on top of the earlier one. The earlier one will still be there but will be hidden underneath. Multiple grid items in same cell. To change this we use the [[z-index]]. For example:&lt;html&gt;&lt;pre&gt;z-index: 5; &lt;/pre&gt;&lt;/html&gt;
@@color(red):Important@@ - if we specify a column and a row for an element and later we specify only a column for a different element, that element will be pushed to a new row and will not hide the first element. *Usually* later defined elements take precedence but not in this case - unless both a row and column are specified.

There are THREE ways to span:
* the span 2 columns: ''grid-column 3 / 5;''
* to span to end or row: ''grid-column 3 / -1;''
* ''span'' 2 columns - starting at column 3. use: ''grid-column 3 / span 2;''

See also [[grid properties]].</pre>
</div>
<div title="grid start" modifier="rvr" created="202210061135" modified="202210061259" changecount="28">
<pre>[[CSS Grids]]

We define a CSS grid container like:
&lt;html&gt;&lt;pre&gt;
&amp;lt;div class=&quot;containerX&quot;&gt; ... &amp;lt;/div&gt;

.containerX {
  display: grid;
}
&lt;/pre&gt;&lt;/html&gt; You can add this code to anything, and it will not change a thing. We need to add more info! If we have:
&lt;html&gt;&lt;pre&gt;
.containerX {
  display: grid;
  grid-template-rows: 100px 100px;
}
&lt;/pre&gt;&lt;/html&gt; Now we'll have only the first 2 [[element]] block on their own row that is 100px tall. All others will be unchanged.
Now things get interesting.&lt;html&gt;&lt;pre&gt;
.containerX {
  display: grid;
  grid-template-rows: 100px 100px;
  grid-template-columns: 150px 150px 150px;
  // could also write above: grid-template-columns: repeat(3, 150px);
}
&lt;/pre&gt;&lt;/html&gt;Now we have a 2 row by 3 column grid. We'll have three elements in the first row and three elements in the second. Any other elements will remain unchanged and simply be following this. Each cell will be 100x150 px.

In the inspector debugging tool in Firefox, it will show the grid display info.
See [[grid properties]].

</pre>
</div>
<div title="grid terminology" modifier="rvr" created="202210081836" modified="202210081840" changecount="7">
<pre>[[CSS Grids]] have some terminology to know. Given a 2x3 grid:
* Grid ''container'' - this is a &quot;container that has a 2x3 grid pattern. It contains all elements.
** This is identified by the CSS: ''display: grid;''
*A ''cell'' is bounded by a grid line - where an element will live.
* Grid ''lines'' - these are lines the split up the container into cells - 2 cells (rows) and 3 cells (columns).
* Grid ''numbers'' - define the cells of a container.
**The first cell would be defined as: 1 / 2 - meaning row line 1 and row line 2 and 1 / 2  - meaning column line 1 and column line 2 
**the left edge of the container would be one and the right edge would be 4
**the top edge of the container would be one and the bottom edge would be 3
* Grid ''column'' is the space between two adjacent vertical grid lines.  
* Grid ''row'' is the space between two adjacent horizontal grid lines. 
* Grid ''area'' is a user defined area made up of multiple ''cells''.</pre>
</div>
<div title="grid-template-areas" modifier="rvr" created="202209060938" modified="202209060947" changecount="11">
<pre>The ''grid-template-areas'' is a good way to have control over where content is placed in the CSS Grid system. You could use the ''grid-column'' and ''grid-row'' also, each has their strength.

Here is what we have:
*2 columns - 75% - 25%
*3 rows - middle row 3x larger than top and bottom row
*5 elements to style: header, main, aside, and footer.
&lt;html&gt;&lt;pre&gt;
body {
    display: grid;
    grid-template-columns: 3fr 1fr;
    grid-template-rows: 1fr 3fr 1fr;
    grid-template-areas: 
      &quot;header header&quot;
      &quot;themain aside&quot;
      &quot;footer footer&quot;;
}
header { grid-area: header; } 
main   { grid-area: themain; }
aside  { grid-area: aside; }
footer { grid-area: footer; }&lt;/pre&gt;&lt;/html&gt;
The ''grid-template-areas'' give you a great idea what the page will look like - easy to move things around!</pre>
</div>
<div title="head" modifier="rvr" created="200911102055" modified="201601101323" changecount="10">
<pre>The head element contains information about the page or the metadata. The body of the page would be the [[body]] element. You should always include character encoding, and the first line is needed for browsers to know that it is an HTML 5 doc.
&lt;html&gt;&lt;pre&gt;
&amp;lt;!DOCTYPE html&gt;
&amp;lt;html lang=&quot;en&quot;&gt;
  &amp;lt;head&gt;
      &amp;lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&amp;gt;   // Regular way
      &amp;lt;meta charset=&quot;utf-8&quot;/&amp;gt;                                                 // HTML 5 way
  &amp;lt;/head&gt;
  &amp;lt;body&gt;
   ... 
  &amp;lt;/body&gt;
&amp;lt;/html&gt;
&lt;/pre&gt;&lt;/html&gt;
Next are the links, telling what resources you are using. 
*Stylesheet - use ''&amp;lt;link rel=&quot;stylesheet&quot; href=&quot;style-original.css&quot; /&amp;gt;'' - you don't have to have type=&quot;text/css&quot;
*Icon - displays on the address bar: ''&amp;lt;link rel=&quot;shortcut icon&quot; href=&quot;/favicon.ico&quot;&amp;gt;''
*Readers - use ''&amp;lt;link rel=&quot;alternate&quot; type=&quot;application/atom+xml&quot;  title=&quot;My Weblog feed&quot;  href=&quot;/feed/&quot; /&amp;gt;''
*There are others, but I'm too lazy to list them.</pre>
</div>
<div title="header" modifier="rvr" created="201507131531" modified="202209041833" changecount="26">
<pre>The ''header'' HTML element is used to place navigation links or introductory text at the top of a page.
It is used to specify the &quot;header&quot; part of a webpage. Consider it a container like [[div]].
Here is an example:
&lt;html&gt;&lt;pre&gt;
header {
    background-image: url(images/windsock.jpg);
    height: 100vh;   
}
&lt;/pre&gt;&lt;/html&gt;# Note: we set 100vh=100% of [[viewport]] height, otherwise the background image only displays in the header container.</pre>
</div>
<div title="height" modifier="rvr" created="201004050206" modified="201705181802" changecount="54">
<pre>The ''height'' &amp; ''width'' have the same properties, just substitute @@height &amp;larr;=&amp;rarr; width@@.
&lt;html&gt;&lt;pre&gt;
   height:auto        // auto, px, em, pt, % or inherit
   max-height:120px   // Can be none, px, em, pt, % or inherit
   min-height:10px    // Can be px, em, pt, % or inherit
   height:100%        // Will fit perfectly in the container/wrapper it is in.
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="hover" modifier="rvr" created="202209081050" modified="202209152026" changecount="15">
<pre>Still some quiks with this, don't have it quite figured out yet.
We have a div that is a box with content. We want to hover over this box, and want to see it expand by 50%.
&lt;html&gt;&lt;pre&gt;
div:hover {
  width: 50%;
}
&lt;/pre&gt;&lt;/html&gt;
If we hover over div, it's opacity changes only for the ''image'' tag. 
&lt;html&gt;&lt;pre&gt;
div:hover img {
  opacity: 0.5;
}
&lt;/pre&gt;&lt;/html&gt;If we had an image set with a different opacity, it will override the div level.</pre>
</div>
<div title="image darker" modifier="rvr" created="201601192005" modified="201601211901" changecount="2">
<pre>Sometimes a image is too light and text on top can be hard to read. 
One trick is to use the linear-gradient, but set both values the same and a transparency of 69%.
In the following css, we have an image, and then we have it with the linear-gradient
&lt;html&gt;&lt;pre&gt;
header {  background-image:url(images/windsock.jpg); }
#And the fix:
header {
   background-image: linear-gradient(rgba(0, 0, 0, 0.69),rgba(0, 0, 0, 0.69)), url(images/windsock.jpg);
}
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="images" modifier="rvr" created="201509071418" modified="202209062014" changecount="23">
<pre>Image tags, should include an ''alt'' attribute.
@@&lt;img class=&quot;some-custom-border&quot; src=&quot;https://rtfm.ca/monster&quot; alt=&quot;A monster&quot;&gt;@@
To open in a new tab use the ''target'' attribute: @@ target=&quot;_blank&quot; @@
See also [[Image Sprites]]. An image sprite is a collection of images put into a single image, a whole other ball of wax,
Make an [[image darker]].
Note that background images are slightly different than just images. See [[background]].</pre>
</div>
<div title="inherit" modifier="rvr" created="202209071305" modified="202209071737" changecount="8">
<pre>Inheritance. 
We get css properties from stylesheets:
* user agents -  aka the browser, set basic default styles.
* author - these are stylesheets set by web developers. They can reset user-agent styles above.
** Set using the ''style'' element.
* user - these stylesheets are added typically by browser extensions or by web config.
Every [[property]] is inherited or non-inherited.  
* Inherited properties, if not set by stylesheet, will inherit what it's parent value. Like ''color''.
** Element ''button'' is inherited, and is styled in ''user agent'' stylesheet.
* Non-inherited will not look up the DOM tree. Like element ''border''.
To get a non-inheriting element to inherit from its parent or to override an inheriting element:
&lt;html&gt;&lt;pre&gt;
button {
    color: inherit;
}
&lt;/pre&gt;&lt;/html&gt;
There is an ''all: initial'' property resets all properties to their initial value. There is also a ''inherit'' and ''unset'' property.</pre>
</div>
<div title="inline" modifier="rvr" created="201407220627" modified="202209141016" changecount="36">
<pre>An element is either [[block]] or ''inline''.
Inline elements 
*typically have just content and are not large. 
*examples include images, [[span]], anchor links, emphasis (''&lt;em&gt;''), and bold. 
*do not have a line-break like [[block]] elements do. 
*are only allowed to have margins and padding applied to the left and right (not top or bottom). 
*ignore width or height set by CSS.

@@color(red):Caution:@@ Floated elements become block elements and can suddenly have top and bottom margins or padding.
@@color(red):Caution:@@This also happens when you change an elements inline position.
You can change block &amp;larr;-&amp;rarr; inline using [[display]]. Like this:
&lt;html&gt;&lt;pre&gt;
em {
  display: block;
}
&lt;/pre&gt;&lt;/html&gt;

If an element is inline and we set: @@ height: 36px; @@ - nothing happens, because this is ignored.
If an element is inline and we set: @@ display: block;  height: 36px; @@ - then this element is now a block and height is performed.
</pre>
</div>
<div title="inline-block" modifier="rvr" created="201705181807" modified="202209031432" changecount="31">
<pre>The [[display]] property can be set to ''inline-block'' which is used to get elements next to each other. Kind of like what [[float]] can do. 
This also makes a &quot;width&quot; property now work - it won't work under just [[inline]].
This allows them to keep their [[block]] formatting (to have height &amp; margins &amp; padding) and we can set ''text-align.''
&lt;html&gt;&lt;pre&gt;
    &amp;lt;ul class=&quot;my-inline&quot;&gt;      
      &amp;lt;li&gt;one&amp;lt;/li&gt;
      &amp;lt;li&gt;two&amp;lt;/li&gt;
      &amp;lt;li&gt;three&amp;lt;/li&gt;
    &amp;lt;/ul&gt;
&lt;/pre&gt;&lt;/html&gt;Produces:
*one
*two
*three
Now set my-inline: @@ .my-inline &gt; li { display: inline-block;  } @@ and you'll get: @@ one two three @@
Add @@ text-align: center; @@ to center. See [[text]].

</pre>
</div>
<div title="input" modifier="rvr" created="201005251910" modified="201603291409" changecount="11">
<pre>Checkout [[input types]].
The ''input'' tag is used to gather input from the user, it has many different types to help get info:
*[[radio button]] - a group of circle buttons where a user can select one of many choices.
*[[text field]] - box where user can enter information like a first name.
*[[checkbox]] - a series of check boxes, where the user can select one or more options.
*[[submit]] - this element is key to send this information to the server.
HTML5 introduced many new types as well as updating others, here are more types:
*''color'' - uses a colour picker
*''range'' - uses a slider
*''number'' - uses a spinner
*''date'' - uses a popup
*''datetime'' - 
*''datetime-local'' - 
*''search'' -
*''month'' - 
*''week'' -
*''tel'' -
*''url'' -
*''</pre>
</div>
<div title="internal stylesheet" modifier="rvr" created="200905310017" modified="200905310018" changecount="13">
<pre>An internal stylesheet allows for on the fly and quickies! It should be in the head of the HTML:
&lt;html&gt;&lt;pre&gt;
...
  &amp;lt;style type=&quot;text/css&quot;&amp;gt;
    hr {color:orange}
    p {color: red; font-family:verdana;}
  &amp;lt;/style&amp;gt;
...
&lt;/pre&gt;&lt;/html&gt;See also [[external stylesheet]].</pre>
</div>
<div title="link" modifier="rvr" created="201509121445" modified="201509141617" changecount="25">
<pre>The ''link'' tag defines a link between a [[document]] and an external resource, like a css file or a font.
For example, to use the Google font family &quot;lobster&quot;
&lt;html&gt;&lt;pre&gt;
&amp;lt;link href=&quot;http://fonts.googleapis.com/css?family=Lobster&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;\&amp;gt;
&lt;/pre&gt;&lt;/html&gt;
Or access a stylesheet:
&lt;html&gt;&lt;pre&gt;&amp;lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;theme.css&quot;&gt;&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="list" modifier="rvr" created="201004030025" modified="201509071419" changecount="53">
<pre>This will increase the different styles of the HTML ordered and unordered lists. Here are some:
|!Property|!Example|!Options|
|list-style-type|ul.a {list-style-type: circle;}|none, disk, circle, square.|
|list-style-type|ol.a {list-style-type: circle;}|decimal, circle, square, lower-alpha, upper-greek, ...|
|list-style-image|ul{list-style-image: url('sqpurple.gif');}||

</pre>
</div>
<div title="margin" modifier="rvr" created="201004050118" modified="202209041801" changecount="75">
<pre>The ''margin'' defines space outside of the [[border]] of an element, or it is the white space between elements.  Margins can auto-collapse (ie overlap), whereas [[padding]] does not. Also margins are not in the click region. Margins are also ''transparent''. You can also set each edge independently:
|!Property|!Example|!Other options|
|margin|p{margin: 10px auto;}|Sets top &amp; bottom to be 10 px. Left &amp; right to be 0.|
|margin|p{margin: auto;}|Sets top &amp; bottom &amp; left &amp; right to be 0.|
|margin|p{margin:50px;}| Sets all margins to 50 pixels. Can use px, pt or em.|
|margin|p{margin:50px 20px 40px 20px;}|Sets margins in order: top, right, bottom, and left.|
|margin-xxxx|p{margin-right:0.4in}|Can use: top, right, bottom, and left.|

Note: If an element has a width &lt;100%, the effect of an ''auto'' margin centers things. If element is 50% width, then auto will set L &amp; R to be each 25%, therefore centers.

See also [[negative margins]].
Use margin to separate the block from things outside it
Use [[padding]] to move the contents away from the edges of the block.
Check out some [[margin examples]]. See also [[text]].
If you don't specify a global margin or padding

If we say: @@margin: 5% @@ we are really saying: 
&lt;html&gt;&lt;pre&gt;margin-top: 5%;
margin-right: 5%;
margin-bottom: 5%;
margin-left: 5%;&lt;/pre&gt;&lt;/html&gt;Which can also be specified as: @@ margin: 5% 5% 5% 5%; @@
!!Center
If you have a wrapper element (ie wrapping lets say 3 elements), then setting @@ margin: auto; @@ will center the whole thing!
</pre>
</div>
<div title="margin examples" modifier="rvr" created="201407110733" modified="202209041816" changecount="20">
<pre>Here are [[margin]] examples.
First example - this will place a top &amp; bottom margin of 13px. The auto (therefore browser) will adjust the L &amp; R. In this case the element is set at 30% width so it'll be centered. If we omitted the ''auto'' the browser would left justify the ''p'' elements, width would still be 30%. (Because auto sets L &amp; R to be equal.)
&lt;html&gt;&lt;pre&gt;
p { 
  margin: 13px auto; 
  width: 33%;
}
&lt;/pre&gt;&lt;/html&gt;
This will set the h1 element to first have a 42px padding, surrounded by a margin that varies depending upon side. &lt;html&gt;&lt;pre&gt;
h1 {
    font-size: 1.15em;
    background-color: #666;
    padding: 42px;
    // The below could also be: &quot;margin: 13px 27px 33px 42px;&quot;
    margin-top: 13px;
    margin-right: 27px;
    margin-bottom: 33px;
    margin-left: 42px;
}
&lt;/pre&gt;&lt;/html&gt;These can be set individually, as margin-top / right / bottom / left. See [[Box Model]] and [[box example]].
The above could be: padding-top, padding-right, padding-bottom, and padding-left
The above could be shortened by just using numbers.
Guideline: ''margin-top, margin-right, margin-bottom, and margin-left''
CSS code: ''margin: 13px 27px 33px 42px;''</pre>
</div>
<div title="media queries" modifier="rvr" created="201601251354" modified="202209071838" changecount="9">
<pre>To determine the screen size so that we can do [[responsive web design]], we'll do a ''media query''. The browser will report this.
|!Device|!Screen Width|
|Mobile|0-480|
|Tablet|480-768|
|Large Tablet|768-1024|
|Computer|768-1200|
Create a file called ''queries.css''. We'll define different styles based on the device.
First we need to add a couple of lines to the ''index.html'' file:
&lt;html&gt;&lt;pre&gt;
&amp;lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;resources/css/queries.css&quot;&gt;
&amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
&lt;/pre&gt;&lt;/html&gt;
Here is a sample ''queries.css''.
&lt;html&gt;&lt;pre&gt;
@media (min-width: 1001px) and (max-width: 1280px){ ... }      /* Laptops */
@media (min-width: 768px) and (max-width: 1000px)) { ... }     /* Tablets and iPads */
@media (min-width: 481px) and (max-width: 767px) { ...  }      /* Small tablets:  */
@media (max-width: 480px){  ... }                              /* Small phones */
&lt;/pre&gt;&lt;/html&gt;You may use or just one, depends on your needs. Anything not covered, regular css runs (ie not in these squiggly brackets and the browser will zoom in/out as required.</pre>
</div>
<div title="meta tags" modifier="rvr" created="201101060610" modified="202209071808" changecount="18">
<pre>Meta tags are used to describe your web page and provide meta information. They always go in the head. Metadata is used by browsers to determine how to display content or reload page. Search engines will use it in the hunt for key words.
|!Tag|!Description|
|&lt;meta name=&quot;description&quot; content=&quot;widget sale&quot;/&gt;|For search engines - description.|
|&lt;meta name=&quot;keywords&quot; content=&quot;widgets, grommets&quot;/&gt;|For search engine consumption.|
|&lt;meta http-equiv=&quot;refresh&quot; content=&quot;xxx&quot;/&gt;|refresh web page in xxx seconds.|
|&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2;url=http://rtfm.ca&quot;/&gt;|Redirect to new page in 2 seconds.|
|&amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;|Designers use to control [[viewport]].|
</pre>
</div>
<div title="more styling forms" modifier="rvr" created="201703160620" modified="201703160714" changecount="21">
<pre>This has more styling of [[Bootstrap forms]].
Some more custom stuff: http://www.quackit.com/bootstrap/bootstrap_4/tutorial/bootstrap_custom_forms.cfm

!Form Control Size 
We use class ''form-control'' for the size of the input boxes.
v3 we add ''input-lg'' and ''input-sm''
v4 we add: ''form-control-lg'' and ''form-control-sm''.
&gt;&lt;input type=&quot;text&quot; class=&quot;form-control form-control-sm&quot; placeholder=&quot;Small&quot;&gt;
!Column Size
Using the grid system we can limit the column size:
&lt;html&gt;&lt;pre&gt;
&amp;lt;div class=&quot;col-xs-3&quot;&gt;
  &amp;lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;first_name&quot; placeholder=&quot;First Name&quot;&gt;
&amp;lt;/div&gt;
...
&amp;lt;div class=&quot;col-xs-5&quot;&gt;
  &amp;lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;last_name&quot; placeholder=&quot;Last Name&quot;&gt;
&amp;lt;/div&gt;
&lt;/pre&gt;&lt;/html&gt;
!Help Text
Use ''form-text'' to do this.
Use ''aria-describedby'' to screen readers can id it.
Use ''text-muted'' to give the text a muted look.
v3 uses: ''help-block''.
&lt;html&gt;&lt;pre&gt;
&amp;lt;input type=&quot;text&quot; id=&quot;name&quot; class=&quot;form-control&quot; aria-describedby=&quot;helpName&quot;&gt;
&amp;lt;span id=&quot;helpName&quot; class=&quot;form-text text-muted&quot;&gt;Give a ficticious name.&amp;lt;/span&gt;
&lt;/pre&gt;&lt;/html&gt;
!Validation
There are 3 validation states: ''has-success'', ''has-warning'', and ''has-danger''. 
These should be applied to the parent element:, like:
&gt;&lt;div class=&quot;form-group has-success&quot;&gt;...
To get fancy icons, add a ''form-control-success'', ''form-control-warning'', or ''form-control-danger'' class to the .''form-control'' input field.
&gt;&lt;input type=&quot;text&quot; id=&quot;name&quot; class=&quot;form-control form-control-success&quot;  aria-describedby=&quot;helpName&quot;&gt;
&gt;&lt;div class=&quot;form-control-feedback&quot;&gt;Your name is good.&lt;/div&gt;
!Static
Use ''form-control-static'' on a &lt;p&gt; element to present plain text next to a label 
&gt;&lt;label class=&quot;col-xs-3 col-form-label&quot;&gt;Username&lt;/label&gt;
&gt;&lt;p class=&quot;form-control-static&quot;&gt;~JamesBond&lt;/p&gt;


</pre>
</div>
<div title="nav dropdown example" modifier="rvr" created="201703201728" modified="201703201758" changecount="43">
<pre>Using [[Nav bars]] and [[Bootstrap dropdown]] 
Note: change ''nav-tabs'' to ''nav-pills'' to go from tabs to &quot;pills&quot;.
&lt;html&gt;&lt;pre&gt;
&amp;lt;div class=&quot;container-fluid&quot;&gt;
  &amp;lt;ul class=&quot;nav nav-tabs&quot;&gt;
    &amp;lt;li class=&quot;nav-item&quot;&gt;
      &amp;lt;a class=&quot;nav-link active&quot; href=&quot;#&quot;&gt;Aardvark&amp;lt;/a&gt;
    &amp;lt;/li&gt;
    &amp;lt;li class=&quot;nav-item&quot;&gt;
      &amp;lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;Baboon&amp;lt;/a&gt;
    &amp;lt;/li&gt;
    &amp;lt;li class=&quot;nav-item&quot;&gt;
      &amp;lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;Chicken&amp;lt;/a&gt;
    &amp;lt;/li&gt;
    &amp;lt;li class=&quot;nav-item dropdown&quot;&gt;
      &amp;lt;a class=&quot;nav-link dropdown-toggle&quot; data-toggle=&quot;dropdown&quot; href=&quot;#&quot;&gt;Dog&amp;lt;/a&gt;
      &amp;lt;div class=&quot;dropdown-menu&quot; &gt;
        &amp;lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;Afghan&amp;lt;/a&gt;
        &amp;lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;Bulldog&amp;lt;/a&gt;
        &amp;lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;Corso&amp;lt;/a&gt;
        &amp;lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;Dalmation&amp;lt;/a&gt;
      &amp;lt;/div&gt;
    &amp;lt;/li&gt;
  &amp;lt;/ul&gt;
&amp;lt;/div&gt;
&lt;/pre&gt;&lt;/html&gt;
See: http://rtfm.ca/bootstrap/nav.html</pre>
</div>
<div title="nav tab dropdown example" modifier="rvr" created="201703201830" modified="201703201906" changecount="43">
<pre>To have a nav bar with tabbed panes and content,
*Need @@data-toggle=&quot;tab&quot;@@
*Have a separate ''div'' with the panel content, use: @@class=&quot;tab-content&quot;@@
**Nest in this another ''div'' with: @@class=&quot;tab-pane&quot;@@ as well as ''id'' to use.
**In this content ''div'' have one ''in'' class for initial and ''fade'' in all others.
&lt;html&gt;&lt;pre&gt;
&amp;lt;div class=&quot;container-fluid&quot;&gt;
  &amp;lt;ul id=&quot;planet-nav&quot; class=&quot;nav nav-tabs&quot;&gt;
  &amp;lt;li class=&quot;nav-item&quot;&gt;
    &amp;lt;a class=&quot;nav-link active&quot; href=&quot;#earth&quot; id=&quot;earth-tab&quot; data-toggle=&quot;tab&quot;&gt;Earth&amp;lt;/a&gt;
  &amp;lt;/li&gt;
  &amp;lt;li class=&quot;nav-item&quot;&gt;
    &amp;lt;a class=&quot;nav-link&quot; href=&quot;#mercury&quot; id=&quot;mercury-tab&quot; data-toggle=&quot;tab&quot; &gt;Mercury&amp;lt;/a&gt;
  &amp;lt;/li&gt;
  &amp;lt;!-- Dropdown --&gt;
  &amp;lt;li class=&quot;nav-item dropdown&quot;&gt;
  &amp;lt;a class=&quot;nav-link dropdown-toggle&quot; data-toggle=&quot;dropdown&quot; href=&quot;#&quot; &gt;Venus&amp;lt;/a&gt;
  &amp;lt;div class=&quot;dropdown-menu&quot;&gt;
    &amp;lt;a class=&quot;dropdown-item&quot; href=&quot;#dropdown-planet&quot;  id=&quot;dropdown-planet-tab&quot; data-toggle=&quot;tab&quot;&gt;planet&amp;lt;/a&gt;
    &amp;lt;a class=&quot;dropdown-item&quot; href=&quot;#dropdown-godess&quot;  id=&quot;dropdown-godess-tab&quot; data-toggle=&quot;tab&quot;&gt;godess&amp;lt;/a&gt;
    &amp;lt;a class=&quot;dropdown-item&quot; href=&quot;#dropdown-flytrap&quot; id=&quot;dropdown-flytrap-tab&quot; data-toggle=&quot;tab&quot;&gt;flytrap&amp;lt;/a&gt;
  &amp;lt;/div&gt;
  &amp;lt;/li&gt;
  &amp;lt;/ul&gt;

  &amp;lt;!-- Content Panel --&gt;
  &amp;lt;div id=&quot;planet-nav-content&quot; class=&quot;tab-content&quot;&gt;
    &amp;lt;div class=&quot;tab-pane fade in active&quot; id=&quot;earth&quot;&gt;
      &amp;lt;p&gt;Earth, it's probably where you are now. Tab to go to other places.&amp;lt;/p&gt;
    &amp;lt;/div&gt;
    &amp;lt;div class=&quot;tab-pane fade&quot; id=&quot;mercury&quot;&gt;
      &amp;lt;p&gt;Mercury is hot hot hot. Don't stay here long.&amp;lt;/p&gt;
      &amp;lt;p&gt;Mercury is the smallest and innermost planet in the Solar System. Its orbital period around the Sun of 88 days is the shortest of all the planets in the Solar System. It is named after the Roman deity Mercury, the messenger to the gods.&amp;lt;/p&gt;
    &amp;lt;/div&gt;
    &amp;lt;div class=&quot;tab-pane fade&quot; id=&quot;dropdown-planet&quot;&gt;
      &amp;lt;p&gt;Venus is the second planet from the Sun, orbiting it every 224.7 Earth days.&amp;lt;/p&gt;
      &amp;lt;p&gt;Venus is one of the four terrestrial planets in the Solar System, meaning that it is a rocky body like Earth.&amp;lt;/p&gt;
    &amp;lt;/div&gt;
    &amp;lt;div class=&quot;tab-pane fade&quot; id=&quot;dropdown-godess&quot;&gt;
      &amp;lt;p&gt;Venus is the Roman goddess whose functions encompassed love, beauty, desire, sex, fertility, prosperity and victory.  &amp;lt;/p&gt;
    &amp;lt;/div&gt;
    &amp;lt;div class=&quot;tab-pane fade&quot; id=&quot;dropdown-flytrap&quot; &quot;&gt;
      &amp;lt;p&gt;The Venus flytrap (also referred to as Venus's flytrap or Venus' flytrap), Dionaea muscipula, is a carnivorous plant native to subtropical wetlands on the East Coast of the United States in North Carolina and South Carolina.[3] It catches its preychiefly insects and arachnidswith a trapping structure formed by the terminal portion of each of the plant's leaves, which is triggered by tiny hairs on their inner surfaces. &amp;lt;/p&gt;
    &amp;lt;/div&gt;
  &amp;lt;/div&gt;
&amp;lt;/div&gt;

&lt;/pre&gt;&lt;/html&gt;
See it live: http://rtfm.ca/bootstrap/navtab.html</pre>
</div>
<div title="negative margins" modifier="rvr" created="201705181757" changecount="30">
<pre>You can specify negative margins to move content to overlap other content.
For Example, you have an image and H3, you can move the H3 over top the picture.
&lt;html&gt;&lt;pre&gt;
.student h3 {
  color: #fff;
  margin: -40px 0 1em;
}
&lt;/pre&gt;&lt;/html&gt;
And the HTML:
&lt;html&gt;&lt;pre&gt;
&amp;lt;div class=&quot;student&quot;&gt;
    &amp;lt;img src=&quot;what.me.worry.png&quot;&gt;
    &amp;lt;h3&gt;Alfred E. Neuman&amp;lt;/h3&gt;
...
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="nesting" modifier="rvr" created="201507131756" modified="201507131813" changecount="21">
<pre>Here is nesting: First unnested
&lt;html&gt;&lt;pre&gt;
.center {   text-align: center;  }
.center h1 {   margin-bottom: 10px; }
&lt;/pre&gt;&lt;/html&gt;
Nested:&lt;html&gt;&lt;pre&gt;
.center {
  text-align: center;
  h1 {   margin-bottom: 10px;   }
}
&lt;/pre&gt;&lt;/html&gt;

Unnested:&lt;html&gt;&lt;pre&gt;
#logo {
  float: left; 
  text-transform: uppercase;
  font-weight: bold;
}
#logo:hover {   color: #fff; }
&lt;/pre&gt;&lt;/html&gt;

Nested:&lt;html&gt;&lt;pre&gt;
#logo {
  float: left;
  text-transform: uppercase;
  font-weight: bold;
  &amp;:hover {  color: #fff;  }
}&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="overflow" modifier="rvr" created="201509122035" modified="201705181811" changecount="24">
<pre>The CSS ''overflow'' property handles how text in a [[block]] is handled, ONLY when it spills out over the edge.
Typically a [[div]] element will grow to accommodate, but if you have a height or width set, then ''overflow'' happens.
So you have wrapper (ie a [[div]]) and inside this you have more content that goes outside the boundaries, here are your options:
*''overflow:visible'' - you see the content, appears where it can outside the block. Shows everything.
*''overflow:hidden'' - you don't see it - it is cut off at the boundaries.
*''overflow:auto'' - scroll-bars magically appear only where they are needed.
*''overflow:scroll'' - add both x-y scroll-bars appear.</pre>
</div>
<div title="padding" modifier="rvr" created="201004050149" modified="201509121537" changecount="59">
<pre>The ''padding'' is between the [[border]] and your content! It will pick up background color, as well it is included in the click region. Like usual, Format: @@ padding; top right bottom  left@@
&lt;html&gt;&lt;pre&gt;
   padding:25px;          // Can use % or px or em or pt.
   padding-top:25px;      // Can use top, right, bottom, and left
   padding:25px 50px      // Sets top &amp; bottom at 25 and L and R at 50px.
&lt;/pre&gt;&lt;/html&gt;Use [[margin]] to separate the block from things outside it
Use padding to move the contents away from the edges of the block.
You can also specify directly &amp; verbosly:
&lt;html&gt;&lt;pre&gt;
    padding-top: 30px;
    padding-right: 25px;
    padding-bottom: 25px;
    padding-left: 40px;
&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="picture" modifier="rvr" created="202208291712" modified="202208291713" changecount="2">
<pre>This is a new tag.</pre>
</div>
<div title="positioning" modifier="rvr" created="201004050219" modified="202209041851" changecount="70">
<pre>''Positioning'' is how elements are displayed on the screen. You can let the browser choose where or you can specify. This should be used sparingly.
Other elements are not affected by this, so there can be covering up or hiding behind going on. Cue [[z-index]].
You can overlap elements.There are four positioning methods:
*''static'' - traditional HTML by default, where it is positioned normally. Scrolls with content.
*[[fixed]] - means positioned relative to the browser, it will not move when the window is scrolled.
*[[relative]] - relative to its normal position. Other content will not fill in the gaps.
*[[absolute]] - positioned relative to the first parent element that has a position other than static (can overlap others). 
*[[overflow]] - if overflowed text is displayed or not
*''sticky'' - combo of (starts like) fixed and )becomes) relative - good for nav bars 
*''inherit'' - not used
&lt;html&gt;&lt;pre&gt;
   p.fixed { position:fixed; top:30px; right:5px; }        // Fixed position.
   p.relative { position:relative; left:-29px; }           // Relative position
   p.absolute { position:absolute; left:22px; top:33px; }  // Absolute position
&lt;/pre&gt;&lt;/html&gt; 
There are some other interesting positioning properties, like clip, cursor, and [[z-index]] not covered here.</pre>
</div>
<div title="preprocessor" modifier="rvr" created="202209100911" modified="202209100925" changecount="11">
<pre>A ''preprocessor'' is different from a [[framework]].
Preprocessors add language functionality. They will have their own unique language and this will run through a ''preprocessor'' and pump out CSS code. Most preprocessors will have some great features that are not available in purse CSS.
Popular ones include:
*[[SASS]] - Ruby based. Provides its own syntax. Most popular.
**variable, mixins, @extends, nesting, looping
*''less'' - JS based, similar to sass. simple to learn
*''Stylus'' - similar to above.
*''~PostCSS'' - JS, very customizable. Plugin collection.
This will make CSS easier to write and produce fewer bugs.</pre>
</div>
<div title="property" modifier="rvr" created="201407110715" modified="202209151452" changecount="15">
<pre>There are many properties that can be used in CSS. To see exactly what a property is see: [[CSS Rules]]. Here are the properties I will cover:
*[[colors]]
*[[display]]
*[[units]]
*[[font]]
*[[text]]
*[[height]] - width
*[[border-radius]]
* [[background-size]]
Probably others too.</pre>
</div>
<div title="pseudo-class" modifier="rvr" created="201601221710" modified="202209021826" changecount="23">
<pre>A ''pseudo-class'' is  used to select parts of a HTML document, they can be anywhere in the [[selector]] chain. They can be referred to as ''selectors''. It is a selector that assists in the selection of something that cannot be expressed by a simple selector. The format is simple - use a colon &quot;:&quot; plus name of class. like: @@'':'' link@@. Here are some examples:
*''p:first-of-type'' - the first paragraphs (of siblings) will be styled
** example: ''p:first-of-type { color: purple; };'' - will have first paragraph purple.
** many types - first-child, nth-child, ...
*''a:link'' as in ''link'' - if the user clicks a link - it is no longer an &quot;unvisited&quot; link:
**If visited and we have ''a:link { color: red ; }'' - only unvisited links will be red.
*''a:visited'' as in ''a:visited'' - styles what the link should look like if a users has already visited the linked page. Opposite of above!
*''input:focus'' input element that has focus
** example: input:focus { outline: 3px solid blue; }
** example: input:invalid { outline: 3px solid red; }
** Above two may fight over what happens first as both can be true at same time. Use: '' input:invalid:not(:focus) { outline: 3px solid red; }''
** Classes are chainable - above reads: style input field red if invalid and not in focus.
*'':hover'' as in ''a:hover'' - if the user hovers over a link.

It is not part of the HTML document tree nor its elements nor attributes or contents, but on a &quot;pseduo&quot; conditions .
See [[pseudo-elements]] - which allows us to create items that do not exist in the HTML document tree.
An example of using this:
*Nav links - change cover on hover.
*Logo element - become opage on hover.
&lt;html&gt;&lt;pre&gt;
.header-nav a:hover,
.header-nav a:active{
  color: #867530;
}
.header-logo:hover,
.header-logo:active {
  opacity: 0.5;
}
&lt;/pre&gt;&lt;/html&gt;''Note:'' - mobile useres won't see '':hover'' so we need '':active'' AND hover has to be before active.</pre>
</div>
<div title="pseudo-elements" modifier="rvr" created="201601221658" modified="202209021832" changecount="8">
<pre>The ''pseudo-element''  are used to address sub-parts of elements. They will use double-colons (&quot;&quot;::&quot;&quot;) where as [[pseudo-class]] uses only one colon.
They can be referred to as ''selectors'', and are considered [[inline]], are empty and take up no space.
They allow you to set style on a part of an element's content beyond what is specified in the document tree. In other words they allow logical elements to be defined which are not actually in the document element tree. 
They are perfect for adding little details to elements without complicating HTML tags.
See [[after and before]].
*''h1::first-letter''  - modify first letter of an h1 tag.
** example: ''h1::first-letter { font-size: 3em; }'' - first letter in 3x bigger
*''blockquote::before'' - to modify/add content before the blockquote
*[[after and before]] as in ''h2::after ''
*[[first-child and last-child]]  as in ''.some-class:first-child ''

The ''pseudo-element'' is an element that doesn't exist, but can add content to the document. 
See also [[pseudo-class]], which helps in selecting something not easily expressed by a simple selector.</pre>
</div>
<div title="radio button" modifier="rvr" created="200911090625" modified="201703160704" changecount="15">
<pre>This is used when you want the user to select one from a few options. The code for a radio button, for some reason we should wrap them in ''label'' tabs.
&lt;html&gt;&lt;pre&gt;
	&amp;lt;label&amp;gt;&amp;lt;input type=&quot;radio&quot; name=&quot;active&quot; value=&quot;yes&quot; checked=&quot;checked&quot;&amp;gt; Yes&amp;lt;/label&amp;gt;
	&amp;lt;label&amp;gt;&amp;lt;input type=&quot;radio&quot; name=&quot;active&quot; value=&quot;no&quot; &amp;gt; No&amp;lt;/label&amp;gt;
&lt;/pre&gt;&lt;/html&gt;
Which will look like:&lt;html&gt;&lt;pre&gt;
	Yes: &lt;input type=&quot;radio&quot; name=&quot;active&quot; value=&quot;yes&quot; checked=&quot;checked&quot;&gt;
	No: &lt;input type=&quot;radio&quot; name=&quot;active&quot; value=&quot;no&quot; &gt;
&lt;/pre&gt;&lt;/html&gt;

Note ''name'' groups the radio buttons. To have the user select one or more options use the [[checkbox]].</pre>
</div>
<div title="relative" modifier="rvr" created="201601181449" modified="201705180211" changecount="16">
<pre>Relative [[positioning]] is specified as: @@ position: relative;@@
*This is like static in that it respects the elements starting position in the flow of content.
*Allows left/right/up/down to be applied that move it away from the boundary of other elements.
*Allows [[absolute]]ly positioned items to be contained within it as though it were a separate canvas.  
*Allows you to change the [[z-index]] of the element.
*Scrolls with content.
</pre>
</div>
<div title="responsive web design" modifier="rvr" created="201601200752" modified="202209071840" changecount="26">
<pre>Responsive web design means that as the screen size changes, desktop size -&gt; laptop size -&gt; tablet size -&lt; mobile size, that the design does not become ugly but responds professionally to the change. Current philosophy is to design for mobile first and then scale up to larger screens.
!!Responsive design Steps
There are a few steps to this.
* Flexible grid-based layout - columns layout. Like [[CSS Grids]].
* Let browser know we will control viewport we'll use [[meta tags]]
* To determine the screen size we'll use [[media queries]] 
* Images that resize - based on screen resolution new [[picture]] tag

To let the browser know that we want to use responsive design and honor how we tell it to scale using the [[viewport]], here is the [[meta tags]] we will need:
&lt;html&gt;&lt;pre&gt;
 &amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
&lt;/pre&gt;&lt;/html&gt;
Now, we'll need [[media queries]] to determine screen sizes. For example, if we are under 888px, then we take over the viewport and run lucky css code and then again under 666 we can have even other devlishly css code to run. Over 888 and the default viewport will run (pure zooming in and out).
&lt;html&gt;&lt;pre&gt;
@media (max-width: 888px) {
    ... css code for lucky smaller screens
}
@media (max-width: 666) {
    ... css code for devilishly smaller screens
}
&lt;/pre&gt;&lt;/html&gt;
Javascript is not responsive design, it's css + html only. We have to set meta tage and control viewport to do that. Default browser viewport behaviour is simple zoom in and out.
</pre>
</div>
<div title="rgba" modifier="rvr" created="201601141048" modified="201705102152" changecount="4">
<pre>CSS uses the typical [[colors]] format, and to add transparency, we use ''rgba''.
Essentially, it is: ''rgba(r,g,b,t)'' where r,g, and b are 0-255.
*r - red 
*g - green
*b - blue
*t - transparency-opaque : 0.0-1.0
An example would be: @@ color: rgba(55, 105, 24, 0.69);@@</pre>
</div>
<div title="root element" modifier="rvr" created="200911102043" modified="200911102046" changecount="5">
<pre>The root element is the ancestor of all [[element]]s and is known as ''&amp;lt;html&amp;gt;'', and with HTML 5 it shall be:
&lt;html&gt;&lt;pre&gt;&amp;lt;html lang=&quot;en&quot;&amp;gt;&lt;/pre&gt;&lt;/html&gt;The first child of the root element is the [[head element]].</pre>
</div>
<div title="select" modifier="rvr" created="201005251941" modified="201005251946" changecount="7">
<pre>The ''select'' tag is used to create a list of choices, from which the user can select one. It looks like:
&lt;html&gt;&lt;pre&gt;
   &amp;lt;select name=&quot;country&quot;&amp;gt;
      &amp;lt;option value=&quot;bermuda&quot;&amp;gt;Bermuda&amp;lt;/option&amp;gt
      &amp;lt;option value=&quot;canada&quot; selected=&quot;selected&quot;&amp;gt;Canada&amp;lt;/option&amp;gt;
      &amp;lt;option value=&quot;denmark&quot;&amp;gt;Denmark&amp;lt;/option&amp;gt;
      &amp;lt;option value=&quot;england&quot;&amp;gt;England&amp;lt;/option&amp;gt;
      &amp;lt;option value=&quot;france&quot;&amp;gt;France&amp;lt;/option&amp;gt;
   &amp;lt;/select&amp;gt;
&lt;/pre&gt;&lt;/html&gt;Using the ''selected'' attribute you can preselect an item.
Which looks like:&lt;html&gt;&lt;pre&gt;&lt;select name=&quot;country&quot;&gt;
	&lt;option value=&quot;bermuda&quot;&gt;Bermuda&lt;/option&gt;
	&lt;option value=&quot;canada&quot; selected=&quot;selected&quot;&gt;Canada&lt;/option&gt;
	&lt;option value=&quot;denmark&quot;&gt;Denmark&lt;/option&gt;
	&lt;option value=&quot;england&quot;&gt;England&lt;/option&gt;
	&lt;option value=&quot;france&quot;&gt;France&lt;/option&gt;
&lt;/select&gt;
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="selector" modifier="rvr" created="200905302343" modified="202209151455" changecount="88">
<pre>The ''selector'' part of [[CSS Rules]] sets which element in our HTML to apply styles to (ie change [[property]]). Think of it as: @@A selector selects which element to style@@. 
In the case of a conflict. the most &quot;specific&quot; selector is used, if the same, it defaults to the last rule in the stylesheet.  See [[Selector Specificity]].
A [[universal selector]], selecting everything would be: @@* { ... } @@
 A selector can target a single element or a whole range of elements. CSS selectors are followed by the curly brackets. 
Here are the three selectors used by CSS:
*[[element type selector]] - this targets by the element type.  (ie ''p''.) It is very broad, the other selectors become more specific.
*[[class selector]] - uses a period and is meant for multiple elements  (ie ''.realfancy'')
*[[ID]] selector - uses a # and is meant for an individual or unique elements  (ie ''#special'')
*[[attribute selector]] - not used often, but used to select an element with some specific attribute or attribute value
*You can [[chain]] ID and class selectors/
*You can also group selectors that have common styles, like: ''h1, h2, h3 { font: Arial; }''
*Advanced selector: [[pseudo-class]]
*[[sibling selector]]
*[[child selector]]
Once we have selected the elements we want to style, we next must set the [[property]] we want to change.
See [[selector examples]].</pre>
</div>
<div title="selector examples" modifier="rvr" created="201601181349" modified="202209141141" changecount="29">
<pre>Here are some examples of selectors:
!Element Type Selectors
&lt;html&gt;&lt;pre&gt;
p { color: red; }
h1 {font-family:verdana;}
ul { font-size: 9px; }
div p { background-color: aqua; }    // Every &quot;p&quot; inside a &quot;div&quot; is styled. &quot;div&quot; not styled.
&lt;/pre&gt;&lt;/html&gt; This last one - the&quot;p&quot; can be a child or a grandchild ... All of'em are selected. To narrow it down see [[child selector]] an example is below too.
!Class Selectors
The class selector selects elements with a specific class. In the first example all elements with the class=&quot;warning&quot; get that styling.
&lt;html&gt;&lt;pre&gt;
.warning {   color: red; }
# In this example, only &quot;p&quot; elements with a class=&quot;warning&quot; get this style.
p.warning {
    text-align: center;
    color: red;
}
&lt;/pre&gt;&lt;/html&gt;
!ID Selectors
Uses the ID attribute of an [[element]] to select a specific element.
&lt;html&gt;&lt;pre&gt;
 #nav {
    text-align: center;
    color: #808080;
}

div&amp;num;tiny p { font-size: smaller; }  // All &quot;p&quot; tags in div with id=&quot;tiny&quot; get smaller
div&amp;num;tiny&gt;p { color: aqua; }         // Only &quot;p&quot; tags that are children of div with id=&quot;tiny&quot; will be aqua.
&lt;/pre&gt;&lt;/html&gt;
!Grouped Selector
You can combine groups with the same styling, like this:
&lt;html&gt;&lt;pre&gt;
h1, h2, h3, p { font-family: monospace; }     // each element has this style
&lt;/pre&gt;&lt;/html&gt;
!Child Selector
See also [[child selector]]. Will only select the children of &quot;div&quot;, not grandchild. ie only one level down.
&lt;html&gt;&lt;pre&gt;
div &gt; p { color: #080808; }
&lt;/pre&gt;&lt;/html&gt;
There are more similar examples, see [[sibling selector]].
!Other Things
You can mix things up a little. If you an image that you want different then all other images on the page, and it is in a class ''navigation'' then you can specifically choose to just change that one. 
Read this as &quot;inside class ''navigation'' style element ''img'' as ...&quot; :
&lt;html&gt;&lt;pre&gt;
.navigation img { 
   height: 123px; 
   border-radius: 50%;
}
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="sibling selector" modifier="rvr" created="201705160158" modified="201705230054" changecount="36">
<pre>A ''sibling selector'' is an advanced [[selector]]. It will only work inside the same parent.
*the adjacent sibling @@+@@: selects a single element only if it is right next to the primary element in the declaration. 
**For example, h2 + p selects a p tag only if it is immediately preceded by an h2 tag.
*the general sibling @@font-size:1.5em;background-color:yellow;~@@ : selects all elements of the type in the declaration if they follow the primary element. 
**For example, h2 ~ p applies to all p tags preceded by an h2 tag.
An example - this will style only the first @@p@@ element after an @@h2@@ element. A second @@p@@ element will not have this styling.
&lt;html&gt;&lt;pre&gt;
h2 + p {
  font-size: 1em;
  margin: 1em auto 0;
  text-align: center;
}
&lt;/pre&gt;&lt;/html&gt;If we replace the @@+@@ with the @@~@@ then the second @@p@@ will get styled.
&lt;html&gt;&lt;pre&gt;
&amp;lt;h2&gt;Some Title&amp;lt;/h2&gt;
&amp;lt;p&gt;This will get styled with the above css.&amp;lt;/p&gt;
&amp;lt;P&gt;This will not get styled, unless the + is changed to a ~.&amp;lt;/p&gt;
&amp;lt;p&gt;And etc&amp;lt;/p&gt;
&lt;/pre&gt;&lt;/html&gt;
Another example - placing vertical bars between nav items (when using ''ul'' to group them. see [[nav dropdown example]]) 
The code: @@li ~ li@@ says, when you see a ''li'', then every ''li'' after add this styling. We'd get 2 vertical bars.
&lt;html&gt;&lt;pre&gt;
.header-nav &gt; li ~ li {
  border-left: 1px solid rgba(0, 0, 0, 0.3);
  padding-left: 1em;
}
&lt;/pre&gt;&lt;/html&gt;HTML code:
&lt;html&gt;&lt;pre&gt;
&amp;lt;ul&gt;
  &amp;lt;li&gt;
    &amp;lt;a href=&quot;#&quot;&gt;Link1&amp;lt;/a&gt;
  &amp;lt;/li&gt;
  &amp;lt;li&gt;
    &amp;lt;a href=&quot;#&quot;&gt;Link2&amp;lt;/a&gt;
  &amp;lt;/li&gt;
  &amp;lt;li&gt;
    &amp;lt;a href=&quot;#&quot;&gt;Link3&amp;lt;/a&gt;
  &amp;lt;/li&gt;
&amp;lt;/ul&gt;
&lt;/pre&gt;&lt;/html&gt;Produces:&lt;html&gt;&lt;pre&gt;Link1 | Link2 | Link3&lt;/pre&gt;&lt;/html&gt;
</pre>
</div>
<div title="span" modifier="rvr" created="201407220630" modified="201705190024" changecount="7">
<pre>The ''span'' element is an [[inline]] element, similar to the [[div]] which is a [[block]] element. 
The ''span'' element can be used inline without changing outer tags. example:
&lt;html&gt;&lt;pre&gt;
  &amp;lt;h1&amp;gt;Some &amp;lt;span style=&quot;color: red&quot;&amp;gt;Fancy&amp;lt;/span&amp;gt; Title&amp;lt;/h1&amp;gt;
&lt;/pre&gt;&lt;/html&gt;&lt;html&gt;&lt;h1&gt;Some &lt;span style=&quot;color: red&quot;&gt;Fancy&lt;/span&gt; Title&lt;/h1&gt;&lt;/html&gt;</pre>
</div>
<div title="special chars" modifier="rvr" created="201009042054" modified="202209141059" changecount="24">
<pre>There are special characters that we use:

|!Special Char|!Meaning|
|# (hash)|This is an [[ID]] selector|
|&amp;gt;|This is a [[child selector]]. Used to select elements with a specific parent.|
|+|This is a [[sibling selector]]. Used to select just one element with a preceding sibling.|
|&amp;#126;|This is a [[sibling selector]]. Used to select all sibling elements.|
|. (period)|This is a [[class selector]]|
|*{ ... }|The whole document selector. aka [[universal selector]].|
</pre>
</div>
<div title="stacking context" modifier="rvr" created="202209051108" modified="202209051116" changecount="12">
<pre>''Stacking context'' is the 3D look at a web page, that is - an imaginary z-axis where elements are on top or under other elements. 
If we incorporate a z-axis and a fixed position, then the block level elements are called stacked.

&lt;html&gt;&lt;pre&gt;
  position: fixed;   // also &quot;sticky&quot;
  z-index:3;
&lt;/pre&gt;&lt;/html&gt;
Stacking is in context (like scope), that is if one section uses stacking, it is separate from a sibling section that also may use stacking. 
Stated another way - the ''z-index'' only applies within a stacking context, not the whole document.</pre>
</div>
<div title="style" modifier="rvr" created="201509071317" modified="201509071335" changecount="18">
<pre>You can change an [[element]]s ''style'' by using the ''style'' [[attribute]].
Changing a paragraph to color blue: 
&lt;html&gt;&lt;pre&gt;&amp;lt;p style=&quot;color: red&quot;&amp;gt;blah blah blah...&amp;lt;/p&amp;gt;&lt;/pre&gt;&lt;/html&gt;
&lt;html&gt;&lt;p style=&quot;color: red&quot;&gt;blah blah blah...&lt;/p&gt;&lt;/html&gt;
See more examples in [[div]].
Of course, this should be done with [[CSS]], like this:
&lt;html&gt;&lt;pre&gt;
&amp;lt;style&amp;gt;h2 {color: red;}&amp;lt;/style&amp;gt;
&amp;lt;p&amp;gt;blah blah blah...&amp;lt;/p&amp;gt;
&lt;/pre&gt;&lt;/html&gt;
Or even better, like this:&lt;html&gt;&lt;pre&gt;
&amp;lt;style&amp;gt;
  .red-text { color: red; }   # This is a class.
  p { font-size: 13; }        # This will only change the paragraph element.
&amp;lt;/style&amp;gt;
&amp;lt;p class=&quot;red-text&quot;&amp;gt;blah blah blah...&amp;lt;/p&amp;gt;
&lt;/pre&gt;&lt;/html&gt;
Note that a [[class]] in [[CSS]] starts with a period.</pre>
</div>
<div title="submit" modifier="rvr" created="201005251930" modified="201703172207" changecount="10">
<pre>The [[input]] tag has a ''type'' [[attribute]] that has a ''submit'' action to send the form back to the server.  It looks like:
&lt;html&gt;&lt;pre&gt;
   &amp;lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&amp;gt;
&lt;/pre&gt;&lt;/html&gt;
You will often see a button tag in this situation which is the preferred method, however, it will ''not'' perform a submit. The button tag is used in conjunction with some javascript to perform a submit. </pre>
</div>
<div title="table" modifier="rvr" created="201004030058" modified="201406261746" changecount="54">
<pre>The table:
&lt;html&gt;&lt;pre&gt;
   table { border: 1px solid black, width:100%; table-layout: fixed;  }
   th { height:50px; background-color:green; }
   td { text-align:right; background-color:green; }
&lt;/pre&gt;&lt;/html&gt;To have more control over the sizing of a table, use: ''table-layout: fixed;''</pre>
</div>
<div title="tags" modifier="rvr" created="200912130225" modified="202209051136" changecount="9">
<pre>HTML tags are mark-up codes used to tell the browser how to mark-up a web page. They are bounded by angle brackets. Typically a beginning and end tag are required for an HTML [[element]].
Think of it like this: An HTML paragraph [[element]] consists of two HTML tags.
&lt;html&gt;&lt;pre&gt; &amp;lt;p&amp;gt; - this is a paragraph start tag, with no attributes.
 &amp;lt;/p&amp;gt; - this is a paragraph end tag.
 &amp;lt;p class=&quot;woot&quot;&amp;gt; - this is a paragraph start tag, with one attribute named class.
&lt;/pre&gt;&lt;/html&gt;
Some typical tags: body, h1, p, div, section, link, title, ...</pre>
</div>
<div title="text" modifier="rvr" created="201004030005" modified="202209151652" changecount="67">
<pre>There are many text properties, here are some:
|!Property|!Example|!Other options|
|color|p { color:blue;}|See [[colors]].|
|text-align|p { text-align:right; }|left, right, center, justify|
|text-decoration|a {text-decoration:none;}|none, overline, underline, line-through, blink|
|text-transform|p.uppercase {text-transform:uppercase;}|uppercase, lowercase, capitalize|
|text-indent|p {text-indent:50px;}|For the first line of a paragraph. length or %|
|text-transform|p{text-transform:capitalize;}|none, capitalize (initial capitals), lowercase, uppercase.|
|text-decoration|p{text-decoration:underline;} |none, blink, underline, overline, line-through.|
|word-spacing|p{word-spacing:42px;}|Space between words, px, pt, cm, em...|
|letter-spacing|p{letter-spacing:-3px;}|Space between words, px, pt, cm, em. Negative means closer together.|
|line-height|p{line-height:18px;}|Sets line height - text is placed in vertical centre^^1^^.|
^^1^^ For a horizontal center of the text use: ''text-align: center;''

See also [[margin]], and while you are at it [[colors]] and [[units]].</pre>
</div>
<div title="text field" modifier="rvr" created="201005251915" modified="201509071430" changecount="8">
<pre>This is used to enter information like first name. This is typically part of a web [[form]].
&lt;html&gt;&lt;pre&gt;
   Firstname: &amp;lt;input type=&quot;text&quot; name=&quot;firstname&quot; &amp;gt; 
   Lastname: &amp;lt;input type=&quot;text&quot; name=&quot;lastname&quot; &amp;gt; 
&lt;/pre&gt;&lt;/html&gt;
The tag will be rendered into a single line box (default=20 chars) where the user can enter information.
</pre>
</div>
<div title="textarea" modifier="rvr" created="201005251946" modified="201005251946" changecount="7">
<pre>The ''textarea'' tag allows a multi-line text area to enter information.
&lt;html&gt;&lt;pre&gt;
   &amp;lt;textarea rows=&quot;4&quot; cols=&quot;20&quot;&amp;gt;
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="toggle" modifier="rvr" created="201703180016" modified="201703180022" changecount="21">
<pre>Toggle - use Bootstrap class ''data-toggle''
Wrap buttons in ''label'' elements.
Can swap ''checkbox'' and ''radio''.
&lt;html&gt;&lt;pre&gt;
&amp;lt;div class=&quot;btn-group&quot; data-toggle=&quot;buttons&quot;&gt;
  &amp;lt;label class=&quot;btn btn-primary active&quot;&gt;
    &amp;lt;input type=&quot;checkbox&quot; checked autocomplete=&quot;off&quot;&gt; Apples
  &amp;lt;/label&gt;
  &amp;lt;label class=&quot;btn btn-primary&quot;&gt;
    &amp;lt;input type=&quot;checkbox&quot; autocomplete=&quot;off&quot;&gt; Boats 
  &amp;lt;/label&gt;
  &amp;lt;label class=&quot;btn btn-primary&quot;&gt;
    &amp;lt;input type=&quot;checkbox&quot; autocomplete=&quot;off&quot;&gt; Mangos
  &amp;lt;/label&gt;
&amp;lt;/div&gt;
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="tooltip" modifier="rvr" created="201703202022" modified="201703202047" changecount="43">
<pre>Bootstrap does not enable tooltip by default. To do so:
&lt;html&gt;&lt;pre&gt;
&amp;lt;script&gt;
$(function () {
  $('[data-toggle=&quot;tooltip&quot;]').tooltip()
})
&amp;lt;/script&gt;
&lt;/pre&gt;&lt;/html&gt;
The Bootstrap class ''popover'' is a fancier ''tooltip'' that has more control. Like it has a title capability, and you can enable hover or click.
The text of the tooltip comes from the title attribute.
Here is an example:
&lt;html&gt;&lt;pre&gt;
&amp;lt;p style=&quot;margin:22px;&quot;&amp;gt;
  Bootstrap 
  &amp;lt;a target=&quot;_blank&quot; href=&quot;http://rtfm.ca/bootstrap/navtab.html&quot; data-toggle=&quot;tooltip&quot; data-placement=&quot;top&quot; title=&quot;RTFM!&quot;&gt;  navs&amp;lt;/a&gt; 
  are cool.
&amp;lt;/p&gt;
&lt;/pre&gt;&lt;/html&gt;
On a button it's defaulted to the top. But it can be on any side by adding: @@data-placement=&quot;right&quot;@@ (left, right, top, bottom):
&lt;html&gt;&lt;pre&gt;
&amp;lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot; data-toggle=&quot;tooltip&quot; title=&quot;and Stars&quot; style=&quot;margin:20px;&quot; data-placement=&quot;right&quot;&gt;
  Sun and Moon
&amp;lt;/button&gt;
&lt;/pre&gt;&lt;/html&gt;See example at (click on ''sun'' http://rtfm.ca/bootstrap/navtab.html)
</pre>
</div>
<div title="transform" modifier="rvr" created="201705180254" modified="202209081149" changecount="33">
<pre>The ''transform'' property can move or change the appearance of an element. It is often used with [[transition]].
Let's center an image. Format: @@ transform: translate(x, y); @@
Header with a logo
&lt;html&gt;&lt;pre&gt;
.header-logo {
  height: 110px;
  width: 110px;
  top: 50%;     
  left: 50%;
  position: absolute;
  transform: translate(-50%, -50%);
}
&lt;/pre&gt;&lt;/html&gt;Here we can get the center of the element - using top/left of 50%. But the image needs to be centered, not the top-left corner of it. So we have to ''transform'' this image, by moving it 50% along the x and y axis to get the image at center.

See also [[transition]].</pre>
</div>
<div title="transition" modifier="rvr" created="201705240027" modified="202209161233" changecount="22">
<pre>CSS ''transitions'' provide a way to smoothly control animation speed when changing CSS properties from one state to another. It is often used with [[transform]].
An example would be to animate an element from partially transparent to opaque.

Format: @@ transition: &lt;property&gt; &lt;duration&gt; &lt;timing-function&gt; &lt;delay&gt;; @@

|!Property|!Values|!Description|
|transition-property|all, inherit, &lt;css property name&gt;|The css property names^^1^^ to transition. All CSS properties? Pick &quot;all&quot;|
|transition-duration|ns (n=# s=s)|Period over which transition occurs.|
|transition-timing-function|ease, linear, stop-end, steps(4, end)|Specifies a function to define how intermediate values for properties are computed.|
|transition-delay|ns (n=# s=s)|Defines how long to wait between the time a property is changed and the transition actually begins.|
^^1^^ One or more properties. An example: ''transition-property: width, box-shadow;'' So both properties transition.
See [[transition example]] and [[transform]]</pre>
</div>
<div title="transition example" modifier="rvr" created="202209081100" modified="202209081151" changecount="8">
<pre>This example, we have a div that is a box, and we want to expand the box from 22% to 50% when we hover over it. We want the ''transition'' to be smooth, so we add 2 [[CSS Rules]] setting 4 ''transition-'' properties. Here is the required CSS:
&lt;html&gt;&lt;pre&gt;div:hover {
    width: 50%;
}

div {
    background-color: orchid;
    width: 22%;
    height: 8em;
    border-radius: 13px;
    width: 50%;
    padding: 123x;
    margin: 4em;
    transition-property: width;    // What property in &quot;hover&quot; to transition!
    transition-duration: 1s;       // How long to do this complex haha task
    transition-timing-function: ease;   // default - could also pick others
    transition-delay: 1s;          // How long to delay the transition
} 
&lt;/pre&gt;&lt;/html&gt;You could also use the shortcut: ''transition width 1s ease 1%''

Now let's add [[transform]] to this example - see [[transition example 2]].</pre>
</div>
<div title="transition example 2" modifier="rvr" created="202209081152" modified="202209081157" changecount="8">
<pre>This expands the [[transition example]], we are adding a [[transform]] to the ''a:hover'' selector.
Note that we need to call transition twice. Once for our width change and once for our ''transform''. Notice we used the shortcut to collapse 4 separate ''transition-'' properties (see [[transition example]]) into one property: ''transition''.
&lt;html&gt;&lt;pre&gt;
div:hover {
    width: 50%;
    transform: rotate(90deg)
  }
div {
    background-color: orchid;
    width: 22%;
    height: 8em;
    border-radius: 13px;
    padding: 13px;
    margin: 4em;
    transition: width 1s, ease 1s, transform 1s ease 0s;
} 
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="tricks" modifier="rvr" created="201705190127" modified="201705190129" changecount="30">
<pre>!!Down pointing triangle.
When you draw a box with a border, the corners are joined by a 45% angle.
To have a downward pointing triangle at the bottom of the element
border-color: #000 red purple blue;
&lt;html&gt;&lt;pre&gt;
.some-div-class:after {
  bottom: 2vh;          # Will be 2vh from bottom of element
  border: 10px solid;   # We want the line 10px thick and solid
  border-color: #fff transparent transparent;     # Top is white.
  content: &quot;&quot;;
  left: 50%;   # To approx center this.
  width: 0;    # We need these to be 0 to work.
  height: 0;  
}
&lt;/pre&gt;&lt;/html&gt;
If we had used: @@ border-color: white red purple blue; @@ we'd have 4 triangles making a box, with white at the top. (Border is drawn top, right, bottom, left)</pre>
</div>
<div title="typography" modifier="rvr" created="201703160457" modified="201703160523" changecount="21">
<pre>Bootstrap typography - some basics.
Bootstrap will style some HTML elemtents, but to add more styling you need to add the appropriate bootstrap class.
For example, you can use an HTML table, but to style it more via bootstrap use: @@&lt;table class=&quot;table&quot;&gt;...@@
HTML text elements have defaults. The default font-family is &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif.
You can use the HTML heading elements, or use them as a class, ie @@&lt;p class=&quot;h1&quot;&gt;Something&lt;/p1&gt;@@
To make then stand out more use display class: @@&lt;h1 class=&quot;display-1&quot;&gt;Display 1&lt;/h1&gt;@@ - can be ''display-1'' to ''display-4''

|!Class|!To|!Example|!Description|
|blockquote||&lt;blockquote class=&quot;blockquote&quot;&gt;&lt;footer&gt;&lt;/cite&gt;...&lt;/cite&gt;&lt;/footer&gt;&lt;/blockquote&gt;|Add to HTML blockquote.|
|blockquote-reverse||&lt;blockquote class=&quot;blockquote blockquote-reverse&quot;&gt;...|To right align.|
|h1|to h6|&lt;p class=&quot;h1&quot;&gt;Something&lt;/p&gt;|Same as HTML element h1.|
|display-1|display-4|&lt;h1 class=&quot;display-1&quot;&gt;Display 1&lt;/h1&gt;|To make heading even bigger.|
|lead||&lt;p class=&quot;lead&quot;&gt;Blah blah...&lt;/p&gt;|Leading sentance to stand out.|
|mark||&lt;p&gt;Sample &lt;mark&gt;marked text&lt;/mark&gt;.&lt;/p&gt;|To mark important text.|

!!Lists
There are a few new things to do with lists:
*''list-unstyled'' - no styling (ie dots) Example: @@&lt;ul class=&quot;list-unstyled&quot;&gt;@@
*''list-inline'' &amp; ''list-inline-item'' - list in a line (row) Example: @@&lt;ul class=&quot;list-inline&quot;&gt;   &lt;li class=&quot;list-inline-item&quot;&gt;Apples&lt;/li&gt;...@@
*''dl-horizontal'', also ''&lt;dl&gt;'' in HTML.

</pre>
</div>
<div title="units" modifier="rvr" created="201407110700" modified="202209041833" changecount="21">
<pre>There are certain units that CSS understands. They are absolute &amp; relative measurements:
*''px'' - pixel, absolute size. 1/92&quot; = 1 px - it is an absolute, not relative.
** does not scale to others around it if them change
*[[em]] -  relative size based on parent/child current font size, so twice would be: 2em. It has a problem, it is cumulative when size is changed.
**''rem'' - root ''em''. This sets it document wide. It is relative to the root element font size (html tag).  It is a percentage of an absolute font size.
*''pt'' - points,  absolute size. Used in traditional media, 1/72&quot; = 1 pt.
*''%'' - percent - much like em, i.e. 37%
*''ch'' - width of zero &quot;0&quot; character. Good for monospaced character, 
** ''60ch'' - good control for monospaced chars, but proportional fonts are unpredictable.
*[[vw]] and ''vh'' - [[viewport]] width and viewport height, using a % of the screen width/height.

These are used in many places:
* Width / height: Use cases: % - relative to parent, vw/vh - relative to viewport ch - paragraph rem/px - close to absolute 
* Margin / padding: Use case: rem - closer to absolute, will scale  em - scale to font size  px - small values, last resort
* Borders / shadows: Use cases: px - small values   rem/em - ok, scaling doesn't look great
* Font size: Use cases: rem - usually best  em - scale to parent size and px - as last resort

See also [[colors]].</pre>
</div>
<div title="universal selector" modifier="rvr" created="201601251014" modified="201601251017" changecount="3">
<pre>The universal selector selects all elements.
The following means that every element will default to the three listed rules.
&lt;html&gt;&lt;pre&gt;
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}
&lt;/pre&gt;&lt;/html&gt;
To narrow the range of this action, you can! This turns all focus highlighting off (typically in an input form):
&lt;html&gt;&lt;pre&gt;
*:focus { outline: none;}
&lt;/pre&gt;&lt;/html&gt;</pre>
</div>
<div title="user agent stylesheet" modifier="rvr" created="201407110822" modified="201407110823" changecount="9">
<pre>When using developer tools in Chrome (or firefox) you will see: ''user agent stylesheet'' with stuff you did not code. This is what the browser will set as a base styling. Anything that you do will override this! That is why you will see it at the bottom of the &quot;styles&quot; tab in the developer window. If you set any of its values, it will appear before &quot;user agent stylesheet&quot; and will cross out entries that are overridden.
That is why you will see &quot;reset&quot; stylesheets - to start with a blank slate, especially for cross browser support.</pre>
</div>
<div title="variables" modifier="rvr" created="202209081303" modified="202209081355" changecount="8">
<pre>Variables are used to help reduce redundancy. aka ''Custom Properties''.

If we have multiple instances of same color, like: ''color #123456'' do:&lt;html&gt;&lt;pre&gt;
:root {  --main-color: #448877; }
h1 { color: var(--main-color); }
em { background-color: var(--main-color); }   ...etc
&lt;/pre&gt;&lt;/html&gt;

Another example using numbers and maths:
&lt;html&gt;&lt;pre&gt;
:root {  
  --some-size: 666px;
  --some-pcent: 13%;
  --a-bit-more: 3px;
}
div { 
  gap: var(--a-bit-more);
  height: calc(var(--some-pcent)*2 );
  width: calc(var(--some-size) + var(--a-bit-more));
}
&lt;/pre&gt;&lt;/html&gt;You can even do things like ''calc(25px + 20vw);'' 

</pre>
</div>
<div title="vertical-align" modifier="rvr" created="201705151836" modified="201705151837" changecount="30">
<pre>The vertical-align property sets the vertical alignment of an element. It has an effect only on objects that are [[inline]], or ''inline block'' (see [[display]]. It centers them only in relation to the line of text that they appear on. 
There are many values you can use:
*''baseline'' - This is default value.  Align the baseline of the element with the baseline of the parent element. 
*''middle'' - The element is placed in the middle of the parent element. Also ''top'' and ''bottom''.
*''text-top'' &amp; ''bottom-text'' - The top/bottom of the element is aligned with the top/bottom of the parent element's font.
*''length'' - Raises or lower an element by the specified length. Negative values are allowed.
*''sub'' &amp; ''super'' - Aligns the element as if it was subscript/superscript.
Usage: @@ vertical-align: middle; @@</pre>
</div>
<div title="viewport" modifier="rvr" created="202209041834" changecount="1">
<pre>The viewport is the user's visible area of a web page. 
If the webpage is bigger, then you will scroll down or to the right. The viewport is your view of the document.</pre>
</div>
<div title="vw" modifier="rvr" created="201705102311" changecount="6">
<pre>Viewport height (''vh'') and viewport width (''vw'') are  mobile friendly units. These are useful for responsive layouts.
These units wlll size elements based on the ''actual'' size of the browser window, using a % of that &quot;viewport&quot; - ie 0%-100%
''42vh'' would be 42% of the height.
''100vw'' would be 100% of the width.</pre>
</div>
<div title="z-index" modifier="rvr" created="201705180154" modified="202209051037" changecount="32">
<pre>The ''z-index'' specifies an elements position in the ''z'' direction. Left/right/up/down are the ''x and y'' directions.
Zero is the bottom position. See [[positioning]].
See [[stacking context]].</pre>
</div>
</div>
<!--POST-STOREAREA-->
<!--POST-BODY-START-->
<!--POST-BODY-END-->
<script id="jsArea" type="text/javascript">
//<![CDATA[
//
// Please note:
//
// * This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments
//   in the project Subversion repository at http://svn.tiddlywiki.org/Trunk/core/
//
// * You should never need to modify this source code directly. TiddlyWiki is carefully designed to allow deep customisation
//   without changing the core code. Please consult the development group at http://groups.google.com/group/TiddlyWikiDev
//

//--
//-- Configuration repository
//--

// Miscellaneous options
var config = {
	numRssItems: 20, // Number of items in the RSS feed
	animDuration: 400, // Duration of UI animations in milliseconds
	cascadeFast: 20, // Speed for cascade animations (higher == slower)
	cascadeSlow: 60, // Speed for EasterEgg cascade animations
	cascadeDepth: 5, // Depth of cascade animation
	locale: "en" // W3C language tag
};

// Hashmap of alternative parsers for the wikifier
config.parsers = {};

// Adaptors
config.adaptors = {};
config.defaultAdaptor = null;

// Backstage tasks
config.tasks = {};

// Annotations
config.annotations = {};

// Custom fields to be automatically added to new tiddlers
config.defaultCustomFields = {};

// Messages
config.messages = {
	messageClose: {},
	dates: {},
	tiddlerPopup: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
	chkRegExpSearch: false,
	chkCaseSensitiveSearch: false,
	chkIncrementalSearch: true,
	chkAnimate: true,
	chkSaveBackups: true,
	chkAutoSave: false,
	chkGenerateAnRssFeed: false,
	chkSaveEmptyTemplate: false,
	chkOpenInNewWindow: true,
	chkToggleLinks: false,
	chkHttpReadOnly: true,
	chkForceMinorUpdate: false,
	chkConfirmDelete: true,
	chkInsertTabs: false,
	chkUsePreForStorage: true, // Whether to use <pre> format for storage
	chkDisplayInstrumentation: false,
	txtBackupFolder: "",
	txtEditorFocus: "text",
	txtMainTab: "tabTimeline",
	txtMoreTab: "moreTabAll",
	txtMaxEditRows: "30",
	txtFileSystemCharSet: "UTF-8",
	txtTheme: ""
	};
config.optionsDesc = {};

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
	1: "ViewTemplate",
	2: "EditTemplate"
};

// More messages (rather a legacy layout that should not really be like this)
config.views = {
	wikified: {
		tag: {}
	},
	editor: {
		tagChooser: {}
	}
};

// Backstage tasks
config.backstageTasks = ["save","sync","importTask","tweak","upgrade","plugins"];

// Macros; each has a 'handler' member that is inserted later
config.macros = {
	today: {},
	version: {},
	search: {sizeTextbox: 15},
	tiddler: {},
	tag: {},
	tags: {},
	tagging: {},
	timeline: {},
	allTags: {},
	list: {
		all: {},
		missing: {},
		orphans: {},
		shadowed: {},
		touched: {},
		filter: {}
	},
	closeAll: {},
	permaview: {},
	saveChanges: {},
	slider: {},
	option: {},
	options: {},
	newTiddler: {},
	newJournal: {},
	tabs: {},
	gradient: {},
	message: {},
	view: {defaultView: "text"},
	edit: {},
	tagChooser: {},
	toolbar: {},
	plugins: {},
	refreshDisplay: {},
	importTiddlers: {},
	upgrade: {
		source: "http://www.tiddlywiki.com/upgrade/",
		backupExtension: "pre.core.upgrade"
	},
	sync: {},
	annotations: {}
};

// Commands supported by the toolbar macro
config.commands = {
	closeTiddler: {},
	closeOthers: {},
	editTiddler: {},
	saveTiddler: {hideReadOnly: true},
	cancelTiddler: {},
	deleteTiddler: {hideReadOnly: true},
	permalink: {},
	references: {type: "popup"},
	jump: {type: "popup"},
	syncing: {type: "popup"},
	fields: {type: "popup"}
};

// Browser detection... In a very few places, there's nothing else for it but to know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
	isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
	isGecko: config.userAgent.indexOf("gecko") != -1,
	ieVersion: /MSIE (\d.\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
	isSafari: config.userAgent.indexOf("applewebkit") != -1,
	isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
	firefoxDate: /gecko\/(\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
	isOpera: config.userAgent.indexOf("opera") != -1,
	isLinux: config.userAgent.indexOf("linux") != -1,
	isUnix: config.userAgent.indexOf("x11") != -1,
	isMac: config.userAgent.indexOf("mac") != -1,
	isWindows: config.userAgent.indexOf("win") != -1
};

// Basic regular expressions
config.textPrimitives = {
	upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
	lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
	anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
	anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
};
if(config.browser.isBadSafari) {
	config.textPrimitives = {
		upperLetter: "[A-Z\u00c0-\u00de]",
		lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
		anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
		anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
	};
}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.sectionSeparator = "##";
config.textPrimitives.urlPattern = "(?:file|http|https|mailto|ftp|irc|news|data):[^\\s'\"]+(?:/|\\b)";
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
	config.textPrimitives.lowerLetter + "+" +
	config.textPrimitives.upperLetter +
	config.textPrimitives.anyLetter + "*)|(?:" +
	config.textPrimitives.upperLetter + "{2,}" +
	config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,"mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp("("+ config.textPrimitives.wikiLink + ")|(?:" +
	config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");

config.glyphs = {
	browsers: [
		function() {return config.browser.isIE;},
		function() {return true;}
	],
	currBrowser: null,
	codes: {
		downTriangle: ["\u25BC","\u25BE"],
		downArrow: ["\u2193","\u2193"],
		bentArrowLeft: ["\u2190","\u21A9"],
		bentArrowRight: ["\u2192","\u21AA"]
	}
};

//--
//-- Shadow tiddlers
//--

config.shadowTiddlers = {
	StyleSheet: "",
	MarkupPreHead: "",
	MarkupPostHead: "",
	MarkupPreBody: "",
	MarkupPostBody: "",
	TabTimeline: '<<timeline>>',
	TabAll: '<<list all>>',
	TabTags: '<<allTags excludeLists>>',
	TabMoreMissing: '<<list missing>>',
	TabMoreOrphans: '<<list orphans>>',
	TabMoreShadowed: '<<list shadowed>>',
	AdvancedOptions: '<<options>>',
	PluginManager: '<<plugins>>',
	ToolbarCommands: '|~ViewToolbar|closeTiddler closeOthers +editTiddler > fields syncing permalink references jump|\n|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|'
};

//--
//-- Translateable strings
//--

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options,{
	txtUserName: "YourName"});

merge(config.tasks,{
	save: {text: "save", tooltip: "Save your changes to this TiddlyWiki", action: saveChanges},
	sync: {text: "sync", tooltip: "Synchronise changes with other TiddlyWiki files and servers", content: '<<sync>>'},
	importTask: {text: "import", tooltip: "Import tiddlers and plugins from other TiddlyWiki files and servers", content: '<<importTiddlers>>'},
	tweak: {text: "tweak", tooltip: "Tweak the appearance and behaviour of TiddlyWiki", content: '<<options>>'},
	upgrade: {text: "upgrade", tooltip: "Upgrade TiddlyWiki core code", content: '<<upgrade>>'},
	plugins: {text: "plugins", tooltip: "Manage installed plugins", content: '<<plugins>>'}
});

// Options that can be set in the options panel and/or cookies
merge(config.optionsDesc,{
	txtUserName: "Username for signing your edits",
	chkRegExpSearch: "Enable regular expressions for searches",
	chkCaseSensitiveSearch: "Case-sensitive searching",
	chkIncrementalSearch: "Incremental key-by-key searching",
	chkAnimate: "Enable animations",
	chkSaveBackups: "Keep backup file when saving changes",
	chkAutoSave: "Automatically save changes",
	chkGenerateAnRssFeed: "Generate an RSS feed when saving changes",
	chkSaveEmptyTemplate: "Generate an empty template when saving changes",
	chkOpenInNewWindow: "Open external links in a new window",
	chkToggleLinks: "Clicking on links to open tiddlers causes them to close",
	chkHttpReadOnly: "Hide editing features when viewed over HTTP",
	chkForceMinorUpdate: "Don't update modifier username and date when editing tiddlers",
	chkConfirmDelete: "Require confirmation before deleting tiddlers",
	chkInsertTabs: "Use the tab key to insert tab characters instead of moving between fields",
	txtBackupFolder: "Name of folder to use for backups",
	txtMaxEditRows: "Maximum number of rows in edit boxes",
	txtFileSystemCharSet: "Default character set for saving changes (Firefox/Mozilla only)"});

merge(config.messages,{
	customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
	pluginError: "Error: %0",
	pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
	pluginForced: "Executed because forced via 'systemConfigForce' tag",
	pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
	nothingSelected: "Nothing is selected. You must select one or more items first",
	savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#DownloadSoftware for details",
	subtitleUnknown: "(unknown)",
	undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
	shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
	tiddlerLinkTooltip: "%0 - %1, %2",
	externalLinkTooltip: "External link to %0",
	noTags: "There are no tagged tiddlers",
	notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
	cantSaveError: "It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",
	invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
	backupSaved: "Backup saved",
	backupFailed: "Failed to save backup file",
	rssSaved: "RSS feed saved",
	rssFailed: "Failed to save RSS feed file",
	emptySaved: "Empty template saved",
	emptyFailed: "Failed to save empty template file",
	mainSaved: "Main TiddlyWiki file saved",
	mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
	macroError: "Error in macro <<\%0>>",
	macroErrorDetails: "Error while executing macro <<\%0>>:\n%1",
	missingMacro: "No such macro",
	overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
	unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
	confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
	saveInstructions: "SaveChanges",
	unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
	tiddlerSaveError: "Error when saving tiddler '%0'",
	tiddlerLoadError: "Error when loading tiddler '%0'",
	wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
	invalidFieldName: "Invalid field name %0",
	fieldCannotBeChanged: "Field '%0' cannot be changed",
	loadingMissingTiddler: "Attempting to retrieve the tiddler '%0' from the '%1' server at:\n\n'%2' in the workspace '%3'",
	upgradeDone: "The upgrade to version %0 is now complete\n\nClick 'OK' to reload the newly upgraded TiddlyWiki"});

merge(config.messages.messageClose,{
	text: "close",
	tooltip: "close this message area"});

config.messages.backstage = {
	open: {text: "backstage", tooltip: "Open the backstage area to perform authoring and editing tasks"},
	close: {text: "close", tooltip: "Close the backstage area"},
	prompt: "backstage: ",
	decal: {
		edit: {text: "edit", tooltip: "Edit the tiddler '%0'"}
	}
};

config.messages.listView = {
	tiddlerTooltip: "Click for the full text of this tiddler",
	previewUnavailable: "(preview not available)"
};

config.messages.dates.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
// suffixes for dates, eg "1st","2nd","3rd"..."30th","31st"
config.messages.dates.daySuffixes = ["st","nd","rd","th","th","th","th","th","th","th",
		"th","th","th","th","th","th","th","th","th","th",
		"st","nd","rd","th","th","th","th","th","th","th",
		"st"];
config.messages.dates.am = "am";
config.messages.dates.pm = "pm";

merge(config.messages.tiddlerPopup,{
	});

merge(config.views.wikified.tag,{
	labelNoTags: "no tags",
	labelTags: "tags: ",
	openTag: "Open tag '%0'",
	tooltip: "Show tiddlers tagged with '%0'",
	openAllText: "Open all",
	openAllTooltip: "Open all of these tiddlers",
	popupNone: "No other tiddlers tagged with '%0'"});

merge(config.views.wikified,{
	defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
	defaultModifier: "(missing)",
	shadowModifier: "(built-in shadow tiddler)",
	dateFormat: "DD MMM YYYY",
	createdPrompt: "created"});

merge(config.views.editor,{
	tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
	defaultText: "Type the text for '%0'"});

merge(config.views.editor.tagChooser,{
	text: "tags",
	tooltip: "Choose existing tags to add to this tiddler",
	popupNone: "There are no tags defined",
	tagTooltip: "Add the tag '%0'"});

merge(config.messages,{
	sizeTemplates:
		[
		{unit: 1024*1024*1024, template: "%0\u00a0GB"},
		{unit: 1024*1024, template: "%0\u00a0MB"},
		{unit: 1024, template: "%0\u00a0KB"},
		{unit: 1, template: "%0\u00a0B"}
		]});

merge(config.macros.search,{
	label: "search",
	prompt: "Search this TiddlyWiki",
	accessKey: "F",
	successMsg: "%0 tiddlers found matching %1",
	failureMsg: "No tiddlers found matching %0"});

merge(config.macros.tagging,{
	label: "tagging: ",
	labelNotTag: "not tagging",
	tooltip: "List of tiddlers tagged with '%0'"});

merge(config.macros.timeline,{
	dateFormat: "DD MMM YYYY"});

merge(config.macros.allTags,{
	tooltip: "Show tiddlers tagged with '%0'",
	noTags: "There are no tagged tiddlers"});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";
config.macros.list.touched.prompt = "Tiddlers that have been modified locally";

merge(config.macros.closeAll,{
	label: "close all",
	prompt: "Close all displayed tiddlers (except any that are being edited)"});

merge(config.macros.permaview,{
	label: "permaview",
	prompt: "Link to an URL that retrieves all the currently displayed tiddlers"});

merge(config.macros.saveChanges,{
	label: "save changes",
	prompt: "Save all tiddlers to create a new TiddlyWiki",
	accessKey: "S"});

merge(config.macros.newTiddler,{
	label: "new tiddler",
	prompt: "Create a new tiddler",
	title: "New Tiddler",
	accessKey: "N"});

merge(config.macros.newJournal,{
	label: "new journal",
	prompt: "Create a new tiddler from the current date and time",
	accessKey: "J"});

merge(config.macros.options,{
	wizardTitle: "Tweak advanced options",
	step1Title: "These options are saved in cookies in your browser",
	step1Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>",
	unknownDescription: "//(unknown)//",
	listViewTemplate: {
		columns: [
			{name: 'Option', field: 'option', title: "Option", type: 'String'},
			{name: 'Description', field: 'description', title: "Description", type: 'WikiText'},
			{name: 'Name', field: 'name', title: "Name", type: 'String'}
			],
		rowClasses: [
			{className: 'lowlight', field: 'lowlight'}
			]}
	});

merge(config.macros.plugins,{
	wizardTitle: "Manage plugins",
	step1Title: "Currently loaded plugins",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	skippedText: "(This plugin has not been executed because it was added since startup)",
	noPluginText: "There are no plugins installed",
	confirmDeleteText: "Are you sure you want to delete these plugins:\n\n%0",
	removeLabel: "remove systemConfig tag",
	removePrompt: "Remove systemConfig tag",
	deleteLabel: "delete",
	deletePrompt: "Delete these tiddlers forever",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox'},
			{name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
			],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
			]}
	});

merge(config.macros.toolbar,{
	moreLabel: "more",
	morePrompt: "Reveal further commands"
	});

merge(config.macros.refreshDisplay,{
	label: "refresh",
	prompt: "Redraw the entire TiddlyWiki display"
	});

merge(config.macros.importTiddlers,{
	readOnlyWarning: "You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL",
	wizardTitle: "Import tiddlers from another file or server",
	step1Title: "Step 1: Locate the server or TiddlyWiki file",
	step1Html: "Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>",
	openLabel: "open",
	openPrompt: "Open the connection to this file or server",
	openError: "There were problems fetching the tiddlywiki file",
	statusOpenHost: "Opening the host",
	statusGetWorkspaceList: "Getting the list of available workspaces",
	step2Title: "Step 2: Choose the workspace",
	step2Html: "Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel this import",
	statusOpenWorkspace: "Opening the workspace",
	statusGetTiddlerList: "Getting the list of available tiddlers",
	errorGettingTiddlerList: "Error getting list of tiddlers, click Cancel to try again",
	step3Title: "Step 3: Choose the tiddlers to import",
	step3Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>",
	importLabel: "import",
	importPrompt: "Import these tiddlers",
	confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
	step4Title: "Step 4: Importing %0 tiddler(s)",
	step4Html: "<input type='hidden' name='markReport'></input>", // DO NOT TRANSLATE
	doneLabel: "done",
	donePrompt: "Close this wizard",
	statusDoingImport: "Importing tiddlers",
	statusDoneImport: "All tiddlers imported",
	systemServerNamePattern: "%2 on %1",
	systemServerNamePatternNoWorkspace: "%1",
	confirmOverwriteSaveTiddler: "The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged",
	serverSaveTemplate: "|''Type:''|%0|\n|''URL:''|%1|\n|''Workspace:''|%2|\n\nThis tiddler was automatically created to record the details of this server",
	serverSaveModifier: "(System)",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Tags', field: 'tags', title: "Tags", type: 'Tags'}
			],
		rowClasses: [
			]}
	});

merge(config.macros.upgrade,{
	wizardTitle: "Upgrade TiddlyWiki core code",
	step1Title: "Update or repair this TiddlyWiki to the latest release",
	step1Html: "You are about to upgrade to the latest release of the TiddlyWiki core code (from <a href='%0' class='externalLink' target='_blank'>%1</a>). Your content will be preserved across the upgrade.<br><br>Note that core upgrades have been known to interfere with older plugins. If you run into problems with the upgraded file, see <a href='http://www.tiddlywiki.org/wiki/CoreUpgrades' class='externalLink' target='_blank'>http://www.tiddlywiki.org/wiki/CoreUpgrades</a>",
	errorCantUpgrade: "Unable to upgrade this TiddlyWiki. You can only perform upgrades on TiddlyWiki files stored locally",
	errorNotSaved: "You must save changes before you can perform an upgrade",
	step2Title: "Confirm the upgrade details",
	step2Html_downgrade: "You are about to downgrade to TiddlyWiki version %0 from %1.<br><br>Downgrading to an earlier version of the core code is not recommended",
	step2Html_restore: "This TiddlyWiki appears to be already using the latest version of the core code (%0).<br><br>You can continue to upgrade anyway to ensure that the core code hasn't been corrupted or damaged",
	step2Html_upgrade: "You are about to upgrade to TiddlyWiki version %0 from %1",
	upgradeLabel: "upgrade",
	upgradePrompt: "Prepare for the upgrade process",
	statusPreparingBackup: "Preparing backup",
	statusSavingBackup: "Saving backup file",
	errorSavingBackup: "There was a problem saving the backup file",
	statusLoadingCore: "Loading core code",
	errorLoadingCore: "Error loading the core code",
	errorCoreFormat: "Error with the new core code",
	statusSavingCore: "Saving the new core code",
	statusReloadingCore: "Reloading the new core code",
	startLabel: "start",
	startPrompt: "Start the upgrade process",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel the upgrade process",
	step3Title: "Upgrade cancelled",
	step3Html: "You have cancelled the upgrade process"
	});

merge(config.macros.sync,{
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Server Type', field: 'serverType', title: "Server type", type: 'String'},
			{name: 'Server Host', field: 'serverHost', title: "Server host", type: 'String'},
			{name: 'Server Workspace', field: 'serverWorkspace', title: "Server workspace", type: 'String'},
			{name: 'Status', field: 'status', title: "Synchronisation status", type: 'String'},
			{name: 'Server URL', field: 'serverUrl', title: "Server URL", text: "View", type: 'Link'}
			],
		rowClasses: [
			],
		buttons: [
			{caption: "Sync these tiddlers", name: 'sync'}
			]},
	wizardTitle: "Synchronize with external servers and files",
	step1Title: "Choose the tiddlers you want to synchronize",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	syncLabel: "sync",
	syncPrompt: "Sync these tiddlers",
	hasChanged: "Changed while unplugged",
	hasNotChanged: "Unchanged while unplugged",
	syncStatusList: {
		none: {text: "...", display:null, className:'notChanged'},
		changedServer: {text: "Changed on server", display:null, className:'changedServer'},
		changedLocally: {text: "Changed while unplugged", display:null, className:'changedLocally'},
		changedBoth: {text: "Changed while unplugged and on server", display:null, className:'changedBoth'},
		notFound: {text: "Not found on server", display:null, className:'notFound'},
		putToServer: {text: "Saved update on server", display:null, className:'putToServer'},
		gotFromServer: {text: "Retrieved update from server", display:null, className:'gotFromServer'}
		}
	});

merge(config.macros.annotations,{
	});

merge(config.commands.closeTiddler,{
	text: "close",
	tooltip: "Close this tiddler"});

merge(config.commands.closeOthers,{
	text: "close others",
	tooltip: "Close all other tiddlers"});

merge(config.commands.editTiddler,{
	text: "edit",
	tooltip: "Edit this tiddler",
	readOnlyText: "view",
	readOnlyTooltip: "View the source of this tiddler"});

merge(config.commands.saveTiddler,{
	text: "done",
	tooltip: "Save changes to this tiddler"});

merge(config.commands.cancelTiddler,{
	text: "cancel",
	tooltip: "Undo changes to this tiddler",
	warning: "Are you sure you want to abandon your changes to '%0'?",
	readOnlyText: "done",
	readOnlyTooltip: "View this tiddler normally"});

merge(config.commands.deleteTiddler,{
	text: "delete",
	tooltip: "Delete this tiddler",
	warning: "Are you sure you want to delete '%0'?"});

merge(config.commands.permalink,{
	text: "permalink",
	tooltip: "Permalink for this tiddler"});

merge(config.commands.references,{
	text: "references",
	tooltip: "Show tiddlers that link to this one",
	popupNone: "No references"});

merge(config.commands.jump,{
	text: "jump",
	tooltip: "Jump to another open tiddler"});

merge(config.commands.syncing,{
	text: "syncing",
	tooltip: "Control synchronisation of this tiddler with a server or external file",
	currentlySyncing: "<div>Currently syncing via <span class='popupHighlight'>'%0'</span> to:</"+"div><div>host: <span class='popupHighlight'>%1</span></"+"div><div>workspace: <span class='popupHighlight'>%2</span></"+"div>", // Note escaping of closing <div> tag
	notCurrentlySyncing: "Not currently syncing",
	captionUnSync: "Stop synchronising this tiddler",
	chooseServer: "Synchronise this tiddler with another server:",
	currServerMarker: "\u25cf ",
	notCurrServerMarker: "  "});

merge(config.commands.fields,{
	text: "fields",
	tooltip: "Show the extended fields of this tiddler",
	emptyText: "There are no extended fields for this tiddler",
	listViewTemplate: {
		columns: [
			{name: 'Field', field: 'field', title: "Field", type: 'String'},
			{name: 'Value', field: 'value', title: "Value", type: 'String'}
			],
		rowClasses: [
			],
		buttons: [
			]}});

merge(config.shadowTiddlers,{
	DefaultTiddlers: "[[GettingStarted]]",
	MainMenu: "[[GettingStarted]]",
	SiteTitle: "My TiddlyWiki",
	SiteSubtitle: "a reusable non-linear personal web notebook",
	SiteUrl: "http://www.tiddlywiki.com/",
	SideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal "DD MMM YYYY" "journal">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel "options \u00bb" "Change TiddlyWiki advanced options">>',
	SideBarTabs: '<<tabs txtMainTab "Timeline" "Timeline" TabTimeline "All" "All tiddlers" TabAll "Tags" "All tags" TabTags "More" "More lists" TabMore>>',
	TabMore: '<<tabs txtMoreTab "Missing" "Missing tiddlers" TabMoreMissing "Orphans" "Orphaned tiddlers" TabMoreOrphans "Shadowed" "Shadowed tiddlers" TabMoreShadowed>>'
	});

merge(config.annotations,{
	AdvancedOptions: "This shadow tiddler provides access to several advanced options",
	ColorPalette: "These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface",
	DefaultTiddlers: "The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up",
	EditTemplate: "The HTML template in this shadow tiddler determines how tiddlers look while they are being edited",
	GettingStarted: "This shadow tiddler provides basic usage instructions",
	ImportTiddlers: "This shadow tiddler provides access to importing tiddlers",
	MainMenu: "This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen",
	MarkupPreHead: "This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file",
	MarkupPostHead: "This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file",
	MarkupPreBody: "This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file",
	MarkupPostBody: "This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately after the script block",
	OptionsPanel: "This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar",
	PageTemplate: "The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout",
	PluginManager: "This shadow tiddler provides access to the plugin manager",
	SideBarOptions: "This shadow tiddler is used as the contents of the option panel in the right-hand sidebar",
	SideBarTabs: "This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar",
	SiteSubtitle: "This shadow tiddler is used as the second part of the page title",
	SiteTitle: "This shadow tiddler is used as the first part of the page title",
	SiteUrl: "This shadow tiddler should be set to the full target URL for publication",
	StyleSheetColors: "This shadow tiddler contains CSS definitions related to the color of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheet: "This tiddler can contain custom CSS definitions",
	StyleSheetLayout: "This shadow tiddler contains CSS definitions related to the layout of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheetLocale: "This shadow tiddler contains CSS definitions related to the translation locale",
	StyleSheetPrint: "This shadow tiddler contains CSS definitions for printing",
	TabAll: "This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar",
	TabMore: "This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar",
	TabMoreMissing: "This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar",
	TabMoreOrphans: "This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar",
	TabMoreShadowed: "This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar",
	TabTags: "This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar",
	TabTimeline: "This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar",
	ToolbarCommands: "This shadow tiddler determines which commands are shown in tiddler toolbars",
	ViewTemplate: "The HTML template in this shadow tiddler determines how tiddlers look"
	});

//--
//-- Main
//--

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
var anim = typeof Animator == "function" ? new Animator() : null; // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var showBackstage; // Whether to include the backstage area
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()

// Whether to use the JavaSaver applet
var useJavaSaver = (config.browser.isSafari || config.browser.isOpera) && (document.location.toString().substr(0,4) != "http");

// Starting up
function main()
{
	var t10,t9,t8,t7,t6,t5,t4,t3,t2,t1,t0 = new Date();
	startingUp = true;
	window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};
	params = getParameters();
	if(params)
		params = params.parseParams("open",null,false);
	store = new TiddlyWiki();
	invokeParamifier(params,"oninit");
	story = new Story("tiddlerDisplay","tiddler");
	addEvent(document,"click",Popup.onDocumentClick);
	saveTest();
	loadOptionsCookie();
	for(var s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
	t1 = new Date();
	loadShadowTiddlers();
	t2 = new Date();
	store.loadFromDiv("storeArea","store",true);
	t3 = new Date();
	invokeParamifier(params,"onload");
	t4 = new Date();
	readOnly = (window.location.protocol == "file:") ? false : config.options.chkHttpReadOnly;
	var pluginProblem = loadPlugins();
	t5 = new Date();
	formatter = new Formatter(config.formatters);
	invokeParamifier(params,"onconfig");
	story.switchTheme(config.options.txtTheme);
	showBackstage = !readOnly;
	t6 = new Date();
	store.notifyAll();
	t7 = new Date();
	restart();
	refreshDisplay();
	t8 = new Date();
	if(pluginProblem) {
		story.displayTiddler(null,"PluginManager");
		displayMessage(config.messages.customConfigError);
	}
	for(var m in config.macros) {
		if(config.macros[m].init)
			config.macros[m].init();
	}
	t9 = new Date();
	if(showBackstage)
		backstage.init();
	t10 = new Date();
	if(config.options.chkDisplayInstrumentation) {
		displayMessage("LoadShadows " + (t2-t1) + " ms");
		displayMessage("LoadFromDiv " + (t3-t2) + " ms");
		displayMessage("LoadPlugins " + (t5-t4) + " ms");
		displayMessage("Notify " + (t7-t6) + " ms");
		displayMessage("Restart " + (t8-t7) + " ms");
		displayMessage("Macro init " + (t9-t8) + " ms");
		displayMessage("Total: " + (t10-t0) + " ms");
	}
	startingUp = false;
}

// Restarting
function restart()
{
	invokeParamifier(params,"onstart");
	if(story.isEmpty()) {
		story.displayDefaultTiddlers();
	}
	window.scrollTo(0,0);
}

function saveTest()
{
	var s = document.getElementById("saveTest");
	if(s.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	s.appendChild(document.createTextNode("savetest"));
}

function loadShadowTiddlers()
{
	var shadows = new TiddlyWiki();
	shadows.loadFromDiv("shadowArea","shadows",true);
	shadows.forEachTiddler(function(title,tiddler){config.shadowTiddlers[title] = tiddler.text;});
	delete shadows;
}

function loadPlugins()
{
	if(safeMode)
		return false;
	var tiddlers = store.getTaggedTiddlers("systemConfig");
	var toLoad = [];
	var nLoaded = 0;
	var map = {};
	var nPlugins = tiddlers.length;
	installedPlugins = [];
	for(var i=0; i<nPlugins; i++) {
		var p = getPluginInfo(tiddlers[i]);
		installedPlugins[i] = p;
		var n = p.Name;
		if(n)
			map[n] = p;
		n = p.Source;
		if(n)
			map[n] = p;
	}
	var visit = function(p) {
		if(!p || p.done)
			return;
		p.done = 1;
		var reqs = p.Requires;
		if(reqs) {
			reqs = reqs.readBracketedList();
			for(var i=0; i<reqs.length; i++)
				visit(map[reqs[i]]);
		}
		toLoad.push(p);
	};
	for(i=0; i<nPlugins; i++)
		visit(installedPlugins[i]);
	for(i=0; i<toLoad.length; i++) {
		p = toLoad[i];
		pluginInfo = p;
		tiddler = p.tiddler;
		if(isPluginExecutable(p)) {
			if(isPluginEnabled(p)) {
				p.executed = true;
				var startTime = new Date();
				try {
					if(tiddler.text)
						window.eval(tiddler.text);
					nLoaded++;
				} catch(ex) {
					p.log.push(config.messages.pluginError.format([exceptionText(ex)]));
					p.error = true;
				}
				pluginInfo.startupTime = String((new Date()) - startTime) + "ms";
			} else {
				nPlugins--;
			}
		} else {
			p.warning = true;
		}
	}
	return nLoaded != nPlugins;
}

function getPluginInfo(tiddler)
{
	var p = store.getTiddlerSlices(tiddler.title,["Name","Description","Version","Requires","CoreVersion","Date","Source","Author","License","Browsers"]);
	p.tiddler = tiddler;
	p.title = tiddler.title;
	p.log = [];
	return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigForce")) {
		plugin.log.push(config.messages.pluginForced);
		return true;
	}
	if(plugin["CoreVersion"]) {
		var coreVersion = plugin["CoreVersion"].split(".");
		var w = parseInt(coreVersion[0],10) - version.major;
		if(w == 0 && coreVersion[1])
			w = parseInt(coreVersion[1],10) - version.minor;
		if(w == 0 && coreVersion[2])
			w = parseInt(coreVersion[2],10) - version.revision;
		if(w > 0) {
			plugin.log.push(config.messages.pluginVersionError);
			return false;
		}
	}
	return true;
}

function isPluginEnabled(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigDisable")) {
		plugin.log.push(config.messages.pluginDisabled);
		return false;
	}
	return true;
}

function invokeMacro(place,macro,params,wikifier,tiddler)
{
	try {
		var m = config.macros[macro];
		if(m && m.handler)
			m.handler(place,macro,params.readMacroParams(),wikifier,params,tiddler);
		else
			createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
	} catch(ex) {
		createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
	}
}

//--
//-- Paramifiers
//--

function getParameters()
{
	var p = null;
	if(window.location.hash) {
		p = decodeURIComponent(window.location.hash.substr(1));
		if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < "20051111")
			p = convertUTF8ToUnicode(p);
	}
	return p;
}

function invokeParamifier(params,handler)
{
	if(!params || params.length == undefined || params.length <= 1)
		return;
	for(var t=1; t<params.length; t++) {
		var p = config.paramifiers[params[t].name];
		if(p && p[handler] instanceof Function)
			p[handler](params[t].value);
	}
}

config.paramifiers = {};

config.paramifiers.start = {
	oninit: function(v) {
		safeMode = v.toLowerCase() == "safe";
	}
};

config.paramifiers.open = {
	onstart: function(v) {
		if(!readOnly || store.tiddlerExists(v) || store.isShadowTiddler(v))
			story.displayTiddler("bottom",v,null,false,null);
	}
};

config.paramifiers.story = {
	onstart: function(v) {
		var list = store.getTiddlerText(v,"").parseParams("open",null,false);
		invokeParamifier(list,"onstart");
	}
};

config.paramifiers.search = {
	onstart: function(v) {
		story.search(v,false,false);
	}
};

config.paramifiers.searchRegExp = {
	onstart: function(v) {
		story.prototype.search(v,false,true);
	}
};

config.paramifiers.tag = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers("[tag["+v+"]]"),null,false,null);
	}
};

config.paramifiers.newTiddler = {
	onstart: function(v) {
		if(!readOnly) {
			story.displayTiddler(null,v,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(v,"text");
		}
	}
};

config.paramifiers.newJournal = {
	onstart: function(v) {
		if(!readOnly) {
			var now = new Date();
			var title = now.formatString(v.trim());
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(title,"text");
		}
	}
};

config.paramifiers.readOnly = {
	onconfig: function(v) {
		var p = v.toLowerCase();
		readOnly = p == "yes" ? true : (p == "no" ? false : readOnly);
	}
};

config.paramifiers.theme = {
	onconfig: function(v) {
		story.switchTheme(v);
	}
};

config.paramifiers.upgrade = {
	onstart: function(v) {
		upgradeFrom(v);
	}
};

config.paramifiers.recent= {
	onstart: function(v) {
		var titles=[];
		var tiddlers=store.getTiddlers("modified","excludeLists").reverse();
		for(var i=0; i<v && i<tiddlers.length; i++)
			titles.push(tiddlers[i].title);
		story.displayTiddlers(null,titles);
	}
};

config.paramifiers.filter = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers(v),null,false);
	}
};

//--
//-- Formatter helpers
//--

function Formatter(formatters)
{
	this.formatters = [];
	var pattern = [];
	for(var n=0; n<formatters.length; n++) {
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
	}
	this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

	createElementAndWikify: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
	},

	inlineCssHelper: function(w)
	{
		var styles = [];
		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var s,v;
			if(lookaheadMatch[1]) {
				s = lookaheadMatch[1].unDash();
				v = lookaheadMatch[2];
			} else {
				s = lookaheadMatch[3].unDash();
				v = lookaheadMatch[4];
			}
			if(s=="bgcolor")
				s = "backgroundColor";
			styles.push({style: s, value: v});
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		}
		return styles;
	},

	applyCssHelper: function(e,styles)
	{
		for(var t=0; t< styles.length; t++) {
			try {
				e.style[styles[t].style] = styles[t].value;
			} catch (ex) {
			}
		}
	},

	enclosedTextHelper: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var text = lookaheadMatch[1];
			if(config.browser.isIE)
				text = text.replace(/\n/g,"\r");
			createTiddlyElement(w.output,this.element,null,null,text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	},

	isExternalLink: function(link)
	{
		if(store.tiddlerExists(link) || store.isShadowTiddler(link)) {
			return false;
		}
		var urlRegExp = new RegExp(config.textPrimitives.urlPattern,"mg");
		if(urlRegExp.exec(link)) {
			return true;
		}
		if(link.indexOf(".")!=-1 || link.indexOf("\\")!=-1 || link.indexOf("/")!=-1 || link.indexOf("#")!=-1) {
			return true;
		}
		return false;
	}

};

//--
//-- Standard formatters
//--

config.formatters = [
{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
	rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
	cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
	cellTermRegExp: /((?:\x20*)\|)/mg,
	rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},
	handler: function(w)
	{
		var table = createTiddlyElement(w.output,"table",null,"twtable");
		var prevColumns = [];
		var currRowType = null;
		var rowContainer;
		var rowCount = 0;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var nextRowType = lookaheadMatch[2];
			if(nextRowType == "k") {
				table.className = lookaheadMatch[1];
				w.nextMatch += lookaheadMatch[0].length+1;
			} else {
				if(nextRowType != currRowType) {
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
					currRowType = nextRowType;
				}
				if(currRowType == "c") {
					// Caption
					w.nextMatch++;
					if(rowContainer != table.firstChild)
						table.insertBefore(rowContainer,table.firstChild);
					rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
					w.subWikifyTerm(rowContainer,this.rowTermRegExp);
				} else {
					var theRow = createTiddlyElement(rowContainer,"tr",null,(rowCount&1)?"oddRow":"evenRow");
					theRow.onmouseover = function() {addClass(this,"hoverRow");};
					theRow.onmouseout = function() {removeClass(this,"hoverRow");};
					this.rowHandler(w,theRow,prevColumns);
					rowCount++;
				}
			}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	},
	rowHandler: function(w,e,prevColumns)
	{
		var col = 0;
		var colSpanCount = 1;
		var prevCell = null;
		this.cellRegExp.lastIndex = w.nextMatch;
		var cellMatch = this.cellRegExp.exec(w.source);
		while(cellMatch && cellMatch.index == w.nextMatch) {
			if(cellMatch[1] == "~") {
				// Rowspan
				var last = prevColumns[col];
				if(last) {
					last.rowSpanCount++;
					last.element.setAttribute("rowspan",last.rowSpanCount);
					last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
					last.element.valign = "center";
				}
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[1] == ">") {
				// Colspan
				colSpanCount++;
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[2]) {
				// End of row
				if(prevCell && colSpanCount > 1) {
					prevCell.setAttribute("colspan",colSpanCount);
					prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
				}
				w.nextMatch = this.cellRegExp.lastIndex;
				break;
			} else {
				// Cell
				w.nextMatch++;
				var styles = config.formatterHelpers.inlineCssHelper(w);
				var spaceLeft = false;
				var chr = w.source.substr(w.nextMatch,1);
				while(chr == " ") {
					spaceLeft = true;
					w.nextMatch++;
					chr = w.source.substr(w.nextMatch,1);
				}
				var cell;
				if(chr == "!") {
					cell = createTiddlyElement(e,"th");
					w.nextMatch++;
				} else {
					cell = createTiddlyElement(e,"td");
				}
				prevCell = cell;
				prevColumns[col] = {rowSpanCount:1,element:cell};
				if(colSpanCount > 1) {
					cell.setAttribute("colspan",colSpanCount);
					cell.setAttribute("colSpan",colSpanCount); // Needed for IE
					colSpanCount = 1;
				}
				config.formatterHelpers.applyCssHelper(cell,styles);
				w.subWikifyTerm(cell,this.cellTermRegExp);
				if(w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
					cell.align = spaceLeft ? "center" : "left";
				else if(spaceLeft)
					cell.align = "right";
				w.nextMatch--;
			}
			col++;
			this.cellRegExp.lastIndex = w.nextMatch;
			cellMatch = this.cellRegExp.exec(w.source);
		}
	}
},

{
	name: "heading",
	match: "^!{1,6}",
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
	}
},

{
	name: "list",
	match: "^(?:[\\*#;:]+)",
	lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0, currType = null;
		var listLevel, listType, itemType, baseType;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			if(lookaheadMatch[1]) {
				listType = "ul";
				itemType = "li";
			} else if(lookaheadMatch[2]) {
				listType = "ol";
				itemType = "li";
			} else if(lookaheadMatch[3]) {
				listType = "dl";
				itemType = "dt";
			} else if(lookaheadMatch[4]) {
				listType = "dl";
				itemType = "dd";
			}
			if(!baseType)
				baseType = listType;
			listLevel = lookaheadMatch[0].length;
			w.nextMatch += lookaheadMatch[0].length;
			var t;
			if(listLevel > currLevel) {
				for(t=currLevel; t<listLevel; t++) {
					var target = (currLevel == 0) ? stack[stack.length-1] : stack[stack.length-1].lastChild;
					stack.push(createTiddlyElement(target,listType));
				}
			} else if(listType!=baseType && listLevel==1) {
				w.nextMatch -= lookaheadMatch[0].length;
				return;
			} else if(listLevel < currLevel) {
				for(t=currLevel; t>listLevel; t--)
					stack.pop();
			} else if(listLevel == currLevel && listType != currType) {
				stack.pop();
				stack.push(createTiddlyElement(stack[stack.length-1].lastChild,listType));
			}
			currLevel = listLevel;
			currType = listType;
			var e = createTiddlyElement(stack[stack.length-1],itemType);
			w.subWikifyTerm(e,this.termRegExp);
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	termRegExp: /(^<<<(\n|$))/mg,
	element: "blockquote",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "quoteByLine",
	match: "^>+",
	lookaheadRegExp: /^>+/mg,
	termRegExp: /(\n)/mg,
	element: "blockquote",
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var t;
		do {
			if(newLevel > currLevel) {
				for(t=currLevel; t<newLevel; t++)
					stack.push(createTiddlyElement(stack[stack.length-1],this.element));
			} else if(newLevel < currLevel) {
				for(t=currLevel; t>newLevel; t--)
					stack.pop();
			}
			currLevel = newLevel;
			w.subWikifyTerm(stack[stack.length-1],this.termRegExp);
			createTiddlyElement(stack[stack.length-1],"br");
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched) {
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
			}
		} while(matched);
	}
},

{
	name: "rule",
	match: "^----+$\\n?",
	handler: function(w)
	{
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "monospacedByLine",
	match: "^(?:/\\*\\{\\{\\{\\*/|\\{\\{\\{|//\\{\\{\\{|<!--\\{\\{\\{-->)\\n",
	element: "pre",
	handler: function(w)
	{
		switch(w.matchText) {
		case "/*{{{*/\n": // CSS
			this.lookaheadRegExp = /\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\/\*\}\}\}\*\/$\n?)/mg;
			break;
		case "{{{\n": // monospaced block
			this.lookaheadRegExp = /^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/mg;
			break;
		case "//{{{\n": // plugin
			this.lookaheadRegExp = /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\/\/\}\}\}$\n?)/mg;
			break;
		case "<!--{{{-->\n": //template
			this.lookaheadRegExp = /<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^<!--\}\}\}-->$\n?)/mg;
			break;
		default:
			break;
		}
		config.formatterHelpers.enclosedTextHelper.call(this,w);
	}
},

{
	name: "wikifyComment",
	match: "^(?:/\\*\\*\\*|<!---)\\n",
	handler: function(w)
	{
		var termRegExp = (w.matchText == "/***\n") ? (/(^\*\*\*\/\n)/mg) : (/(^--->\n)/mg);
		w.subWikifyTerm(w.output,termRegExp);
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
		}
	}
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e;
			var text = lookaheadMatch[1];
			if(lookaheadMatch[3]) {
				// Pretty bracketted link
				var link = lookaheadMatch[3];
				e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link)) ?
						createExternalLink(w.output,link) : createTiddlyLink(w.output,decodeURIComponent(link),false,null,w.isStatic,w.tiddler);
			} else {
				// Simple bracketted link
				e = createTiddlyLink(w.output,decodeURIComponent(text),false,null,w.isStatic,w.tiddler);
			}
			createTiddlyText(e,text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "wikiLink",
	match: config.textPrimitives.unWikiLink+"?"+config.textPrimitives.wikiLink,
	handler: function(w)
	{
		if(w.matchText.substr(0,1) == config.textPrimitives.unWikiLink) {
			w.outputText(w.output,w.matchStart+1,w.nextMatch);
			return;
		}
		if(w.matchStart > 0) {
			var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,"mg");
			preRegExp.lastIndex = w.matchStart-1;
			var preMatch = preRegExp.exec(w.source);
			if(preMatch.index == w.matchStart-1) {
				w.outputText(w.output,w.matchStart,w.nextMatch);
				return;
			}
		}
		if(w.autoLinkWikiWords || store.isShadowTiddler(w.matchText)) {
			var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic,w.tiddler);
			w.outputText(link,w.matchStart,w.nextMatch);
		} else {
			w.outputText(w.output,w.matchStart,w.nextMatch);
		}
	}
},

{
	name: "urlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w)
	{
		w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[[<>]?[Ii][Mm][Gg]\\[",
	lookaheadRegExp: /\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e = w.output;
			if(lookaheadMatch[5]) {
				var link = lookaheadMatch[5];
				e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
				addClass(e,"imageLink");
			}
			var img = createTiddlyElement(e,"img");
			if(lookaheadMatch[1])
				img.align = "left";
			else if(lookaheadMatch[2])
				img.align = "right";
			if(lookaheadMatch[3]) {
				img.title = lookaheadMatch[3];
				img.setAttribute("alt",lookaheadMatch[3]);
			}
			img.src = lookaheadMatch[4];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "commentByBlock",
	match: "/%",
	lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
},

{
	name: "characterFormat",
	match: "''|//|__|\\^\\^|~~|--(?!\\s|$)|\\{\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "''":
			w.subWikifyTerm(w.output.appendChild(document.createElement("strong")),/('')/mg);
			break;
		case "//":
			w.subWikifyTerm(createTiddlyElement(w.output,"em"),/(\/\/)/mg);
			break;
		case "__":
			w.subWikifyTerm(createTiddlyElement(w.output,"u"),/(__)/mg);
			break;
		case "^^":
			w.subWikifyTerm(createTiddlyElement(w.output,"sup"),/(\^\^)/mg);
			break;
		case "~~":
			w.subWikifyTerm(createTiddlyElement(w.output,"sub"),/(~~)/mg);
			break;
		case "--":
			w.subWikifyTerm(createTiddlyElement(w.output,"strike"),/(--)/mg);
			break;
		case "{{{":
			var lookaheadRegExp = /\{\{\{((?:.|\n)*?)\}\}\}/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
				createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
				w.nextMatch = lookaheadRegExp.lastIndex;
			}
			break;
		}
	}
},

{
	name: "customFormat",
	match: "@@|\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "@@":
			var e = createTiddlyElement(w.output,"span");
			var styles = config.formatterHelpers.inlineCssHelper(w);
			if(styles.length == 0)
				e.className = "marked";
			else
				config.formatterHelpers.applyCssHelper(e,styles);
			w.subWikifyTerm(e,/(@@)/mg);
			break;
		case "{{":
			var lookaheadRegExp = /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch) {
				w.nextMatch = lookaheadRegExp.lastIndex;
				e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
				w.subWikifyTerm(e,/(\}\}\})/mg);
			}
			break;
		}
	}
},

{
	name: "mdash",
	match: "--",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
	}
},

{
	name: "lineBreak",
	match: "\\n|<br ?/?>",
	handler: function(w)
	{
		createTiddlyElement(w.output,"br");
	}
},

{
	name: "rawText",
	match: "\\\"{3}|<nowiki>",
	lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "htmlEntitiesEncoding",
	match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = w.matchText;
	}
}

];

//--
//-- Wikifier
//--

function getParser(tiddler,format)
{
	if(tiddler) {
		if(!format)
			format = tiddler.fields["wikiformat"];
		var i;
		if(format) {
			for(i in config.parsers) {
				if(format == config.parsers[i].format)
					return config.parsers[i];
			}
		} else {
			for(i in config.parsers) {
				if(tiddler.isTagged(config.parsers[i].formatTag))
					return config.parsers[i];
			}
		}
	}
	return formatter;
}

function wikify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		var t0 = new Date();
		wikifier.subWikify(output);
		if(tiddler && config.options.chkDisplayInstrumentation)
			displayMessage("wikify:" +tiddler.title+ " in " + (new Date()-t0) + " ms");
	}
}

function wikifyStatic(source,highlightRegExp,tiddler,format)
{
	var e = createTiddlyElement(document.body,"pre");
	e.style.display = "none";
	var html = "";
	if(source && source != "") {
		if(!tiddler)
			tiddler = new Tiddler("temp");
		var wikifier = new Wikifier(source,getParser(tiddler,format),highlightRegExp,tiddler);
		wikifier.isStatic = true;
		wikifier.subWikify(e);
		html = e.innerHTML;
		removeNode(e);
	}
	return html;
}

function wikifyPlain(title,theStore,limit)
{
	if(!theStore)
		theStore = store;
	if(theStore.tiddlerExists(title) || theStore.isShadowTiddler(title)) {
		return wikifyPlainText(theStore.getTiddlerText(title),limit,tiddler);
	} else {
		return "";
	}
}

function wikifyPlainText(text,limit,tiddler)
{
	if(limit > 0)
		text = text.substr(0,limit);
	var wikifier = new Wikifier(text,formatter,null,tiddler);
	return wikifier.wikifyPlain();
}

function highlightify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);
		wikifier.outputText(output,0,source.length);
	}
}

function Wikifier(source,formatter,highlightRegExp,tiddler)
{
	this.source = source;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;
	this.isStatic = false;
	if(highlightRegExp) {
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(source);
	}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	this.subWikify(e);
	var text = getPlainText(e);
	removeNode(e);
	return text;
};

Wikifier.prototype.subWikify = function(output,terminator)
{
	try {
		if(terminator)
			this.subWikifyTerm(output,new RegExp("(" + terminator + ")","mg"));
		else
			this.subWikifyUnterm(output);
	} catch(ex) {
		showException(ex);
	}
};

Wikifier.prototype.subWikifyUnterm = function(output)
{
	var oldOutput = this.output;
	this.output = output;
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	while(formatterMatch) {
		// Output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters for the handler
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)
{
	var oldOutput = this.output;
	this.output = output;
	terminatorRegExp.lastIndex = this.nextMatch;
	var terminatorMatch = terminatorRegExp.exec(this.source);
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	while(terminatorMatch || formatterMatch) {
		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {
			if(terminatorMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,terminatorMatch.index);
			this.matchText = terminatorMatch[1];
			this.matchLength = terminatorMatch[1].length;
			this.matchStart = terminatorMatch.index;
			this.nextMatch = this.matchStart + this.matchLength;
			this.output = oldOutput;
			return;
		}
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		terminatorRegExp.lastIndex = this.nextMatch;
		terminatorMatch = terminatorRegExp.exec(this.source);
		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos)) {
		if(this.highlightMatch.index > startPos) {
			createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
			startPos = this.highlightMatch.index;
		}
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
		var theHighlight = createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		if(startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
	}
	if(startPos < endPos) {
		createTiddlyText(place,this.source.substring(startPos,endPos));
	}
};

//--
//-- Macro definitions
//--

config.macros.today.handler = function(place,macroName,params)
{
	var now = new Date();
	var text = params[0] ? now.formatString(params[0].trim()) : now.toLocaleString();
	createTiddlyElement(place,"span",null,null,text);
};

config.macros.version.handler = function(place)
{
	createTiddlyElement(place,"span",null,null,formatVersion());
};

config.macros.list.handler = function(place,macroName,params)
{
	var type = params[0] || "all";
	var list = document.createElement("ul");
	place.appendChild(list);
	if(this[type].prompt)
		createTiddlyElement(list,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	for(var t = 0; t < results.length; t++) {
		var li = document.createElement("li");
		list.appendChild(li);
		createTiddlyLink(li,typeof results[t] == "string" ? results[t] : results[t].title,true);
	}
};

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
};

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
};

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
};

config.macros.list.shadowed.handler = function(params)
{
	return store.getShadowed();
};

config.macros.list.touched.handler = function(params)
{
	return store.getTouched();
};

config.macros.list.filter.handler = function(params)
{
	var filter = params[1];
	var results = [];
	if(filter) {
		var tiddlers = store.filterTiddlers(filter);
		for(var t=0; t<tiddlers.length; t++)
			results.push(tiddlers[t].title);
	}
	return results;
};

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags(params[0]);
	var ul = createTiddlyElement(place,"ul");
	if(tags.length == 0)
		createTiddlyElement(ul,"li",null,"listTitle",this.noTags);
	for(var t=0; t<tags.length; t++) {
		var title = tags[t][0];
		var info = getTiddlyLinkInfo(title);
		var li = createTiddlyElement(ul,"li");
		var btn = createTiddlyButton(li,title + " (" + tags[t][1] + ")",this.tooltip.format([title]),onClickTag,info.classes);
		btn.setAttribute("tag",title);
		btn.setAttribute("refresh","link");
		btn.setAttribute("tiddlyLink",title);
	}
};

config.macros.timeline.handler = function(place,macroName,params)
{
	var field = params[0] || "modified";
	var tiddlers = store.reverseLookup("tags","excludeLists",false,field);
	var lastDay = "";
	var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1])) : 0;
	var dateFormat = params[2] || this.dateFormat;
	for(var t=tiddlers.length-1; t>=last; t--) {
		var tiddler = tiddlers[t];
		var theDay = tiddler[field].convertToLocalYYYYMMDDHHMM().substr(0,8);
		if(theDay != lastDay) {
			var ul = document.createElement("ul");
			place.appendChild(ul);
			createTiddlyElement(ul,"li",null,"listTitle",tiddler[field].formatString(dateFormat));
			lastDay = theDay;
		}
		createTiddlyElement(ul,"li",null,"listLink").appendChild(createTiddlyLink(place,tiddler.title,true));
	}
};

config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("name",null,true,false,true);
	var names = params[0]["name"];
	var tiddlerName = names[0];
	var className = names[1] || null;
	var args = params[0]["with"];
	var wrapper = createTiddlyElement(place,"span",null,className);
	if(!args) {
		wrapper.setAttribute("refresh","content");
		wrapper.setAttribute("tiddler",tiddlerName);
	}
	var text = store.getTiddlerText(tiddlerName);
	if(text) {
		var stack = config.macros.tiddler.tiddlerStack;
		if(stack.indexOf(tiddlerName) !== -1)
			return;
		stack.push(tiddlerName);
		try {
			var n = args ? Math.min(args.length,9) : 0;
			for(var i=0; i<n; i++) {
				var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
				text = text.replace(placeholderRE,args[i]);
			}
			config.macros.tiddler.renderText(wrapper,text,tiddlerName,params);
		} finally {
			stack.pop();
		}
	}
};

config.macros.tiddler.renderText = function(place,text,tiddlerName,params)
{
	wikify(text,place,null,store.getTiddler(tiddlerName));
};

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
	createTagButton(place,params[0],null,params[1],params[2]);
};

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title && store.tiddlerExists(title))
		tiddler = store.getTiddler(title);
	var sep = getParam(params,"sep"," ");
	var lingo = config.views.wikified.tag;
	var prompt = tiddler.tags.length == 0 ? lingo.labelNoTags : lingo.labelTags;
	createTiddlyElement(ul,"li",null,"listTitle",prompt.format([tiddler.title]));
	for(var t=0; t<tiddler.tags.length; t++) {
		createTagButton(createTiddlyElement(ul,"li"),tiddler.tags[t],tiddler.title);
		if(t<tiddler.tags.length-1)
			createTiddlyText(ul,sep);
	}
};

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title == "" && tiddler instanceof Tiddler)
		title = tiddler.title;
	var sep = getParam(params,"sep"," ");
	ul.setAttribute("title",this.tooltip.format([title]));
	var tagged = store.getTaggedTiddlers(title);
	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
	createTiddlyElement(ul,"li",null,"listTitle",prompt.format([title,tagged.length]));
	for(var t=0; t<tagged.length; t++) {
		createTiddlyLink(createTiddlyElement(ul,"li"),tagged[t].title,true);
		if(t<tagged.length-1)
			createTiddlyText(ul,sep);
	}
};

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.closeAll.onClick = function(e)
{
	story.closeAllTiddlers();
	return false;
};

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.permaview.onClick = function(e)
{
	story.permaView();
	return false;
};

config.macros.saveChanges.handler = function(place,macroName,params)
{
	if(!readOnly)
		createTiddlyButton(place,params[0] || this.label,params[1] || this.prompt,this.onClick,null,null,this.accessKey);
};

config.macros.saveChanges.onClick = function(e)
{
	saveChanges();
	return false;
};

config.macros.slider.onClickSlider = function(ev)
{
	var e = ev || window.event;
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(config.options.chkAnimate && anim && typeof Slider == "function")
		anim.startAnimating(new Slider(n,!isOpen,null,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOptionCookie(cookie);
	return false;
};

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
	var c = cookie || "";
	var btn = createTiddlyButton(place,title,tooltip,this.onClickSlider);
	var panel = createTiddlyElement(null,"div",null,"sliderPanel");
	panel.setAttribute("cookie",c);
	panel.style.display = config.options[c] ? "block" : "none";
	place.appendChild(panel);
	return panel;
};

config.macros.slider.handler = function(place,macroName,params)
{
	var panel = this.createSlider(place,params[0],params[2],params[3]);
	var text = store.getTiddlerText(params[1]);
	panel.setAttribute("refresh","content");
	panel.setAttribute("tiddler",params[1]);
	if(text)
		wikify(text,panel,null,store.getTiddler(params[1]));
};

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var panel = wikifier ? createTiddlyElement(place,"div",null,"gradient") : place;
	panel.style.position = "relative";
	panel.style.overflow = "hidden";
	panel.style.zIndex = "0";
	if(wikifier) {
		var styles = config.formatterHelpers.inlineCssHelper(wikifier);
		config.formatterHelpers.applyCssHelper(panel,styles);
	}
	params = paramString.parseParams("color");
	var locolors = [], hicolors = [];
	for(var t=2; t<params.length; t++) {
		var c = new RGB(params[t].value);
		if(params[t].name == "snap") {
			hicolors[hicolors.length-1] = c;
		} else {
			locolors.push(c);
			hicolors.push(c);
		}
	}
	drawGradient(panel,params[1].value != "vert",locolors,hicolors);
	if(wikifier)
		wikifier.subWikify(panel,">>");
	if(document.all) {
		panel.style.height = "100%";
		panel.style.width = "100%";
	}
};

config.macros.message.handler = function(place,macroName,params)
{
	if(params[0]) {
		var names = params[0].split(".");
		var lookupMessage = function(root,nameIndex) {
				if(names[nameIndex] in root) {
					if(nameIndex < names.length-1)
						return (lookupMessage(root[names[nameIndex]],nameIndex+1));
					else
						return root[names[nameIndex]];
				} else
					return null;
			};
		var m = lookupMessage(config,0);
		if(m == null)
			m = lookupMessage(window,0);
		createTiddlyText(place,m.toString().format(params.splice(1)));
	}
};


config.macros.view.views = {
	text: function(value,place,params,wikifier,paramString,tiddler) {
		highlightify(value,place,highlightHack,tiddler);
	},
	link: function(value,place,params,wikifier,paramString,tiddler) {
		createTiddlyLink(place,value,true);
	},
	wikified: function(value,place,params,wikifier,paramString,tiddler) {
		if(params[2])
			value=params[2].unescapeLineBreaks().format([value]);
		wikify(value,place,highlightHack,tiddler);
	},
	date: function(value,place,params,wikifier,paramString,tiddler) {
		value = Date.convertFromYYYYMMDDHHMM(value);
		createTiddlyText(place,value.formatString(params[2] ? params[2] : config.views.wikified.dateFormat));
	}
};

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if((tiddler instanceof Tiddler) && params[0]) {
		var value = store.getValue(tiddler,params[0]);
		if(value) {
			var type = params[1] || config.macros.view.defaultView;
			var handler = config.macros.view.views[type];
			if(handler)
				handler(value,place,params,wikifier,paramString,tiddler);
		}
	}
};

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var field = params[0];
	var rows = params[1] || 0;
	var defVal = params[2] || '';
	if((tiddler instanceof Tiddler) && field) {
		story.setDirty(tiddler.title,true);
		var e,v;
		if(field != "text" && !rows) {
			e = createTiddlyElement(null,"input");
			if(tiddler.isReadOnly())
				e.setAttribute("readOnly","readOnly");
			e.setAttribute("edit",field);
			e.setAttribute("type","text");
			e.value = store.getValue(tiddler,field) || defVal;
			e.setAttribute("size","40");
			e.setAttribute("autocomplete","off");
			place.appendChild(e);
		} else {
			var wrapper1 = createTiddlyElement(null,"fieldset",null,"fieldsetFix");
			var wrapper2 = createTiddlyElement(wrapper1,"div");
			e = createTiddlyElement(wrapper2,"textarea");
			if(tiddler.isReadOnly())
				e.setAttribute("readOnly","readOnly");
			e.value = v = store.getValue(tiddler,field) || defVal;
			rows = rows || 10;
			var lines = v.match(/\n/mg);
			var maxLines = Math.max(parseInt(config.options.txtMaxEditRows),5);
			if(lines != null && lines.length > rows)
				rows = lines.length + 5;
			rows = Math.min(rows,maxLines);
			e.setAttribute("rows",rows);
			e.setAttribute("edit",field);
			place.appendChild(wrapper1);
		}
		return e;
	}
};

config.macros.tagChooser.onClick = function(ev)
{
	var e = ev || window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags("excludeLists");
	if(tags.length == 0)
		createTiddlyText(createTiddlyElement(popup,"li"),lingo.popupNone);
	for(var t=0; t<tags.length; t++) {
		var tag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
		tag.setAttribute("tag",tags[t][0]);
		tag.setAttribute("tiddler",this.getAttribute("tiddler"));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
};

config.macros.tagChooser.onTagClick = function(ev)
{
	var e = ev || window.event;
	if(e.metaKey || e.ctrlKey) stopEvent(e); //# keep popup open on CTRL-click
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(!readOnly)
		story.setTiddlerTag(title,tag,0);
	return false;
};

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(tiddler instanceof Tiddler) {
		var lingo = config.views.editor.tagChooser;
		var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
		btn.setAttribute("tiddler",tiddler.title);
	}
};

config.macros.refreshDisplay.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.refreshDisplay.onClick = function(e)
{
	refreshAll();
	return false;
};

config.macros.annotations.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var title = tiddler ? tiddler.title : null;
	var a = title ? config.annotations[title] : null;
	if(!tiddler || !title || !a)
		return;
	var text = a.format([title]);
	wikify(text,createTiddlyElement(place,"div",null,"annotation"),null,tiddler);
};

//--
//-- NewTiddler and NewJournal macros
//--

config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)
{
	var tags = [];
	for(var t=1; t<params.length; t++) {
		if((params[t].name == "anon" && t != 1) || (params[t].name == "tag"))
			tags.push(params[t].value);
	}
	label = getParam(params,"label",label);
	prompt = getParam(params,"prompt",prompt);
	accessKey = getParam(params,"accessKey",accessKey);
	newFocus = getParam(params,"focus",newFocus);
	var customFields = getParam(params,"fields","");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);
	btn.setAttribute("newTitle",title);
	btn.setAttribute("isJournal",isJournal ? "true" : "false");
	if(tags.length > 0)
		btn.setAttribute("params",tags.join("|"));
	btn.setAttribute("newFocus",newFocus);
	btn.setAttribute("newTemplate",getParam(params,"template",DEFAULT_EDIT_TEMPLATE));
	if(customFields !== "")
		btn.setAttribute("customFields",customFields);
	var text = getParam(params,"text");
	if(text !== undefined)
		btn.setAttribute("newText",text);
	return btn;
};

config.macros.newTiddler.onClickNewTiddler = function()
{
	var title = this.getAttribute("newTitle");
	if(this.getAttribute("isJournal") == "true") {
		title = new Date().formatString(title.trim());
	}
	var params = this.getAttribute("params");
	var tags = params ? params.split("|") : [];
	var focus = this.getAttribute("newFocus");
	var template = this.getAttribute("newTemplate");
	var customFields = this.getAttribute("customFields");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	story.displayTiddler(null,title,template,false,null,null);
	var tiddlerElem = story.getTiddler(title);
	if(customFields)
		story.addCustomFields(tiddlerElem,customFields);
	var text = this.getAttribute("newText");
	if(typeof text == "string")
		story.getTiddlerField(title,"text").value = text.format([title]);
	for(var t=0;t<tags.length;t++)
		story.setTiddlerTag(title,tags[t],+1);
	story.focusTiddler(title,focus);
	return false;
};

config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
		title = getParam(params,"title",title);
		this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"title",false);
	}
};

config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : config.macros.timeline.dateFormat;
		title = getParam(params,"title",title);
		config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"text",true);
	}
};

//--
//-- Search macro
//--

config.macros.search.handler = function(place,macroName,params)
{
	var searchTimeout = null;
	var btn = createTiddlyButton(place,this.label,this.prompt,this.onClick,"searchButton");
	var txt = createTiddlyElement(place,"input",null,"txtOptionInput searchField");
	if(params[0])
		txt.value = params[0];
	txt.onkeyup = this.onKeyPress;
	txt.onfocus = this.onFocus;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("accessKey",this.accessKey);
	txt.setAttribute("autocomplete","off");
	txt.setAttribute("lastSearchText","");
	if(config.browser.isSafari) {
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
	} else {
		txt.setAttribute("type","text");
	}
};

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
	if(txt.value.length > 0) {
		story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
		txt.setAttribute("lastSearchText",txt.value);
	}
};

config.macros.search.onClick = function(e)
{
	config.macros.search.doSearch(this.nextSibling);
	return false;
};

config.macros.search.onKeyPress = function(ev)
{
	var e = ev || window.event;
	switch(e.keyCode) {
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
			config.macros.search.doSearch(this);
			break;
		case 27: // Escape
			this.value = "";
			clearMessage();
			break;
	}
	if(config.options.chkIncrementalSearch) {
		if(this.value.length > 2) {
			if(this.value != this.getAttribute("lastSearchText")) {
				if(config.macros.search.timeout)
					clearTimeout(config.macros.search.timeout);
				var txt = this;
				config.macros.search.timeout = setTimeout(function() {config.macros.search.doSearch(txt);},500);
			}
		} else {
			if(config.macros.search.timeout)
				clearTimeout(config.macros.search.timeout);
		}
	}
};

config.macros.search.onFocus = function(e)
{
	this.select();
};

//--
//-- Tabs macro
//--

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(null,"div",null,"tabsetWrapper " + cookie);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset");
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	for(var t=0; t<numTabs; t++) {
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
	}
	if(!validTab)
		config.options[cookie] = params[1];
	place.appendChild(wrapper);
	this.switchTab(tabset,config.options[cookie]);
};

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
	return false;
};

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null;
	var nodes = tabset.childNodes;
	for(var t=0; t<nodes.length; t++) {
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab) {
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
		} else {
			nodes[t].className = "tab tabUnselected";
		}
	}
	if(theTab) {
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			removeNode(tabset.nextSibling);
		var tabContent = createTiddlyElement(null,"div",null,"tabContents");
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		var contentTitle = theTab.getAttribute("content");
		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
		if(cookie) {
			config.options[cookie] = tab;
			saveOptionCookie(cookie);
		}
	}
};

//--
//-- Tiddler toolbar
//--

// Create a toolbar command button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,className)
{
	if(typeof commandName != "string") {
		var c = null;
		for(var t in config.commands) {
			if(config.commands[t] == commandName)
				c = t;
		}
		commandName = c;
	}
	if((tiddler instanceof Tiddler) && (typeof commandName == "string")) {
		var command = config.commands[commandName];
		if(command.isEnabled ? command.isEnabled(tiddler) : this.isCommandEnabled(command,tiddler)) {
			var text = command.getText ? command.getText(tiddler) : this.getCommandText(command,tiddler);
			var tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command,tiddler);
			var cmd;
			switch(command.type) {
			case "popup":
				cmd = this.onClickPopup;
				break;
			case "command":
			default:
				cmd = this.onClickCommand;
				break;
			}
			var btn = createTiddlyButton(null,text,tooltip,cmd);
			btn.setAttribute("commandName",commandName);
			btn.setAttribute("tiddler",tiddler.title);
			if(className)
				addClass(btn,className);
			place.appendChild(btn);
		}
	}
};

config.macros.toolbar.isCommandEnabled = function(command,tiddler)
{
	var title = tiddler.title;
	var ro = tiddler.isReadOnly();
	var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
	return (!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow);
};

config.macros.toolbar.getCommandText = function(command,tiddler)
{
	return tiddler.isReadOnly() && command.readOnlyText || command.text;
};

config.macros.toolbar.getCommandTooltip = function(command,tiddler)
{
	return tiddler.isReadOnly() && command.readOnlyTooltip || command.tooltip;
};

config.macros.toolbar.onClickCommand = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var command = config.commands[this.getAttribute("commandName")];
	return command.handler(e,this,this.getAttribute("tiddler"));
};

config.macros.toolbar.onClickPopup = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var popup = Popup.create(this);
	var command = config.commands[this.getAttribute("commandName")];
	var title = this.getAttribute("tiddler");
	var tiddler = store.fetchTiddler(title);
	popup.setAttribute("tiddler",title);
	command.handlePopup(popup,title);
	Popup.show();
	return false;
};

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,className,event)
{
	var children = place.getElementsByTagName("a");
	for(var t=0; t<children.length; t++) {
		var c = children[t];
		if(hasClass(c,className) && c.getAttribute && c.getAttribute("commandName")) {
			if(c.onclick instanceof Function)
				c.onclick.call(c,event);
			break;
		}
	}
};

config.macros.toolbar.onClickMore = function(ev)
{
	var e = this.nextSibling;
	e.style.display = "inline";
	removeNode(this);
	return false;
};

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	for(var t=0; t<params.length; t++) {
		var c = params[t];
		switch(c) {
		case '>':
			var btn = createTiddlyButton(place,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore);
			addClass(btn,"moreCommand");
			var e = createTiddlyElement(place,"span",null,"moreCommand");
			e.style.display = "none";
			place = e;
			break;
		default:
			var className = "";
			switch(c.substr(0,1)) {
			case "+":
				className = "defaultCommand";
				c = c.substr(1);
				break;
			case "-":
				className = "cancelCommand";
				c = c.substr(1);
				break;
			}
			if(c in config.commands)
				this.createCommand(place,c,tiddler,className);
			break;
		}
	}
};

//--
//-- Menu and toolbar commands
//--

config.commands.closeTiddler.handler = function(event,src,title)
{
	if(story.isDirty(title) && !readOnly) {
		if(!confirm(config.commands.cancelTiddler.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.closeTiddler(title,true);
	return false;
};

config.commands.closeOthers.handler = function(event,src,title)
{
	story.closeAllTiddlers(title);
	return false;
};

config.commands.editTiddler.handler = function(event,src,title)
{
	clearMessage();
	var tiddlerElem = story.getTiddler(title);
	var fields = tiddlerElem.getAttribute("tiddlyFields");
	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,fields);
	story.focusTiddler(title,config.options.txtEditorFocus||"text");
	return false;
};

config.commands.saveTiddler.handler = function(event,src,title)
{
	var newTitle = story.saveTiddler(title,event.shiftKey);
	if(newTitle)
		story.displayTiddler(null,newTitle);
	return false;
};

config.commands.cancelTiddler.handler = function(event,src,title)
{
	if(story.hasChanges(title) && !readOnly) {
		if(!confirm(this.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.displayTiddler(null,title);
	return false;
};

config.commands.deleteTiddler.handler = function(event,src,title)
{
	var deleteIt = true;
	if(config.options.chkConfirmDelete)
		deleteIt = confirm(this.warning.format([title]));
	if(deleteIt) {
		store.removeTiddler(title);
		story.closeTiddler(title,true);
		autoSaveChanges();
	}
	return false;
};

config.commands.permalink.handler = function(event,src,title)
{
	var t = encodeURIComponent(String.encodeTiddlyLink(title));
	if(window.location.hash != t)
		window.location.hash = t;
	return false;
};

config.commands.references.handlePopup = function(popup,title)
{
	var references = store.getReferringTiddlers(title);
	var c = false;
	for(var r=0; r<references.length; r++) {
		if(references[r].title != title && !references[r].isTagged("excludeLists")) {
			createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
			c = true;
		}
	}
	if(!c)
		createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),this.popupNone);
};

config.commands.jump.handlePopup = function(popup,title)
{
	story.forEachTiddler(function(title,element) {
		createTiddlyLink(createTiddlyElement(popup,"li"),title,true,null,false,null,true);
		});
};

config.commands.syncing.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var serverType = tiddler.getServerType();
	var serverHost = tiddler.fields['server.host'];
	var serverWorkspace = tiddler.fields['server.workspace'];
	if(!serverWorkspace)
		serverWorkspace = "";
	if(serverType) {
		var e = createTiddlyElement(popup,"li",null,"popupMessage");
		e.innerHTML = config.commands.syncing.currentlySyncing.format([serverType,serverHost,serverWorkspace]);
	} else {
		createTiddlyElement(popup,"li",null,"popupMessage",config.commands.syncing.notCurrentlySyncing);
	}
	if(serverType) {
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var btn = createTiddlyButton(createTiddlyElement(popup,"li"),this.captionUnSync,null,config.commands.syncing.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type","");
	}
	createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
	createTiddlyElement(popup,"li",null,"popupMessage",config.commands.syncing.chooseServer);
	var feeds = store.getTaggedTiddlers("systemServer","title");
	for(var t=0; t<feeds.length; t++) {
		var f = feeds[t];
		var feedServerType = store.getTiddlerSlice(f.title,"Type");
		if(!feedServerType)
			feedServerType = "file";
		var feedServerHost = store.getTiddlerSlice(f.title,"URL");
		if(!feedServerHost)
			feedServerHost = "";
		var feedServerWorkspace = store.getTiddlerSlice(f.title,"Workspace");
		if(!feedServerWorkspace)
			feedServerWorkspace = "";
		var caption = f.title;
		if(serverType == feedServerType && serverHost == feedServerHost && serverWorkspace == feedServerWorkspace) {
			caption = config.commands.syncing.currServerMarker + caption;
		} else {
			caption = config.commands.syncing.notCurrServerMarker + caption;
		}
		btn = createTiddlyButton(createTiddlyElement(popup,"li"),caption,null,config.commands.syncing.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type",feedServerType);
		btn.setAttribute("server.host",feedServerHost);
		btn.setAttribute("server.workspace",feedServerWorkspace);
	}
};

config.commands.syncing.onChooseServer = function(e)
{
	var tiddler = this.getAttribute("tiddler");
	var serverType = this.getAttribute("server.type");
	if(serverType) {
		store.addTiddlerFields(tiddler,{
			"server.type": serverType,
			"server.host": this.getAttribute("server.host"),
			"server.workspace": this.getAttribute("server.workspace")
			});
	} else {
		store.setValue(tiddler,"server",null);
	}
	return false;
};

config.commands.fields.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var fields = {};
	store.forEachField(tiddler,function(tiddler,fieldName,value) {fields[fieldName] = value;},true);
	var items = [];
	for(var t in fields) {
		items.push({field: t,value: fields[t]});
	}
	items.sort(function(a,b) {return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1);});
	if(items.length > 0)
		ListView.create(popup,items,this.listViewTemplate);
	else
		createTiddlyElement(popup,"div",null,null,this.emptyText);
};

//--
//-- Tiddler() object
//--

function Tiddler(title)
{
	this.title = title;
	this.text = "";
	this.modifier = null;
	this.created = new Date();
	this.modified = this.created;
	this.links = [];
	this.linksUpdated = false;
	this.tags = [];
	this.fields = {};
	return this;
}

Tiddler.prototype.getLinks = function()
{
	if(this.linksUpdated==false)
		this.changed();
	return this.links;
};

// Returns the fields that are inherited in string field:"value" field2:"value2" format
Tiddler.prototype.getInheritedFields = function()
{
	var f = {};
	for(var i in this.fields) {
		if(i=="server.host" || i=="server.workspace" || i=="wikiformat"|| i=="server.type") {
			f[i] = this.fields[i];
		}
	}
	return String.encodeHashMap(f);
};

// Increment the changeCount of a tiddler
Tiddler.prototype.incChangeCount = function()
{
	var c = this.fields['changecount'];
	c = c ? parseInt(c,10) : 0;
	this.fields['changecount'] = String(c+1);
};

// Clear the changeCount of a tiddler
Tiddler.prototype.clearChangeCount = function()
{
	if(this.fields['changecount']) {
		delete this.fields['changecount'];
	}
};

Tiddler.prototype.doNotSave = function()
{
	return this.fields['doNotSave'];
};

// Returns true if the tiddler has been updated since the tiddler was created or downloaded
Tiddler.prototype.isTouched = function()
{
	var changeCount = this.fields['changecount'];
	if(changeCount === undefined)
		changeCount = 0;
	return changeCount > 0;
};

// Return the tiddler as an RSS item
Tiddler.prototype.toRssItem = function(uri)
{
	var s = [];
	s.push("<title" + ">" + this.title.htmlEncode() + "</title" + ">");
	s.push("<description>" + wikifyStatic(this.text,null,this).htmlEncode() + "</description>");
	for(var t=0; t<this.tags.length; t++)
		s.push("<category>" + this.tags[t] + "</category>");
	s.push("<link>" + uri + "#" + encodeURIComponent(String.encodeTiddlyLink(this.title)) + "</link>");
	s.push("<pubDate>" + this.modified.toGMTString() + "</pubDate>");
	return s.join("\n");
};

// Format the text for storage in an RSS item
Tiddler.prototype.saveToRss = function(uri)
{
	return "<item>\n" + this.toRssItem(uri) + "\n</item>";
};

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields)
{
	this.assign(title,text,modifier,modified,tags,created,fields);
	this.changed();
	return this;
};

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(created != undefined)
		this.created = created;
	if(fields != undefined)
		this.fields = fields;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else if(this.tags == undefined)
		this.tags = [];
	return this;
};

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	return String.encodeTiddlyLinkList(this.tags);
};

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
	return this.tags.indexOf(tag) != -1;
};

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	return text ? text.unescapeLineBreaks() : "";
};

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.escapeLineBreaks();
};

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var t = this.autoLinkWikiWords() ? 0 : 1;
	var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;
	tiddlerLinkRegExp.lastIndex = 0;
	var formatMatch = tiddlerLinkRegExp.exec(this.text);
	while(formatMatch) {
		var lastIndex = tiddlerLinkRegExp.lastIndex;
		if(t==0 && formatMatch[1] && formatMatch[1] != this.title) {
			// wikiWordLink
			if(formatMatch.index > 0) {
				var preRegExp = new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
				preRegExp.lastIndex = formatMatch.index-1;
				var preMatch = preRegExp.exec(this.text);
				if(preMatch.index != formatMatch.index-1)
					this.links.pushUnique(formatMatch[1]);
			} else {
				this.links.pushUnique(formatMatch[1]);
			}
		}
		else if(formatMatch[2-t] && !config.formatterHelpers.isExternalLink(formatMatch[3-t])) // titledBrackettedLink
			this.links.pushUnique(formatMatch[3-t]);
		else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink
			this.links.pushUnique(formatMatch[4-t]);
		tiddlerLinkRegExp.lastIndex = lastIndex;
		formatMatch = tiddlerLinkRegExp.exec(this.text);
	}
	this.linksUpdated = true;
};

Tiddler.prototype.getSubtitle = function()
{
	var modifier = this.modifier;
	if(!modifier)
		modifier = config.messages.subtitleUnknown;
	var modified = this.modified;
	if(modified)
		modified = modified.toLocaleString();
	else
		modified = config.messages.subtitleUnknown;
	return config.messages.tiddlerLinkTooltip.format([this.title,modifier,modified]);
};

Tiddler.prototype.isReadOnly = function()
{
	return readOnly;
};

Tiddler.prototype.autoLinkWikiWords = function()
{
	return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
};

Tiddler.prototype.generateFingerprint = function()
{
	return "0x" + Crypto.hexSha1Str(this.text);
};

Tiddler.prototype.getServerType = function()
{
	var serverType = null;
	if(this.fields['server.type'])
		serverType = this.fields['server.type'];
	if(!serverType)
		serverType = this.fields['wikiformat'];
	if(serverType && !config.adaptors[serverType])
		serverType = null;
	return serverType;
};

Tiddler.prototype.getAdaptor = function()
{
	var serverType = this.getServerType();
	return serverType ? new config.adaptors[serverType]() : null;
};

//--
//-- TiddlyWiki() object contains Tiddler()s
//--

function TiddlyWiki()
{
	var tiddlers = {}; // Hashmap by name of tiddlers
	this.tiddlersUpdated = false;
	this.namedNotifications = []; // Array of {name:,notify:} of notification functions
	this.notificationLevel = 0;
	this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
	this.clear = function() {
		tiddlers = {};
		this.setDirty(false);
	};
	this.fetchTiddler = function(title) {
		var t = tiddlers[title];
		return t instanceof Tiddler ? t : null;
	};
	this.deleteTiddler = function(title) {
		delete this.slices[title];
		delete tiddlers[title];
	};
	this.addTiddler = function(tiddler) {
		delete this.slices[tiddler.title];
		tiddlers[tiddler.title] = tiddler;
	};
	this.forEachTiddler = function(callback) {
		for(var t in tiddlers) {
			var tiddler = tiddlers[t];
			if(tiddler instanceof Tiddler)
				callback.call(this,t,tiddler);
		}
	};
}

TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
};

TiddlyWiki.prototype.isDirty = function()
{
	return this.dirty;
};

TiddlyWiki.prototype.tiddlerExists = function(title)
{
	var t = this.fetchTiddler(title);
	return t != undefined;
};

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
	return typeof config.shadowTiddlers[title] == "string";
};

TiddlyWiki.prototype.createTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler) {
		tiddler = new Tiddler(title);
		this.addTiddler(tiddler);
		this.setDirty(true);
	}
	return tiddler;
};

TiddlyWiki.prototype.getTiddler = function(title)
{
	var t = this.fetchTiddler(title);
	if(t != undefined)
		return t;
	else
		return null;
};

TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	if(!title)
		return defaultText;
	var pos = title.indexOf(config.textPrimitives.sectionSeparator);
	var section = null;
	if(pos != -1) {
		section = title.substr(pos + config.textPrimitives.sectionSeparator.length);
		title = title.substr(0,pos);
	}
	pos = title.indexOf(config.textPrimitives.sliceSeparator);
	if(pos != -1) {
		var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
		if(slice)
			return slice;
	}
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		if(!section)
			return tiddler.text;
		var re = new RegExp("(^!{1,6}" + section.escapeRegExp() + "[ \t]*\n)","mg");
		re.lastIndex = 0;
		var match = re.exec(tiddler.text);
		if(match) {
			var t = tiddler.text.substr(match.index+match[1].length);
			var re2 = /^!/mg;
			re2.lastIndex = 0;
			match = re2.exec(t); //# search for the next heading
			if(match)
				t = t.substr(0,match.index-1);//# don't include final \n
			return t;
		}
		return defaultText;
	}
	if(this.isShadowTiddler(title))
		return config.shadowTiddlers[title];
	if(defaultText != undefined)
		return defaultText;
	return null;
};

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,null);
	if(text == null)
		return defaultText;
	var textOut = [];
	var lastPos = 0;
	do {
		var match = bracketRegExp.exec(text);
		if(match) {
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1]) {
				if(depth <= 0)
					textOut.push(match[1]);
				else
					textOut.push(this.getRecursiveTiddlerText(match[1],"[[" + match[1] + "]]",depth-1));
			}
			lastPos = match.index + match[0].length;
		} else {
			textOut.push(text.substr(lastPos));
		}
	} while(match);
	return textOut.join("");
};

TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1\s*([^\n]+)\s*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|\s*([^\|\n]+)\s*\|$)/gm;

// @internal
TiddlyWiki.prototype.calcAllSlices = function(title)
{
	var slices = {};
	var text = this.getTiddlerText(title,"");
	this.slicesRE.lastIndex = 0;
	var m = this.slicesRE.exec(text);
	while(m) {
		if(m[2])
			slices[m[2]] = m[3];
		else
			slices[m[5]] = m[6];
		m = this.slicesRE.exec(text);
	}
	return slices;
};

// Returns the slice of text of the given name
TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)
{
	var slices = this.slices[title];
	if(!slices) {
		slices = this.calcAllSlices(title);
		this.slices[title] = slices;
	}
	return slices[sliceName];
};

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)
{
	var r = {};
	for(var t=0; t<sliceNames.length; t++) {
		var slice = this.getTiddlerSlice(title,sliceNames[t]);
		if(slice)
			r[sliceNames[t]] = slice;
	}
	return r;
};

TiddlyWiki.prototype.suspendNotifications = function()
{
	this.notificationLevel--;
};

TiddlyWiki.prototype.resumeNotifications = function()
{
	this.notificationLevel++;
};

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	if(!this.notificationLevel) {
		for(var t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if((n.name == null && doBlanket) || (n.name == title))
				n.notify(title);
		}
	}
};

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	if(!this.notificationLevel) {
		for(var t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if(n.name)
				n.notify(n.name);
		}
	}
};

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	for(var i=0; i<this.namedNotifications.length; i++) {
		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
			return this;
	}
	this.namedNotifications.push({name: title, notify: fn});
	return this;
};

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		this.deleteTiddler(title);
		this.notify(title,true);
		this.setDirty(true);
	}
};

// Reset the sync status of a freshly synced tiddler
TiddlyWiki.prototype.resetTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		tiddler.clearChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		var t = tiddler.tags.indexOf(tag);
		if(t != -1)
			tiddler.tags.splice(t,1);
		if(status)
			tiddler.tags.push(tag);
		tiddler.changed();
		tiddler.incChangeCount(title);
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.addTiddlerFields = function(title,fields)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler)
		return;
	merge(tiddler.fields,fields);
	tiddler.changed();
	tiddler.incChangeCount(title);
	this.notify(title,true);
	this.setDirty(true);
};

TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		created = created || tiddler.created; // Preserve created date
		this.deleteTiddler(title);
	} else {
		created = created || modified;
		tiddler = new Tiddler();
	}
	tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields);
	this.addTiddler(tiddler);
	if(clearChangeCount)
		tiddler.clearChangeCount();
	else
		tiddler.incChangeCount();
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	this.setDirty(true);
	return tiddler;
};

TiddlyWiki.prototype.incChangeCount = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		tiddler.incChangeCount();
};

TiddlyWiki.prototype.getLoader = function()
{
	if(!this.loader)
		this.loader = new TW21Loader();
	return this.loader;
};

TiddlyWiki.prototype.getSaver = function()
{
	if(!this.saver)
		this.saver = new TW21Saver();
	return this.saver;
};

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
	return this.getSaver().externalize(store);
};

// Load contents of a TiddlyWiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)
{
	this.idPrefix = idPrefix;
	var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
	if(!storeElem)
		return;
	var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);
	this.setDirty(false);
	if(!noUpdate) {
		for(var i = 0;i<tiddlers.length; i++)
			tiddlers[i].changed();
	}
};

// Load contents of a TiddlyWiki from a string
// Returns null if there's an error
TiddlyWiki.prototype.importTiddlyWiki = function(text)
{
	var posDiv = locateStoreArea(text);
	if(!posDiv)
		return null;
	var content = "<" + "html><" + "body>" + text.substring(posDiv[0],posDiv[1] + endSaveArea.length) + "<" + "/body><" + "/html>";
	// Create the iframe
	var iframe = document.createElement("iframe");
	iframe.style.display = "none";
	document.body.appendChild(iframe);
	var doc = iframe.document;
	if(iframe.contentDocument)
		doc = iframe.contentDocument; // For NS6
	else if(iframe.contentWindow)
		doc = iframe.contentWindow.document; // For IE5.5 and IE6
	// Put the content in the iframe
	doc.open();
	doc.writeln(content);
	doc.close();
	// Load the content into a TiddlyWiki() object
	var storeArea = doc.getElementById("storeArea");
	this.loadFromDiv(storeArea,"store");
	// Get rid of the iframe
	iframe.parentNode.removeChild(iframe);
	return this;
};

TiddlyWiki.prototype.updateTiddlers = function()
{
	this.tiddlersUpdated = true;
	this.forEachTiddler(function(title,tiddler) {
		tiddler.changed();
	});
};

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag,match)
{
	var candidates = this.reverseLookup("tags",excludeTag,!!match);
	var results = [];
	for(var t=0; t<candidates.length; t++) {
		if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
			results.push(candidates[t]);
	}
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Returns a list of all tags in use
//   excludeTag - if present, excludes tags that are themselves tagged with excludeTag
// Returns an array of arrays where [tag][0] is the name of the tag and [tag][1] is the number of occurances
TiddlyWiki.prototype.getTags = function(excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		for(var g=0; g<tiddler.tags.length; g++) {
			var tag = tiddler.tags[g];
			var n = true;
			for(var c=0; c<results.length; c++) {
				if(results[c][0] == tag) {
					n = false;
					results[c][1]++;
				}
			}
			if(n && excludeTag) {
				var t = this.fetchTiddler(tag);
				if(t && t.isTagged(excludeTag))
					n = false;
			}
			if(n)
				results.push([tag,1]);
		}
	});
	results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});
	return results;
};

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
};

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	return this.reverseLookup("links",title,true,sortField);
};

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		var f = !lookupMatch;
		for(var lookup=0; lookup<tiddler[lookupField].length; lookup++) {
			if(tiddler[lookupField][lookup] == lookupValue)
				f = lookupMatch;
		}
		if(f)
			results.push(tiddler);
	});
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
			results.push(tiddler);
	});
	if(field)
		results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});
	return results;
};

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function(sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(tiddler.isTagged("excludeMissing") || tiddler.isTagged("systemConfig"))
			return;
		for(var n=0; n<tiddler.links.length;n++) {
			var link = tiddler.links[n];
			if(this.fetchTiddler(link) == null && !this.isShadowTiddler(link))
				results.pushUnique(link);
		}
	});
	results.sort();
	return results;
};

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
			results.push(title);
	});
	results.sort();
	return results;
};

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
	var results = [];
	for(var t in config.shadowTiddlers) {
		if(typeof config.shadowTiddlers[t] == "string")
			results.push(t);
	}
	results.sort();
	return results;
};

// Return an array of tiddlers that have been touched since they were downloaded or created
TiddlyWiki.prototype.getTouched = function()
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(tiddler.isTouched())
			results.push(tiddler);
		});
	results.sort();
	return results;
};

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler)
{
	var t = (typeof tiddler == 'string') ? this.getTiddler(tiddler) : tiddler;
	return t instanceof Tiddler ? t : null;
};

// Filter a list of tiddlers
TiddlyWiki.prototype.filterTiddlers = function(filter)
{
	var results = [];
	if(filter) {
		var tiddler;
		var re = /([^\s\[\]]+)|(?:\[([ \w]+)\[([^\]]+)\]\])|(?:\[\[([^\]]+)\]\])/mg;
		var match = re.exec(filter);
		while(match) {
			if(match[1] || match[4]) {
				var title = match[1] || match[4];
				tiddler = this.fetchTiddler(title);
				if(tiddler) {
					results.pushUnique(tiddler);
				} else if(this.isShadowTiddler(title)) {
					tiddler = new Tiddler();
					tiddler.set(title,this.getTiddlerText(title));
					results.pushUnique(tiddler);
				}
			} else if(match[2]) {
				switch(match[2]) {
					case "tag":
						var matched = this.getTaggedTiddlers(match[3]);
						for(var m = 0; m < matched.length; m++)
							results.pushUnique(matched[m]);
						break;
					case "sort":
						results = this.sortTiddlers(results,match[3]);
						break;
				}
			}
			match = re.exec(filter);
		}
	}
	return results;
};

// Sort a list of tiddlers
TiddlyWiki.prototype.sortTiddlers = function(tiddlers,field)
{
	var asc = +1;
	switch(field.substr(0,1)) {
	case "-":
		asc = -1;
		// Note: this fall-through is intentional
		/*jsl:fallthru*/
	case "+":
		field = field.substr(1);
		break;
	}
	if(TiddlyWiki.standardFieldAccess[field])
		tiddlers.sort(function(a,b) {return a[field] < b[field] ? -asc : (a[field] == b[field] ? 0 : asc);});
	else
		tiddlers.sort(function(a,b) {return a.fields[field] < b.fields[field] ? -asc : (a.fields[field] == b.fields[field] ? 0 : +asc);});
	return tiddlers;
};

// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by '.'
TiddlyWiki.isValidFieldName = function(name)
{
	var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
	return match && (match[0] == name);
};

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name)
{
	if(!TiddlyWiki.isValidFieldName(name))
		throw config.messages.invalidFieldName.format([name]);
};

function StringFieldAccess(n,readOnly)
{
	this.set = readOnly ?
			function(t,v) {if(v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);} :
			function(t,v) {if(v != t[n]) {t[n] = v; return true;}};
	this.get = function(t) {return t[n];};
}

function DateFieldAccess(n)
{
	this.set = function(t,v) {
		var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v);
		if(d != t[n]) {
			t[n] = d; return true;
		}
	};
	this.get = function(t) {return t[n].convertToYYYYMMDDHHMM();};
}

function LinksFieldAccess(n)
{
	this.set = function(t,v) {
		var s = (typeof v == "string") ? v.readBracketedList() : v;
		if(s.toString() != t[n].toString()) {
			t[n] = s; return true;
		}
	};
	this.get = function(t) {return String.encodeTiddlyLinkList(t[n]);};
}

TiddlyWiki.standardFieldAccess = {
	// The set functions return true when setting the data has changed the value.
	"title":    new StringFieldAccess("title",true),
	// Handle the "tiddler" field name as the title
	"tiddler":  new StringFieldAccess("title",true),
	"text":     new StringFieldAccess("text"),
	"modifier": new StringFieldAccess("modifier"),
	"modified": new DateFieldAccess("modified"),
	"created":  new DateFieldAccess("created"),
	"tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name)
{
	return TiddlyWiki.standardFieldAccess[name] != undefined;
};

// Sets the value of the given field of the tiddler to the value.
// Setting an ExtendedField's value to null or undefined removes the field.
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddler,fieldName,value)
{
	TiddlyWiki.checkFieldName(fieldName);
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return;
	fieldName = fieldName.toLowerCase();
	var isRemove = (value === undefined) || (value === null);
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		if(isRemove)
			// don't remove StandardFields
			return;
		var h = TiddlyWiki.standardFieldAccess[fieldName];
		if(!h.set(t,value))
			return;
	} else {
		var oldValue = t.fields[fieldName];
		if(isRemove) {
			if(oldValue !== undefined) {
				// deletes a single field
				delete t.fields[fieldName];
			} else {
				// no concrete value is defined for the fieldName
				// so we guess this is a namespace path.
				// delete all fields in a namespace
				var re = new RegExp('^'+fieldName+'\\.');
				var dirty = false;
				for(var n in t.fields) {
					if(n.match(re)) {
						delete t.fields[n];
						dirty = true;
					}
				}
				if(!dirty)
					return;
			}
		} else {
			// the "normal" set case. value is defined (not null/undefined)
			// For convenience provide a nicer conversion Date->String
			value = value instanceof Date ? value.convertToYYYYMMDDHHMMSSMMM() : String(value);
			if(oldValue == value)
				return;
			t.fields[fieldName] = value;
		}
	}
	// When we are here the tiddler/store really was changed.
	this.notify(t.title,true);
	if(!fieldName.match(/^temp\./))
		this.setDirty(true);
};

// Returns the value of the given field of the tiddler.
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddler,fieldName)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	fieldName = fieldName.toLowerCase();
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		return accessor.get(t);
	}
	return t.fields[fieldName];
};

// Calls the callback function for every field in the tiddler.
// When callback function returns a non-false value the iteration stops
// and that value is returned.
// The order of the fields is not defined.
// @param callback a function(tiddler,fieldName,value).
TiddlyWiki.prototype.forEachField = function(tiddler,callback,onlyExtendedFields)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	var n,result;
	for(n in t.fields) {
		result = callback(t,n,t.fields[n]);
		if(result)
			return result;
		}
	if(onlyExtendedFields)
		return undefined;
	for(n in TiddlyWiki.standardFieldAccess) {
		if(n == "tiddler")
			// even though the "title" field can also be referenced through the name "tiddler"
			// we only visit this field once.
			continue;
		result = callback(t,n,TiddlyWiki.standardFieldAccess[n].get(t));
		if(result)
			return result;
	}
	return undefined;
};

//--
//-- Story functions
//--

function Story(containerId,idPrefix)
{
	this.container = containerId;
	this.idPrefix = idPrefix;
	this.highlightRegExp = null;
	this.tiddlerId = function(title) {
		var id = this.idPrefix + title;
		return id==this.container ? this.idPrefix + "_" + title : id;
	};
	this.containerId = function() {
		return this.container;
	};
}

Story.prototype.getTiddler = function(title)
{
	return document.getElementById(this.tiddlerId(title));
};

Story.prototype.getContainer = function()
{
	return document.getElementById(this.containerId());
};

Story.prototype.forEachTiddler = function(fn)
{
	var place = this.getContainer();
	if(!place)
		return;
	var e = place.firstChild;
	while(e) {
		var n = e.nextSibling;
		var title = e.getAttribute("tiddler");
		fn.call(this,title,e);
		e = n;
	}
};

Story.prototype.displayDefaultTiddlers = function()
{
	this.displayTiddlers(null,store.filterTiddlers(store.getTiddlerText("DefaultTiddlers")));
};

Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,unused,customFields,toggle)
{
	for(var t = titles.length-1;t>=0;t--)
		this.displayTiddler(srcElement,titles[t],template,animate,unused,customFields);
};

Story.prototype.displayTiddler = function(srcElement,tiddler,template,animate,unused,customFields,toggle,animationSrc)
{
	var title = (tiddler instanceof Tiddler) ? tiddler.title : tiddler;
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(toggle)
			this.closeTiddler(title,true);
		else
			this.refreshTiddler(title,template,false,customFields);
	} else {
		var place = this.getContainer();
		var before = this.positionTiddler(srcElement);
		tiddlerElem = this.createTiddler(place,before,title,template,customFields);
	}
	if(animationSrc && typeof animationSrc !== "string") {
		srcElement = animationSrc;
	}
	if(srcElement && typeof srcElement !== "string") {
		if(config.options.chkAnimate && (animate == undefined || animate == true) && anim && typeof Zoomer == "function" && typeof Scroller == "function")
			anim.startAnimating(new Zoomer(title,srcElement,tiddlerElem),new Scroller(tiddlerElem));
		else
			window.scrollTo(0,ensureVisible(tiddlerElem));
	}
};

Story.prototype.positionTiddler = function(srcElement)
{
	var place = this.getContainer();
	var before = null;
	if(typeof srcElement == "string") {
		switch(srcElement) {
		case "top":
			before = place.firstChild;
			break;
		case "bottom":
			before = null;
			break;
		}
	} else {
		var after = this.findContainingTiddler(srcElement);
		if(after == null) {
			before = place.firstChild;
		} else if(after.nextSibling) {
			before = after.nextSibling;
			if(before.nodeType != 1)
				before = null;
		}
	}
	return before;
};

Story.prototype.createTiddler = function(place,before,title,template,customFields)
{
	var tiddlerElem = createTiddlyElement(null,"div",this.tiddlerId(title),"tiddler");
	tiddlerElem.setAttribute("refresh","tiddler");
	if(customFields)
		tiddlerElem.setAttribute("tiddlyFields",customFields);
	place.insertBefore(tiddlerElem,before);
	var defaultText = null;
	if(!store.tiddlerExists(title) && !store.isShadowTiddler(title))
		defaultText = this.loadMissingTiddler(title,customFields,tiddlerElem);
	this.refreshTiddler(title,template,false,customFields,defaultText);
	return tiddlerElem;
};

Story.prototype.loadMissingTiddler = function(title,fields,tiddlerElem)
{
	var tiddler = new Tiddler(title);
	tiddler.fields = typeof fields == "string" ? fields.decodeHashMap() : (fields || {});
	var serverType = tiddler.getServerType();
	var host = tiddler.fields['server.host'];
	var workspace = tiddler.fields['server.workspace'];
	if(!serverType || !host)
		return null;
	var sm = new SyncMachine(serverType,{
			start: function() {
				return this.openHost(host,"openWorkspace");
			},
			openWorkspace: function() {
				return this.openWorkspace(workspace,"getTiddler");
			},
			getTiddler: function() {
				return this.getTiddler(title,"onGetTiddler");
			},
			onGetTiddler: function(context) {
				var tiddler = context.tiddler;
				if(tiddler && tiddler.text) {
					var downloaded = new Date();
					if(!tiddler.created)
						tiddler.created = downloaded;
					if(!tiddler.modified)
						tiddler.modified = tiddler.created;
					store.saveTiddler(tiddler.title,tiddler.title,tiddler.text,tiddler.modifier,tiddler.modified,tiddler.tags,tiddler.fields,true,tiddler.created);
					autoSaveChanges();
				}
				delete this;
				return true;
			},
			error: function(message) {
				displayMessage("Error loading missing tiddler from %0: %1".format([host,message]));
			}
		});
	sm.go();
	return config.messages.loadingMissingTiddler.format([title,serverType,host,workspace]);
};

Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	if(!template)
		template = DEFAULT_VIEW_TEMPLATE;
	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
		template = config.tiddlerTemplates[template];
	return template;
};

Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
	return store.getRecursiveTiddlerText(template,null,10);
};

Story.prototype.refreshTiddler = function(title,template,force,customFields,defaultText)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(tiddlerElem.getAttribute("dirty") == "true" && !force)
			return tiddlerElem;
		template = this.chooseTemplateForTiddler(title,template);
		var currTemplate = tiddlerElem.getAttribute("template");
		if((template != currTemplate) || force) {
			var tiddler = store.getTiddler(title);
			if(!tiddler) {
				tiddler = new Tiddler();
				if(store.isShadowTiddler(title)) {
					tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,[],version.date);
				} else {
					var text = template=="EditTemplate" ?
								config.views.editor.defaultText.format([title]) :
								config.views.wikified.defaultText.format([title]);
					text = defaultText || text;
					var fields = customFields ? customFields.decodeHashMap() : null;
					tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date,fields);
				}
			}
			tiddlerElem.setAttribute("tags",tiddler.tags.join(" "));
			tiddlerElem.setAttribute("tiddler",title);
			tiddlerElem.setAttribute("template",template);
			tiddlerElem.onmouseover = this.onTiddlerMouseOver;
			tiddlerElem.onmouseout = this.onTiddlerMouseOut;
			tiddlerElem.ondblclick = this.onTiddlerDblClick;
			tiddlerElem[window.event?"onkeydown":"onkeypress"] = this.onTiddlerKeyPress;
			tiddlerElem.innerHTML = this.getTemplateForTiddler(title,template,tiddler);
			applyHtmlMacros(tiddlerElem,tiddler);
			if(store.getTaggedTiddlers(title).length > 0)
				addClass(tiddlerElem,"isTag");
			else
				removeClass(tiddlerElem,"isTag");
			if(store.tiddlerExists(title)) {
				removeClass(tiddlerElem,"shadow");
				removeClass(tiddlerElem,"missing");
			} else {
				addClass(tiddlerElem,store.isShadowTiddler(title) ? "shadow" : "missing");
			}
			if(customFields)
				this.addCustomFields(tiddlerElem,customFields);
			forceReflow();
		}
	}
	return tiddlerElem;
};

Story.prototype.addCustomFields = function(place,customFields)
{
	var fields = customFields.decodeHashMap();
	var w = document.createElement("div");
	w.style.display = "none";
	place.appendChild(w);
	for(var t in fields) {
		var e = document.createElement("input");
		e.setAttribute("type","text");
		e.setAttribute("value",fields[t]);
		w.appendChild(e);
		e.setAttribute("edit",t);
	}
};

Story.prototype.refreshAllTiddlers = function(force)
{
	var e = this.getContainer().firstChild;
	while(e) {
		var template = e.getAttribute("template");
		if(template && e.getAttribute("dirty") != "true") {
			this.refreshTiddler(e.getAttribute("tiddler"),force ? null : template,true);
		}
		e = e.nextSibling;
	}
};

Story.prototype.onTiddlerMouseOver = function(e)
{
	if(window.addClass instanceof Function)
		addClass(this,"selected");
};

Story.prototype.onTiddlerMouseOut = function(e)
{
	if(window.removeClass instanceof Function)
		removeClass(this,"selected");
};

Story.prototype.onTiddlerDblClick = function(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	if(target && target.nodeName.toLowerCase() != "input" && target.nodeName.toLowerCase() != "textarea") {
		if(document.selection && document.selection.empty)
			document.selection.empty();
		config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
		e.cancelBubble = true;
		if(e.stopPropagation) e.stopPropagation();
		return true;
	}
	return false;
};

Story.prototype.onTiddlerKeyPress = function(ev)
{
	var e = ev || window.event;
	clearMessage();
	var consume = false;
	var title = this.getAttribute("tiddler");
	var target = resolveTarget(e);
	switch(e.keyCode) {
	case 9: // Tab
		if(config.options.chkInsertTabs && target.tagName.toLowerCase() == "textarea") {
			replaceSelection(target,String.fromCharCode(9));
			consume = true;
		}
		if(config.isOpera) {
			target.onblur = function() {
				this.focus();
				this.onblur = null;
			};
		}
		break;
	case 13: // Ctrl-Enter
	case 10: // Ctrl-Enter on IE PC
	case 77: // Ctrl-Enter is "M" on some platforms
		if(e.ctrlKey) {
			blurElement(this);
			config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
			consume = true;
		}
		break;
	case 27: // Escape
		blurElement(this);
		config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
		consume = true;
		break;
	}
	e.cancelBubble = consume;
	if(consume) {
		if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
		e.returnValue = true; // Cancel The Event in IE
		if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz
	}
	return !consume;
};

Story.prototype.getTiddlerField = function(title,field)
{
	var tiddlerElem = this.getTiddler(title);
	var e = null;
	if(tiddlerElem ) {
		var children = tiddlerElem.getElementsByTagName("*");
		for(var t=0; t<children.length; t++) {
			var c = children[t];
			if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea") {
				if(!e)
					e = c;
				if(c.getAttribute("edit") == field)
					e = c;
			}
		}
	}
	return e;
};

Story.prototype.focusTiddler = function(title,field)
{
	var e = this.getTiddlerField(title,field);
	if(e) {
		e.focus();
		e.select();
	}
};

Story.prototype.blurTiddler = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem && tiddlerElem.focus && tiddlerElem.blur) {
		tiddlerElem.focus();
		tiddlerElem.blur();
	}
};

Story.prototype.setTiddlerField = function(title,tag,mode,field)
{
	var c = this.getTiddlerField(title,field);
	var tags = c.value.readBracketedList();
	tags.setItem(tag,mode);
	c.value = String.encodeTiddlyLinkList(tags);
};

Story.prototype.setTiddlerTag = function(title,tag,mode)
{
	this.setTiddlerField(title,tag,mode,"tags");
};

Story.prototype.closeTiddler = function(title,animate,unused)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		clearMessage();
		this.scrubTiddler(tiddlerElem);
		if(config.options.chkAnimate && animate && anim && typeof Slider == "function")
			anim.startAnimating(new Slider(tiddlerElem,false,null,"all"));
		else {
			removeNode(tiddlerElem);
			forceReflow();
		}
	}
};

Story.prototype.scrubTiddler = function(tiddlerElem)
{
	tiddlerElem.id = null;
};

Story.prototype.setDirty = function(title,dirty)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		tiddlerElem.setAttribute("dirty",dirty ? "true" : "false");
};

Story.prototype.isDirty = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		return tiddlerElem.getAttribute("dirty") == "true";
	return null;
};

Story.prototype.areAnyDirty = function()
{
	var r = false;
	this.forEachTiddler(function(title,element) {
		if(this.isDirty(title))
			r = true;
	});
	return r;
};

Story.prototype.closeAllTiddlers = function(exclude)
{
	clearMessage();
	this.forEachTiddler(function(title,element) {
		if((title != exclude) && element.getAttribute("dirty") != "true")
			this.closeTiddler(title);
	});
	window.scrollTo(0,ensureVisible(this.container));
};

Story.prototype.isEmpty = function()
{
	var place = this.getContainer();
	return place && place.firstChild == null;
};

Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
	this.closeAllTiddlers();
	highlightHack = new RegExp(useRegExp ? text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
	var matches = store.search(highlightHack,"title","excludeSearch");
	this.displayTiddlers(null,matches);
	highlightHack = null;
	var q = useRegExp ? "/" : "'";
	if(matches.length > 0)
		displayMessage(config.macros.search.successMsg.format([matches.length.toString(),q + text + q]));
	else
		displayMessage(config.macros.search.failureMsg.format([q + text + q]));
};

Story.prototype.findContainingTiddler = function(e)
{
	while(e && !hasClass(e,"tiddler"))
		e = e.parentNode;
	return e;
};

Story.prototype.gatherSaveFields = function(e,fields)
{
	if(e && e.getAttribute) {
		var f = e.getAttribute("edit");
		if(f)
			fields[f] = e.value.replace(/\r/mg,"");
		if(e.hasChildNodes()) {
			var c = e.childNodes;
			for(var t=0; t<c.length; t++)
				this.gatherSaveFields(c[t],fields);
		}
	}
};

Story.prototype.hasChanges = function(title)
{
	var e = this.getTiddler(title);
	if(e) {
		var fields = {};
		this.gatherSaveFields(e,fields);
		var tiddler = store.fetchTiddler(title);
		if(!tiddler)
			return false;
		for(var n in fields) {
			if(store.getValue(title,n) != fields[n])
				return true;
		}
	}
	return false;
};

Story.prototype.saveTiddler = function(title,minorUpdate)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		var fields = {};
		this.gatherSaveFields(tiddlerElem,fields);
		var newTitle = fields.title || title;
		if(!store.tiddlerExists(newTitle))
			newTitle = newTitle.trim();
		if(store.tiddlerExists(newTitle) && newTitle != title) {
			if(!confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
				return null;
		}
		if(newTitle != title)
			this.closeTiddler(newTitle,false);
		tiddlerElem.id = this.tiddlerId(newTitle);
		tiddlerElem.setAttribute("tiddler",newTitle);
		tiddlerElem.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
		tiddlerElem.setAttribute("dirty","false");
		if(config.options.chkForceMinorUpdate)
			minorUpdate = !minorUpdate;
		if(!store.tiddlerExists(newTitle))
			minorUpdate = false;
		var newDate = new Date();
		var extendedFields = store.tiddlerExists(newTitle) ? store.fetchTiddler(newTitle).fields : (newTitle!=title && store.tiddlerExists(title) ? store.fetchTiddler(title).fields : config.defaultCustomFields);
		for(var n in fields) {
			if(!TiddlyWiki.isStandardField(n))
				extendedFields[n] = fields[n];
		}
		var tiddler = store.saveTiddler(title,newTitle,fields.text,minorUpdate ? undefined : config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags,extendedFields);
		autoSaveChanges(null,[tiddler]);
		return newTitle;
	}
	return null;
};

Story.prototype.permaView = function()
{
	var links = [];
	this.forEachTiddler(function(title,element) {
		links.push(String.encodeTiddlyLink(title));
	});
	var t = encodeURIComponent(links.join(" "));
	if(t == "")
		t = "#";
	if(window.location.hash != t)
		window.location.hash = t;
};

Story.prototype.switchTheme = function(theme)
{
	if(safeMode)
		return;

	var isAvailable = function(title) {
		var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
		if(s!=-1)
			title = title.substr(0,s);
		return store.tiddlerExists(title) || store.isShadowTiddler(title);
	};

	var getSlice = function(theme,slice) {
		var r;
		if(readOnly)
			r = store.getTiddlerSlice(theme,slice+"ReadOnly") || store.getTiddlerSlice(theme,"Web"+slice);
		r = r || store.getTiddlerSlice(theme,slice);
		if(r && r.indexOf(config.textPrimitives.sectionSeparator)==0)
			r = theme + r;
		return isAvailable(r) ? r : slice;
	};

	var replaceNotification = function(i,name,theme,slice) {
		var newName = getSlice(theme,slice);
		if(name!=newName && store.namedNotifications[i].name==name) {
			store.namedNotifications[i].name = newName;
			return newName;
		}
		return name;
	};

	var pt = config.refresherData.pageTemplate;
	var vi = DEFAULT_VIEW_TEMPLATE;
	var vt = config.tiddlerTemplates[vi];
	var ei = DEFAULT_EDIT_TEMPLATE;
	var et = config.tiddlerTemplates[ei];

	for(var i=0; i<config.notifyTiddlers.length; i++) {
		var name = config.notifyTiddlers[i].name;
		switch(name) {
		case "PageTemplate":
			config.refresherData.pageTemplate = replaceNotification(i,config.refresherData.pageTemplate,theme,name);
			break;
		case "StyleSheet":
			removeStyleSheet(config.refresherData.styleSheet);
			config.refresherData.styleSheet = replaceNotification(i,config.refresherData.styleSheet,theme,name);
			break;
		case "ColorPalette":
			config.refresherData.colorPalette = replaceNotification(i,config.refresherData.colorPalette,theme,name);
			break;
		default:
			break;
		}
	}
	config.tiddlerTemplates[vi] = getSlice(theme,"ViewTemplate");
	config.tiddlerTemplates[ei] = getSlice(theme,"EditTemplate");
	if(!startingUp) {
		if(config.refresherData.pageTemplate!=pt || config.tiddlerTemplates[vi]!=vt || config.tiddlerTemplates[ei]!=et) {
			refreshAll();
			this.refreshAllTiddlers(true);
		} else {
			setStylesheet(store.getRecursiveTiddlerText(config.refresherData.styleSheet,"",10),config.refreshers.styleSheet);
		}
		config.options.txtTheme = theme;
		saveOptionCookie("txtTheme");
	}
};

//--
//-- Backstage
//--

var backstage = {
	area: null,
	toolbar: null,
	button: null,
	showButton: null,
	hideButton: null,
	cloak: null,
	panel: null,
	panelBody: null,
	panelFooter: null,
	currTabName: null,
	currTabElem: null,
	content: null,

	init: function() {
		var cmb = config.messages.backstage;
		this.area = document.getElementById("backstageArea");
		this.toolbar = document.getElementById("backstageToolbar");
		this.button = document.getElementById("backstageButton");
		this.button.style.display = "block";
		var t = cmb.open.text + " " + glyph("bentArrowLeft");
		this.showButton = createTiddlyButton(this.button,t,cmb.open.tooltip,
						function(e) {backstage.show(); return false;},null,"backstageShow");
		t = glyph("bentArrowRight") + " " + cmb.close.text;
		this.hideButton = createTiddlyButton(this.button,t,cmb.close.tooltip,
						function(e) {backstage.hide(); return false;},null,"backstageHide");
		this.cloak = document.getElementById("backstageCloak");
		this.panel = document.getElementById("backstagePanel");
		this.panelFooter = createTiddlyElement(this.panel,"div",null,"backstagePanelFooter");
		this.panelBody = createTiddlyElement(this.panel,"div",null,"backstagePanelBody");
		this.cloak.onmousedown = function(e) {backstage.switchTab(null);};
		createTiddlyText(this.toolbar,cmb.prompt);
		for(t=0; t<config.backstageTasks.length; t++) {
			var taskName = config.backstageTasks[t];
			var task = config.tasks[taskName];
			var handler = task.action ? this.onClickCommand : this.onClickTab;
			var text = task.text + (task.action ? "" : glyph("downTriangle"));
			var btn = createTiddlyButton(this.toolbar,text,task.tooltip,handler,"backstageTab");
			btn.setAttribute("task",taskName);
			addClass(btn,task.action ? "backstageAction" : "backstageTask");
			}
		this.content = document.getElementById("contentWrapper");
		if(config.options.chkBackstage)
			this.show();
		else
			this.hide();
	},

	isVisible: function() {
		return this.area ? this.area.style.display == "block" : false;
	},

	show: function() {
		this.area.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.toolbar.style.left = findWindowWidth() + "px";
			var p = [{style: "left", start: findWindowWidth(), end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p));
		} else {
			backstage.area.style.left = "0px";
		}
		this.showButton.style.display = "none";
		this.hideButton.style.display = "block";
		config.options.chkBackstage = true;
		saveOptionCookie("chkBackstage");
		addClass(this.content,"backstageVisible");
	},

	hide: function() {
		if(this.currTabElem) {
			this.switchTab(null);
		} else {
			backstage.toolbar.style.left = "0px";
			if(anim && config.options.chkAnimate) {
				var p = [{style: "left", start: 0, end: findWindowWidth(), template: "%0px"}];
				var c = function(element,properties) {backstage.area.style.display = "none";};
				anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p,c));
			} else {
				this.area.style.display = "none";
			}
			this.showButton.style.display = "block";
			this.hideButton.style.display = "none";
			config.options.chkBackstage = false;
			saveOptionCookie("chkBackstage");
			removeClass(this.content,"backstageVisible");
		}
	},

	onClickCommand: function(e) {
		var task = config.tasks[this.getAttribute("task")];
		displayMessage(task);
		if(task.action) {
			backstage.switchTab(null);
			task.action();
		}
		return false;
	},

	onClickTab: function(e) {
		backstage.switchTab(this.getAttribute("task"));
		return false;
	},

	// Switch to a given tab, or none if null is passed
	switchTab: function(tabName) {
		var tabElem = null;
		var e = this.toolbar.firstChild;
		while(e)
			{
			if(e.getAttribute && e.getAttribute("task") == tabName)
				tabElem = e;
			e = e.nextSibling;
			}
		if(tabName == backstage.currTabName)
			return;
		if(backstage.currTabElem) {
			removeClass(this.currTabElem,"backstageSelTab");
		}
		if(tabElem && tabName) {
			backstage.preparePanel();
			addClass(tabElem,"backstageSelTab");
			var task = config.tasks[tabName];
			wikify(task.content,backstage.panelBody,null,null);
			backstage.showPanel();
		} else if(backstage.currTabElem) {
			backstage.hidePanel();
		}
		backstage.currTabName = tabName;
		backstage.currTabElem = tabElem;
	},

	isPanelVisible: function() {
		return backstage.panel ? backstage.panel.style.display == "block" : false;
	},

	preparePanel: function() {
		backstage.cloak.style.height = findWindowHeight() + "px";
		backstage.cloak.style.display = "block";
		removeChildren(backstage.panelBody);
		return backstage.panelBody;
	},

	showPanel: function() {
		backstage.panel.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.panel.style.top = (-backstage.panel.offsetHeight) + "px";
			var p = [{style: "top", start: -backstage.panel.offsetHeight, end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p),new Scroller(backstage.panel,false));
		} else {
			backstage.panel.style.top = "0px";
		}
		return backstage.panelBody;
	},

	hidePanel: function() {
		if(backstage.currTabElem)
			removeClass(backstage.currTabElem,"backstageSelTab");
		backstage.currTabElem = null;
		backstage.currTabName = null;
		if(anim && config.options.chkAnimate) {
			var p = [
				{style: "top", start: 0, end: -(backstage.panel.offsetHeight), template: "%0px"},
				{style: "display", atEnd: "none"}
			];
			var c = function(element,properties) {backstage.cloak.style.display = "none";};
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p,c));
		 } else {
			backstage.panel.style.display = "none";
			backstage.cloak.style.display = "none";
		}
	}
};

config.macros.backstage = {};

config.macros.backstage.handler = function(place,macroName,params)
{
	var backstageTask = config.tasks[params[0]];
	if(backstageTask)
		createTiddlyButton(place,backstageTask.text,backstageTask.tooltip,function(e) {backstage.switchTab(params[0]); return false;});
};

//--
//-- ImportTiddlers macro
//--

config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(readOnly) {
		createTiddlyElement(place,"div",null,"marked",this.readOnlyWarning);
		return;
	}
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	this.restart(w);
};

config.macros.importTiddlers.onCancel = function(e)
{
	var wizard = new Wizard(this);
	var place = wizard.clear();
	config.macros.importTiddlers.restart(wizard);
	return false;
};

config.macros.importTiddlers.onClose = function(e)
{
	backstage.hidePanel();
	return false;
};

config.macros.importTiddlers.restart = function(wizard)
{
	wizard.addStep(this.step1Title,this.step1Html);
	var s = wizard.getElement("selTypes");
	for(var t in config.adaptors) {
		var e = createTiddlyElement(s,"option",null,null,config.adaptors[t].serverLabel ? config.adaptors[t].serverLabel : t);
		e.value = t;
	}
	if(config.defaultAdaptor)
		s.value = config.defaultAdaptor;
	s = wizard.getElement("selFeeds");
	var feeds = this.getFeeds();
	for(t in feeds) {
		e = createTiddlyElement(s,"option",null,null,t);
		e.value = t;
	}
	wizard.setValue("feeds",feeds);
	s.onchange = config.macros.importTiddlers.onFeedChange;
	var fileInput = wizard.getElement("txtBrowse");
	fileInput.onchange = config.macros.importTiddlers.onBrowseChange;
	fileInput.onkeyup = config.macros.importTiddlers.onBrowseChange;
	wizard.setButtons([{caption: this.openLabel, tooltip: this.openPrompt, onClick: config.macros.importTiddlers.onOpen}]);
	wizard.formElem.action = "javascript:;";
	wizard.formElem.onsubmit = function() {
		if(this.txtPath.value.length)
			this.lastChild.firstChild.onclick();
	};
};

config.macros.importTiddlers.getFeeds = function()
{
	var feeds = {};
	var tagged = store.getTaggedTiddlers("systemServer","title");
	for(var t=0; t<tagged.length; t++) {
		var title = tagged[t].title;
		var serverType = store.getTiddlerSlice(title,"Type");
		if(!serverType)
			serverType = "file";
		feeds[title] = {title: title,
						url: store.getTiddlerSlice(title,"URL"),
						workspace: store.getTiddlerSlice(title,"Workspace"),
						workspaceList: store.getTiddlerSlice(title,"WorkspaceList"),
						tiddlerFilter: store.getTiddlerSlice(title,"TiddlerFilter"),
						serverType: serverType,
						description: store.getTiddlerSlice(title,"Description")};
	}
	return feeds;
};

config.macros.importTiddlers.onFeedChange = function(e)
{
	var wizard = new Wizard(this);
	var selTypes = wizard.getElement("selTypes");
	var fileInput = wizard.getElement("txtPath");
	var feeds = wizard.getValue("feeds");
	var f = feeds[this.value];
	if(f) {
		selTypes.value = f.serverType;
		fileInput.value = f.url;
		wizard.setValue("feedName",f.serverType);
		wizard.setValue("feedHost",f.url);
		wizard.setValue("feedWorkspace",f.workspace);
		wizard.setValue("feedWorkspaceList",f.workspaceList);
		wizard.setValue("feedTiddlerFilter",f.tiddlerFilter);
	}
	return false;
};

config.macros.importTiddlers.onBrowseChange = function(e)
{
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	fileInput.value = config.macros.importTiddlers.getURLFromLocalPath(this.value);
	var serverType = wizard.getElement("selTypes");
	serverType.value = "file";
	return true;
};

config.macros.importTiddlers.getURLFromLocalPath = function(v)
{
	if(!v||!v.length)
		return v;
	v = v.replace(/\\/g,"/"); // use "/" for cross-platform consistency
	var u;
	var t = v.split(":");
	var p = t[1]||t[0]; // remove drive letter (if any)
	if (t[1] && (t[0]=="http"||t[0]=="https"||t[0]=="file")) {
		u = v;
	} else if(p.substr(0,1)=="/") {
		u = document.location.protocol + "//" + document.location.hostname + (t[1] ? "/" : "") + v;
	} else {
		var c = document.location.href.replace(/\\/g,"/");
		var pos = c.lastIndexOf("/");
		if (pos!=-1)
			c = c.substr(0,pos); // remove filename
		u = c + "/" + p;
	}
	return u;
};

config.macros.importTiddlers.onOpen = function(e)
{
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	var url = fileInput.value;
	var serverType = wizard.getElement("selTypes").value || config.defaultAdaptor;
	var adaptor = new config.adaptors[serverType]();
	wizard.setValue("adaptor",adaptor);
	wizard.setValue("serverType",serverType);
	wizard.setValue("host",url);
	var ret = adaptor.openHost(url,null,wizard,config.macros.importTiddlers.onOpenHost);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenHost);
	return false;
};

config.macros.importTiddlers.onOpenHost = function(context,wizard)
{
	var adaptor = wizard.getValue("adaptor");
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenHost: " + context.statusText);
	var ret = adaptor.getWorkspaceList(context,wizard,config.macros.importTiddlers.onGetWorkspaceList);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusGetWorkspaceList);
};

config.macros.importTiddlers.onGetWorkspaceList = function(context,wizard)
{
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onGetWorkspaceList: " + context.statusText);
	wizard.setValue("context",context);
	var workspace = wizard.getValue("feedWorkspace");
	if(!workspace && context.workspaces.length==1)
		workspace = context.workspaces[0].title;
	if(workspace) {
		var ret = context.adaptor.openWorkspace(workspace,context,wizard,config.macros.importTiddlers.onOpenWorkspace);
		if(ret !== true)
			displayMessage(ret);
		wizard.setValue("workspace",workspace);
		wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenWorkspace);
		return;
	}
	wizard.addStep(config.macros.importTiddlers.step2Title,config.macros.importTiddlers.step2Html);
	var s = wizard.getElement("selWorkspace");
	s.onchange = config.macros.importTiddlers.onWorkspaceChange;
	for(var t=0; t<context.workspaces.length; t++) {
		var e = createTiddlyElement(s,"option",null,null,context.workspaces[t].title);
		e.value = context.workspaces[t].title;
	}
	var workspaceList = wizard.getValue("feedWorkspaceList");
	if(workspaceList) {
		var list = workspaceList.parseParams("workspace",null,false,true);
		for(var n=1; n<list.length; n++) {
			if(context.workspaces.findByField("title",list[n].value) == null) {
				e = createTiddlyElement(s,"option",null,null,list[n].value);
				e.value = list[n].value;
			}
		}
	}
	if(workspace) {
		t = wizard.getElement("txtWorkspace");
		t.value = workspace;
	}
	wizard.setButtons([{caption: config.macros.importTiddlers.openLabel, tooltip: config.macros.importTiddlers.openPrompt, onClick: config.macros.importTiddlers.onChooseWorkspace}]);
};

config.macros.importTiddlers.onWorkspaceChange = function(e)
{
	var wizard = new Wizard(this);
	var t = wizard.getElement("txtWorkspace");
	t.value = this.value;
	this.selectedIndex = 0;
	return false;
};

config.macros.importTiddlers.onChooseWorkspace = function(e)
{
	var wizard = new Wizard(this);
	var adaptor = wizard.getValue("adaptor");
	var workspace = wizard.getElement("txtWorkspace").value;
	wizard.setValue("workspace",workspace);
	var context = wizard.getValue("context");
	var ret = adaptor.openWorkspace(workspace,context,wizard,config.macros.importTiddlers.onOpenWorkspace);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenWorkspace);
	return false;
};

config.macros.importTiddlers.onOpenWorkspace = function(context,wizard)
{
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenWorkspace: " + context.statusText);
	var adaptor = wizard.getValue("adaptor");
	var ret = adaptor.getTiddlerList(context,wizard,config.macros.importTiddlers.onGetTiddlerList,wizard.getValue("feedTiddlerFilter"));
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusGetTiddlerList);
};

config.macros.importTiddlers.onGetTiddlerList = function(context,wizard)
{
	if(context.status !== true) {
		wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.errorGettingTiddlerList);
		return;
	}
	// Extract data for the listview
	var listedTiddlers = [];
	if(context.tiddlers) {
		for(var n=0; n<context.tiddlers.length; n++) {
			var tiddler = context.tiddlers[n];
			listedTiddlers.push({
				title: tiddler.title,
				modified: tiddler.modified,
				modifier: tiddler.modifier,
				text: tiddler.text ? wikifyPlainText(tiddler.text,100) : "",
				tags: tiddler.tags,
				size: tiddler.text ? tiddler.text.length : 0,
				tiddler: tiddler
			});
		}
	}
	listedTiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	// Display the listview
	wizard.addStep(config.macros.importTiddlers.step3Title,config.macros.importTiddlers.step3Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	var listView = ListView.create(listWrapper,listedTiddlers,config.macros.importTiddlers.listViewTemplate);
	wizard.setValue("listView",listView);
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler");
	txtSaveTiddler.value = config.macros.importTiddlers.generateSystemServerName(wizard);
	wizard.setButtons([
			{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel},
			{caption: config.macros.importTiddlers.importLabel, tooltip: config.macros.importTiddlers.importPrompt, onClick: config.macros.importTiddlers.doImport}
		]);
};

config.macros.importTiddlers.generateSystemServerName = function(wizard)
{
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var pattern = config.macros.importTiddlers[workspace ? "systemServerNamePattern" : "systemServerNamePatternNoWorkspace"];
	return pattern.format([serverType,host,workspace]);
};

config.macros.importTiddlers.saveServerTiddler = function(wizard)
{
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler").value;
	if(store.tiddlerExists(txtSaveTiddler)) {
		if(!confirm(config.macros.importTiddlers.confirmOverwriteSaveTiddler.format([txtSaveTiddler])))
			return;
		store.suspendNotifications();
		store.removeTiddler(txtSaveTiddler);
		store.resumeNotifications();
	}
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var text = config.macros.importTiddlers.serverSaveTemplate.format([serverType,host,workspace]);
	store.saveTiddler(txtSaveTiddler,txtSaveTiddler,text,config.macros.importTiddlers.serverSaveModifier,new Date(),["systemServer"]);
};

config.macros.importTiddlers.doImport = function(e)
{
	var wizard = new Wizard(this);
	if(wizard.getElement("chkSave").checked)
		config.macros.importTiddlers.saveServerTiddler(wizard);
	var chkSync = wizard.getElement("chkSync").checked;
	wizard.setValue("sync",chkSync);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	var adaptor = wizard.getValue("adaptor");
	var overwrite = [];
	var t;
	for(t=0; t<rowNames.length; t++) {
		if(store.tiddlerExists(rowNames[t]))
			overwrite.push(rowNames[t]);
	}
	if(overwrite.length > 0) {
		if(!confirm(config.macros.importTiddlers.confirmOverwriteText.format([overwrite.join(", ")])))
			return false;
	}
	wizard.addStep(config.macros.importTiddlers.step4Title.format([rowNames.length]),config.macros.importTiddlers.step4Html);
	for(t=0; t<rowNames.length; t++) {
		var link = document.createElement("div");
		createTiddlyLink(link,rowNames[t],true);
		var place = wizard.getElement("markReport");
		place.parentNode.insertBefore(link,place);
	}
	wizard.setValue("remainingImports",rowNames.length);
	wizard.setButtons([
			{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}
		],config.macros.importTiddlers.statusDoingImport);
	for(t=0; t<rowNames.length; t++) {
		var context = {};
		context.allowSynchronous = true;
		var inbound = adaptor.getTiddler(rowNames[t],context,wizard,config.macros.importTiddlers.onGetTiddler);
	}
	return false;
};

config.macros.importTiddlers.onGetTiddler = function(context,wizard)
{
	if(!context.status)
		displayMessage("Error in importTiddlers.onGetTiddler: " + context.statusText);
	var tiddler = context.tiddler;
	store.suspendNotifications();
	store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
	if(!wizard.getValue("sync")) {
		store.setValue(tiddler.title,'server',null);
	}
	store.resumeNotifications();
	if(!context.isSynchronous)
		store.notify(tiddler.title,true);
	var remainingImports = wizard.getValue("remainingImports")-1;
	wizard.setValue("remainingImports",remainingImports);
	if(remainingImports == 0) {
		if(context.isSynchronous) {
			store.notifyAll();
			refreshDisplay();
		}
		wizard.setButtons([
				{caption: config.macros.importTiddlers.doneLabel, tooltip: config.macros.importTiddlers.donePrompt, onClick: config.macros.importTiddlers.onClose}
			],config.macros.importTiddlers.statusDoneImport);
		autoSaveChanges();
	}
};

//--
//-- Upgrade macro
//--

config.macros.upgrade.handler = function(place)
{
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	w.addStep(this.step1Title,this.step1Html.format([this.source,this.source]));
	w.setButtons([{caption: this.upgradeLabel, tooltip: this.upgradePrompt, onClick: this.onClickUpgrade}]);
};

config.macros.upgrade.onClickUpgrade = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	if(window.location.protocol != "file:") {
		alert(me.errorCantUpgrade);
		return false;
	}
	if(story.areAnyDirty() || store.isDirty()) {
		alert(me.errorNotSaved);
		return false;
	}
	var localPath = getLocalPath(document.location.toString());
	var backupPath = getBackupPath(localPath,me.backupExtension);
	w.setValue("backupPath",backupPath);
	w.setButtons([],me.statusPreparingBackup);
	var original = loadOriginal(localPath);
	w.setButtons([],me.statusSavingBackup);
	var backup = config.browser.isIE ? ieCopyFile(backupPath,localPath) : saveFile(backupPath,original);
	if(backup != true) {
		w.setButtons([],me.errorSavingBackup);
		alert(me.errorSavingBackup);
		return false;
	}
	w.setButtons([],me.statusLoadingCore);
	var load = loadRemoteFile(me.source,me.onLoadCore,w);
	if(typeof load == "string") {
		w.setButtons([],me.errorLoadingCore);
		alert(me.errorLoadingCore);
		return false;
	}
	return false;
};

config.macros.upgrade.onLoadCore = function(status,params,responseText,url,xhr)
{
	var me = config.macros.upgrade;
	var w = params;
	var errMsg;
	if(!status)
		errMsg = me.errorLoadingCore;
	var newVer = me.extractVersion(responseText);
	if(!newVer)
		errMsg = me.errorCoreFormat;
	if(errMsg) {
		w.setButtons([],errMsg);
		alert(errMsg);
		return;
	}
	var onStartUpgrade = function(e) {
		w.setButtons([],me.statusSavingCore);
		var localPath = getLocalPath(document.location.toString());
		saveFile(localPath,responseText);
		w.setButtons([],me.statusReloadingCore);
		var backupPath = w.getValue("backupPath");
		var newLoc = document.location.toString() + '?time=' + new Date().convertToYYYYMMDDHHMM() + '#upgrade:[[' + encodeURI(backupPath) + ']]';
		window.setTimeout(function () {window.location = newLoc;},10);
	};
	var step2 = [me.step2Html_downgrade,me.step2Html_restore,me.step2Html_upgrade][compareVersions(version,newVer) + 1];
	w.addStep(me.step2Title,step2.format([formatVersion(newVer),formatVersion(version)]));
	w.setButtons([{caption: me.startLabel, tooltip: me.startPrompt, onClick: onStartUpgrade},{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}]);
};

config.macros.upgrade.onCancel = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	w.addStep(me.step3Title,me.step3Html);
	w.setButtons([]);
	return false;
};

config.macros.upgrade.extractVersion = function(upgradeFile)
{
	var re = /^var version = \{title: "([^"]+)", major: (\d+), minor: (\d+), revision: (\d+)(, beta: (\d+)){0,1}, date: new Date\("([^"]+)"\)/mg;
	var m = re.exec(upgradeFile);
	return  m ? {title: m[1], major: m[2], minor: m[3], revision: m[4], beta: m[6], date: new Date(m[7])} : null;
};

function upgradeFrom(path)
{
	var importStore = new TiddlyWiki();
	var tw = loadFile(path);
	if(window.netscape !== undefined)
		tw = convertUTF8ToUnicode(tw);
	importStore.importTiddlyWiki(tw);
	importStore.forEachTiddler(function(title,tiddler) {
		if(!store.getTiddler(title)) {
			store.addTiddler(tiddler);
		}
	});
	refreshDisplay();
	saveChanges(); //# To create appropriate Markup* sections
	alert(config.messages.upgradeDone.format([formatVersion()]));
	window.location = window.location.toString().substr(0,window.location.toString().lastIndexOf('?'));
}

//--
//-- Sync macro
//--

// Synchronisation handlers
config.syncers = {};

// Sync state.
var currSync = null;

// sync macro
config.macros.sync.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!wikifier.isStatic)
		this.startSync(place);
};

config.macros.sync.cancelSync = function()
{
	currSync = null;
};

config.macros.sync.startSync = function(place)
{
	if(currSync)
		config.macros.sync.cancelSync();
	currSync = {};
	currSync.syncList = this.getSyncableTiddlers();
	currSync.syncTasks = this.createSyncTasks(currSync.syncList);
	this.preProcessSyncableTiddlers(currSync.syncList);
	var wizard = new Wizard();
	currSync.wizard = wizard;
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	currSync.listView = ListView.create(listWrapper,currSync.syncList,this.listViewTemplate);
	this.processSyncableTiddlers(currSync.syncList);
	wizard.setButtons([{caption: this.syncLabel, tooltip: this.syncPrompt, onClick: this.doSync}]);
};

config.macros.sync.getSyncableTiddlers = function()
{
	var list = [];
	store.forEachTiddler(function(title,tiddler) {
		var syncItem = {};
		syncItem.serverType = tiddler.getServerType();
		syncItem.serverHost = tiddler.fields['server.host'];
		if(syncItem.serverType && syncItem.serverHost) {
			syncItem.serverWorkspace = tiddler.fields['server.workspace'];
			syncItem.tiddler = tiddler;
			syncItem.title = tiddler.title;
			syncItem.isTouched = tiddler.isTouched();
			syncItem.selected = syncItem.isTouched;
			syncItem.syncStatus = config.macros.sync.syncStatusList[syncItem.isTouched ? "changedLocally" : "none"];
			syncItem.status = syncItem.syncStatus.text;
			list.push(syncItem);
		}
		});
	list.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	return list;
};

config.macros.sync.preProcessSyncableTiddlers = function(syncList)
{
	for(var i=0; i<syncList.length; i++) {
		var si = syncList[i];
		si.serverUrl = si.syncTask.syncMachine.generateTiddlerInfo(si.tiddler).uri;
	}
};

config.macros.sync.processSyncableTiddlers = function(syncList)
{
	for(var i=0; i<syncList.length; i++) {
		var si = syncList[i];
		si.rowElement.style.display = si.syncStatus.display;
		if(si.syncStatus.className)
			si.rowElement.className = si.syncStatus.className;
	}
};

config.macros.sync.createSyncTasks = function(syncList)
{
	var syncTasks = [];
	for(var i=0; i<syncList.length; i++) {
		var si = syncList[i];
		var r = null;
		for(var j=0; j<syncTasks.length; j++) {
			var cst = syncTasks[j];
			if(si.serverType == cst.serverType && si.serverHost == cst.serverHost && si.serverWorkspace == cst.serverWorkspace)
				r = cst;
		}
		if(r) {
			si.syncTask = r;
			r.syncItems.push(si);
		} else {
			si.syncTask = this.createSyncTask(si);
			syncTasks.push(si.syncTask);
		}
	}
	return syncTasks;
};

config.macros.sync.createSyncTask = function(syncItem)
{
	var st = {};
	st.serverType = syncItem.serverType;
	st.serverHost = syncItem.serverHost;
	st.serverWorkspace = syncItem.serverWorkspace;
	st.syncItems = [syncItem];
	st.syncMachine = new SyncMachine(st.serverType,{
		start: function() {
			return this.openHost(st.serverHost,"openWorkspace");
		},
		openWorkspace: function() {
			return this.openWorkspace(st.serverWorkspace,"getTiddlerList");
		},
		getTiddlerList: function() {
			return this.getTiddlerList("onGetTiddlerList");
		},
		onGetTiddlerList: function(context) {
			var tiddlers = context.tiddlers;
			for(var i=0; i<st.syncItems.length; i++) {
				var si = st.syncItems[i];
				var f = tiddlers.findByField("title",si.title);
				if(f !== null) {
					if(tiddlers[f].fields['server.page.revision'] > si.tiddler.fields['server.page.revision']) {
						si.syncStatus = config.macros.sync.syncStatusList[si.isTouched ? 'changedBoth' : 'changedServer'];
					}
				} else {
					si.syncStatus = config.macros.sync.syncStatusList.notFound;
				}
				config.macros.sync.updateSyncStatus(si);
			}
		},
		getTiddler: function(title) {
			return this.getTiddler(title,"onGetTiddler");
		},
		onGetTiddler: function(context) {
			var tiddler = context.tiddler;
			var syncItem = st.syncItems.findByField("title",tiddler.title);
			if(syncItem !== null) {
				syncItem = st.syncItems[syncItem];
				store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
				syncItem.syncStatus = config.macros.sync.syncStatusList.gotFromServer;
				config.macros.sync.updateSyncStatus(syncItem);
			}
		},
		putTiddler: function(tiddler) {
			return this.putTiddler(tiddler,"onPutTiddler");
		},
		onPutTiddler: function(context) {
			var title = context.title;
			var syncItem = st.syncItems.findByField("title",title);
			if(syncItem !== null) {
				syncItem = st.syncItems[syncItem];
				store.resetTiddler(title);
				if(context.status) {
					syncItem.syncStatus = config.macros.sync.syncStatusList.putToServer;
					config.macros.sync.updateSyncStatus(syncItem);
				}
			}
		}
	});
	st.syncMachine.go();
	return st;
};

config.macros.sync.updateSyncStatus = function(syncItem)
{
	var e = syncItem.colElements["status"];
	removeChildren(e);
	createTiddlyText(e,syncItem.syncStatus.text);
	syncItem.rowElement.style.display = syncItem.syncStatus.display;
	if(syncItem.syncStatus.className)
		syncItem.rowElement.className = syncItem.syncStatus.className;
};

config.macros.sync.doSync = function(e)
{
	var rowNames = ListView.getSelectedRows(currSync.listView);
	var sl = config.macros.sync.syncStatusList;
	for(var i=0; i<currSync.syncList.length; i++) {
		var si = currSync.syncList[i];
		if(rowNames.indexOf(si.title) != -1) {
			var r = true;
			switch(si.syncStatus) {
			case sl.changedServer:
				r = si.syncTask.syncMachine.go("getTiddler",si.title);
				break;
			case sl.notFound:
			case sl.changedLocally:
			case sl.changedBoth:
				r = si.syncTask.syncMachine.go("putTiddler",si.tiddler);
				break;
			default:
				break;
			}
			if(!r)
				displayMessage("Error in doSync: " + r);
		}
	}
	return false;
};

function SyncMachine(serverType,steps)
{
	this.serverType = serverType;
	this.adaptor = new config.adaptors[serverType]();
	this.steps = steps;
}

SyncMachine.prototype.go = function(step,context)
{
	var r = context ? context.status : null;
	if(typeof r == "string") {
		this.invokeError(r);
		return r;
	}
	var h = this.steps[step ? step : "start"];
	if(!h)
		return null;
	r = h.call(this,context);
	if(typeof r == "string")
		this.invokeError(r);
	return r;
};

SyncMachine.prototype.invokeError = function(message)
{
	if(this.steps.error)
		this.steps.error(message);
};

SyncMachine.prototype.openHost = function(host,nextStep)
{
	var me = this;
	return me.adaptor.openHost(host,null,null,function(context) {me.go(nextStep,context);});
};

SyncMachine.prototype.getWorkspaceList = function(nextStep)
{
	var me = this;
	return me.adaptor.getWorkspaceList(null,null,function(context) {me.go(nextStep,context);});
};

SyncMachine.prototype.openWorkspace = function(workspace,nextStep)
{
	var me = this;
	return me.adaptor.openWorkspace(workspace,null,null,function(context) {me.go(nextStep,context);});
};

SyncMachine.prototype.getTiddlerList = function(nextStep)
{
	var me = this;
	return me.adaptor.getTiddlerList(null,null,function(context) {me.go(nextStep,context);});
};

SyncMachine.prototype.generateTiddlerInfo = function(tiddler)
{
	return this.adaptor.generateTiddlerInfo(tiddler);
};

SyncMachine.prototype.getTiddler = function(title,nextStep)
{
	var me = this;
	return me.adaptor.getTiddler(title,null,null,function(context) {me.go(nextStep,context);});
};

SyncMachine.prototype.putTiddler = function(tiddler,nextStep)
{
	var me = this;
	return me.adaptor.putTiddler(tiddler,null,null,function(context) {me.go(nextStep,context);});
};

//--
//-- Manager UI for groups of tiddlers
//--

config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString)
{
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	listWrapper.setAttribute("refresh","macro");
	listWrapper.setAttribute("macroName","plugins");
	listWrapper.setAttribute("params",paramString);
	this.refresh(listWrapper,paramString);
};

config.macros.plugins.refresh = function(listWrapper,params)
{
	var wizard = new Wizard(listWrapper);
	var selectedRows = [];
	ListView.forEachSelector(listWrapper,function(e,rowName) {
			if(e.checked)
				selectedRows.push(e.getAttribute("rowName"));
		});
	removeChildren(listWrapper);
	params = params.parseParams("anon");
	var plugins = installedPlugins.slice(0);
	var t,tiddler,p;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(t=0; t<configTiddlers.length; t++) {
		tiddler = configTiddlers[t];
		if(plugins.findByField("title",tiddler.title) == null) {
			p = getPluginInfo(tiddler);
			p.executed = false;
			p.log.splice(0,0,this.skippedText);
			plugins.push(p);
		}
	}
	for(t=0; t<plugins.length; t++) {
		p = plugins[t];
		p.size = p.tiddler.text ? p.tiddler.text.length : 0;
		p.forced = p.tiddler.isTagged("systemConfigForce");
		p.disabled = p.tiddler.isTagged("systemConfigDisable");
		p.Selected = selectedRows.indexOf(plugins[t].title) != -1;
	}
	if(plugins.length == 0) {
		createTiddlyElement(listWrapper,"em",null,null,this.noPluginText);
		wizard.setButtons([]);
	} else {
		var listView = ListView.create(listWrapper,plugins,this.listViewTemplate,this.onSelectCommand);
		wizard.setValue("listView",listView);
		wizard.setButtons([
				{caption: config.macros.plugins.removeLabel, tooltip: config.macros.plugins.removePrompt, onClick: config.macros.plugins.doRemoveTag},
				{caption: config.macros.plugins.deleteLabel, tooltip: config.macros.plugins.deletePrompt, onClick: config.macros.plugins.doDelete}
			]);
	}
};

config.macros.plugins.doRemoveTag = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		for(var t=0; t<rowNames.length; t++)
			store.setTiddlerTag(rowNames[t],false,"systemConfig");
	}
};

config.macros.plugins.doDelete = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		if(confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")]))) {
			for(var t=0; t<rowNames.length; t++) {
				store.removeTiddler(rowNames[t]);
				story.closeTiddler(rowNames[t],true);
			}
		}
	}
};

//--
//-- Message area
//--

function getMessageDiv()
{
	var msgArea = document.getElementById("messageArea");
	if(!msgArea)
		return null;
	if(!msgArea.hasChildNodes())
		createTiddlyButton(createTiddlyElement(msgArea,"div",null,"messageToolbar"),
			config.messages.messageClose.text,
			config.messages.messageClose.tooltip,
			clearMessage);
	msgArea.style.display = "block";
	return createTiddlyElement(msgArea,"div");
}

function displayMessage(text,linkText)
{
	var e = getMessageDiv();
	if(!e) {
		alert(text);
		return;
	}
	if(linkText) {
		var link = createTiddlyElement(e,"a",null,null,text);
		link.href = linkText;
		link.target = "_blank";
	} else {
		e.appendChild(document.createTextNode(text));
	}
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	if(msgArea) {
		removeChildren(msgArea);
		msgArea.style.display = "none";
	}
	return false;
}

//--
//-- Refresh mechanism
//--

config.notifyTiddlers = [
	{name: "StyleSheetLayout", notify: refreshStyles},
	{name: "StyleSheetColors", notify: refreshStyles},
	{name: "StyleSheet", notify: refreshStyles},
	{name: "StyleSheetPrint", notify: refreshStyles},
	{name: "PageTemplate", notify: refreshPageTemplate},
	{name: "SiteTitle", notify: refreshPageTitle},
	{name: "SiteSubtitle", notify: refreshPageTitle},
	{name: "ColorPalette", notify: refreshColorPalette},
	{name: null, notify: refreshDisplay}
];

config.refreshers = {
	link: function(e,changeList)
		{
		var title = e.getAttribute("tiddlyLink");
		refreshTiddlyLink(e,title);
		return true;
		},

	tiddler: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var template = e.getAttribute("template");
		if(changeList && changeList.indexOf(title) != -1 && !story.isDirty(title))
			story.refreshTiddler(title,template,true);
		else
			refreshElements(e,changeList);
		return true;
		},

	content: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var force = e.getAttribute("force");
		if(force != null || changeList == null || changeList.indexOf(title) != -1) {
			removeChildren(e);
			wikify(store.getTiddlerText(title,""),e,null,store.fetchTiddler(title));
			return true;
		} else
			return false;
		},

	macro: function(e,changeList)
		{
		var macro = e.getAttribute("macroName");
		var params = e.getAttribute("params");
		if(macro)
			macro = config.macros[macro];
		if(macro && macro.refresh)
			macro.refresh(e,params);
		return true;
		}
};

config.refresherData = {
	styleSheet: "StyleSheet",
	defaultStyleSheet: "StyleSheet",
	pageTemplate: "PageTemplate",
	defaultPageTemplate: "PageTemplate",
	colorPalette: "ColorPalette",
	defaultColorPalette: "ColorPalette"
};

function refreshElements(root,changeList)
{
	var nodes = root.childNodes;
	for(var c=0; c<nodes.length; c++) {
		var e = nodes[c], type = null;
		if(e.getAttribute && (e.tagName ? e.tagName != "IFRAME" : true))
			type = e.getAttribute("refresh");
		var refresher = config.refreshers[type];
		var refreshed = false;
		if(refresher != undefined)
			refreshed = refresher(e,changeList);
		if(e.hasChildNodes() && !refreshed)
			refreshElements(e,changeList);
	}
}

function applyHtmlMacros(root,tiddler)
{
	var e = root.firstChild;
	while(e) {
		var nextChild = e.nextSibling;
		if(e.getAttribute) {
			var macro = e.getAttribute("macro");
			if(macro) {
				e.removeAttribute("macro");
				var params = "";
				var p = macro.indexOf(" ");
				if(p != -1) {
					params = macro.substr(p+1);
					macro = macro.substr(0,p);
				}
				invokeMacro(e,macro,params,null,tiddler);
			}
		}
		if(e.hasChildNodes())
			applyHtmlMacros(e,tiddler);
		e = nextChild;
	}
}

function refreshPageTemplate(title)
{
	var stash = createTiddlyElement(document.body,"div");
	stash.style.display = "none";
	var display = story.getContainer();
	var nodes,t;
	if(display) {
		nodes = display.childNodes;
		for(t=nodes.length-1; t>=0; t--)
			stash.appendChild(nodes[t]);
	}
	var wrapper = document.getElementById("contentWrapper");

	var isAvailable = function(title) {
		var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
		if(s!=-1)
			title = title.substr(0,s);
		return store.tiddlerExists(title) || store.isShadowTiddler(title);
	};
	if(!title || !isAvailable(title))
		title = config.refresherData.pageTemplate;
	if(!isAvailable(title))
		title = config.refresherData.defaultPageTemplate; //# this one is always avaialable
	wrapper.innerHTML = store.getRecursiveTiddlerText(title,null,10);
	applyHtmlMacros(wrapper);
	refreshElements(wrapper);
	display = story.getContainer();
	removeChildren(display);
	if(!display)
		display = createTiddlyElement(wrapper,"div",story.containerId());
	nodes = stash.childNodes;
	for(t=nodes.length-1; t>=0; t--)
		display.appendChild(nodes[t]);
	removeNode(stash);
}

function refreshDisplay(hint)
{
	if(typeof hint == "string")
		hint = [hint];
	var e = document.getElementById("contentWrapper");
	refreshElements(e,hint);
	if(backstage.isPanelVisible()) {
		e = document.getElementById("backstage");
		refreshElements(e,hint);
	}
}

function refreshPageTitle()
{
	document.title = getPageTitle();
}

function getPageTitle()
{
	var st = wikifyPlain("SiteTitle");
	var ss = wikifyPlain("SiteSubtitle");
	return st + ((st == "" || ss == "") ? "" : " - ") + ss;
}

function refreshStyles(title,doc)
{
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title,doc || document);
}

function refreshColorPalette(title)
{
	if(!startingUp)
		refreshAll();
}

function refreshAll()
{
	refreshPageTemplate();
	refreshDisplay();
	refreshStyles("StyleSheetLayout");
	refreshStyles("StyleSheetColors");
	refreshStyles(config.refresherData.styleSheet);
	refreshStyles("StyleSheetPrint");
}

//--
//-- Options stuff
//--

config.optionHandlers = {
	'txt': {
		get: function(name) {return encodeCookie(config.options[name].toString());},
		set: function(name,value) {config.options[name] = decodeCookie(value);}
	},
	'chk': {
		get: function(name) {return config.options[name] ? "true" : "false";},
		set: function(name,value) {config.options[name] = value == "true";}
	}
};

function loadOptionsCookie()
{
	if(safeMode)
		return;
	var cookies = document.cookie.split(";");
	for(var c=0; c<cookies.length; c++) {
		var p = cookies[c].indexOf("=");
		if(p != -1) {
			var name = cookies[c].substr(0,p).trim();
			var value = cookies[c].substr(p+1).trim();
			var optType = name.substr(0,3);
			if(config.optionHandlers[optType] && config.optionHandlers[optType].set)
				config.optionHandlers[optType].set(name,value);
		}
	}
}

function saveOptionCookie(name)
{
	if(safeMode)
		return;
	var c = name + "=";
	var optType = name.substr(0,3);
	if(config.optionHandlers[optType] && config.optionHandlers[optType].get)
		c += config.optionHandlers[optType].get(name);
	c += "; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
	document.cookie = c;
}

function encodeCookie(s)
{
	return escape(convertUnicodeToHtmlEntities(s));
}

function decodeCookie(s)
{
	s = unescape(s);
	var re = /&#[0-9]{1,5};/g;
	return s.replace(re,function($0) {return String.fromCharCode(eval($0.replace(/[&#;]/g,"")));});
}


config.macros.option.genericCreate = function(place,type,opt,className,desc)
{
	var typeInfo = config.macros.option.types[type];
	var c = document.createElement(typeInfo.elementType);
	if(typeInfo.typeValue)
		c.setAttribute("type",typeInfo.typeValue);
	c[typeInfo.eventName] = typeInfo.onChange;
	c.setAttribute("option",opt);
	c.className = className || typeInfo.className;
	if(config.optionsDesc[opt])
		c.setAttribute("title",config.optionsDesc[opt]);
	place.appendChild(c);
	if(desc != "no")
		createTiddlyText(place,config.optionsDesc[opt] || opt);
	c[typeInfo.valueField] = config.options[opt];
	return c;
};

config.macros.option.genericOnChange = function(e)
{
	var opt = this.getAttribute("option");
	if(opt) {
		var optType = opt.substr(0,3);
		var handler = config.macros.option.types[optType];
		if(handler.elementType && handler.valueField)
			config.macros.option.propagateOption(opt,handler.valueField,this[handler.valueField],handler.elementType,this);
	}
	return true;
};

config.macros.option.types = {
	'txt': {
		elementType: "input",
		valueField: "value",
		eventName: "onchange",
		className: "txtOptionInput",
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	},
	'chk': {
		elementType: "input",
		valueField: "checked",
		eventName: "onclick",
		className: "chkOptionInput",
		typeValue: "checkbox",
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	}
};

config.macros.option.propagateOption = function(opt,valueField,value,elementType,elem)
{
	config.options[opt] = value;
	saveOptionCookie(opt);
	var nodes = document.getElementsByTagName(elementType);
	for(var t=0; t<nodes.length; t++) {
		var optNode = nodes[t].getAttribute("option");
		if(opt == optNode && nodes[t]!=elem)
			nodes[t][valueField] = value;
	}
};

config.macros.option.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var opt = (params[1] && params[1].name == "anon") ? params[1].value : getParam(params,"name",null);
	var className = (params[2] && params[2].name == "anon") ? params[2].value : getParam(params,"class",null);
	var desc = getParam(params,"desc","no");
	var type = opt.substr(0,3);
	var h = config.macros.option.types[type];
	if(h && h.create)
		h.create(place,type,opt,className,desc);
};

config.macros.options.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var showUnknown = getParam(params,"showUnknown","no");
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var chkUnknown = wizard.getElement("chkUnknown");
	chkUnknown.checked = showUnknown == "yes";
	chkUnknown.onchange = this.onChangeUnknown;
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	wizard.setValue("listWrapper",listWrapper);
	this.refreshOptions(listWrapper,showUnknown == "yes");
};

config.macros.options.refreshOptions = function(listWrapper,showUnknown)
{
	var opts = [];
	for(var n in config.options) {
		var opt = {};
		opt.option = "";
		opt.name = n;
		opt.lowlight = !config.optionsDesc[n];
		opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
		if(!opt.lowlight || showUnknown)
			opts.push(opt);
	}
	opts.sort(function(a,b) {return a.name.substr(3) < b.name.substr(3) ? -1 : (a.name.substr(3) == b.name.substr(3) ? 0 : +1);});
	var listview = ListView.create(listWrapper,opts,this.listViewTemplate);
	for(n=0; n<opts.length; n++) {
		var type = opts[n].name.substr(0,3);
		var h = config.macros.option.types[type];
		if(h && h.create) {
			h.create(opts[n].colElements['option'],type,opts[n].name,null,"no");
		}
	}
};

config.macros.options.onChangeUnknown = function(e)
{
	var wizard = new Wizard(this);
	var listWrapper = wizard.getValue("listWrapper");
	removeChildren(listWrapper);
	config.macros.options.refreshOptions(listWrapper,this.checked);
	return false;
};

//--
//-- Saving
//--

var saveUsingSafari = false;

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var endSaveArea = '</d' + 'iv>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
	hadConfirmExit = true;
	if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
		return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
	if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false) {
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
	}
}

function updateLanguageAttribute(s)
{
	if(config.locale) {
		var mRE = /(<html(?:.*?)?)(?: xml:lang\="([a-z]+)")?(?: lang\="([a-z]+)")?>/;
		var m = mRE.exec(s);
		if(m) {
			var t = m[1];
			if(m[2])
				t += ' xml:lang="' + config.locale + '"';
			if(m[3])
				t += ' lang="' + config.locale + '"';
			t += ">";
			s = s.substr(0,m.index) + t + s.substr(m.index+m[0].length);
		}
	}
	return s;
}

function updateMarkupBlock(s,blockName,tiddlerName)
{
	return s.replaceChunk(
			"<!--%0-START-->".format([blockName]),
			"<!--%0-END-->".format([blockName]),
			"\n" + convertUnicodeToFileFormat(store.getRecursiveTiddlerText(tiddlerName,"")) + "\n");
}

function updateOriginal(original,posDiv,localPath)
{
	if(!posDiv)
		posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return null;
	}
	var revised = original.substr(0,posDiv[0] + startSaveArea.length) + "\n" +
				convertUnicodeToFileFormat(store.allTiddlersAsHtml()) + "\n" +
				original.substr(posDiv[1]);
	var newSiteTitle = convertUnicodeToFileFormat(getPageTitle()).htmlEncode();
	revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
	revised = updateLanguageAttribute(revised);
	revised = updateMarkupBlock(revised,"PRE-HEAD","MarkupPreHead");
	revised = updateMarkupBlock(revised,"POST-HEAD","MarkupPostHead");
	revised = updateMarkupBlock(revised,"PRE-BODY","MarkupPreBody");
	revised = updateMarkupBlock(revised,"POST-SCRIPT","MarkupPostBody");
	return revised;
}

function locateStoreArea(original)
{
	// Locate the storeArea div's
	var posOpeningDiv = original.indexOf(startSaveArea);
	var limitClosingDiv = original.indexOf("<"+"!--POST-STOREAREA--"+">");
	if(limitClosingDiv == -1)
		limitClosingDiv = original.indexOf("<"+"!--POST-BODY-START--"+">");
	var posClosingDiv = original.lastIndexOf(endSaveArea,limitClosingDiv == -1 ? original.length : limitClosingDiv);
	return (posOpeningDiv != -1 && posClosingDiv != -1) ? [posOpeningDiv,posClosingDiv] : null;
}

function autoSaveChanges(onlyIfDirty,tiddlers)
{
	if(config.options.chkAutoSave)
		saveChanges(onlyIfDirty,tiddlers);
}

function loadOriginal(localPath)
{
	return loadFile(localPath);
}

// Save this tiddlywiki with the pending changes
function saveChanges(onlyIfDirty,tiddlers)
{
	if(onlyIfDirty && !store.isDirty())
		return;
	clearMessage();
	var t0 = new Date();
	var originalPath = document.location.toString();
	if(originalPath.substr(0,5) != "file:") {
		alert(config.messages.notFileUrlError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
	}
	var localPath = getLocalPath(originalPath);
	var original = loadOriginal(localPath);
	if(original == null) {
		alert(config.messages.cantSaveError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
	}
	var posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return;
	}
	saveMain(localPath,original,posDiv);
	if(config.options.chkSaveBackups)
		saveBackup(localPath,original);
	if(config.options.chkSaveEmptyTemplate)
		saveEmpty(localPath,original,posDiv);
	if(config.options.chkGenerateAnRssFeed && saveRss instanceof Function)
		saveRss(localPath);
	if(config.options.chkDisplayInstrumentation)
		displayMessage("saveChanges " + (new Date()-t0) + " ms");
}

function saveMain(localPath,original,posDiv)
{
	var save;
	try {
		var revised = updateOriginal(original,posDiv,localPath);
		save = saveFile(localPath,revised);
	} catch (ex) {
		showException(ex);
	}
	if(save) {
		displayMessage(config.messages.mainSaved,"file://" + localPath);
		store.setDirty(false);
	} else {
		alert(config.messages.mainFailed);
	}
}

function saveBackup(localPath,original)
{
	var backupPath = getBackupPath(localPath);
	var backup = copyFile(backupPath,localPath);
	if(!backup)
		backup = saveFile(backupPath,original);
	if(backup)
		displayMessage(config.messages.backupSaved,"file://" + backupPath);
	else
		alert(config.messages.backupFailed);
}

function saveEmpty(localPath,original,posDiv)
{
	var emptyPath,p;
	if((p = localPath.lastIndexOf("/")) != -1)
		emptyPath = localPath.substr(0,p) + "/";
	else if((p = localPath.lastIndexOf("\\")) != -1)
		emptyPath = localPath.substr(0,p) + "\\";
	else
		emptyPath = localPath + ".";
	emptyPath += "empty.html";
	var empty = original.substr(0,posDiv[0] + startSaveArea.length) + original.substr(posDiv[1]);
	var emptySave = saveFile(emptyPath,empty);
	if(emptySave)
		displayMessage(config.messages.emptySaved,"file://" + emptyPath);
	else
		alert(config.messages.emptyFailed);
}

function getLocalPath(origPath)
{
	var originalPath = convertUriToUTF8(origPath,config.options.txtFileSystemCharSet);
	// Remove any location or query part of the URL
	var argPos = originalPath.indexOf("?");
	if(argPos != -1)
		originalPath = originalPath.substr(0,argPos);
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert file://localhost/ to file:///
	if(originalPath.indexOf("file://localhost/") == 0)
		originalPath = "file://" + originalPath.substr(16);
	// Convert to a native file format
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	return localPath;
}

function getBackupPath(localPath,title,extension)
{
	var slash = "\\";
	var dirPathPos = localPath.lastIndexOf("\\");
	if(dirPathPos == -1) {
		dirPathPos = localPath.lastIndexOf("/");
		slash = "/";
	}
	var backupFolder = config.options.txtBackupFolder;
	if(!backupFolder || backupFolder == "")
		backupFolder = ".";
	var backupPath = localPath.substr(0,dirPathPos) + slash + backupFolder + localPath.substr(dirPathPos);
	backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + ".";
	if(title)
		backupPath += title.replace(/[\\\/\*\?\":<> ]/g,"_") + ".";
	backupPath += (new Date()).convertToYYYYMMDDHHMMSSMMM() + "." + (extension || "html");
	return backupPath;
}

//--
//-- RSS Saving
//--

function saveRss(localPath)
{
	var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
	if(saveFile(rssPath,convertUnicodeToFileFormat(generateRss())))
		displayMessage(config.messages.rssSaved,"file://" + rssPath);
	else
		alert(config.messages.rssFailed);
}

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl");
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title" + ">" + wikifyPlain("SiteTitle").htmlEncode() + "</title" + ">");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + wikifyPlain("SiteSubtitle").htmlEncode() + "</description>");
	s.push("<language>" + config.locale + "</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + formatVersion() + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified","excludeLists");
	var n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
	for(var t=tiddlers.length-1; t>=n; t--) {
		s.push("<item>\n" + tiddlers[t].toRssItem(u) + "\n</item>");
	}
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}

//--
//-- Filesystem code
//--

function convertUTF8ToUnicode(u)
{
	return config.browser.isOpera || !window.netscape ? manualConvertUTF8ToUnicode(u) : mozConvertUTF8ToUnicode(u);
}

function manualConvertUTF8ToUnicode(utf)
{
	var uni = utf;
	var src = 0;
	var dst = 0;
	var b1, b2, b3;
	var c;
	while(src < utf.length) {
		b1 = utf.charCodeAt(src++);
		if(b1 < 0x80) {
			dst++;
		} else if(b1 < 0xE0) {
			b2 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		} else {
			b2 = utf.charCodeAt(src++);
			b3 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		}
	}
	return uni;
}

function mozConvertUTF8ToUnicode(u)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUTF8ToUnicode(u);
	} // fallback
	var s = converter.ConvertToUnicode(u);
	var fin = converter.Finish();
	return fin.length > 0 ? s+fin : s;
}

function convertUnicodeToFileFormat(s)
{
	return config.browser.isOpera || !window.netscape ? convertUnicodeToHtmlEntities(s) : mozConvertUnicodeToUTF8(s);
}

function convertUnicodeToHtmlEntities(s)
{
	var re = /[^\u0000-\u007F]/g;
	return s.replace(re,function($0) {return "&#" + $0.charCodeAt(0).toString() + ";";});
}

function convertUnicodeToUTF8(s)
{
// return convertUnicodeToFileFormat to allow plugin migration
	return convertUnicodeToFileFormat(s);
}

function manualConvertUnicodeToUTF8(s)
{
	return unescape(encodeURIComponent(s));
}

function mozConvertUnicodeToUTF8(s)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUnicodeToUTF8(s);
	} // fallback
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	return fin.length > 0 ? u + fin : u;
}

function convertUriToUTF8(uri,charSet)
{
	if(window.netscape == undefined || charSet == undefined || charSet == "")
		return uri;
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/utf8converterservice;1"].getService(Components.interfaces.nsIUTF8ConverterService);
	} catch(ex) {
		return uri;
	}
	return converter.convertURISpecToUTF8(uri,charSet);
}

function copyFile(dest,source)
{
	return config.browser.isIE ? ieCopyFile(dest,source) : false;
}

function saveFile(fileUrl,content)
{
	var r = mozillaSaveFile(fileUrl,content);
	if(!r)
		r = ieSaveFile(fileUrl,content);
	if(!r)
		r = javaSaveFile(fileUrl,content);
	return r;
}

function loadFile(fileUrl)
{
	var r = mozillaLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = ieLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = javaLoadFile(fileUrl);
	return r;
}

function ieCreatePath(path)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}

	var pos = path.lastIndexOf("\\");
	if(pos!=-1)
		path = path.substring(0,pos+1);

	var scan = [path];
	var parent = fso.GetParentFolderName(path);
	while(parent && !fso.FolderExists(parent)) {
		scan.push(parent);
		parent = fso.GetParentFolderName(parent);
	}

	for(i=scan.length-1;i>=0;i--) {
		if(!fso.FolderExists(scan[i])) {
			fso.CreateFolder(scan[i]);
		}
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath,content)
{
	ieCreatePath(filePath);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(content);
	file.Close();
	return true;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var file = fso.OpenTextFile(filePath,1);
		var content = file.ReadAll();
		file.Close();
	} catch(ex) {
		return null;
	}
	return content;
}

function ieCopyFile(dest,source)
{
	ieCreatePath(dest);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		fso.GetFile(source).Copy(dest);
	} catch(ex) {
		return false;
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath,content)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				file.create(0,0664);
			var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file,0x20|0x02,00004,null);
			out.write(content,content.length);
			out.flush();
			out.close();
			return true;
		} catch(ex) {
			return false;
		}
	}
	return null;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				return null;
			var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
			inputStream.init(file,0x01,00004,null);
			var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
			sInputStream.init(inputStream);
			var contents = sInputStream.read(sInputStream.available());
			sInputStream.close();
			inputStream.close();
			return contents;
		} catch(ex) {
			return false;
		}
	}
	return null;
}

function javaUrlToFilename(url)
{
	var f = "//localhost";
	if(url.indexOf(f) == 0)
		return url.substring(f.length);
	var i = url.indexOf(":");
	return i > 0 ? url.substring(i-1) : url;
}

function javaSaveFile(filePath,content)
{
	try {
		if(document.applets["TiddlySaver"])
			return document.applets["TiddlySaver"].saveFile(javaUrlToFilename(filePath),"UTF-8",content);
	} catch(ex) {
	}
	try {
		var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));
		s.print(content);
		s.close();
	} catch(ex) {
		return null;
	}
	return true;
}

function javaLoadFile(filePath)
{
	try {
		if(document.applets["TiddlySaver"])
			return String(document.applets["TiddlySaver"].loadFile(javaUrlToFilename(filePath),"UTF-8"));
	} catch(ex) {
	}
	var content = [];
	try {
		var r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));
		var line;
		while((line = r.readLine()) != null)
			content.push(new String(line));
		r.close();
	} catch(ex) {
		return null;
	}
	return content.join("\n");
}

//--
//-- Server adaptor base class
//--

function AdaptorBase()
{
	this.host = null;
	this.store = null;
	return this;
}

AdaptorBase.prototype.close = function()
{
	return true;
};

AdaptorBase.prototype.fullHostName = function(host)
{
	if(!host)
		return '';
	host = host.trim();
	if(!host.match(/:\/\//))
		host = 'http://' + host;
	if(host.substr(host.length-1) == '/')
		host = host.substr(0,host.length-1)
	return host;
};

AdaptorBase.minHostName = function(host)
{
	return host ? host.replace(/^http:\/\//,'').replace(/\/$/,'') : '';
};

AdaptorBase.prototype.setContext = function(context,userParams,callback)
{
	if(!context) context = {};
	context.userParams = userParams;
	if(callback) context.callback = callback;
	context.adaptor = this;
	if(!context.host)
		context.host = this.host;
	context.host = this.fullHostName(context.host);
	if(!context.workspace)
		context.workspace = this.workspace;
	return context;
};

// Open the specified host
AdaptorBase.prototype.openHost = function(host,context,userParams,callback)
{
	this.host = host;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {context.callback(context,userParams);},10);
	return true;
};

// Open the specified workspace
AdaptorBase.prototype.openWorkspace = function(workspace,context,userParams,callback)
{
	this.workspace = workspace;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

//--
//-- Server adaptor for talking to static TiddlyWiki files
//--

function FileAdaptor()
{
}

FileAdaptor.prototype = new AdaptorBase();

FileAdaptor.serverType = 'file';
FileAdaptor.serverLabel = 'TiddlyWiki';

FileAdaptor.loadTiddlyWikiCallback = function(status,context,responseText,url,xhr)
{
	context.status = status;
	if(!status) {
		context.statusText = "Error reading file";
	} else {
		context.adaptor.store = new TiddlyWiki();
		if(!context.adaptor.store.importTiddlyWiki(responseText)) {
			context.statusText = config.messages.invalidFileError.format([url]);
			context.status = false;
		}
	}
	context.complete(context,context.userParams);
};

// Get the list of workspaces on a given server
FileAdaptor.prototype.getWorkspaceList = function(context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.workspaces = [{title:"(default)"}];
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

// Gets the list of tiddlers within a given workspace
FileAdaptor.prototype.getTiddlerList = function(context,userParams,callback,filter)
{
	context = this.setContext(context,userParams,callback);
	if(!context.filter)
		context.filter = filter;
	context.complete = FileAdaptor.getTiddlerListComplete;
	if(this.store) {
		var ret = context.complete(context,context.userParams);
	} else {
		ret = loadRemoteFile(context.host,FileAdaptor.loadTiddlyWikiCallback,context);
		if(typeof ret != "string")
			ret = true;
	}
	return ret;
};

FileAdaptor.getTiddlerListComplete = function(context,userParams)
{
	if(context.status) {
		if(context.filter) {
			context.tiddlers = context.adaptor.store.filterTiddlers(context.filter);
		} else {
			context.tiddlers = [];
			context.adaptor.store.forEachTiddler(function(title,tiddler) {context.tiddlers.push(tiddler);});
		}
		for(var i=0; i<context.tiddlers.length; i++) {
			context.tiddlers[i].fields['server.type'] = FileAdaptor.serverType;
			context.tiddlers[i].fields['server.host'] = AdaptorBase.minHostName(context.host);
			context.tiddlers[i].fields['server.page.revision'] = context.tiddlers[i].modified.convertToYYYYMMDDHHMM();
		}
		context.status = true;
	}
	if(context.callback) {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.generateTiddlerInfo = function(tiddler)
{
	var info = {};
	info.uri = tiddler.fields['server.host'] + "#" + tiddler.title;
	return info;
};

// Retrieve a tiddler from a given workspace on a given server
FileAdaptor.prototype.getTiddler = function(title,context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.title = title;
	context.complete = FileAdaptor.getTiddlerComplete;
	return context.adaptor.store ?
		context.complete(context,context.userParams) :
		loadRemoteFile(context.host,FileAdaptor.loadTiddlyWikiCallback,context);
};

FileAdaptor.getTiddlerComplete = function(context,userParams)
{
	var t = context.adaptor.store.fetchTiddler(context.title);
	t.fields['server.type'] = FileAdaptor.serverType;
	t.fields['server.host'] = AdaptorBase.minHostName(context.host);
	t.fields['server.page.revision'] = t.modified.convertToYYYYMMDDHHMM();
	context.tiddler = t;
	context.status = true;
	if(context.allowSynchronous) {
		context.isSynchronous = true;
		context.callback(context,userParams);
	} else {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.close = function()
{
	delete this.store;
	this.store = null;
};

config.adaptors[FileAdaptor.serverType] = FileAdaptor;

config.defaultAdaptor = FileAdaptor.serverType;

//--
//-- Remote HTTP requests
//--

function loadRemoteFile(url,callback,params)
{
	return httpReq("GET",url,callback,params);
}

function httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache)
{
	var x = null;
	try {
		x = new XMLHttpRequest(); //# Modern
	} catch(ex) {
		try {
			x = new ActiveXObject("Msxml2.XMLHTTP"); //# IE 6
		} catch(ex2) {
		}
	}
	if(!x)
		return "Can't create XMLHttpRequest object";
	x.onreadystatechange = function() {
		try {
			var status = x.status;
		} catch(ex) {
			status = false;
		}
		if(x.readyState == 4 && callback && (status !== undefined)) {
			if([0, 200, 201, 204, 207].contains(status))
				callback(true,params,x.responseText,url,x);
			else
				callback(false,params,null,url,x);
			x.onreadystatechange = function(){};
			x = null;
		}
	};
	if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	try {
		if(!allowCache)
			url = url + (url.indexOf("?") < 0 ? "?" : "&") + "nocache=" + Math.random();
		x.open(type,url,true,username,password);
		if(data)
			x.setRequestHeader("Content-Type", contentType || "application/x-www-form-urlencoded");
		if(x.overrideMimeType)
			x.setRequestHeader("Connection", "close");
		if(headers) {
			for(var n in headers)
				x.setRequestHeader(n,headers[n]);
		}
		x.setRequestHeader("X-Requested-With", "TiddlyWiki " + formatVersion());
		x.send(data);
	} catch(ex) {
		return exceptionText(ex);
	}
	return x;
}

// included for compatibility
function getXMLHttpRequest()
{
	try {
		var x = new XMLHttpRequest(); // Modern
	} catch(ex) {
		try {
			x = new ActiveXObject("Msxml2.XMLHTTP"); // IE 6
		} catch (ex2) {
			return null;
		}
	}
	return x;
}

// included for compatibility
function doHttp(type,url,data,contentType,username,password,callback,params,headers,allowCache)
{
	return httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache);
}

//--
//-- TiddlyWiki-specific utility functions
//--

function formatVersion(v)
{
	v = v || version;
	return v.major + "." + v.minor + "." + v.revision + (v.beta ? " (beta " + v.beta + ")" : "");
}

function compareVersions(v1,v2)
{
	var a = ["major","minor","revision"];
	for(var i = 0; i<a.length; i++) {
		var x1 = v1[a[i]] || 0;
		var x2 = v2[a[i]] || 0;
		if(x1<x2)
			return 1;
		if(x1>x2)
			return -1;
	}
	x1 = v1.beta || 9999;
	x2 = v2.beta || 9999;
	if(x1<x2)
		return 1;
	return x1 > x2 ? -1 : 0;
}

function createTiddlyButton(parent,text,tooltip,action,className,id,accessKey,attribs)
{
	var btn = document.createElement("a");
	if(action) {
		btn.onclick = action;
		btn.setAttribute("href","javascript:;");
	}
	if(tooltip)
		btn.setAttribute("title",tooltip);
	if(text)
		btn.appendChild(document.createTextNode(text));
	btn.className = className || "button";
	if(id)
		btn.id = id;
	if(attribs) {
		for(var i in attribs) {
			btn.setAttribute(i,attribs[i]);
		}
	}
	if(parent)
		parent.appendChild(btn);
	if(accessKey)
		btn.setAttribute("accessKey",accessKey);
	return btn;
}

function createTiddlyLink(place,title,includeText,className,isStatic,linkedFromTiddler,noToggle)
{
	var text = includeText ? title : null;
	var i = getTiddlyLinkInfo(title,className);
	var btn = isStatic ? createExternalLink(place,store.getTiddlerText("SiteUrl",null) + "#" + title) : createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);
	if(isStatic)
		btn.className += ' ' + className;
	btn.setAttribute("refresh","link");
	btn.setAttribute("tiddlyLink",title);
	if(noToggle)
		btn.setAttribute("noToggle","true");
	if(linkedFromTiddler) {
		var fields = linkedFromTiddler.getInheritedFields();
		if(fields)
			btn.setAttribute("tiddlyFields",fields);
	}
	return btn;
}

function refreshTiddlyLink(e,title)
{
	var i = getTiddlyLinkInfo(title,e.className);
	e.className = i.classes;
	e.title = i.subTitle;
}

function getTiddlyLinkInfo(title,currClasses)
{
	var classes = currClasses ? currClasses.split(" ") : [];
	classes.pushUnique("tiddlyLink");
	var tiddler = store.fetchTiddler(title);
	var subTitle;
	if(tiddler) {
		subTitle = tiddler.getSubtitle();
		classes.pushUnique("tiddlyLinkExisting");
		classes.remove("tiddlyLinkNonExisting");
		classes.remove("shadow");
	} else {
		classes.remove("tiddlyLinkExisting");
		classes.pushUnique("tiddlyLinkNonExisting");
		if(store.isShadowTiddler(title)) {
			subTitle = config.messages.shadowedTiddlerToolTip.format([title]);
			classes.pushUnique("shadow");
		} else {
			subTitle = config.messages.undefinedTiddlerToolTip.format([title]);
			classes.remove("shadow");
		}
	}
	if(typeof config.annotations[title]=="string")
		subTitle = config.annotations[title];
	return {classes: classes.join(" "),subTitle: subTitle};
}

function createExternalLink(place,url)
{
	var link = document.createElement("a");
	link.className = "externalLink";
	link.href = url;
	link.title = config.messages.externalLinkTooltip.format([url]);
	if(config.options.chkOpenInNewWindow)
		link.target = "_blank";
	place.appendChild(link);
	return link;
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	var link = target;
	var title = null;
	var fields = null;
	var noToggle = null;
	do {
		title = link.getAttribute("tiddlyLink");
		fields = link.getAttribute("tiddlyFields");
		noToggle = link.getAttribute("noToggle");
		link = link.parentNode;
	} while(title == null && link != null);
	if(!store.isShadowTiddler(title)) {
		var f = fields ? fields.decodeHashMap() : {};
		fields = String.encodeHashMap(merge(f,config.defaultCustomFields,true));
	}
	if(title) {
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		if(noToggle)
			toggling = false;
		if(store.getTiddler(title))
			fields = null;
		story.displayTiddler(target,title,null,true,null,fields,toggling);
	}
	clearMessage();
	return false;
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler,title,tooltip)
{
	var btn = createTiddlyButton(place,title||tag,(tooltip||config.views.wikified.tag.tooltip).format([tag]),onClickTag);
	btn.setAttribute("tag",tag);
	if(excludeTiddler)
		btn.setAttribute("tiddler",excludeTiddler);
	return btn;
}

// Event handler for clicking on a tiddler tag
function onClickTag(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag) {
		var tagged = store.getTaggedTiddlers(tag);
		var titles = [];
		var li,r;
		for(r=0;r<tagged.length;r++) {
			if(tagged[r].title != title)
				titles.push(tagged[r].title);
		}
		var lingo = config.views.wikified.tag;
		if(titles.length > 0) {
			var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
			for(r=0; r<titles.length; r++) {
				createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
			}
		} else {
			createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),lingo.popupNone.format([tag]));
		}
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
		createTiddlyText(h,lingo.openTag.format([tag]));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(ev)
{
	var tiddlers = store.getTaggedTiddlers(this.getAttribute("tag"));
	story.displayTiddlers(this,tiddlers);
	return false;
}

function onClickError(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	var lines = this.getAttribute("errorText").split("\n");
	for(var t=0; t<lines.length; t++)
		createTiddlyElement(popup,"li",null,null,lines[t]);
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyDropDown(place,onchange,options,defaultValue)
{
	var sel = createTiddlyElement(place,"select");
	sel.onchange = onchange;
	for(var t=0; t<options.length; t++) {
		var e = createTiddlyElement(sel,"option",null,null,options[t].caption);
		e.value = options[t].name;
		if(options[t].name == defaultValue)
			e.selected = true;
	}
	return sel;
}

function createTiddlyPopup(place,caption,tooltip,tiddler)
{
	if(tiddler.text) {
		createTiddlyLink(place,caption,true);
		var btn = createTiddlyButton(place,glyph("downArrow"),tooltip,onClickTiddlyPopup,"tiddlerPopupButton");
		btn.tiddler = tiddler;
	} else {
		createTiddlyText(place,caption);
	}
}

function onClickTiddlyPopup(ev)
{
	var e = ev || window.event;
	var tiddler = this.tiddler;
	if(tiddler.text) {
		var popup = Popup.create(this,"div","popupTiddler");
		wikify(tiddler.text,popup,null,tiddler);
		Popup.show();
	}
	if(e) e.cancelBubble = true;
	if(e && e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyError(place,title,text)
{
	var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
	if(text) btn.setAttribute("errorText",text);
}

function merge(dst,src,preserveExisting)
{
	for(var i in src) {
		if(!preserveExisting || dst[i] === undefined)
			dst[i] = src[i];
	}
	return dst;
}

// Returns a string containing the description of an exception, optionally prepended by a message
function exceptionText(e,message)
{
	var s = e.description || e.toString();
	return message ? "%0:\n%1".format([message,s]) : s;
}

// Displays an alert of an exception description with optional message
function showException(e,message)
{
	alert(exceptionText(e,message));
}

function alertAndThrow(m)
{
	alert(m);
	throw(m);
}

function glyph(name)
{
	var g = config.glyphs;
	var b = g.currBrowser;
	if(b == null) {
		b = 0;
		while(!g.browsers[b]() && b < g.browsers.length-1)
			b++;
		g.currBrowser = b;
	}
	if(!g.codes[name])
		return "";
	return g.codes[name][b];
}

if(!window.console) {
	console = {log:function(message) {displayMessage(message);}};
}

//-
//- Animation engine
//-

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID = 0; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() //# Variable number of arguments
{
	for(var t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0) {
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},10);
	}
	this.running += arguments.length;
};

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a < me.animations.length) {
		var animation = me.animations[a];
		if(animation.tick()) {
			a++;
		} else {
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
		}
	}
};

Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
};

//--
//-- Morpher animation
//--

// Animate a set of properties of an element
function Morpher(element,duration,properties,callback)
{
	this.element = element;
	this.duration = duration;
	this.properties = properties;
	this.startTime = new Date();
	this.endTime = Number(this.startTime) + duration;
	this.callback = callback;
	this.tick();
	return this;
}

Morpher.prototype.assignStyle = function(element,style,value)
{
	switch(style) {
	case "-tw-vertScroll":
		window.scrollTo(findScrollX(),value);
		break;
	case "-tw-horizScroll":
		window.scrollTo(value,findScrollY());
		break;
	default:
		element.style[style] = value;
		break;
	}
};

Morpher.prototype.stop = function()
{
	for(var t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.atEnd !== undefined) {
			this.assignStyle(this.element,p.style,p.atEnd);
		}
	}
	if(this.callback)
		this.callback(this.element,this.properties);
};

Morpher.prototype.tick = function()
{
	var currTime = Number(new Date());
	var progress = Animator.slowInSlowOut(Math.min(1,(currTime-this.startTime)/this.duration));
	for(var t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.start !== undefined && p.end !== undefined) {
			var template = p.template || "%0";
			switch(p.format) {
			case undefined:
			case "style":
				var v = p.start + (p.end-p.start) * progress;
				this.assignStyle(this.element,p.style,template.format([v]));
				break;
			case "color":
				break;
			}
		}
	}
	if(currTime >= this.endTime) {
		this.stop();
		return false;
	}
	return true;
};

//--
//-- Zoomer animation
//--

function Zoomer(text,startElement,targetElement,unused)
{
	var e = createTiddlyElement(document.body,"div",null,"zoomer");
	createTiddlyElement(e,"div",null,null,text);
	var winWidth = findWindowWidth();
	var winHeight = findWindowHeight();
	var p = [
		{style: 'left', start: findPosX(startElement), end: findPosX(targetElement), template: '%0px'},
		{style: 'top', start: findPosY(startElement), end: findPosY(targetElement), template: '%0px'},
		{style: 'width', start: Math.min(startElement.scrollWidth,winWidth), end: Math.min(targetElement.scrollWidth,winWidth), template: '%0px', atEnd: 'auto'},
		{style: 'height', start: Math.min(startElement.scrollHeight,winHeight), end: Math.min(targetElement.scrollHeight,winHeight), template: '%0px', atEnd: 'auto'},
		{style: 'fontSize', start: 8, end: 24, template: '%0pt'}
	];
	var c = function(element,properties) {removeNode(element);};
	return new Morpher(e,config.animDuration,p,c);
}

//--
//-- Scroller animation
//--

function Scroller(targetElement)
{
	var p = [{style: '-tw-vertScroll', start: findScrollY(), end: ensureVisible(targetElement)}];
	return new Morpher(targetElement,config.animDuration,p);
}

//--
//-- Slider animation
//--

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,unused,deleteMode)
{
	element.style.overflow = 'hidden';
	if(opening)
		element.style.height = '0px'; // Resolves a Firefox flashing bug
	element.style.display = 'block';
	var left = findPosX(element);
	var width = element.scrollWidth;
	var height = element.scrollHeight;
	var winWidth = findWindowWidth();
	var p = [];
	var c = null;
	if(opening) {
		p.push({style: 'height', start: 0, end: height, template: '%0px', atEnd: 'auto'});
		p.push({style: 'opacity', start: 0, end: 1, template: '%0'});
		p.push({style: 'filter', start: 0, end: 100, template: 'alpha(opacity:%0)'});
	} else {
		p.push({style: 'height', start: height, end: 0, template: '%0px'});
		p.push({style: 'display', atEnd: 'none'});
		p.push({style: 'opacity', start: 1, end: 0, template: '%0'});
		p.push({style: 'filter', start: 100, end: 0, template: 'alpha(opacity:%0)'});
		switch(deleteMode) {
		case "all":
			c = function(element,properties) {removeNode(element);};
			break;
		case "children":
			c = function(element,properties) {removeChildren(element);};
			break;
		}
	}
	return new Morpher(element,config.animDuration,p,c);
}

//--
//-- Popup menu
//--

var Popup = {
	stack: [] // Array of objects with members root: and popup:
	};

Popup.create = function(root,elem,className)
{
	var stackPosition = this.find(root,"popup");
	Popup.remove(stackPosition+1);
	var popup = createTiddlyElement(document.body,elem || "ol","popup",className || "popup");
	popup.stackPosition = stackPosition;
	Popup.stack.push({root: root, popup: popup});
	return popup;
};

Popup.onDocumentClick = function(ev)
{
	var e = ev || window.event;
	if(e.eventPhase == undefined)
		Popup.remove();
	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
		Popup.remove();
	return true;
};

Popup.show = function(valign,halign,offset)
{
	var curr = Popup.stack[Popup.stack.length-1];
	this.place(curr.root,curr.popup,valign,halign,offset);
	addClass(curr.root,"highlight");
	if(config.options.chkAnimate && anim && typeof Scroller == "function")
		anim.startAnimating(new Scroller(curr.popup));
	else
		window.scrollTo(0,ensureVisible(curr.popup));
};

Popup.place = function(root,popup,valign,halign,offset)
{
	if(!offset)
		var offset = {x:0,y:0};
	if(popup.stackPosition >= 0 && !valign && !halign) {
		offset.x = offset.x + root.offsetWidth;
	} else {
		offset.x = (halign == 'right') ? offset.x + root.offsetWidth : offset.x;
		offset.y = (valign == 'top') ? offset.y : offset.y + root.offsetHeight;
	}
	var rootLeft = findPosX(root);
	var rootTop = findPosY(root);
	var popupLeft = rootLeft + offset.x;
	var popupTop = rootTop + offset.y;
	var winWidth = findWindowWidth();
	if(popup.offsetWidth > winWidth*0.75)
		popup.style.width = winWidth*0.75 + "px";
	var popupWidth = popup.offsetWidth;
	var scrollWidth = winWidth - document.body.offsetWidth;
	if(popupLeft + popupWidth > winWidth - scrollWidth - 1) {
		if(halign == 'right')
			popupLeft = popupLeft - root.offsetWidth - popupWidth;
		else
			popupLeft = winWidth - popupWidth - scrollWidth - 1;
	}
	popup.style.left = popupLeft + "px";
	popup.style.top = popupTop + "px";
	popup.style.display = "block";
};

Popup.find = function(e)
{
	var pos = -1;
	for (var t=this.stack.length-1; t>=0; t--) {
		if(isDescendant(e,this.stack[t].popup))
			pos = t;
	}
	return pos;
};

Popup.remove = function(pos)
{
	if(!pos) var pos = 0;
	if(Popup.stack.length > pos) {
		Popup.removeFrom(pos);
	}
};

Popup.removeFrom = function(from)
{
	for(var t=Popup.stack.length-1; t>=from; t--) {
		var p = Popup.stack[t];
		removeClass(p.root,"highlight");
		removeNode(p.popup);
	}
	Popup.stack = Popup.stack.slice(0,from);
};

//--
//-- Wizard support
//--

function Wizard(elem)
{
	if(elem) {
		this.formElem = findRelated(elem,"wizard","className");
		this.bodyElem = findRelated(this.formElem.firstChild,"wizardBody","className","nextSibling");
		this.footElem = findRelated(this.formElem.firstChild,"wizardFooter","className","nextSibling");
	} else {
		this.formElem = null;
		this.bodyElem = null;
		this.footElem = null;
	}
}

Wizard.prototype.setValue = function(name,value)
{
	if(this.formElem)
		this.formElem[name] = value;
};

Wizard.prototype.getValue = function(name)
{
	return this.formElem ? this.formElem[name] : null;
};

Wizard.prototype.createWizard = function(place,title)
{
	this.formElem = createTiddlyElement(place,"form",null,"wizard");
	createTiddlyElement(this.formElem,"h1",null,null,title);
	this.bodyElem = createTiddlyElement(this.formElem,"div",null,"wizardBody");
	this.footElem = createTiddlyElement(this.formElem,"div",null,"wizardFooter");
};

Wizard.prototype.clear = function()
{
	removeChildren(this.bodyElem);
};

Wizard.prototype.setButtons = function(buttonInfo,status)
{
	removeChildren(this.footElem);
	for(var t=0; t<buttonInfo.length; t++) {
		createTiddlyButton(this.footElem,buttonInfo[t].caption,buttonInfo[t].tooltip,buttonInfo[t].onClick);
		insertSpacer(this.footElem);
		}
	if(typeof status == "string") {
		createTiddlyElement(this.footElem,"span",null,"status",status);
	}
};

Wizard.prototype.addStep = function(stepTitle,html)
{
	removeChildren(this.bodyElem);
	var w = createTiddlyElement(this.bodyElem,"div");
	createTiddlyElement(w,"h2",null,null,stepTitle);
	var step = createTiddlyElement(w,"div",null,"wizardStep");
	step.innerHTML = html;
	applyHtmlMacros(step,tiddler);
};

Wizard.prototype.getElement = function(name)
{
	return this.formElem.elements[name];
};

//--
//-- ListView gadget
//--

var ListView = {};

// Create a listview
ListView.create = function(place,listObject,listTemplate,callback,className)
{
	var table = createTiddlyElement(place,"table",null,className || "listView twtable");
	var thead = createTiddlyElement(table,"thead");
	var r = createTiddlyElement(thead,"tr");
	for(var t=0; t<listTemplate.columns.length; t++) {
		var columnTemplate = listTemplate.columns[t];
		var c = createTiddlyElement(r,"th");
		var colType = ListView.columnTypes[columnTemplate.type];
		if(colType && colType.createHeader) {
			colType.createHeader(c,columnTemplate,t);
			if(columnTemplate.className)
				addClass(c,columnTemplate.className);
		}
	}
	var tbody = createTiddlyElement(table,"tbody");
	for(var rc=0; rc<listObject.length; rc++) {
		var rowObject = listObject[rc];
		r = createTiddlyElement(tbody,"tr");
		for(c=0; c<listTemplate.rowClasses.length; c++) {
			if(rowObject[listTemplate.rowClasses[c].field])
				addClass(r,listTemplate.rowClasses[c].className);
		}
		rowObject.rowElement = r;
		rowObject.colElements = {};
		for(var cc=0; cc<listTemplate.columns.length; cc++) {
			c = createTiddlyElement(r,"td");
			columnTemplate = listTemplate.columns[cc];
			var field = columnTemplate.field;
			colType = ListView.columnTypes[columnTemplate.type];
			if(colType && colType.createItem) {
				colType.createItem(c,rowObject,field,columnTemplate,cc,rc);
				if(columnTemplate.className)
					addClass(c,columnTemplate.className);
			}
			rowObject.colElements[field] = c;
		}
	}
	if(callback && listTemplate.actions)
		createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);
	if(callback && listTemplate.buttons) {
		for(t=0; t<listTemplate.buttons.length; t++) {
			var a = listTemplate.buttons[t];
			if(a && a.name != "")
				createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));
		}
	}
	return table;
};

ListView.getCommandHandler = function(callback,name,allowEmptySelection)
{
	return function(e) {
		var view = findRelated(this,"TABLE",null,"previousSibling");
		var tiddlers = [];
		ListView.forEachSelector(view,function(e,rowName) {
					if(e.checked)
						tiddlers.push(rowName);
					});
		if(tiddlers.length == 0 && !allowEmptySelection) {
			alert(config.messages.nothingSelected);
		} else {
			if(this.nodeName.toLowerCase() == "select") {
				callback(view,this.value,tiddlers);
				this.selectedIndex = 0;
			} else {
				callback(view,name,tiddlers);
			}
		}
	};
};

// Invoke a callback for each selector checkbox in the listview
ListView.forEachSelector = function(view,callback)
{
	var checkboxes = view.getElementsByTagName("input");
	var hadOne = false;
	for(var t=0; t<checkboxes.length; t++) {
		var cb = checkboxes[t];
		if(cb.getAttribute("type") == "checkbox") {
			var rn = cb.getAttribute("rowName");
			if(rn) {
				callback(cb,rn);
				hadOne = true;
			}
		}
	}
	return hadOne;
};

ListView.getSelectedRows = function(view)
{
	var rowNames = [];
	ListView.forEachSelector(view,function(e,rowName) {
				if(e.checked)
					rowNames.push(rowName);
				});
	return rowNames;
};

ListView.columnTypes = {};

ListView.columnTypes.String = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyText(place,columnTemplate.title);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v);
		}
};

ListView.columnTypes.WikiText = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				wikify(v,place,null,null);
		}
};

ListView.columnTypes.Tiddler = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined && v.title)
				createTiddlyPopup(place,v.title,config.messages.listView.tiddlerTooltip,v);
		}
};

ListView.columnTypes.Size = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var t = 0;
				while(t<config.messages.sizeTemplates.length-1 && v<config.messages.sizeTemplates[t].unit)
					t++;
				createTiddlyText(place,config.messages.sizeTemplates[t].template.format([Math.round(v/config.messages.sizeTemplates[t].unit)]));
			}
		}
};

ListView.columnTypes.Link = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			var c = columnTemplate.text;
			if(v != undefined)
				createTiddlyText(createExternalLink(place,v),c || v);
		}
};

ListView.columnTypes.Date = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v.formatString(columnTemplate.dateFormat));
		}
};

ListView.columnTypes.StringList = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				for(var t=0; t<v.length; t++) {
					createTiddlyText(place,v[t]);
					createTiddlyElement(place,"br");
				}
			}
		}
};

ListView.columnTypes.Selector = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyCheckbox(place,null,false,this.onHeaderChange);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],null);
			e.setAttribute("rowName",listObject[columnTemplate.rowName]);
		},
	onHeaderChange: function(e)
		{
			var state = this.checked;
			var view = findRelated(this,"TABLE");
			if(!view)
				return;
			ListView.forEachSelector(view,function(e,rowName) {
								e.checked = state;
							});
		}
};

ListView.columnTypes.Tags = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var tags = listObject[field];
			createTiddlyText(place,String.encodeTiddlyLinkList(tags));
		}
};

ListView.columnTypes.Boolean = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			if(listObject[field] == true)
				createTiddlyText(place,columnTemplate.trueText);
			if(listObject[field] == false)
				createTiddlyText(place,columnTemplate.falseText);
		}
};

ListView.columnTypes.TagCheckbox = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);
			e.setAttribute("tiddler",listObject.title);
			e.setAttribute("tag",columnTemplate.tag);
		},
	onChange : function(e)
		{
			var tag = this.getAttribute("tag");
			var tiddler = this.getAttribute("tiddler");
			store.setTiddlerTag(tiddler,this.checked,tag);
		}
};

ListView.columnTypes.TiddlerLink = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);
				createTiddlyText(link,listObject[field]);
			}
		}
};

//--
//-- Augmented methods for the JavaScript Number(), Array(), String() and Date() objects
//--

// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	var c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return c;
};

// Add indexOf function if browser does not support it
if(!Array.indexOf) {
Array.prototype.indexOf = function(item,from)
{
	if(!from)
		from = 0;
	for(var i=from; i<this.length; i++) {
		if(this[i] === item)
			return i;
	}
	return -1;
};}

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field,value)
{
	for(var t=0; t<this.length; t++) {
		if(this[t][field] == value)
			return t;
	}
	return null;
};

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
Array.prototype.setItem = function(value,mode)
{
	var p = this.indexOf(value);
	if(mode == 0)
		mode = (p == -1) ? +1 : -1;
	if(mode == +1) {
		if(p == -1)
			this.push(value);
	} else if(mode == -1) {
		if(p != -1)
			this.splice(p,1);
	}
};

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
	for(var i=0; i<items.length; i++) {
		if(this.indexOf(items[i]) != -1)
			return true;
	}
	return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
	for(var i = 0; i<items.length; i++) {
		if(this.indexOf(items[i]) == -1)
			return false;
	}
	return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique === false) {
		this.push(item);
	} else {
		if(this.indexOf(item) == -1)
			this.push(item);
	}
};

Array.prototype.remove = function(item)
{
	var p = this.indexOf(item);
	if(p != -1)
		this.splice(p,1);
};

if(!Array.prototype.map) {
Array.prototype.map = function(fn,thisObj)
{
	var scope = thisObj || window;
	var a = [];
	for(var i=0, j=this.length; i < j; ++i) {
		a.push(fn.call(scope,this[i],i,this));
	}
	return a;
};}

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	return n < this.length ? this.slice(this.length-n) : this;
};

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	return this.replace(/^\s*|\s*$/g,"");
};

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
	var s = this.split("-");
	if(s.length > 1) {
		for(var t=1; t<s.length; t++)
			s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
	}
	return s.join("");
};

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(substrings)
{
	var subRegExp = /(?:%(\d+))/mg;
	var currPos = 0;
	var r = [];
	do {
		var match = subRegExp.exec(this);
		if(match && match[1]) {
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1])]);
			currPos = subRegExp.lastIndex;
		}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
};

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	var s = "\\^$*+?()=!|,{}[].";
	var c = this;
	for(var t=0; t<s.length; t++)
		c = c.replace(new RegExp("\\" + s.substr(t,1),"g"),"\\" + s.substr(t,1));
	return c;
};

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
	return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
};

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
	return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
};

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	return this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;");
};

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
	return this.replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\"").replace(/&amp;/mg,"&");
};

// Convert a string to it's JSON representation by encoding control characters, double quotes and backslash. See json.org
String.prototype.toJSONString = function()
{
	var m = {
		'\b': '\\b',
		'\f': '\\f',
		'\n': '\\n',
		'\r': '\\r',
		'\t': '\\t',
		'"' : '\\"',
		'\\': '\\\\'
		};
	var replaceFn = function(a,b) {
		var c = m[b];
		if(c)
			return c;
		c = b.charCodeAt();
		return '\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
		};
	if(/["\\\x00-\x1f]/.test(this))
		return '"' + this.replace(/([\x00-\x1f\\"])/g,replaceFn) + '"';
	return '"' + this + '"';
};

// Parse a space-separated string of name:value parameters
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)
{
	var parseToken = function(match,p) {
		var n;
		if(match[p]) // Double quoted
			n = match[p];
		else if(match[p+1]) // Single quoted
			n = match[p+1];
		else if(match[p+2]) // Double-square-bracket quoted
			n = match[p+2];
		else if(match[p+3]) // Double-brace quoted
			try {
				n = match[p+3];
				if(allowEval)
					n = window.eval(n);
			} catch(ex) {
				throw "Unable to evaluate {{" + match[p+3] + "}}: " + exceptionText(ex);
			}
		else if(match[p+4]) // Unquoted
			n = match[p+4];
		else if(match[p+5]) // empty quote
			n = "";
		return n;
	};
	var r = [{}];
	var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
	var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
	var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
	var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
	var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
	var emptyQuote = "((?:\"\")|(?:''))";
	var skipSpace = "(?:\\s*)";
	var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
	var re = noNames ? new RegExp(token,"mg") : new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?","mg");
	var params = [];
	do {
		var match = re.exec(this);
		if(match) {
			var n = parseToken(match,1);
			if(noNames) {
				r.push({name:"",value:n});
			} else {
				var v = parseToken(match,8);
				if(v == null && defaultName) {
					v = n;
					n = defaultName;
				} else if(v == null && defaultValue) {
					v = defaultValue;
				}
				r.push({name:n,value:v});
				if(cascadeDefaults) {
					defaultName = n;
					defaultValue = v;
				}
			}
		}
	} while(match);
	// Summarise parameters into first element
	for(var t=1; t<r.length; t++) {
		if(r[0][r[t].name])
			r[0][r[t].name].push(r[t].value);
		else
			r[0][r[t].name] = [r[t].value];
	}
	return r;
};

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function()
{
	var p = this.parseParams("list",null,true,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.push(p[t].value);
	return n;
};

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var p = this.parseParams("list",null,false,true);
	var n = [];
	for(var t=1; t<p.length; t++) {
		if(p[t].value)
			n.pushUnique(p[t].value,unique);
	}
	return n;
};

// Returns array with start and end index of chunk between given start and end marker, or undefined.
String.prototype.getChunkRange = function(start,end)
{
	var s = this.indexOf(start);
	if(s != -1) {
		s += start.length;
		var e = this.indexOf(end,s);
		if(e != -1)
			return [s,e];
	}
};

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
	var r = this.getChunkRange(start,end);
	return r ? this.substring(0,r[0]) + sub + this.substring(r[1]) : this;
};

// Returns a chunk of a string between start and end markers, or undefined
String.prototype.getChunk = function(start,end)
{
	var r = this.getChunkRange(start,end);
	if(r)
		return this.substring(r[0],r[1]);
};


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	return title.indexOf(" ") == -1 ? title : "[[" + title + "]]";
};

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
	if(list) {
		var results = [];
		for(var t=0; t<list.length; t++)
			results.push(String.encodeTiddlyLink(list[t]));
		return results.join(" ");
	} else {
		return "";
	}
};

// Convert a string as a sequence of name:"value" pairs into a hashmap
String.prototype.decodeHashMap = function()
{
	var fields = this.parseParams("anon","",false);
	var r = {};
	for(var t=1; t<fields.length; t++)
		r[fields[t].name] = fields[t].value;
	return r;
};

// Static method to encode a hashmap into a name:"value"... string
String.encodeHashMap = function(hashmap)
{
	var r = [];
	for(var t in hashmap)
		r.push(t + ':"' + hashmap[t] + '"');
	return r.join(" ");
};

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return s;
};

String.prototype.startsWith = function(prefix)
{
	return !prefix || this.substring(0,prefix.length) == prefix;
};

// Returns the first value of the given named parameter.
function getParam(params,name,defaultValue)
{
	if(!params)
		return defaultValue;
	var p = params[0][name];
	return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
function getFlag(params,name,defaultValue)
{
	return !!getParam(params,name,defaultValue);
}

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
	t = t.replace(/hh12/g,this.getHours12());
	t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
	t = t.replace(/hh/g,this.getHours());
	t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
	t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
	t = t.replace(/mm/g,this.getMinutes());
	t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
	t = t.replace(/ss/g,this.getSeconds());
	t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
	t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
	t = t.replace(/wYYYY/g,this.getYearForWeekNo());
	t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
	t = t.replace(/YYYY/g,this.getFullYear());
	t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
	t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
	t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
	t = t.replace(/MM/g,this.getMonth()+1);
	t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
	t = t.replace(/WW/g,this.getWeek());
	t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
	t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
	t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
	t = t.replace(/DDth/g,this.getDate()+this.daySuffix());
	t = t.replace(/DD/g,this.getDate());
	var tz = this.getTimezoneOffset();
	var atz = Math.abs(tz);
	t = t.replace(/TZD/g,(tz < 0 ? '+' : '-') + String.zeroPad(Math.floor(atz / 60),2) + ':' + String.zeroPad(atz % 60,2));
	t = t.replace(/\\/g,"");
	return t;
};

Date.prototype.getWeek = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo
	var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000);
	return Math.floor(n/7)+1;
};

Date.prototype.getYearForWeekNo = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week
	return dt.getFullYear();
};

Date.prototype.getHours12 = function()
{
	var h = this.getHours();
	return h > 12 ? h-12 : ( h > 0 ? h : 12 );
};

Date.prototype.getAmPm = function()
{
	return this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;
};

Date.prototype.daySuffix = function()
{
	return config.messages.dates.daySuffixes[this.getDate()-1];
};

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
	return this.getFullYear() + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2);
};

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2);
};

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),4);
};

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	var hh = d.substr(8,2) || "00";
	var mm = d.substr(10,2) || "00";
	return new Date(Date.UTC(parseInt(d.substr(0,4),10),
			parseInt(d.substr(4,2),10)-1,
			parseInt(d.substr(6,2),10),
			parseInt(hh,10),
			parseInt(mm,10),0,0));
};

//--
//-- Crypto functions and associated conversion routines
//--

// Crypto 'namespace'
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
	var be=[];
	var len=Math.floor(str.length/4);
	var i, j;
	for(i=0, j=0; i<len; i++, j+=4) {
		be[i]=((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
	}
	while(j<str.length) {
		be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
		j++;
	}
	return be;
};

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
	var str='';
	for(var i=0;i<be.length*32;i+=8) {
		str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
	}
	return str;
};

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
	var hex='0123456789ABCDEF';
	var str='';
	for(var i=0;i<be.length*4;i++) {
		str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
	}
	return str;
};

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
	return Crypto.be32sToHex(Crypto.sha1Str(str));
};

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
	return Crypto.sha1(Crypto.strToBe32s(str),str.length);
};

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
	// Add 32-bit integers, wrapping at 32 bits
	function add32(a,b)
	{
		var lsw=(a&0xFFFF)+(b&0xFFFF);
		var msw=(a>>16)+(b>>16)+(lsw>>16);
		return (msw<<16)|(lsw&0xFFFF);
	}
	function AA(a,b,c,d,e)
	{
		b=(b>>>27)|(b<<5);
		var lsw=(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
		var msw=(a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
		return (msw<<16)|(lsw&0xFFFF);
	}
	function RR(w,j)
	{
		var n=w[j-3]^w[j-8]^w[j-14]^w[j-16];
		return (n>>>31)|(n<<1);
	}

	var len=blen*8;
	x[len>>5] |= 0x80 << (24-len%32);
	x[((len+64>>9)<<4)+15]=len;
	var w=new Array(80);

	var k1=0x5A827999;
	var k2=0x6ED9EBA1;
	var k3=0x8F1BBCDC;
	var k4=0xCA62C1D6;

	var h0=0x67452301;
	var h1=0xEFCDAB89;
	var h2=0x98BADCFE;
	var h3=0x10325476;
	var h4=0xC3D2E1F0;

	for(var i=0;i<x.length;i+=16) {
		var j=0;
		var t;
		var a=h0;
		var b=h1;
		var c=h2;
		var d=h3;
		var e=h4;
		while(j<16) {
			w[j]=x[i+j];
			t=AA(e,a,d^(b&(c^d)),w[j],k1);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
		}
		while(j<20) {
			w[j]=RR(w,j);
			t=AA(e,a,d^(b&(c^d)),w[j],k1);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
		}
		while(j<40) {
			w[j]=RR(w,j);
			t=AA(e,a,b^c^d,w[j],k2);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
		}
		while(j<60) {
			w[j]=RR(w,j);
			t=AA(e,a,(b&c)|(d&(b|c)),w[j],k3);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
		}
		while(j<80) {
			w[j]=RR(w,j);
			t=AA(e,a,b^c^d,w[j],k4);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
		}
		h0=add32(h0,a);
		h1=add32(h1,b);
		h2=add32(h2,c);
		h3=add32(h3,d);
		h4=add32(h4,e);
	}
	return [h0,h1,h2,h3,h4];
};

//--
//-- RGB colour object
//--

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string") {
		if(r.substr(0,1) == "#") {
			if(r.length == 7) {
				this.r = parseInt(r.substr(1,2),16)/255;
				this.g = parseInt(r.substr(3,2),16)/255;
				this.b = parseInt(r.substr(5,2),16)/255;
			} else {
				this.r = parseInt(r.substr(1,1),16)/15;
				this.g = parseInt(r.substr(2,1),16)/15;
				this.b = parseInt(r.substr(3,1),16)/15;
			}
		} else {
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/;
			var c = r.match(rgbPattern);
			if(c) {
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
			}
		}
	} else {
		this.r = r;
		this.g = g;
		this.b = b;
	}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
};

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	return "#" + ("0" + Math.floor(this.r.clamp(0,1) * 255).toString(16)).right(2) +
				 ("0" + Math.floor(this.g.clamp(0,1) * 255).toString(16)).right(2) +
				 ("0" + Math.floor(this.b.clamp(0,1) * 255).toString(16)).right(2);
};

//--
//-- DOM utilities - many derived from www.quirksmode.org
//--

function drawGradient(place,horiz,locolors,hicolors)
{
	if(!hicolors)
		hicolors = locolors;
	for(var t=0; t<= 100; t+=2) {
		var bar = document.createElement("div");
		place.appendChild(bar);
		bar.style.position = "absolute";
		bar.style.left = horiz ? t + "%" : 0;
		bar.style.top = horiz ? 0 : t + "%";
		bar.style.width = horiz ? (101-t) + "%" : "100%";
		bar.style.height = horiz ? "100%" : (101-t) + "%";
		bar.style.zIndex = -1;
		var p = t/100*(locolors.length-1);
		bar.style.backgroundColor = hicolors[Math.floor(p)].mix(locolors[Math.ceil(p)],p-Math.floor(p)).toString();
	}
}

function createTiddlyText(parent,text)
{
	return parent.appendChild(document.createTextNode(text));
}

function createTiddlyCheckbox(parent,caption,checked,onChange)
{
	var cb = document.createElement("input");
	cb.setAttribute("type","checkbox");
	cb.onclick = onChange;
	parent.appendChild(cb);
	cb.checked = checked;
	cb.className = "chkOptionInput";
	if(caption)
		wikify(caption,parent);
	return cb;
}

function createTiddlyElement(parent,element,id,className,text,attribs)
{
	var e = document.createElement(element);
	if(className != null)
		e.className = className;
	if(id != null)
		e.setAttribute("id",id);
	if(text != null)
		e.appendChild(document.createTextNode(text));
	if(attribs) {
		for(var n in attribs) {
			e.setAttribute(n,attribs[n]);
		}
	}
	if(parent != null)
		parent.appendChild(e);
	return e;
}

function addEvent(obj,type,fn)
{
	if(obj.attachEvent) {
		obj['e'+type+fn] = fn;
		obj[type+fn] = function(){obj['e'+type+fn](window.event);};
		obj.attachEvent('on'+type,obj[type+fn]);
	} else {
		obj.addEventListener(type,fn,false);
	}
}

function removeEvent(obj,type,fn)
{
	if(obj.detachEvent) {
		obj.detachEvent('on'+type,obj[type+fn]);
		obj[type+fn] = null;
	} else {
		obj.removeEventListener(type,fn,false);
	}
}

function addClass(e,className)
{
	var currClass = e.className.split(" ");
	if(currClass.indexOf(className) == -1)
		e.className += " " + className;
}

function removeClass(e,className)
{
	var currClass = e.className.split(" ");
	var i = currClass.indexOf(className);
	while(i != -1) {
		currClass.splice(i,1);
		i = currClass.indexOf(className);
	}
	e.className = currClass.join(" ");
}

function hasClass(e,className)
{
	if(e.className && e.className.split(" ").indexOf(className) != -1) {
		return true;
	}
	return false;
}

// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e,value,name,relative)
{
	name = name || "tagName";
	relative = relative || "parentNode";
	if(name == "className") {
		while(e && !hasClass(e,value)) {
			e = e[relative];
		}
	} else {
		while(e && e[name] != value) {
			e = e[relative];
		}
	}
	return e;
}

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if(e.target)
		obj = e.target;
	else if(e.srcElement)
		obj = e.srcElement;
	if(obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return obj;
}

// Prevent an event from bubbling
function stopEvent(e)
{
	var ev = e || window.event;
	ev.cancelBubble = true;
	if(ev.stopPropagation) ev.stopPropagation();
	return false;
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
	var text = "";
	if(e.innerText)
		text = e.innerText;
	else if(e.textContent)
		text = e.textContent;
	return text;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop) {
		return posTop;
	} else if(posBot > winBot) {
		if(e.offsetHeight < winHeight)
			return posTop - (winHeight - e.offsetHeight);
		else
			return posTop;
	} else {
		return winTop;
	}
}

// Get the current width of the display window
function findWindowWidth()
{
	return window.innerWidth || document.documentElement.clientWidth;
}

// Get the current height of the display window
function findWindowHeight()
{
	return window.innerHeight || document.documentElement.clientHeight;
}

// Get the current horizontal page scroll position
function findScrollX()
{
	return window.scrollX || document.documentElement.scrollLeft;
}

// Get the current vertical page scroll position
function findScrollY()
{
	return window.scrollY || document.documentElement.scrollTop;
}

function findPosX(obj)
{
	var curleft = 0;
	while(obj.offsetParent) {
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
	}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while(obj.offsetParent) {
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
	}
	return curtop;
}

// Blur a particular element
function blurElement(e)
{
	if(e && e.focus && e.blur) {
		e.focus();
		e.blur();
	}
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Remove all children of a node
function removeChildren(e)
{
	while(e && e.hasChildNodes())
		removeNode(e.firstChild);
}

// Remove a node and all it's children
function removeNode(e)
{
	scrubNode(e);
	e.parentNode.removeChild(e);
}

// Remove any event handlers or non-primitve custom attributes
function scrubNode(e)
{
	if(!config.browser.isIE)
		return;
	var att = e.attributes;
	if(att) {
		for(var t=0; t<att.length; t++) {
			var n = att[t].name;
			if(n !== 'style' && (typeof e[n] === 'function' || (typeof e[n] === 'object' && e[n] != null))) {
				try {
					e[n] = null;
				} catch(ex) {
				}
			}
		}
	}
	var c = e.firstChild;
	while(c) {
		scrubNode(c);
		c = c.nextSibling;
	}
}

// Add a stylesheet, replacing any previous custom stylesheet
function setStylesheet(s,id,doc)
{
	if(!id)
		id = "customStyleSheet";
	if(!doc)
		doc = document;
	var n = doc.getElementById(id);
	if(doc.createStyleSheet) {
		// Test for IE's non-standard createStyleSheet method
		if(n)
			n.parentNode.removeChild(n);
		// This failed without the &nbsp;
		doc.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style id='" + id + "'>" + s + "</style>");
	} else {
		if(n) {
			n.replaceChild(doc.createTextNode(s),n.firstChild);
		} else {
			n = doc.createElement("style");
			n.type = "text/css";
			n.id = id;
			n.appendChild(doc.createTextNode(s));
			doc.getElementsByTagName("head")[0].appendChild(n);
		}
	}
}

function removeStyleSheet(id)
{
	var e = document.getElementById(id);
	if(e)
		e.parentNode.removeChild(e);
}

// Force the browser to do a document reflow when needed to workaround browser bugs
function forceReflow()
{
	if(config.browser.isGecko) {
		setStylesheet("body {top:0px;margin-top:0px;}","forceReflow");
		setTimeout(function() {setStylesheet("","forceReflow");},1);
	}
}

// Replace the current selection of a textarea or text input and scroll it into view
function replaceSelection(e,text)
{
	if(e.setSelectionRange) {
		var oldpos = e.selectionStart;
		var isRange = e.selectionEnd > e.selectionStart;
		e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionEnd);
		e.setSelectionRange(isRange ? oldpos : oldpos + text.length,oldpos + text.length);
		var linecount = e.value.split('\n').length;
		var thisline = e.value.substr(0,e.selectionStart).split('\n').length-1;
		e.scrollTop = Math.floor((thisline - e.rows / 2) * e.scrollHeight / linecount);
	} else if(document.selection) {
		var range = document.selection.createRange();
		if(range.parentElement() == e) {
			var isCollapsed = range.text == "";
			range.text = text;
			if(!isCollapsed) {
				range.moveStart('character', -text.length);
				range.select();
			}
		}
	}
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
	var t = "";
	while(e && e.nodeName == "#text") {
		t += e.nodeValue;
		e = e.nextSibling;
	}
	return t;
}

// Returns true if the element e has a given ancestor element
function isDescendant(e,ancestor)
{
	while(e) {
		if(e === ancestor)
			return true;
		e = e.parentNode;
	}
	return false;
}

//--
//-- LoaderBase and SaverBase
//--

function LoaderBase() {}

LoaderBase.prototype.loadTiddler = function(store,node,tiddlers)
{
	var title = this.getTitle(store,node);
	if(safeMode && store.isShadowTiddler(title))
		return;
	if(title) {
		var tiddler = store.createTiddler(title);
		this.internalizeTiddler(store,tiddler,title,node);
		tiddlers.push(tiddler);
	}
};

LoaderBase.prototype.loadTiddlers = function(store,nodes)
{
	var tiddlers = [];
	for(var t = 0; t < nodes.length; t++) {
		try {
			this.loadTiddler(store,nodes[t],tiddlers);
		} catch(ex) {
			showException(ex,config.messages.tiddlerLoadError.format([this.getTitle(store,nodes[t])]));
		}
	}
	return tiddlers;
};

function SaverBase() {}

SaverBase.prototype.externalize = function(store)
{
	var results = [];
	var tiddlers = store.getTiddlers("title");
	for(var t = 0; t < tiddlers.length; t++) {
		if(!tiddlers[t].doNotSave())
			results.push(this.externalizeTiddler(store, tiddlers[t]));
	}
	return results.join("\n");
};

//--
//-- TW21Loader (inherits from LoaderBase)
//--

function TW21Loader() {}

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store,node)
{
	var title = null;
	if(node.getAttribute) {
		title = node.getAttribute("title");
		if(!title)
			title = node.getAttribute("tiddler");
	}
	if(!title && node.id) {
		var lenPrefix = store.idPrefix.length;
		if(node.id.substr(0,lenPrefix) == store.idPrefix)
			title = node.id.substr(lenPrefix);
	}
	return title;
};

TW21Loader.prototype.internalizeTiddler = function(store,tiddler,title,node)
{
	var e = node.firstChild;
	var text = null;
	if(node.getAttribute("tiddler")) {
		text = getNodeText(e).unescapeLineBreaks();
	} else {
		while(e.nodeName!="PRE" && e.nodeName!="pre") {
			e = e.nextSibling;
		}
		text = e.innerHTML.replace(/\r/mg,"").htmlDecode();
	}
	var modifier = node.getAttribute("modifier");
	var c = node.getAttribute("created");
	var m = node.getAttribute("modified");
	var created = c ? Date.convertFromYYYYMMDDHHMM(c) : version.date;
	var modified = m ? Date.convertFromYYYYMMDDHHMM(m) : created;
	var tags = node.getAttribute("tags");
	var fields = {};
	var attrs = node.attributes;
	for(var i = attrs.length-1; i >= 0; i--) {
		var name = attrs[i].name;
		if(attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
			fields[name] = attrs[i].value.unescapeLineBreaks();
		}
	}
	tiddler.assign(title,text,modifier,modified,tags,created,fields);
	return tiddler;
};

//--
//-- TW21Saver (inherits from SaverBase)
//--

function TW21Saver() {}

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store,tiddler)
{
	try {
		var extendedAttributes = "";
		var usePre = config.options.chkUsePreForStorage;
		store.forEachField(tiddler,
			function(tiddler,fieldName,value) {
				// don't store stuff from the temp namespace
				if(typeof value != "string")
					value = "";
				if(!fieldName.match(/^temp\./))
					extendedAttributes += ' %0="%1"'.format([fieldName,value.escapeLineBreaks().htmlEncode()]);
			},true);
		var created = tiddler.created;
		var modified = tiddler.modified;
		var attributes = tiddler.modifier ? ' modifier="' + tiddler.modifier.htmlEncode() + '"' : "";
		attributes += (usePre && created == version.date) ? "" :' created="' + created.convertToYYYYMMDDHHMM() + '"';
		attributes += (usePre && modified == created) ? "" : ' modified="' + modified.convertToYYYYMMDDHHMM() +'"';
		var tags = tiddler.getTags();
		if(!usePre || tags)
			attributes += ' tags="' + tags.htmlEncode() + '"';
		return ('<div %0="%1"%2%3>%4</'+'div>').format([
				usePre ? "title" : "tiddler",
				tiddler.title.htmlEncode(),
				attributes,
				extendedAttributes,
				usePre ? "\n<pre>" + tiddler.text.htmlEncode() + "</pre>\n" : tiddler.text.escapeLineBreaks().htmlEncode()
			]);
	} catch (ex) {
		throw exceptionText(ex,config.messages.tiddlerSaveError.format([tiddler.title]));
	}
};

//]]>
</script>
<script type="text/javascript">
//<![CDATA[
if(useJavaSaver)
	document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
</script>
<!--POST-SCRIPT-START-->

<!--POST-SCRIPT-END-->
</body>
</html>
